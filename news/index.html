<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DIBDash - Defense Industrial Base Intelligence</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Atkinson+Hyperlegible+Next:ital,wght@0,200..800;1,200..800&display=swap" rel="stylesheet">
    <style>
:root {
    --bg-primary: #f4f6f3;
    --bg-secondary: #eef2ed;
    --bg-tertiary: #e8ede6;
    --surface: #f8faf7;
    --border-light: #e2e7e0;
    --border-medium: #d4dbd2;
    --text-primary: #2a3028;
    --text-secondary: #4a524a;
    --text-tertiary: #6b736b;
    --text-quaternary: #8b938b;
    --accent-subtle: #3d4f3d;
    --accent-muted: #5a6e5a;
    --shadow-soft: rgba(45, 55, 45, 0.03);
    --shadow-medium: rgba(45, 55, 45, 0.06);
    --category-defense: #4a6b4a;
    --category-industry: #5a5e6b;
    --category-government: #6b5a3d;
    --fresh-accent: #4a7c59;
    --breaking-accent: #7c4a4a;
    --ink-green: #3d4f3d;
    --ink-grey: #5a625a;
    --paper-white: #f9fbf8;
    --paper-cream: #f6f8f5;
}

body.dark-mode {
    --bg-primary: #1e211e;
    --bg-secondary: #252925;
    --bg-tertiary: #2c302c;
    --surface: #222622;
    --border-light: #3a403a;
    --border-medium: #4c524c;
    --text-primary: #e0e5e0;
    --text-secondary: #b0b5b0;
    --text-tertiary: #808580;
    --text-quaternary: #606560;
    --accent-subtle: #6a806a;
    --accent-muted: #8ab08a;
    --shadow-soft: rgba(0, 0, 0, 0.1);
    --shadow-medium: rgba(0, 0, 0, 0.2);
    --fresh-accent: #72a683;
    --breaking-accent: #b07a7a;
    --ink-green: #6a806a;
    --ink-grey: #8a8e8a;
    --paper-white: #202420;
    --paper-cream: #282c28;
}

* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Atkinson Hyperlegible Next', sans-serif;
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.4;
    font-size: 13px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    letter-spacing: -0.005em;
    transition: background-color 0.3s ease;
}

.container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 10px;
}

/* Header */
header {
    padding: 10px 0 6px 0;
    border-bottom: 1px solid var(--border-light);
    margin-bottom: 8px;
}

.header-content {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.header-left {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
    gap: 1px;
}

h1 {
    font-size: 15px;
    font-weight: 600;
    color: var(--text-primary);
    letter-spacing: -0.01em;
}

.current-date {
    font-size: 8px;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 400;
    margin-top: 1px;
    margin-bottom: 1px;
}

.greeting {
    font-size: 8px;
    color: var(--text-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 400;
    display: flex;
    align-items: center;
    gap: 5px;
}

.last-updated {
    font-size: 8px;
    color: var(--text-quaternary);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 400;
    margin-top: 1px;
}

.contextual-message {
    font-size: 9px;
    color: var(--accent-muted);
    font-style: italic;
    margin-top: 2px;
}

.header-right {
    display: flex;
    gap: 6px;
    align-items: center;
}

.action-btn {
    background: none;
    border: 1px solid var(--border-medium);
    color: var(--text-tertiary);
    padding: 4px 8px;
    border-radius: 12px;
    cursor: pointer;
    font-family: inherit;
    font-size: 9px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 4px;
    white-space: nowrap;
}

.action-btn:hover {
    background: var(--bg-secondary);
    border-color: var(--border-medium);
    color: var(--text-secondary);
}

.action-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.refresh-btn.loading svg {
    animation: gentleSpin 2s linear infinite;
}

/* 🚀 SPEED READER STYLES */
.speed-reader-section {
    background: var(--surface);
    border: 1px solid var(--border-light);
    border-radius: 12px;
    margin-bottom: 20px;
    padding: 16px;
    box-shadow: var(--shadow-medium);
}

.speed-reader-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
}

.speed-reader-title {
    font-size: 12px;
    font-weight: 600;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 8px;
}

.reading-speed-indicator {
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    background: var(--fresh-accent);
    color: white;
}

.speed-reader-controls {
    display: flex;
    gap: 8px;
    margin-bottom: 16px;
}

.speed-control-btn {
    background: none;
    border: 1px solid var(--border-medium);
    color: var(--text-tertiary);
    padding: 4px 8px;
    border-radius: 8px;
    cursor: pointer;
    font-family: inherit;
    font-size: 9px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    transition: all 0.2s ease;
}

.speed-control-btn:hover {
    background: var(--bg-secondary);
    color: var(--text-secondary);
}

.speed-control-btn.active {
    background: var(--accent-subtle);
    border-color: var(--accent-subtle);
    color: white;
}

.speed-articles-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 12px;
}

.speed-article {
    background: var(--bg-secondary);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    padding: 16px;
    cursor: pointer;
    transition: all 0.2s ease;
    position: relative;
}

.speed-article:hover {
    box-shadow: var(--shadow-medium);
    transform: translateY(-1px);
    border-color: var(--accent-muted);
}

.speed-article.reading {
    border-color: var(--fresh-accent);
    background: var(--paper-white);
}

.speed-article-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
}

.speed-article-meta {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 8px;
    color: var(--text-quaternary);
    text-transform: uppercase;
    letter-spacing: 0.08em;
}

.speed-reading-time {
    background: var(--fresh-accent);
    color: white;
    padding: 2px 6px;
    border-radius: 8px;
    font-size: 7px;
    font-weight: 600;
}

.speed-relevance {
    padding: 2px 6px;
    border-radius: 8px;
    font-size: 7px;
    font-weight: 600;
}

.relevance-high {
    background: var(--breaking-accent);
    color: white;
}

.relevance-medium {
    background: var(--accent-muted);
    color: white;
}

.relevance-low {
    background: var(--fresh-accent);
    color: white;
}

.speed-headline {
    font-size: 14px;
    font-weight: 600;
    color: var(--text-primary);
    line-height: 1.3;
    margin-bottom: 12px;
    letter-spacing: -0.01em;
}

.speed-key-facts {
    margin-bottom: 12px;
}

.speed-key-facts h4 {
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--accent-subtle);
    margin-bottom: 6px;
}

.speed-fact {
    font-size: 11px;
    color: var(--text-secondary);
    margin-bottom: 3px;
    padding-left: 8px;
    position: relative;
}

.speed-fact::before {
    content: "▸";
    position: absolute;
    left: 0;
    color: var(--accent-muted);
    font-size: 10px;
}

.speed-reading-chunks {
    display: none;
    line-height: 1.6;
    font-size: 13px;
    margin-top: 12px;
    padding: 12px;
    background: var(--paper-white);
    border-radius: 6px;
    border: 1px solid var(--border-light);
}

.speed-reading-chunks.active {
    display: block;
}

.reading-chunk {
    display: inline;
    margin-right: 8px;
    transition: all 0.3s ease;
}

.reading-chunk.highlight {
    background: linear-gradient(120deg, #84fab0 0%, #8fd3f4 100%);
    padding: 2px 4px;
    border-radius: 3px;
    font-weight: 600;
}

.reading-chunk.bold {
    font-weight: 700;
    color: var(--text-primary);
}

.reading-chunk.current {
    background: var(--fresh-accent);
    color: white;
    padding: 2px 4px;
    border-radius: 3px;
    font-weight: 600;
    animation: highlightPulse 0.6s ease-in-out;
}

.power-words {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    margin-top: 8px;
}

.power-word {
    background: var(--accent-subtle);
    color: white;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.speed-article-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 12px;
    padding-top: 8px;
    border-top: 1px solid var(--border-light);
}

.speed-read-btn {
    background: var(--fresh-accent);
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 16px;
    cursor: pointer;
    font-family: inherit;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all 0.2s ease;
}

.speed-read-btn:hover {
    background: var(--accent-subtle);
    transform: translateY(-1px);
}

.speed-read-btn.reading {
    background: var(--breaking-accent);
}

.full-article-link {
    color: var(--text-tertiary);
    text-decoration: none;
    font-size: 9px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    transition: color 0.2s ease;
}

.full-article-link:hover {
    color: var(--accent-muted);
}

.reading-progress-bar {
    height: 2px;
    background: var(--border-light);
    border-radius: 1px;
    overflow: hidden;
    margin-top: 8px;
}

.reading-progress-fill {
    height: 100%;
    background: var(--fresh-accent);
    width: 0%;
    transition: width 0.3s ease;
}

/* Category filters */
.filters {
    display: flex;
    gap: 6px;
    margin-bottom: 12px;
    flex-wrap: wrap;
    align-items: center;
}

.filter-tab {
    background: none;
    border: 1px solid var(--border-medium);
    color: var(--text-tertiary);
    padding: 4px 10px;
    border-radius: 16px;
    cursor: pointer;
    font-family: inherit;
    font-size: 9px;
    font-weight: 400;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    transition: all 0.2s ease;
    white-space: nowrap;
}

.filter-tab:hover {
    background: var(--bg-secondary);
    border-color: var(--border-medium);
    color: var(--text-secondary);
}

.filter-tab.active {
    background: var(--text-primary);
    border-color: var(--text-primary);
    color: var(--bg-primary);
}

.fresh-count {
    font-size: 8px;
    background: var(--fresh-accent);
    color: white;
    padding: 1px 4px;
    border-radius: 8px;
    margin-left: 4px;
}

/* Article grid */
.article-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 6px;
    transition: gap 0.3s ease;
}

.article {
    background: var(--surface);
    padding: 12px;
    transition: all 0.3s ease;
    border: 1px solid var(--border-light);
    border-radius: 6px;
    box-shadow: var(--shadow-soft);
    display: flex;
    flex-direction: column;
    height: fit-content;
    position: relative;
}

.article:hover {
    box-shadow: var(--shadow-medium);
    transform: translateY(-1px);
    border-color: var(--border-medium);
}

.article-meta {
    display: flex;
    align-items: center;
    gap: 5px;
    margin-bottom: 6px;
    font-size: 8px;
    color: var(--text-quaternary);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 400;
}

.article-source {
    color: var(--accent-muted);
    font-weight: 500;
}

.article-source.defense { color: var(--category-defense); }
.article-source.industry { color: var(--category-industry); }
.article-source.government { color: var(--category-government); }

.article-separator {
    width: 2px;
    height: 2px;
    background: var(--text-quaternary);
    border-radius: 50%;
}

.article-time {
    color: var(--text-quaternary);
}

.reading-time {
    font-size: 7px;
    color: var(--text-quaternary);
    margin-left: auto;
}

.article-title {
    font-size: 13px;
    font-weight: 500;
    color: var(--text-primary);
    line-height: 1.3;
    margin-bottom: 5px;
    letter-spacing: -0.01em;
}

.article-description {
    font-size: 11px;
    color: var(--text-secondary);
    line-height: 1.4;
    font-weight: 300;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    flex-grow: 1;
}

.article-actions {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    gap: 8px;
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px solid var(--border-light);
}

.article-action-button {
    background: var(--surface);
    border: 1px solid var(--border-medium);
    color: var(--text-secondary);
    padding: 6px 12px;
    border-radius: 20px;
    cursor: pointer;
    font-family: inherit;
    font-size: 10px;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    transition: all 0.2s ease;
    white-space: nowrap;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 6px;
}

.article-action-button:hover {
    background: var(--bg-secondary);
    border-color: var(--accent-muted);
}

/* Stock Ticker */
.stock-ticker-section {
    margin-bottom: 20px;
    background: var(--surface);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    box-shadow: var(--shadow-soft);
    padding: 8px 12px;
    overflow: hidden;
    position: relative;
}

.stock-ticker-header {
    font-size: 8px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-tertiary);
    margin-bottom: 8px;
}

.ticker-scroll-wrapper {
    position: relative;
    white-space: nowrap;
    overflow: hidden;
}

.ticker-scroll-content {
    display: inline-block;
    animation: tickerScroll 120s linear infinite;
    will-change: transform;
}

.stock-item {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 0 16px;
}

.stock-ticker {
    font-size: 10px;
    font-weight: 600;
    color: var(--text-primary);
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.stock-price {
    font-size: 10px;
    color: var(--text-secondary);
}

.stock-percent-change {
    font-size: 9px;
    font-weight: 500;
    margin-left: -4px;
}

.stock-change-positive {
    color: #28a745;
}

.stock-change-negative {
    color: #dc3545;
}

/* Contract Awards Section */
.contracts-section {
    margin-bottom: 20px;
    padding: 12px 0;
    border-bottom: 2px solid var(--border-light);
}

.contracts-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
}

.contracts-title {
    font-size: 12px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--text-primary);
    display: flex;
    align-items: center;
    gap: 6px;
}

.contracts-summary {
    font-size: 10px;
    color: var(--text-tertiary);
}

.contracts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 8px;
    margin-bottom: 10px;
}

.agency-card {
    background: var(--surface);
    border: 1px solid var(--border-light);
    border-radius: 8px;
    padding: 12px;
    cursor: pointer;
    transition: all 0.2s ease;
}

.agency-card:hover {
    box-shadow: 0 2px 8px var(--shadow-medium);
    transform: translateY(-1px);
    border-color: var(--border-medium);
}

/* Date groups */
.date-group {
    margin-bottom: 16px;
}

.date-group-header {
    font-size: 10px;
    font-weight: 500;
    color: var(--text-secondary);
    text-transform: uppercase;
    letter-spacing: 0.1em;
    margin-bottom: 8px;
    padding-left: 2px;
    border-bottom: 1px solid var(--border-light);
    padding-bottom: 4px;
}

/* States and animations */
.empty-state {
    grid-column: 1 / -1;
    text-align: center;
    padding: 30px 10px;
    color: var(--text-tertiary);
}

.loading {
    grid-column: 1 / -1;
    text-align: center;
    padding: 15px;
    color: var(--text-tertiary);
    font-size: 9px;
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-weight: 400;
}

.loading-message {
    animation: fadeInOut 2s ease infinite;
}

.error-message {
    background: #fef9f9;
    border: 1px solid #f5e6e6;
    color: var(--text-secondary);
    padding: 6px 10px;
    border-radius: 4px;
    margin-bottom: 8px;
    font-size: 10px;
    display: none;
    text-align: center;
    font-weight: 300;
}

.reading-progress {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 1px;
    background: var(--border-light);
    z-index: 100;
}

.progress-bar {
    height: 100%;
    background: linear-gradient(90deg, var(--accent-subtle), var(--accent-muted));
    width: 0%;
    transition: width 0.1s ease;
}

.toast {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%) translateY(100px);
    background: var(--surface);
    border: 1px solid var(--border-medium);
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 10px;
    color: var(--text-primary);
    box-shadow: 0 2px 8px var(--shadow-medium);
    opacity: 0;
    transition: all 0.3s ease;
    z-index: 1001;
}

.toast.visible {
    transform: translateX(-50%) translateY(0);
    opacity: 1;
}

/* Footer */
footer {
    margin-top: 40px;
    border-top: 1px solid var(--border-light);
    padding: 20px 0;
    background: var(--bg-secondary);
}

.footer-content {
    display: flex;
    flex-direction: column;
    gap: 12px;
    align-items: center;
    text-align: center;
}

.footer-about p {
    font-size: 11px;
    color: var(--text-secondary);
    line-height: 1.4;
    font-weight: 300;
    max-width: 500px;
    margin: 0 auto;
}

.share-link {
    font-size: 10px;
    color: var(--accent-muted);
    text-decoration: none;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 400;
    padding: 6px 12px;
    border: 1px solid var(--border-medium);
    border-radius: 16px;
    transition: all 0.2s ease;
    background: var(--surface);
}

.share-link:hover {
    background: var(--bg-tertiary);
    border-color: var(--accent-muted);
    color: var(--text-primary);
    transform: translateY(-1px);
}

.footer-copyright p {
    font-size: 9px;
    color: var(--text-quaternary);
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-weight: 400;
}

/* Responsive */
@media (min-width: 1200px) {
    .article-grid {
        grid-template-columns: repeat(4, 1fr);
    }
}

@media (min-width: 900px) and (max-width: 1199px) {
    .article-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (min-width: 600px) and (max-width: 899px) {
    .article-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 599px) {
    .container {
        padding: 0 10px;
    }
    
    .header-content {
        flex-direction: column;
        gap: 4px;
        align-items: flex-start;
    }
    
    .article-grid {
        grid-template-columns: 1fr;
        gap: 8px;
    }
    
    .speed-reader-section {
        padding: 12px;
    }
    
    .speed-articles-grid {
        gap: 8px;
    }
    
    .speed-article {
        padding: 12px;
    }
    
    .speed-headline {
        font-size: 12px;
    }
    
    .speed-reading-chunks {
        font-size: 12px;
    }
}

/* Animations */
@keyframes fadeInOut {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

@keyframes gentleSpin {
    to { transform: rotate(360deg); }
}

@keyframes tickerScroll {
    from { transform: translateX(0%); }
    to { transform: translateX(-50%); }
}

@keyframes highlightPulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.7; }
}

html {
    scroll-behavior: smooth;
}
    </style>
</head>
<body>
   <div class="reading-progress">
       <div class="progress-bar" id="progressBar"></div>
   </div>
   
   <div class="container">
       <header>
           <div class="header-content">
               <div class="header-left">
                   <h1>🚀 DIBDash - Defense Industrial Base Intelligence</h1>
                   <div class="current-date" id="currentDate"></div>
                   <div class="greeting" id="greeting"></div>
                   <div class="last-updated" id="lastUpdated">Loading...</div>
                   <div class="contextual-message" id="contextualMessage"></div>
               </div>
   
               <div class="header-right">
                   <button class="action-btn" id="darkModeToggle">
                       <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                           <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                       </svg>
                       Dark Mode
                   </button>
                   <button class="action-btn refresh-btn" id="refreshBtn">
                       <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                           <path d="M21 2v6h-6M3 12a9 9 0 0 1 15-6.7L21 8M3 22v-6h6M21 12a9 9 0 0 1-15 6.7L3 16"/>
                       </svg>
                       Refresh
                   </button>
               </div>
           </div>
       </header>
       
       <div class="filters" id="filterContainer">
	   <button class="filter-tab active" data-filter="all">All</button>
      </div>
      
      <div class="error-message" id="errorMessage"></div>
      <div id="content">
          <div class="article-grid">
              <div class="loading">
                  <div class="loading-message" id="loadingMessage">Gathering intelligence...</div>
              </div>
          </div>
      </div>
      
      <footer>
          <div class="footer-content">
              <div class="footer-about">
                  <p>Curated intelligence for Defense professionals, enhanced with speed reading optimization.</p>
              </div>
              <div class="footer-links">
                  <a href="#" class="share-link" id="shareLink">Share With a Friend.</a>
              </div>
              <div class="footer-copyright">
                  <p>&copy; 2025 DIBDash.com. All rights reserved.</p>
              </div>
          </div>
      </footer>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <script>
      // 🚀 SPEED READER CONFIGURATION
      const S3_JSON_URL = 'https://askarti-daily-data.s3.us-east-1.amazonaws.com/daily-news.json';
      const MAIN_LAMBDA_URL = 'YOUR_MAIN_LAMBDA_URL_HERE'; // Replace with your actual Lambda URL
      
      // State
      let articles = [];
      let currentFilter = 'all';
      let isLoading = false;
      let focusMode = false;
      let scrollPosition = 0;
      let speedReaderData = null;
      let currentReadingArticle = null;
      let readingInterval = null;
      let readingSpeed = 250; // words per minute
      let stockData = [];
      let currentContractsData = null;
      
      // Loading messages
      const loadingMessages = [
          "Gathering intelligence...",
          "Scanning defense channels...",
          "Checking industry updates...",
          "Analyzing government feeds...",
          "Optimizing for speed reading...",
          "Almost there...",
          "Compiling your briefing..."
      ];
      let loadingMessageIndex = 0;
      
      // Empty state messages by category
      const emptyStateMessages = {
          defense: ["Intel is quiet today", "All quiet on the defense front", "Defense channels are silent"],
          industry: ["Markets taking a breather", "Industry in stealth mode", "No industry updates"],
          government: ["Capitol Hill is unusually quiet", "Government on pause", "No government activity"],
          all: ["No updates at the moment", "Channels are quiet", "Nothing new to report"]
      };
      
      // UI Elements
      const content = document.getElementById('content');
      const refreshBtn = document.getElementById('refreshBtn');
      const errorMessage = document.getElementById('errorMessage');
      const filterContainer = document.getElementById('filterContainer');
      const lastUpdated = document.getElementById('lastUpdated');
      const greeting = document.getElementById('greeting');
      const currentDateElement = document.getElementById('currentDate');
      const progressBar = document.getElementById('progressBar');
      const shareLink = document.getElementById('shareLink');
      const contextualMessage = document.getElementById('contextualMessage');
      const loadingMessage = document.getElementById('loadingMessage');
      const toast = document.getElementById('toast');
      
      // 🚀 SPEED READER FUNCTIONS
      
      // Fetch speed reader articles
      async function fetchSpeedReaderArticles(forceGenerate = false) {
          try {
              console.log('🚀 Fetching speed reader articles...');
              
              let requestBody;
              if (forceGenerate) {
                  requestBody = {
                      situation: "Process articles for speed reading",
                      mode: "speed-reader"
                  };
              } else {
                  requestBody = {
                      situation: "Get existing speed reader articles", 
                      mode: "get-speed-reader"
                  };
              }
              
              const response = await fetch(MAIN_LAMBDA_URL, {
                  method: 'POST',
                  headers: {
                      'Content-Type': 'application/json'
                  },
                  body: JSON.stringify(requestBody)
              });
              
              if (!response.ok) {
                  if (response.status === 404 && !forceGenerate) {
                      console.log('🚀 No existing speed reader articles, generating...');
                      return await fetchSpeedReaderArticles(true);
                  }
                  throw new Error(`HTTP ${response.status}`);
              }
              
              const result = await response.json();
              
              if (result.success) {
                  console.log('✅ Speed reader articles fetched successfully');
                  return result;
              } else {
                  throw new Error(result.error || 'Failed to fetch speed reader articles');
              }
              
          } catch (error) {
              console.error('❌ Error fetching speed reader articles:', error);
              return null;
          }
      }
      
      // Create speed reader section in DOM
      function createSpeedReaderSection() {
          const filtersElement = document.getElementById('filterContainer');
          if (!filtersElement) return;
          
          const speedReaderHtml = `
              <div class="speed-reader-section" id="speedReaderSection">
                  <div class="speed-reader-header">
                      <div class="speed-reader-title">
                          <span class="icon">🚀</span>
                          <span>Speed Reader</span>
                      </div>
                      <div style="display: flex; align-items: center; gap: 8px;">
                          <div class="reading-speed-indicator">
                              AVG: <span id="avgReadingTime">30 sec</span>
                          </div>
                          <button class="action-btn" id="speedReaderRefreshBtn">
                              <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                  <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                              </svg>
                              Refresh
                          </button>
                      </div>
                  </div>
                  
                  <div class="speed-reader-controls">
                      <button class="speed-control-btn" data-speed="200">Slow</button>
                      <button class="speed-control-btn active" data-speed="250">Normal</button>
                      <button class="speed-control-btn" data-speed="300">Fast</button>
                      <button class="speed-control-btn" data-speed="400">Rapid</button>
                  </div>
                  
                  <div class="speed-articles-grid" id="speedArticlesContainer">
                      <div style="text-align: center; padding: 20px; color: var(--text-tertiary);">
                          Loading speed-optimized articles...
                      </div>
                  </div>
              </div>
          `;
          
          filtersElement.insertAdjacentHTML('afterend', speedReaderHtml);
          setupSpeedReaderControls();
      }
      
      // Setup speed reader controls
      function setupSpeedReaderControls() {
          // Speed control buttons
          document.querySelectorAll('.speed-control-btn').forEach(btn => {
              btn.addEventListener('click', function() {
                  document.querySelectorAll('.speed-control-btn').forEach(b => b.classList.remove('active'));
                  this.classList.add('active');
                  readingSpeed = parseInt(this.dataset.speed);
              });
          });
          
          // Refresh button
          const refreshBtn = document.getElementById('speedReaderRefreshBtn');
          if (refreshBtn) {
              refreshBtn.addEventListener('click', async () => {
                  refreshBtn.disabled = true;
                  refreshBtn.innerHTML = 'Processing...';
                  
                  try {
                      const freshData = await fetchSpeedReaderArticles(true);
                      if (freshData) {
                          renderSpeedReaderSection(freshData);
                          showToast('🚀 Fresh speed reader articles generated');
                      }
                  } catch (error) {
                      showToast('❌ Failed to refresh speed reader');
                  } finally {
                      refreshBtn.disabled = false;
                      refreshBtn.innerHTML = `
                          <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M21 12a9 9 0 1 1-6.219-8.56"/>
                          </svg>
                          Refresh
                      `;
                  }
              });
          }
      }
      
      // Render speed reader section
      function renderSpeedReaderSection(speedData) {
          if (!speedData || !speedData.articles || speedData.articles.length === 0) {
              return;
          }
          
          speedReaderData = speedData;
          
          const articlesContainer = document.getElementById('speedArticlesContainer');
          if (!articlesContainer) return;
          
          const articlesHtml = speedData.articles.map((article, index) => {
              const speedReader = article.speed_reader;
              if (!speedReader) return '';
              
              return `
                  <div class="speed-article" data-article-index="${index}">
                      <div class="speed-article-header">
                          <div class="speed-article-meta">
                              <span class="article-source ${getCategoryClass(article.category)}">${article.source}</span>
                              <span class="article-separator">•</span>
                              <span>${timeAgo(article.pubDate)}</span>
                          </div>
                          <div style="display: flex; gap: 4px;">
                              <span class="speed-reading-time">${speedReader.time_to_read}</span>
                              <span class="speed-relevance relevance-${speedReader.business_relevance || 'medium'}">
                                  ${(speedReader.business_relevance || 'medium').toUpperCase()}
                              </span>
                          </div>
                      </div>
                      
                      <h3 class="speed-headline">${speedReader.headline_optimized || article.title}</h3>
                      
                      ${speedReader.key_facts && speedReader.key_facts.length > 0 ? `
                          <div class="speed-key-facts">
                              <h4>Key Facts</h4>
                              ${speedReader.key_facts.map(fact => `<div class="speed-fact">${fact}</div>`).join('')}
                          </div>
                      ` : ''}
                      
                      <div class="speed-reading-chunks" id="chunks-${index}">
                          ${speedReader.reading_chunks ? speedReader.reading_chunks.map((chunk, chunkIndex) => `
                              <span class="reading-chunk ${chunk.emphasis}" data-chunk-index="${chunkIndex}">
                                  ${chunk.text}
                              </span>
                          `).join('') : ''}
                      </div>
                      
                      ${speedReader.power_words && speedReader.power_words.length > 0 ? `
                          <div class="power-words">
                              ${speedReader.power_words.map(word => `<span class="power-word">${word}</span>`).join('')}
                          </div>
                      ` : ''}
                      
                      <div class="speed-article-actions">
                          <button class="speed-read-btn" onclick="startSpeedReading(${index})">
                              🚀 Speed Read
                          </button>
                          <a href="${article.link}" target="_blank" class="full-article-link">Full Article</a>
                      </div>
                      
                      <div class="reading-progress-bar">
                          <div class="reading-progress-fill" id="progress-${index}"></div>
                      </div>
                  </div>
              `;
          }).join('');
          
          articlesContainer.innerHTML = articlesHtml;
          
          // Update header info
          const avgTime = document.getElementById('avgReadingTime');
          if (avgTime) {
              avgTime.textContent = speedData.avg_reading_time || '30 seconds';
          }
          
          console.log('✅ Speed reader section rendered');
      }
      
      // Start speed reading for an article
      function startSpeedReading(articleIndex) {
          const article = document.querySelector(`[data-article-index="${articleIndex}"]`);
          const chunksContainer = document.getElementById(`chunks-${articleIndex}`);
          const progressBar = document.getElementById(`progress-${articleIndex}`);
          const readBtn = article.querySelector('.speed-read-btn');
          
          if (currentReadingArticle === articleIndex) {
              // Stop reading
              stopSpeedReading();
              return;
          }
          
          // Stop any current reading
          stopSpeedReading();
          
          currentReadingArticle = articleIndex;
          article.classList.add('reading');
          chunksContainer.classList.add('active');
          readBtn.textContent = '⏸ Pause';
          readBtn.classList.add('reading');
          
          const chunks = chunksContainer.querySelectorAll('.reading-chunk');
          let currentChunkIndex = 0;
          
          // Calculate reading interval based on speed
          const wordsPerChunk = 3; // Average words per chunk
          const intervalMs = (wordsPerChunk / readingSpeed) * 60000; // Convert to milliseconds
          
          function highlightNextChunk() {
              // Remove current highlighting
              chunks.forEach(chunk => chunk.classList.remove('current'));
              
              if (currentChunkIndex < chunks.length) {
                  // Highlight current chunk
                  chunks[currentChunkIndex].classList.add('current');
                  
                  // Update progress
                  const progress = ((currentChunkIndex + 1) / chunks.length) * 100;
                  progressBar.style.width = `${progress}%`;
                  
                  // Scroll chunk into view
                  chunks[currentChunkIndex].scrollIntoView({
                      behavior: 'smooth',
                      block: 'center',
                      inline: 'nearest'
                  });
                  
                  currentChunkIndex++;
              } else {
                  // Finished reading
                  stopSpeedReading();
                  showToast('✅ Article completed!');
              }
          }
          
          // Start the reading interval
          readingInterval = setInterval(highlightNextChunk, intervalMs);
          
          // Highlight first chunk immediately
          highlightNextChunk();
      }
      
      // Stop speed reading
      function stopSpeedReading() {
          if (readingInterval) {
              clearInterval(readingInterval);
              readingInterval = null;
          }
          
          if (currentReadingArticle !== null) {
              const article = document.querySelector(`[data-article-index="${currentReadingArticle}"]`);
              const chunksContainer = document.getElementById(`chunks-${currentReadingArticle}`);
              const readBtn = article.querySelector('.speed-read-btn');
              
              article.classList.remove('reading');
              chunksContainer.classList.remove('active');
              readBtn.textContent = '🚀 Speed Read';
              readBtn.classList.remove('reading');
              
              // Remove all chunk highlighting
              const chunks = chunksContainer.querySelectorAll('.reading-chunk');
              chunks.forEach(chunk => chunk.classList.remove('current'));
              
              currentReadingArticle = null;
          }
      }
      
      // UTILITY FUNCTIONS
      
      function timeAgo(dateString) {
          const now = new Date();
          const date = new Date(dateString);
          const seconds = Math.floor((now - date) / 1000);
          if (seconds < 60) return 'now';
          const minutes = Math.floor(seconds / 60);
          if (minutes < 60) return `${minutes}m`;
          const hours = Math.floor(minutes / 60);
          if (hours < 24) return `${hours}h`;
          const days = Math.floor(hours / 24);
          if (days < 7) return `${days}d`;
          return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
      }
      
      function getCategoryClass(category) {
          return category ? category.toLowerCase() : '';
      }
      
      function getFreshnessClass(dateString) {
          const hours = (new Date() - new Date(dateString)) / 3600000;
          if (hours < 2) return 'fresh';
          if (hours < 6) return 'recent';
          return '';
      }
      
      function getArticleHints(article) {
          const hints = [];
          const hours = (new Date() - new Date(article.pubDate)) / 3600000;
          if (hours < 1) hints.push('⚡');
          if (article.characteristics?.includes('data')) hints.push('📊');
          if (article.characteristics?.includes('longread')) hints.push('📖');
          if (article.characteristics?.includes('tech')) hints.push('🔬');
          return hints;
      }
      
      function showToast(message, duration = 2000) {
          toast.textContent = message;
          toast.classList.add('visible');
          setTimeout(() => {
              toast.classList.remove('visible');
          }, duration);
      }
      
      function setGreetingAndDate() {
          const now = new Date();
          const hour = now.getHours();
          const day = now.getDay();
          
          let greetingText = 'Good Morning';
          if (hour >= 12 && hour < 17) {
              greetingText = 'Good Afternoon';
          } else if (hour >= 17) {
              greetingText = 'Good Evening';
          }
          
          const weekendEmoji = (day === 0 || day === 6) ? '<span class="weekend-emoji">☕</span>' : '';
          
          const options = { weekday: 'short', day: 'numeric', month: 'long', year: 'numeric' };
          const formattedDate = now.toLocaleDateString('en-US', options);
          
          currentDateElement.textContent = formattedDate;
          greeting.innerHTML = `${greetingText}. Welcome to the Loop. ${weekendEmoji}`;
          
          contextualMessage.textContent = getContextualMessage(now);
      }
      
      function getContextualMessage(now) {
          const day = now.getDay();
          const hour = now.getHours();
          
          if (day === 1 && hour < 10) return "Monday briefing ready";
          if (day === 5 && hour > 15) return "Weekend preview";
          if (hour > 20) return "Evening digest";
          if (hour < 7) return "Early bird briefing";
          if (day === 0 || day === 6) return "Weekend reading";
          return "";
      }
      
      function updateReadingProgress() {
          const scrollTop = window.pageYOffset;
          const docHeight = document.body.scrollHeight - window.innerHeight;
          const scrollPercent = (scrollTop / docHeight) * 100;
          progressBar.style.width = Math.min(scrollPercent, 100) + '%';
      }
      
      function saveScrollPosition() {
          scrollPosition = window.pageYOffset;
      }
      
      function restoreScrollPosition() {
          if (scrollPosition > 0) {
              setTimeout(() => {
                  window.scrollTo({ top: scrollPosition, behavior: 'smooth' });
              }, 100);
          }
      }
      
      // DARK MODE
      const darkModeToggle = document.getElementById('darkModeToggle');
      const body = document.body;
      
      function enableDarkMode() {
          body.classList.add('dark-mode');
          darkModeToggle.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> Light Mode`;
          localStorage.setItem('theme', 'dark');
      }
      
      function disableDarkMode() {
          body.classList.remove('dark-mode');
          darkModeToggle.innerHTML = `<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg> Dark Mode`;
          localStorage.setItem('theme', 'light');
      }
      
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'dark') {
          enableDarkMode();
      } else {
          disableDarkMode();
      }
      
      darkModeToggle.addEventListener('click', () => {
          if (body.classList.contains('dark-mode')) {
              disableDarkMode();
          } else {
              enableDarkMode();
          }
      });
      
      // GROUP ARTICLES BY DATE
      function groupArticlesByDate(articles) {
          const now = new Date();
          const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
          const yesterday = new Date(today.getTime() - 24 * 60 * 60 * 1000);
          const thisWeek = new Date(today.getTime() - 7 * 24 * 60 * 60 * 1000);
          
          const groups = {
              today: { label: 'Today', articles: [] },
              yesterday: { label: 'Yesterday', articles: [] },
              thisWeek: { label: 'This Week', articles: [] },
              older: { label: 'Earlier', articles: [] }
          };
          
          articles.forEach(article => {
              const articleDate = new Date(article.pubDate);
              const articleDay = new Date(articleDate.getFullYear(), articleDate.getMonth(), articleDate.getDate());
              
              if (articleDay.getTime() === today.getTime()) {
                  groups.today.articles.push(article);
              } else if (articleDay.getTime() === yesterday.getTime()) {
                  groups.yesterday.articles.push(article);
              } else if (articleDay.getTime() >= thisWeek.getTime()) {
                  groups.thisWeek.articles.push(article);
              } else {
                  groups.older.articles.push(article);
              }
          });
          
          return groups;
      }
      
      // FETCH ARTICLES
      async function fetchArticles() {
          try {
              const response = await fetch(S3_JSON_URL + '?t=' + Date.now());
              if (!response.ok) throw new Error(`HTTP ${response.status}`);
              const data = await response.json();
              
              if (data.summary?.timestamp) {
                  lastUpdated.textContent = `Updated ${timeAgo(data.summary.timestamp)}`;
              }
              
              currentContractsData = data.contracts || null;
              
              return data.items || [];
          } catch (error) {
              console.error('Error fetching articles:', error);
              throw error;
          }
      }
      
      // CREATE FILTERS
      function createFilters() {
          const categories = [...new Set(articles.map(a => a.category))].filter(Boolean).sort();
          
          const freshCounts = {};
          articles.forEach(article => {
              if (getFreshnessClass(article.pubDate) === 'fresh') {
                  freshCounts[article.category] = (freshCounts[article.category] || 0) + 1;
                  freshCounts['all'] = (freshCounts['all'] || 0) + 1;
              }
          });
          
          filterContainer.innerHTML = `
              <button class="filter-tab ${currentFilter === 'all' ? 'active' : ''}" data-filter="all">
                  All ${freshCounts['all'] ? `<span class="fresh-count">${freshCounts['all']}</span>` : ''}
              </button>
              ${categories.map(category => `
                  <button class="filter-tab ${getCategoryClass(category)} ${currentFilter === category ? 'active' : ''}" data-filter="${category}">
                      ${category.charAt(0).toUpperCase() + category.slice(1)}
                      ${freshCounts[category] ? `<span class="fresh-count">${freshCounts[category]}</span>` : ''}
                  </button>
              `).join('')}
          `;
          
          document.querySelectorAll('.filter-tab').forEach(tab => {
              tab.addEventListener('click', function() {
                  document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                  this.classList.add('active');
                  currentFilter = this.dataset.filter;
                  saveScrollPosition();
                  renderArticles();
                  restoreScrollPosition();
              });
          });
      }
      
      // STOCK TICKER
      const GOOGLE_SHEETS_URL = 'https://docs.google.com/spreadsheets/d/1svXheHx4C1XVLITnVsW7nbT0v-B8tJxDviZG-Op2v58/gviz/tq?tqx=out:csv&sheet=Sheet1';

      async function fetchStockData() {
          try {
              const response = await fetch(GOOGLE_SHEETS_URL + '&t=' + Date.now());
              if (!response.ok) {
                  throw new Error(`Failed to fetch Google Sheet data: ${response.statusText}`);
              }
              const csv = await response.text();
              const lines = csv.split('\n');
              
              let tickerIndex = -1;
              let priceIndex = -1;
              let percentChangeIndex = -1;
              
              const headers = lines[0].split(',');
              for (let i = 0; i < headers.length; i++) {
                  const header = headers[i].trim().replace(/^"|"$/g, '');
                  if (header === 'Ticker') {
                      tickerIndex = i;
                  }
                  if (header === 'Price') {
                      priceIndex = i;
                  }
                  if (header === 'Change%') {
                      percentChangeIndex = i;
                  }
              }
              
              if (tickerIndex === -1 || priceIndex === -1 || percentChangeIndex === -1) {
                  console.error('Error: Could not find required headers in the Google Sheet.');
                  return [];
              }

              const data = [];
              for (let i = 1; i < lines.length; i++) {
                  const values = lines[i].split(',').map(value => value.trim().replace(/^"|"$/g, ''));
                  if (values.length > tickerIndex && values.length > priceIndex && values.length > percentChangeIndex) {
                      const percentChangeValue = values[percentChangeIndex].replace(/[^0-9.-]/g, '');
                      
                      data.push({
                          ticker: values[tickerIndex],
                          price: parseFloat(values[priceIndex].replace(/[^0-9.]/g, '')),
                          percentChange: parseFloat(percentChangeValue)
                      });
                  }
              }
              return data;
          } catch (error) {
              console.error('Error fetching stock data:', error);
              return [];
          }
      }

      function getStockTickerHtml() {
          if (stockData.length === 0) {
              return '';
          }
          
          const stockItemsHtml = stockData.map(stock => {
              const changeClass = stock.percentChange >= 0 ? 'stock-change-positive' : 'stock-change-negative';
              const changeSign = stock.percentChange >= 0 ? '+' : '';

              return `
                  <div class="stock-item">
                      <span class="stock-ticker">${stock.ticker}</span>
                      <span class="stock-price">$${stock.price.toFixed(2)}</span>
                      <span class="stock-percent-change ${changeClass}">${changeSign}${stock.percentChange.toFixed(2)}%</span>
                  </div>
              `;
          }).join('');

          const tickerContent = stockItemsHtml + stockItemsHtml;

          return `
              <div class="stock-ticker-section">
                  <div class="stock-ticker-header">
                      DIB Stocks (20-minute delay)
                  </div>
                  <div class="ticker-scroll-wrapper">
                      <div class="ticker-scroll-content">
                          ${tickerContent}
                      </div>
                  </div>
              </div>
          `;
      }
      
      // CONTRACT FUNCTIONS (simplified for space)
      function formatCurrency(value) {
          if (value >= 1000000000) return `$${(value / 1000000000).toFixed(1)}B`;
          if (value >= 1000000) return `$${(value / 1000000).toFixed(1)}M`;
          if (value >= 1000) return `$${(value / 1000).toFixed(0)}K`;
          return `$${value}`;
      }

      function renderContractsSection(contractsData) {
          if (!contractsData || !contractsData.agencies) {
              return '';
          }
          
          const insights = contractsData.insights || {
              totalContracts: 0,
              totalValue: 0,
          };
          
          // Simplified contracts rendering - just show summary for space
          return `
              <div class="contracts-section">
                  <div class="contracts-header">
                      <div class="contracts-title">
                          Contract Awards This Week
                      </div>
                      <div class="contracts-summary">
                          ${insights.totalContracts || 0} contracts • ${formatCurrency(insights.totalValue || 0)} total
                      </div>
                  </div>
              </div>
          `;
      }
      
      // RENDER ARTICLES WITH SPEED READER
      async function renderArticles() {
          stockData = await fetchStockData();

          const filtered = currentFilter === 'all' 
              ? articles 
              : articles.filter(a => a.category === currentFilter);
          
          let html = '';
          
          // Show speed reader section only on 'all' filter
          const speedSection = document.getElementById('speedReaderSection');
          if (speedSection) {
              speedSection.style.display = currentFilter === 'all' ? 'block' : 'none';
          }
          
          if (currentContractsData && currentFilter === 'all') {
              html += renderContractsSection(currentContractsData);
          }

          if (currentFilter === 'all') {
              html += getStockTickerHtml();
          }
          
          if (filtered.length === 0) {
              const messages = emptyStateMessages[currentFilter] || emptyStateMessages['all'];
              const randomMessage = messages[Math.floor(Math.random() * messages.length)];
              
              html += `
                  <div class="article-grid">
                      <div class="empty-state">
                          <div class="icon">📋</div>
                          <h3>${randomMessage}</h3>
                          <p>Try another filter or check back later.</p>
                      </div>
                  </div>
              `;
          } else {
              const groups = groupArticlesByDate(filtered);
              const dateGroups = Object.entries(groups);

              dateGroups.forEach(([key, group]) => {
                  if (group.articles.length > 0) {
                      html += `
					  <div class="date-group">
                              <div class="date-group-header">${group.label}</div>
                              <div class="article-grid">
                                  ${group.articles.map((article, index) => {
                                      const freshnessClass = getFreshnessClass(article.pubDate);
                                      const hints = getArticleHints(article);
                                      const readingTime = article.readingTime || 2;
                                      
                                      const linkedInUrl = `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(article.link)}`;
                                      
                                      return `
                                          <article class="article ${freshnessClass}" 
                                                   data-index="${index}"
                                                   tabindex="0" 
                                                   role="article" 
                                                   aria-label="Article: ${article.title}">
                                              <div class="article-meta">
                                                  <span class="article-source ${getCategoryClass(article.category)}">${article.source}</span>
                                                  <div class="article-separator"></div>
                                                  <span class="article-time">${timeAgo(article.pubDate)}</span>
                                                  ${hints.length > 0 ? `
                                                      <div class="article-hints">
                                                          ${hints.map(h => `<span class="hint-emoji"></span>`).join('')}
                                                      </div>
                                                  ` : ''}
                                                  <span class="reading-time">${readingTime} min</span>
                                              </div>
                                              <h2 class="article-title">${article.title}</h2>
                                              <p class="article-description">${article.description || 'Read more for details.'}</p>
                                              <div class="article-actions">
                                                  <a href="${article.link}" target="_blank" class="article-action-button">Read More</a>
                                                  <a href="${linkedInUrl}" target="_blank" class="article-action-button">
                                                      Share on LinkedIn
                                                  </a>
                                              </div>
                                          </article>
                                      `;
                                  }).join('')}
                              </div>
                          </div>
                      `;
                  }
              });
          }

          content.innerHTML = html;
          
          document.querySelectorAll('.article').forEach(article => {
              article.addEventListener('keydown', function(e) {
                  if (e.key === 'Enter' || e.key === ' ') {
                      e.preventDefault();
                  }
              });
              
              article.addEventListener('dblclick', function(e) {
                  e.preventDefault();
                  toggleFocusMode(this);
              });
          });
      }
      
      function toggleFocusMode(articleElement) {
          if (focusMode) {
              document.body.classList.remove('focus-mode');
              document.querySelectorAll('.article').forEach(a => a.classList.remove('focused'));
              focusMode = false;
          } else {
              document.body.classList.add('focus-mode');
              articleElement.classList.add('focused');
              focusMode = true;
          }
      }
      
      function cycleLoadingMessage() {
          if (isLoading) {
              loadingMessage.textContent = loadingMessages[loadingMessageIndex];
              loadingMessageIndex = (loadingMessageIndex + 1) % loadingMessages.length;
              setTimeout(cycleLoadingMessage, 800);
          }
      }
      
      // ENHANCED REFRESH FEED WITH SPEED READER
      async function refreshFeed() {
          if (isLoading) return;
          
          isLoading = true;
          refreshBtn.classList.add('loading');
          refreshBtn.disabled = true;
          errorMessage.style.display = 'none';
          
          loadingMessageIndex = 0;
          cycleLoadingMessage();
          
          try {
              const fetchedArticles = await fetchArticles();
              articles = fetchedArticles;
              
              stockData = await fetchStockData();
              
              // Fetch speed reader articles
              const speedData = await fetchSpeedReaderArticles();
              
              createFilters();
              await renderArticles();
              
              // Render speed reader section if we have data and on 'all' filter
              if (speedData && currentFilter === 'all') {
                  if (!document.getElementById('speedReaderSection')) {
                      createSpeedReaderSection();
                  }
                  renderSpeedReaderSection(speedData);
              }
              
              showToast('🚀 Feed refreshed with speed reader optimization');
              
          } catch (error) {
              errorMessage.style.display = 'block';
              errorMessage.textContent = 'Unable to load content. Please check your connection.';
              content.innerHTML = `
                  <div class="article-grid">
                      <div class="empty-state">
                          <div class="icon">📡</div>
                          <h3>Connection Issue</h3>
                          <p>Having trouble reaching sources. Please try again.</p>
                      </div>
                  </div>
              `;
          } finally {
              isLoading = false;
              refreshBtn.classList.remove('loading');
              refreshBtn.disabled = false;
          }
      }
      
      // KEYBOARD SHORTCUTS
      document.addEventListener('keydown', function(e) {
          if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') return;
          
          // S: Toggle speed reader or start reading first article
          if (e.key === 's' || e.key === 'S') {
              e.preventDefault();
              if (currentReadingArticle !== null) {
                  stopSpeedReading();
              } else if (speedReaderData && speedReaderData.articles.length > 0) {
                  startSpeedReading(0);
              }
          }
          
          // Space: Pause/resume speed reading
          if (e.key === ' ' && currentReadingArticle !== null) {
              e.preventDefault();
              if (readingInterval) {
                  stopSpeedReading();
              } else {
                  startSpeedReading(currentReadingArticle);
              }
          }
          
          // Arrow keys: Navigate between speed reader articles
          if ((e.key === 'ArrowLeft' || e.key === 'ArrowRight') && speedReaderData) {
              e.preventDefault();
              const maxIndex = speedReaderData.articles.length - 1;
              let nextIndex = 0;
              
              if (currentReadingArticle !== null) {
                  if (e.key === 'ArrowRight') {
                      nextIndex = Math.min(currentReadingArticle + 1, maxIndex);
                  } else {
                      nextIndex = Math.max(currentReadingArticle - 1, 0);
                  }
              }
              
              stopSpeedReading();
              startSpeedReading(nextIndex);
          }
          
          // F: Focus on filters
          if (e.key === 'f' || e.key === 'F') {
              e.preventDefault();
              const nextFilter = document.querySelector('.filter-tab:not(.active)');
              if (nextFilter) nextFilter.click();
          }
          
          // R: Refresh
          if (e.key === 'r' || e.key === 'R') {
              e.preventDefault();
              refreshFeed();
          }
          
          // ESC: Exit focus mode or stop reading
          if (e.key === 'Escape') {
              if (currentReadingArticle !== null) {
                  stopSpeedReading();
              } else if (focusMode) {
                  document.body.classList.remove('focus-mode');
                  document.querySelectorAll('.article').forEach(a => a.classList.remove('focused'));
                  focusMode = false;
              }
          }
      });
      
      // SETUP SHARE
      function setupShare() {
          shareLink.addEventListener('click', function(e) {
              e.preventDefault();
              if (navigator.share) {
                  navigator.share({
                      title: 'DIBDash - Defense Industrial Base Intelligence',
                      text: 'Check out DIBDash - AI-powered speed reading for defense professionals',
                      url: window.location.href
                  }).catch(err => console.log('Error sharing:', err));
              } else {
                  navigator.clipboard.writeText(window.location.href).then(() => {
                      showToast('Link copied!');
                  }).catch(() => {
                      const subject = encodeURIComponent('Check out DIBDash');
                      const body = encodeURIComponent('Speed reading for defense intelligence: ' + window.location.href);
                      window.open(`mailto:?subject=${subject}&body=${body}`);
                  });
              }
          });
      }
      
      // INITIALIZATION
      setGreetingAndDate();
      refreshFeed();
      setupShare();
      
      // Event listeners
      window.addEventListener('scroll', updateReadingProgress);
      window.addEventListener('beforeunload', saveScrollPosition);
      refreshBtn.addEventListener('click', refreshFeed);
      
      // Update greeting every hour
      setInterval(setGreetingAndDate, 3600000);
      
      // Auto-refresh every 15 minutes if page is visible and not reading
      setInterval(() => {
          if (!document.hidden && !isLoading && currentReadingArticle === null) {
              refreshFeed();
          }
      }, 15 * 60 * 1000);
      
      // Initialize speed reader on page load
      document.addEventListener('DOMContentLoaded', function() {
          console.log('🚀 Initializing speed reader system...');
          
          // Load speed reader articles after main content loads
          setTimeout(async () => {
              const speedData = await fetchSpeedReaderArticles();
              if (speedData && currentFilter === 'all') {
                  if (!document.getElementById('speedReaderSection')) {
                      createSpeedReaderSection();
                  }
                  renderSpeedReaderSection(speedData);
              }
          }, 2000);
          
          console.log('✅ Speed reader system initialized');
      });
      
      // Auto-refresh speed reader articles periodically
      setInterval(() => {
          if (!document.hidden && !isLoading && currentReadingArticle === null) {
              fetchSpeedReaderArticles().then(speedData => {
                  if (speedData && currentFilter === 'all') {
                      renderSpeedReaderSection(speedData);
                  }
              });
          }
      }, 30 * 60 * 1000); // Every 30 minutes
      
      console.log('🚀 Speed reader system loaded successfully');
  </script>
</body>
</html>