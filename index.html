<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti.">
    <meta property="og:image" content="https://askarti.com/images/arti_right.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti.">
    <meta name="twitter:image" content="https://askarti.com/images/arti_right.png">
    
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/images/arti_right.png" as="image">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-purple': '#7C6BBE',
                        'brand-gray': {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            400: '#9CA3AF',
                            600: '#4B5563',
                            800: '#1F2937',
                            900: '#111827',
                        },
                        'brand-yellow': {
                            bg: '#FEF9C3',
                            text: '#854D0E',
                            border: '#FDE68A',
                        },
                        'brand-blue': {
                            bg: '#DBEAFE',
                            text: '#1E40AF',
                            border: '#BFDBFE',
                        },
                        'brand-green': {
                            bg: '#D1FAE5',
                            text: '#065F46',
                            border: '#A7F3D0',
                        }
                    }
                }
            }
        }
    </script>

<style>
    :root {
        --brand-purple: #7C6BBE;
        --brand-gray-50: #F9FAFB;
        --brand-gray-100: #F3F4F6;
        --brand-gray-800: #1F2937;
    }
    html {
        scroll-behavior: smooth;
    }
    body {
        background-color: var(--brand-gray-50);
        font-family: 'Inter', sans-serif;
        color: var(--brand-gray-800);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }
    .main-container {
        max-width: 768px;
        margin: 0 auto;
        padding: 1rem;
    }
    .fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    /* --- Card Styles --- */
    .io-card {
        background-color: white;
        border-radius: 1rem;
        border: 1px solid #E5E7EB;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.2s ease;
    }
    .io-card:focus-within {
        box-shadow: 0 0 0 2px var(--brand-purple);
    }
    .results-card {
        background-color: white;
        border-radius: 1rem;
        border: 1px solid #E5E7EB;
        overflow: hidden;
        margin-top: 1.5rem;
    }
    .results-card-header {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #E5E7EB;
    }
    .results-card-body {
        padding: 1.5rem;
    }
    /* --- Form Elements --- */
    textarea, input[type="text"] {
        font-size: 16px !important; /* Prevent iOS zoom */
        transition: all 0.2s ease;
    }
    .quick-prompt {
        transition: all 0.2s ease-in-out;
        border: 1px solid var(--brand-gray-100);
    }
    .quick-prompt:hover {
        transform: translateY(-2px);
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        border-color: #E5E7EB;
    }
    /* --- Buttons --- */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        border-radius: 0.75rem;
        padding: 0.75rem 1.5rem;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    .btn-primary {
        background-color: var(--brand-purple);
        color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .btn-primary:hover {
        background-color: #6959a7;
        transform: translateY(-1px);
    }
    .btn-secondary {
        background-color: white;
        color: #374151;
        border: 1px solid #D1D5DB;
    }
    .btn-secondary:hover {
        background-color: #F9FAFB;
        border-color: #9CA3AF;
    }
    /* --- Loader --- */
    .loader {
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        width: 1.25rem;
        height: 1.25rem;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    /* --- Chat specific styles --- */
    .chat-container {
        height: 60dvh;
        max-height: 500px;
        overflow-y: auto;
        padding: 1rem;
        background-color: #F9FAFB;
        border-radius: 1rem;
        border: 1px solid #E5E7EB;
    }
    .chat-message-user {
        background-color: var(--brand-purple);
        color: white;
        border-radius: 1rem 1rem 0.25rem 1rem;
    }
    .chat-message-arti {
        background-color: white;
        color: #1f2937;
        border: 1px solid #e5e7eb;
        border-radius: 1rem 1rem 1rem 0.25rem;
    }
    /* --- Responsive & Mobile --- */
    @media (max-width: 640px) {
        .main-container { padding: 0.75rem; }
        .io-card, .results-card-body { padding: 1rem; }
        .btn { padding: 0.625rem 1rem; font-size: 0.9rem; }
    }
</style>

</head>
<body class="bg-brand-gray-50">

   <div class="main-container pt-4 pb-20">
       
       <header class="text-center mb-4">
    <a href="/" aria-label="AskArti Home" class="inline-block">
        <img src="/images/asklite.png" alt="AskArti Logo" class="h-20 w-auto mx-auto sm:h-24">
    </a>
</header>

       <main id="main-content">
             <div id="quick-mode" class="mode-content fade-in">
                <div class="io-card">
                    <label for="situation-input" class="block text-md font-semibold text-brand-gray-800 mb-3">
                        What's your sales situation?
                    </label>
                    <textarea 
    id="situation-input" 
    rows="4" 
    class="w-full p-3 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-purple focus:border-brand-purple resize-none placeholder-gray-500"
    placeholder='e.g., Prospect for cyber opps at DHS. Include keywords like "Prospect" if you are hunting for pipeline or "Interview" if job hunting.'
    maxlength="2000"></textarea>
                    <div class="text-xs text-gray-500 mt-1.5 flex justify-between">
    <span class="hint-text">Enter a sales deal for a Game Plan, paste any press release or text for News or Market Analysis.</span>
    <span id="char-count">0/2000</span>
</div>

                    <div class="mt-4">
                        <p class="text-sm font-medium text-brand-gray-600 mb-2">Try an example prompt:</p>
                        <div class="flex flex-wrap gap-2">
                            <button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Buyer at VA ghosted me after I sent pricing. CISO loves our competitor.">Buyer Went Dark</button>
                            <button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Demo crashed at DOJ yesterday. CTO walked out. How to recover?">Demo Crashed</button>
							<button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Internal partner and account reps are fighting over customer access, pipeline, and revenue. Sales are hurting.">Partner Drama</button>
							<button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="I just took over as Director of DoD for Chiquita Bananas. Help me prospect for opps within Navy.">Prospecting</button>
                        </div>
                    </div>

                    <div class="mt-6 border-t border-gray-200 pt-4 flex flex-col sm:flex-row gap-3">
                        <button id="ask-btn" class="btn btn-primary w-full sm:w-auto flex-1">
                            <span id="btn-text">Game Plan</span>
                            <div id="loader" class="loader hidden"></div>
                        </button>
                        <button id="news-btn" class="btn btn-secondary w-full sm:w-auto">
                            <span id="news-btn-text">News Analysis</span>
                        </button>
                        <button id="investment-btn" class="btn btn-secondary w-full sm:w-auto" title="For best results, paste the full text of a press release or market news. This feature does not work with stock symbols alone.">
    <span>Market Analysis</span>
</button>
                        </div>
                </div>
            </div>
		
            <div id="chat-mode" class="mode-content hidden fade-in">
                <div class="io-card">
                    <div class="chat-container mb-4" id="chat-container">
                        <div id="chat-messages" class="space-y-4">
                            <div class="flex justify-start">
                                <div class="chat-message-arti p-3 text-sm max-w-[85%]">
                                    <p>Hey! I'm Arti. I can help with stuck deals, boss problems, or whatever's on your mind. If you need a structured plan, flip to the "Game Plans" tab.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" class="flex-1 p-3 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-purple focus:border-brand-purple" placeholder="Type your message..." maxlength="2000">
                        <button id="chat-send-btn" class="btn btn-primary px-4">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                </div>
            </div>
       </main>

        <div id="loading-message-container" class="text-center py-6 hidden">
            <p id="loading-message" class="text-gray-600 font-medium"></p>
        </div>
        <div id="error-message" class="bg-red-100 border border-red-300 rounded-lg p-4 text-center my-6 hidden">
            <p class="text-red-800 font-semibold mb-1">Something went wrong</p>
            <p class="text-red-700 text-sm" id="error-details">We're having trouble connecting to Arti.</p>
        </div>

       <div id="results-container" class="fade-in"></div>

       <div class="mt-12 text-center">
           <p class="text-sm text-gray-500 mb-2">Need something different? Switch modes.</p>
           <div class="io-card max-w-sm mx-auto p-2">
                <div class="flex bg-brand-gray-100 p-1 rounded-xl">
                    <button class="mode-btn flex-1 px-3 py-2 rounded-lg font-semibold text-sm transition-all active" data-mode="quick">
                        ⚡️ Game Plans
                    </button>
                    <button class="mode-btn flex-1 px-3 py-2 rounded-lg font-semibold text-sm transition-all" data-mode="chat">
                        💬 Chat with Arti
                    </button>
                </div>
           </div>
       </div>
       <footer class="text-center mt-12 text-xs text-gray-500">
            <div class="flex justify-center gap-4 mb-4">
                <a href="#" id="about-btn" class="font-medium text-brand-purple hover:underline">About AskArti</a>
                <a href="mailto:mark@subhoo.com" class="font-medium text-brand-purple hover:underline">Contact</a>
            </div>
            <p>© 2025 AskArti.com. Made for Federal Sellers by Federal Sellers.</p>
        </footer>

   </div>
   
   <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
       <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
           <div class="flex justify-between items-start mb-4">
               <h2 class="text-xl font-bold text-gray-900">About AskArti</h2>
               <button id="close-about" class="text-gray-400 hover:text-gray-600">
                   <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
               </button>
           </div>
           <div class="space-y-4 text-gray-700 text-sm">
               <p>AskArti is your 24/7 AI sales coach, designed for federal sales professionals. Get instant advice on stuck deals, meeting preparation, and sales strategy.</p>
               <div class="mt-4 pt-4 border-t">
                   <h3 class="font-semibold text-gray-800 mb-2">Privacy & Technology</h3>
                   <p class="text-gray-600">AskArti uses advanced AI models. We do not store, log, or persist any conversation data. All processing occurs in-memory and is discarded.</p>
               </div>
           </div>
       </div>
   </div>
<script>
// --- Mode Toggle Active State ---
const modeButtons = document.querySelectorAll('.mode-btn');
modeButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        modeButtons.forEach(b => b.classList.remove('active', 'bg-white', 'text-brand-purple'));
        btn.classList.add('active', 'bg-white', 'text-brand-purple');
        const inactiveBtn = [...modeButtons].find(b => !b.classList.contains('active'));
        if(inactiveBtn) {
            inactiveBtn.classList.add('text-gray-600');
            inactiveBtn.classList.remove('bg-white', 'text-brand-purple');
        }
    });
});
document.querySelector('.mode-btn[data-mode="quick"]').classList.add('bg-white', 'text-brand-purple');
document.querySelector('.mode-btn[data-mode="chat"]').classList.add('text-gray-600');


const CONFIG = {
  API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
  REQUEST_TIMEOUT: 30000,
  MAX_RETRIES: 2,
  RETRY_DELAY: 2000,
  MAX_INPUT_LENGTH: 2000,
  MIN_REQUEST_INTERVAL: 2000,
  LOADING_MESSAGES: [
      "Hang on. I'm...Working Backwards", 
      "...Diving Deep", 
      "...Unpacking This", 
      "...Putting a Pin in it", 
      "...Circling Back", 
      "...Thinking Big"
  ]
};

class AskArti {
  constructor() {
   this.elements = this.getElements();
   this.state = {
       pendingRequest: false,
       lastRequestTime: 0,
       loadingInterval: null,
       abortController: null,
       lastQuery: '',
       currentMode: 'quick',
       chatHistory: [],
   };
   this.init();
}

  getElements() {
      return {
          situationInput: document.getElementById('situation-input'),
          askBtn: document.getElementById('ask-btn'),
          newsBtn: document.getElementById('news-btn'),
          investmentBtn: document.getElementById('investment-btn'), // New element
          btnText: document.getElementById('btn-text'),
          loader: document.getElementById('loader'),
          charCount: document.getElementById('char-count'),
          loadingMessageContainer: document.getElementById('loading-message-container'),
          loadingMessage: document.getElementById('loading-message'),
          errorMessage: document.getElementById('error-message'),
          errorDetails: document.getElementById('error-details'),
          resultsContainer: document.getElementById('results-container'),
          aboutBtn: document.getElementById('about-btn'),
          aboutModal: document.getElementById('about-modal'),
          closeAbout: document.getElementById('close-about'),
          quickPromptBtns: document.querySelectorAll('.quick-prompt'),
          modeButtons: document.querySelectorAll('.mode-btn'),
          quickMode: document.getElementById('quick-mode'),
          chatMode: document.getElementById('chat-mode'),
          chatMessages: document.getElementById('chat-messages'),
          chatInput: document.getElementById('chat-input'),
          chatSendBtn: document.getElementById('chat-send-btn'),
      };
  }

  init() {
      mermaid.initialize({ startOnLoad: false, securityLevel: 'strict', theme: 'base', themeVariables: {
            primaryColor: '#F3F4F6',
            primaryTextColor: '#1F2937',
            primaryBorderColor: '#D1D5DB',
            lineColor: '#6B7280',
            textColor: '#111827',
            fontSize: '14px'
      }});
      this.setupEventListeners();
      this.elements.situationInput.focus();
      this.updateCharCount();
  }

    updateCharCount() {
        if (!this.elements.situationInput) return;
        const current = this.elements.situationInput.value.length;
        const max = CONFIG.MAX_INPUT_LENGTH;
        this.elements.charCount.textContent = `${current}/${max}`;
    }

    setupEventListeners() {
        this.elements.situationInput.addEventListener('input', () => this.updateCharCount());

        this.elements.quickPromptBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                this.elements.situationInput.value = e.currentTarget.dataset.text;
                this.updateCharCount();
                this.getAdvice();
            });
        });

        this.elements.askBtn.addEventListener('click', () => this.getAdvice());
        this.elements.newsBtn.addEventListener('click', () => this.getAdvice('news'));
        this.elements.investmentBtn.addEventListener('click', () => this.getAdvice('investment')); // New listener
        
        this.elements.situationInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.getAdvice();
            }
        });

        this.elements.aboutBtn.addEventListener('click', () => this.showModal());
        this.elements.closeAbout.addEventListener('click', () => this.hideModal());
        this.elements.aboutModal.addEventListener('click', (e) => {
            if (e.target === this.elements.aboutModal) this.hideModal();
        });
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') this.hideModal();
        });

        this.elements.modeButtons.forEach(btn => {
            btn.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode));
        });

        this.elements.chatSendBtn.addEventListener('click', () => this.sendChatMessage());
        this.elements.chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.sendChatMessage();
            }
        });
    }

    switchMode(mode) {
        this.state.currentMode = mode;
        this.elements.resultsContainer.innerHTML = '';
        this.elements.errorMessage.classList.add('hidden');
        this.hideLoadingMessages();

        if (mode === 'quick') {
            this.elements.quickMode.classList.remove('hidden');
            this.elements.chatMode.classList.add('hidden');
            this.elements.situationInput.focus();
        } else {
            this.elements.quickMode.classList.add('hidden');
            this.elements.chatMode.classList.remove('hidden');
            this.elements.chatInput.focus();
        }
    }

    addChatMessage(content, isUser = false) {
        let processedContent = isUser ? content : marked.parse(content.replace(/<action>(.*?)<\/action>/g, '<strong class="text-brand-purple">$1</strong>'));
        
        const messageClass = isUser ? 'chat-message-user justify-end' : 'chat-message-arti justify-start';
        const alignClass = isUser ? 'justify-end' : 'justify-start';

        const messageHtml = `
            <div class="flex ${alignClass} fade-in">
                <div class="${messageClass} p-3 text-sm max-w-[85%]">
                    ${processedContent}
                </div>
            </div>
        `;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
        this.scrollChatToBottom();
    }
    
    showTypingIndicator() {
        const typingHtml = `<div id="typing-indicator" class="flex justify-start"><div class="chat-message-arti p-3 text-sm">...</div></div>`;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
        this.scrollChatToBottom();
    }

    hideTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
    }

    scrollChatToBottom() {
        const chatContainer = document.getElementById('chat-container');
        if (chatContainer) {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
    }

    async sendChatMessage() {
        const message = this.elements.chatInput.value.trim();
        if (!message || this.state.pendingRequest) return;

        this.state.pendingRequest = true;
        this.addChatMessage(message, true);
        this.state.chatHistory.push({ role: 'user', content: message });
        this.elements.chatInput.value = '';
        this.showTypingIndicator();

        try {
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ situation: message, mode: 'chat', conversationHistory: this.state.chatHistory }),
            });
            if (!response.ok) throw new Error(`Server error (${response.status})`);
            
            const data = await response.json();
            this.hideTypingIndicator();
            this.addChatMessage(data.message);
            this.state.chatHistory.push({ role: 'assistant', content: data.message });

        } catch (error) {
            this.hideTypingIndicator();
            this.addChatMessage("Sorry, I'm having trouble connecting right now. Please try again in a moment.", false);
        } finally {
            this.state.pendingRequest = false;
        }
    }

    setLoading(loading) {
        this.state.pendingRequest = loading;
        this.elements.errorMessage.classList.add('hidden');

        if (loading) {
            this.elements.btnText.classList.add('hidden');
            this.elements.loader.classList.remove('hidden');
            this.elements.askBtn.disabled = true;
            this.elements.newsBtn.disabled = true;
            this.elements.investmentBtn.disabled = true; // Disable new button while loading
        } else {
            this.elements.btnText.classList.remove('hidden');
            this.elements.loader.classList.add('hidden');
            this.elements.askBtn.disabled = false;
            this.elements.newsBtn.disabled = false;
            this.elements.investmentBtn.disabled = false; // Enable new button
        }
    }

    showLoadingMessages() {
        this.elements.loadingMessageContainer.classList.remove('hidden');
        let i = 0;
        this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[i];
        this.state.loadingInterval = setInterval(() => {
            i = (i + 1) % CONFIG.LOADING_MESSAGES.length;
            this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[i];
        }, 2000);
    }

    hideLoadingMessages() {
        clearInterval(this.state.loadingInterval);
        this.elements.loadingMessageContainer.classList.add('hidden');
    }

    showError(message) {
        this.elements.errorMessage.classList.remove('hidden');
        this.elements.errorDetails.textContent = message;
        this.setLoading(false);
    }
    
    async getAdvice(forceType = null) {
        const situation = this.elements.situationInput.value.trim();
        if (!situation) { this.showError("Please enter your situation first."); return; }
        if (this.state.pendingRequest) return;
        
        this.state.pendingRequest = true;
        this.state.lastQuery = situation;
        this.elements.resultsContainer.innerHTML = '';
        this.setLoading(true);

        try {
            const body = { situation };
            if (forceType) body.forceType = forceType;

            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(body),
            });
            if (!response.ok) {
                 const error = new Error(`Server error: ${response.statusText}`);
                 error.response = response;
                 throw error;
            }
            
            const data = await response.json();
            if(data.error) throw new Error(data.message || data.error);
            
            this.displayAdvice(data);

        } catch (error) {
             console.error('Request failed:', error);
            if (error.response && typeof error.response.json === 'function') {
                error.response.json().then(errorData => {
                    this.showError(errorData.error || "An unknown error occurred.");
                }).catch(() => {
                    this.showError(error.message || "An unknown error occurred.");
                });
            } else {
                this.showError(error.message || "An unknown error occurred.");
            }
        } finally {
            this.setLoading(false);
        }
    }

    displayAdvice(data) {
        const { response_type } = data;
        let html = '';

        if (response_type === 'news') {
            html = this.renderNewsAdvice(data);
        } else if (response_type === 'investment') { // The backend type is still 'investment'
            html = this.renderMarketAnalysis(data); // Call the newly named function
        } else if (response_type === 'prospect') {
            html = this.renderProspectAdvice(data);
        } else {
            html = this.renderGeneralAdvice(data);
        }
        
        this.elements.resultsContainer.innerHTML = html;
        if (data.mermaid_chart) {
            this.renderMermaidChart();
        }
        this.elements.resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    renderMarketAnalysis(data) { // Renamed from renderInvestmentAdvice
        const {
            investment_thesis, financial_health, market_position, growth_catalysts,
            identified_risks, management_outlook, key_financial_metrics, bull_case, bear_case, next_steps
        } = data;

        return `
            <div class="results-card">
                <div class="results-card-header flex items-center gap-4 bg-brand-yellow-bg">
                    <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                    <h2 class="font-bold text-lg text-brand-yellow-text">Market Analysis Summary</h2>
                </div>
                <div class="results-card-body space-y-6">
                    <div class="p-4 bg-brand-yellow-bg/50 rounded-lg text-brand-yellow-text">
                        ${marked.parse(investment_thesis)}
                    </div>

                    <div>
                        <h3 class="font-semibold mb-2">Key Financial Metrics</h3>
                        <div class="flex flex-wrap gap-2">
                            ${key_financial_metrics && key_financial_metrics.length > 0 ? key_financial_metrics.map(metric => `
                                <span class="text-sm font-medium bg-gray-100 text-gray-800 px-3 py-1.5 rounded-lg">${metric}</span>`
                            ).join('') : '<p class="text-gray-500 text-sm">None mentioned.</p>'}
                        </div>
                    </div>

                    <div class="space-y-3 text-sm">
                        <p><strong>Financial Health:</strong> ${financial_health || 'Not detailed.'}</p>
                        <p><strong>Market Position:</strong> ${market_position || 'Not detailed.'}</p>
                        <p><strong>Management Outlook:</strong> ${management_outlook || 'Not detailed.'}</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                           <h4 class="font-semibold text-green-700 mb-3">📈 Growth Catalysts</h4>
                           <ul class="space-y-2 text-sm">${growth_catalysts && growth_catalysts.length > 0 ? growth_catalysts.map(c => `<li class="flex gap-2 items-start"><span class="text-green-500 mt-1">▲</span><span>${c}</span></li>`).join('') : '<li>None identified.</li>'}</ul>
                        </div>
                        <div>
                           <h4 class="font-semibold text-red-700 mb-3">🚨 Identified Risks</h4>
                           <ul class="space-y-2 text-sm">${identified_risks && identified_risks.length > 0 ? identified_risks.map(r => `<li class="flex gap-2 items-start"><span class="text-red-500 mt-1">▼</span><span>${r}</span></li>`).join('') : '<li>None identified.</li>'}</ul>
                        </div>
                    </div>

                    <div>
                        <h3 class="font-semibold mb-3">Bull vs. Bear Case</h3>
                        <div class="space-y-4">
                             <div class="p-3 bg-green-50 border-l-4 border-green-400">
                                <p class="font-bold text-green-800">Bull Case</p>
                                <p class="text-sm text-gray-700">${bull_case}</p>
                             </div>
                             <div class="p-3 bg-red-50 border-l-4 border-red-400">
                                <p class="font-bold text-red-800">Bear Case</p>
                                <p class="text-sm text-gray-700">${bear_case}</p>
                             </div>
                        </div>
                    </div>
                    
                    <div class="pt-4 border-t">
                        <p class="text-sm font-semibold text-gray-800">${next_steps}</p>
                    </div>
                    
                    <div class="p-3 mt-4 text-xs text-gray-500 bg-gray-50 rounded-lg border border-gray-200">
                        <strong>Disclaimer:</strong> This content is for informational purposes only and does not constitute financial or investment advice. It is not a recommendation to buy or sell any security. You should always conduct your own research and consult a qualified financial professional before making any investment decisions.
                    </div>
                </div>
            </div>
        `;
    }
    
    renderGeneralAdvice(data) {
        const { quick_take, key_moves, mermaid_chart, talking_points, email_template, next_steps, response_type } = data;
        const title = response_type === 'interview' ? 'Your Interview Plan' : 'Your Game Plan';
        const talkingPointsTitle = response_type === 'interview' ? 'What They May Ask' : 'Key Questions to Ask';

        return `
            <div class="results-card">
                <div class="results-card-header flex items-center gap-4">
                    <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                    <h2 class="font-bold text-lg text-brand-gray-900">${title}</h2>
                </div>
                <div class="results-card-body space-y-6">
                    <div class="p-4 bg-brand-purple/10 rounded-lg text-brand-purple/90">${marked.parse(quick_take)}</div>
                    <div>
                        <h3 class="font-semibold mb-3">Your Next 3 Moves</h3>
                        <div class="space-y-3">${key_moves.map((m, i) => `
                            <div class="flex gap-3 items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-brand-purple text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">${i + 1}</span>
                                <div>
                                    <p class="font-medium text-gray-900">${m.action}</p>
                                    <p class="text-sm text-gray-600">${m.why}</p>
                                </div>
                            </div>`).join('')}
                        </div>
                    </div>
                    ${mermaid_chart ? `
                    <div>
                        <h3 class="font-semibold mb-2">Visual Strategy</h3>
                        <div class="mermaid-container p-4 bg-white border rounded-lg"><div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div></div>
                    </div>` : ''}
                    ${talking_points?.length > 0 ? `
                    <div>
                        <h3 class="font-semibold mb-2">${talkingPointsTitle}</h3>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">${talking_points.map(t => `<li>${t}</li>`).join('')}</ul>
                    </div>
                    ` : ''}
                    ${email_template ? `
                    <div>
                        <h3 class="font-semibold mb-2">Email Template</h3>
                        <div class="bg-gray-50 rounded-lg p-3 font-mono text-xs text-gray-700 whitespace-pre-wrap border">${email_template}</div>
                    </div>
                    ` : ''}
                </div>
            </div>
        `;
    }
    
    renderProspectAdvice(data) {
        const { summary, top_s_is, top_software_and_cloud, company_capabilities, naics_codes, prospect_recommendations } = data;
        const renderList = (items) => {
             if (!items || items.length === 0) return '<p class="text-sm text-gray-500">No data available</p>';
             return `<div class="space-y-3">${items.map(item => `
                <div class="p-3 bg-gray-50 border rounded-md">
                    <p class="font-semibold text-sm text-gray-800">${item.company || 'N/A'}</p>
                    <p class="text-xs text-gray-600">${item.value || ''}</p>
                </div>
             `).join('')}</div>`;
        };

        return `
             <div class="results-card">
                <div class="results-card-header flex items-center gap-4 bg-brand-green-bg">
                    <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                    <h2 class="font-bold text-lg text-brand-green-text">Prospecting Intelligence</h2>
                </div>
                <div class="results-card-body space-y-6">
                    <div class="p-4 bg-brand-green-bg/50 rounded-lg text-brand-green-text">${marked.parse(summary)}</div>
                    <div>
                        <h3 class="font-semibold mb-3">Top Contractors (SIs)</h3>
                        ${renderList(top_s_is)}
                    </div>
                    <div>
                        <h3 class="font-semibold mb-3">Top Software & Cloud Partners</h3>
                        ${renderList(top_software_and_cloud)}
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                           <h4 class="font-semibold text-gray-800 mb-3">Relevant Capabilities</h4>
                           <ul class="space-y-2 text-sm">${company_capabilities.map(c => `<li class="flex gap-2 items-center"><svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${c}</li>`).join('')}</ul>
                        </div>
                        <div>
                           <h4 class="font-semibold text-gray-800 mb-3">NAICS Codes</h4>
                           <ul class="space-y-2 text-sm">${naics_codes.map(n => `<li class="flex gap-2 items-center"><svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${n.code ? `${n.code} - ${n.description}`: n}</li>`).join('')}</ul>
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold mb-3">Recommendations</h3>
                        <div class="p-4 bg-gray-50 border rounded-lg text-sm space-y-2">${prospect_recommendations.map(r => `<p>${r}</p>`).join('')}</div>
                    </div>
                </div>
            </div>
        `;
    }

    renderNewsAdvice(data) {
    const { 
        quick_take, background, implications, suggested_opening_lines, immediate_actions, strategic_moves, mermaid_chart,
        key_people_and_titles, suggested_discovery_questions, money_keywords 
    } = data;
    
    return `
        <div class="results-card">
            <div class="results-card-header flex items-center gap-4 bg-brand-blue-bg">
                <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                <h2 class="font-bold text-lg text-brand-blue-text">GTM Intelligence Report</h2>
            </div>
            <div class="results-card-body space-y-6">
                <div class="p-4 bg-brand-blue-bg/50 rounded-lg text-brand-blue-text">${marked.parse(quick_take)}</div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-semibold mb-3">Key People & Titles</h3>
                        <div class="space-y-2 text-sm">
                            ${key_people_and_titles && key_people_and_titles.length > 0 ? key_people_and_titles.map(person => `
                                <div class="flex items-center gap-2">
                                    <svg class="h-4 w-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                                    <span>${person}</span>
                                </div>`).join('') : '<p class="text-gray-500">None mentioned.</p>'}
                        </div>
                    </div>
                    <div>
                        <h3 class="font-semibold mb-3">Money Keywords</h3>
                        <div class="flex flex-wrap gap-2">
                            ${money_keywords && money_keywords.length > 0 ? money_keywords.map(keyword => `
                                <span class="text-xs font-medium bg-green-100 text-green-800 px-2.5 py-1 rounded-full">${keyword}</span>`
                            ).join('') : '<p class="text-gray-500">No funding keywords found.</p>'}
                        </div>
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold mb-3">Suggested Discovery Questions</h3>
                    <div class="space-y-2">
                        ${suggested_discovery_questions && suggested_discovery_questions.length > 0 ? suggested_discovery_questions.map(q => `
                            <div class="p-3 bg-gray-50 border rounded-md text-sm text-gray-800 flex gap-2">
                                <span class="font-bold text-brand-purple">Q.</span>
                                <span>${q}</span>
                            </div>`).join('') : '<p class="text-gray-500">No questions suggested.</p>'}
                    </div>
                </div>
                <div>
                    <h3 class="font-semibold mb-3">Email Openers</h3>
                    <div class="space-y-2">${suggested_opening_lines.map((line, i) => `
                        <div class="p-3 bg-gray-50 border rounded-md text-sm text-gray-700"><strong>Option ${i + 1}:</strong> ${line}</div>`).join('')}
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">⚡ Immediate Actions</h4>
                        <div class="space-y-3">${immediate_actions.map((action, i) => `
                            <div class="flex gap-3 items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">${i + 1}</span>
                                <div>
                                    <p class="font-medium text-sm text-gray-900">${action.action}</p>
                                    <p class="text-xs text-gray-600">${action.why}</p>
                                </div>
                            </div>`).join('')}
                        </div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-gray-800 mb-3">🎯 Strategic Moves</h4>
                        <div class="space-y-3">${strategic_moves.map((move, i) => `
                            <div class="flex gap-3 items-start">
                                <span class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">${i + 1}</span>
                                <div>
                                    <p class="font-medium text-sm text-gray-900">${move.action}</p>
                                    <p class="text-xs text-gray-600">${move.why}</p>
                                </div>
                            </div>`).join('')}
                        </div>
                    </div>
                </div>
                ${mermaid_chart ? `
                <div>
                    <h3 class="font-semibold mb-2">GTM Flow</h3>
                    <div class="mermaid-container p-4 bg-white border rounded-lg"><div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div></div>
                </div>` : ''}
            </div>
        </div>
    `;
    }

    async renderMermaidChart() {
        try {
            await mermaid.run();
        } catch (error) {
            console.error('Mermaid rendering error:', error);
            const container = document.querySelector('.mermaid-container');
            if (container) container.innerHTML = '<p class="text-red-500 text-sm">Could not render visual plan.</p>';
        }
    }

    showModal() { this.elements.aboutModal.classList.remove('hidden'); }
    hideModal() { this.elements.aboutModal.classList.add('hidden'); }
}

const app = new AskArti();
</script>
</body>
</html>