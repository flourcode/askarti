<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Arti - Your Federal Sales Coach</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="AI-powered federal sales coach. Get account plans, deal strategies, interview prep, and pipeline guidance tailored for government contractors.">
    <meta name="keywords" content="federal sales coach, government contracting, account planning, deal strategy, pipeline management, govcon">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <!-- Mobile Web App -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="format-detection" content="telephone=no">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="Arti - Your Federal Sales Coach">
    <meta property="og:description" content="AI-powered federal sales coach for government contractors">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Favicons -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#7C6BBE">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Styles and Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C6BBE',
                        purple: {
                            50: '#F5F3FB',
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            300: '#B8ACE0',
                            400: '#9A89D1',
                            500: '#7C6BBE',
                            600: '#6554A5',
                            700: '#5A4E8C',
                            800: '#483E70',
                            900: '#403866'
                        }
                    }
                }
            }
        }
    </script>
    
<style>
    * {
        -webkit-tap-highlight-color: transparent;
        -webkit-touch-callout: none;
        -webkit-user-select: none;
        user-select: none;
    }
    
    input, textarea {
        -webkit-user-select: text;
        user-select: text;
    }
    
    html, body {
        height: 100%;
        overflow: hidden;
        overscroll-behavior: none;
        position: fixed;
        width: 100%;
    }
    
    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        margin: 0;
        padding: 0;
        -webkit-font-smoothing: antialiased;
    }
    
    #app {
        display: flex;
        flex-direction: column;
        height: 100vh;
        height: 100dvh;
        width: 100%;
        position: relative;
        overflow: hidden;
    }
    
    .chat-messages {
        flex: 1;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        overscroll-behavior: contain;
        padding: 1rem;
        padding-bottom: 2rem;
    }
    
    .input-area {
        position: sticky;
        bottom: 0;
        background: linear-gradient(to top, white 85%, transparent);
        padding: 1rem;
        padding-bottom: env(safe-area-inset-bottom, 1rem);
        border-top: 1px solid #e5e7eb;
    }
    
    .message {
        animation: slideIn 0.3s ease-out;
        transform-origin: bottom;
    }
    
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .typing-dot {
        display: inline-block;
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background-color: #9ca3af;
        animation: typing 1.4s infinite ease-in-out;
    }
    
    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    .typing-dot:nth-child(3) { animation-delay: -0.16s; }
    
    @keyframes typing {
        0%, 80%, 100% {
            transform: scale(0.8);
            opacity: 0.5;
        }
        40% {
            transform: scale(1);
            opacity: 1;
        }
    }
    
    .quick-action {
        background: white;
        border: 1px solid #e5e7eb;
        transition: all 0.2s ease;
        white-space: nowrap;
    }
    
    .quick-action:active {
        transform: scale(0.98);
        background: #f9fafb;
    }
    
    .output-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 1.25rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        position: relative;
        transition: all 0.2s ease;
    }
    
    .output-card:hover {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    
    .copy-btn {
        position: absolute;
        top: 0.75rem;
        right: 0.75rem;
        background: white;
        border: 1px solid #e5e7eb;
        padding: 0.5rem;
        border-radius: 0.5rem;
        cursor: pointer;
        transition: all 0.2s ease;
        opacity: 0;
    }
    
    .output-card:hover .copy-btn {
        opacity: 1;
    }
    
    .copy-btn:hover {
        background: #f9fafb;
        border-color: #d1d5db;
    }
    
    .copy-btn.copied {
        background: #10b981;
        border-color: #10b981;
        color: white;
    }
    
    .strategy-visual {
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        border-radius: 0.75rem;
        padding: 1.5rem;
        text-align: center;
        min-height: 200px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .action-item {
        display: flex;
        gap: 0.75rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid #f3f4f6;
    }
    
    .action-item:last-child {
        border-bottom: none;
    }
    
    .action-number {
        flex-shrink: 0;
        width: 28px;
        height: 28px;
        background: #7C6BBE;
        color: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 0.875rem;
    }
    
    .suggestion-pill {
        background: white;
        border: 1px solid #e5e7eb;
        padding: 0.5rem 1rem;
        border-radius: 2rem;
        font-size: 0.875rem;
        transition: all 0.2s ease;
        cursor: pointer;
        white-space: nowrap;
        max-width: 100%;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .suggestion-pill:active {
        transform: scale(0.98);
        background: #f9fafb;
    }
    
    @media (max-width: 640px) {
        .chat-messages {
            padding: 0.75rem;
        }
        
        .output-card {
            padding: 1rem;
        }
        
        .copy-btn {
            opacity: 1;
        }
    }
    
    /* Prevent iOS rubber band scrolling */
    @supports (-webkit-touch-callout: none) {
        .chat-messages {
            -webkit-overflow-scrolling: touch;
        }
    }
    
    /* Custom scrollbar */
    .chat-messages::-webkit-scrollbar {
        width: 6px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
        background: transparent;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
        background: #e5e7eb;
        border-radius: 3px;
    }
    
    .chat-messages::-webkit-scrollbar-thumb:hover {
        background: #d1d5db;
    }
    
    /* Loading animation */
    .shimmer {
        background: linear-gradient(90deg, #f3f4f6 25%, #e5e7eb 50%, #f3f4f6 75%);
        background-size: 200% 100%;
        animation: shimmer 1.5s infinite;
    }
    
    @keyframes shimmer {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }
    
    /* Template styles */
    .email-template {
        font-family: 'Courier New', monospace;
        font-size: 0.875rem;
        line-height: 1.6;
        background: #f9fafb;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #e5e7eb;
        white-space: pre-wrap;
        word-wrap: break-word;
    }
    
    .metric-card {
        background: linear-gradient(135deg, #7C6BBE 0%, #6554A5 100%);
        color: white;
        padding: 1rem;
        border-radius: 0.75rem;
        text-align: center;
    }
    
    .metric-value {
        font-size: 2rem;
        font-weight: 700;
        margin-bottom: 0.25rem;
    }
    
    .metric-label {
        font-size: 0.875rem;
        opacity: 0.9;
    }
</style>
</head>
<body class="bg-gray-50">
    <div id="app">
        <!-- Header -->
        <header class="bg-white border-b border-gray-200 px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="/images/asklite.png" alt="Arti" class="h-8 w-auto">
                <div>
                    <h1 class="text-sm font-semibold text-gray-900">Arti</h1>
                    <p class="text-xs text-gray-500">Your Federal Sales Coach</p>
                </div>
            </div>
            <button id="menu-btn" class="p-2 rounded-lg hover:bg-gray-100 transition-colors">
                <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </header>
        
        <!-- Chat Messages -->
        <div class="chat-messages" id="chat-messages">
            <!-- Welcome Message -->
            <div class="message mb-4">
                <div class="flex items-start gap-3">
                    <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 rounded-full flex-shrink-0">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900 mb-1">Arti</p>
                        <div class="bg-white rounded-2xl px-4 py-3 shadow-sm border border-gray-100">
                            <p class="text-gray-800 text-sm leading-relaxed">
                                Hey! I'm Arti. Tell me what's going on and I'll help you work through it.
                            </p>
                        </div>
                        
                        <!-- Quick Actions -->
                        <div class="mt-3 flex flex-wrap gap-2">
                            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700" 
                                    data-action="prospect">
                                Find Prospects
                            </button>
                            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700"
                                    data-action="account-plan">
                                Account Plan
                            </button>
                            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700"
                                    data-action="unstick-deal">
                                Unstick Deal
                            </button>
                            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700"
                                    data-action="interview">
                                Interview Prep
                            </button>
                            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700"
                                    data-action="boss-issue">
                                Boss Issues
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Input Area -->
        <div class="input-area">
            <form id="chat-form" class="flex gap-2">
                <input 
                    type="text" 
                    id="chat-input"
                    class="flex-1 px-4 py-3 bg-white border border-gray-300 rounded-full text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    placeholder="Type your message..."
                    autocomplete="off"
                    autocorrect="on"
                    autocapitalize="sentences"
                    spellcheck="true"
                    maxlength="500">
                <button 
                    type="submit"
                    id="send-btn"
                    class="px-5 py-3 bg-purple-500 text-white rounded-full font-medium text-sm hover:bg-purple-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed">
                    Send
                </button>
            </form>
            <p class="text-xs text-gray-400 text-center mt-2">Tip: Be specific about your situation for best results</p>
        </div>
    </div>
    
    <!-- Menu Modal -->
    <div id="menu-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-end sm:items-center justify-center">
        <div class="bg-white w-full sm:max-w-md rounded-t-2xl sm:rounded-2xl p-6 transform transition-transform duration-300 translate-y-full">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-semibold text-gray-900">Menu</h2>
                <button id="close-menu" class="p-2 rounded-lg hover:bg-gray-100">
                    <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-2">
                <button id="new-chat-btn" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    <span class="text-gray-700">New Chat</span>
                </button>
                
                <button id="about-btn" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    <span class="text-gray-700">About Arti</span>
                </button>
                
                <button id="share-btn" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m9.632 4.268C18.114 15.562 18 16.018 18 16.5c0 1.657-1.343 3-3 3s-3-1.343-3-3 1.343-3 3-3c.482 0 .938.114 1.342.316m0 0a3 3 0 00-4.268-4.268m4.268 4.268a3 3 0 01-4.268 4.268"></path>
                    </svg>
                    <span class="text-gray-700">Share</span>
                </button>
                
                <a href="mailto:mark@subhoo.com" class="w-full text-left px-4 py-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center gap-3">
                    <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                    </svg>
                    <span class="text-gray-700">Contact</span>
                </a>
            </div>
            
            <div class="mt-6 pt-6 border-t border-gray-200">
                <div class="bg-purple-50 rounded-lg p-4">
                    <p class="text-sm font-medium text-purple-900 mb-1">Sponsor This Space</p>
                    <p class="text-xs text-purple-700">Help keep Arti free. $99/mo gets your message here.</p>
                    <a href="mailto:mark@subhoo.com" class="text-xs text-purple-600 font-medium hover:underline">Learn more →</a>
                </div>
            </div>
        </div>
    </div>

<script>
class ArtiChat {
    constructor() {
        this.API_ENDPOINT = 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI';
        this.chatHistory = [];
        this.isProcessing = false;
        this.elements = this.getElements();
        this.init();
    }
    
    getElements() {
        return {
            chatMessages: document.getElementById('chat-messages'),
            chatInput: document.getElementById('chat-input'),
            chatForm: document.getElementById('chat-form'),
            sendBtn: document.getElementById('send-btn'),
            menuBtn: document.getElementById('menu-btn'),
            menuModal: document.getElementById('menu-modal'),
            closeMenu: document.getElementById('close-menu'),
            newChatBtn: document.getElementById('new-chat-btn'),
            aboutBtn: document.getElementById('about-btn'),
            shareBtn: document.getElementById('share-btn')
        };
    }
    
    init() {
        this.setupEventListeners();
        this.initializeMermaid();
        this.focusInput();
    }
    
    initializeMermaid() {
        mermaid.initialize({
            startOnLoad: false,
            theme: 'default',
            securityLevel: 'strict',
            flowchart: {
                htmlLabels: true,
                curve: 'basis'
            }
        });
    }
    
    setupEventListeners() {
        // Chat form
        this.elements.chatForm.addEventListener('submit', (e) => {
            e.preventDefault();
            this.sendMessage();
        });
        
        // Quick actions
        document.addEventListener('click', (e) => {
            if (e.target.classList.contains('quick-action')) {
                this.handleQuickAction(e.target.dataset.action);
            }
            
            if (e.target.classList.contains('suggestion-pill')) {
                this.elements.chatInput.value = e.target.textContent;
                this.sendMessage();
            }
            
            if (e.target.closest('.copy-btn')) {
                this.copyContent(e.target.closest('.copy-btn'));
            }
        });
        
        // Menu
        this.elements.menuBtn.addEventListener('click', () => this.showMenu());
        this.elements.closeMenu.addEventListener('click', () => this.hideMenu());
        this.elements.menuModal.addEventListener('click', (e) => {
            if (e.target === this.elements.menuModal) this.hideMenu();
        });
        
        // Menu actions
        this.elements.newChatBtn.addEventListener('click', () => {
            this.clearChat();
            this.hideMenu();
        });
        
        this.elements.aboutBtn.addEventListener('click', () => {
            this.showAbout();
            this.hideMenu();
        });
        
        this.elements.shareBtn.addEventListener('click', () => {
            this.share();
            this.hideMenu();
        });
        
        // Prevent iOS bounce
        document.addEventListener('touchmove', (e) => {
            if (!e.target.closest('.chat-messages')) {
                e.preventDefault();
            }
        }, { passive: false });
    }
    
    handleQuickAction(action) {
        const prompts = {
            'prospect': 'I need to find new prospects for enterprise cloud services at civilian agencies',
            'account-plan': 'Help me build an account plan for DHS. They\'re my largest account.',
            'unstick-deal': 'My champion at VA went dark after I sent pricing. The CISO loves our competitor.',
            'interview': 'I have a federal sales interview at AWS next week. Help me prepare.',
            'boss-issue': 'My boss keeps taking credit for my wins and blaming me for losses. How do I handle this?'
        };
        
        if (prompts[action]) {
            this.elements.chatInput.value = prompts[action];
            this.sendMessage();
        }
    }
    
    async sendMessage() {
        const message = this.elements.chatInput.value.trim();
        if (!message || this.isProcessing) return;
        
        this.isProcessing = true;
        this.elements.sendBtn.disabled = true;
        this.elements.chatInput.value = '';
        
        // Add user message
        this.addMessage(message, 'user');
        this.chatHistory.push({ role: 'user', content: message });
        
        // Show typing indicator
        const typingId = this.showTyping();
        
        try {
            const response = await this.makeRequest(message);
            this.removeTyping(typingId);
            
            if (response.message) {
                // Chat response
                this.addMessage(response.message, 'assistant');
                this.chatHistory.push({ role: 'assistant', content: response.message });
                
                if (response.suggestions?.length > 0) {
                    this.addSuggestions(response.suggestions);
                }
            } else if (response.response_type) {
                // Structured response
                this.addStructuredResponse(response);
                this.chatHistory.push({ 
                    role: 'assistant', 
                    content: `Generated ${response.response_type} report` 
                });
            }
            
        } catch (error) {
            this.removeTyping(typingId);
            this.addMessage('Sorry, I\'m having connection issues. Please try again.', 'error');
        } finally {
            this.isProcessing = false;
            this.elements.sendBtn.disabled = false;
            this.focusInput();
        }
    }
    
    async makeRequest(message) {
        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), 25000);
        
        try {
            const response = await fetch(this.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    situation: message,
                    mode: 'enhanced',
                    conversationHistory: this.chatHistory.slice(-10)
                }),
                signal: controller.signal
            });
            
            clearTimeout(timeoutId);
            
            if (!response.ok) {
                throw new Error(`Server error: ${response.status}`);
            }
            
            return await response.json();
            
        } catch (error) {
            if (error.name === 'AbortError') {
                throw new Error('Request timed out');
            }
            throw error;
        }
    }
    
    addMessage(content, type) {
        const messageId = `msg-${Date.now()}`;
        const isUser = type === 'user';
        
        const messageHtml = `
            <div class="message mb-4" id="${messageId}">
                <div class="flex items-start gap-3 ${isUser ? 'flex-row-reverse' : ''}">
                    ${!isUser ? `<img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 rounded-full flex-shrink-0">` : ''}
                    <div class="flex-1 ${isUser ? 'flex justify-end' : ''}">
                        ${!isUser ? '<p class="text-sm font-medium text-gray-900 mb-1">Arti</p>' : ''}
                        <div class="${isUser ? 'bg-purple-500 text-white' : type === 'error' ? 'bg-red-50 text-red-700 border border-red-200' : 'bg-white border border-gray-100'} 
                                    rounded-2xl px-4 py-3 shadow-sm max-w-[85%] ${isUser ? 'rounded-tr-md' : 'rounded-tl-md'}">
                            <div class="text-sm leading-relaxed">${isUser ? this.escapeHtml(content) : marked.parse(content)}</div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
        this.scrollToBottom();
    }
    
    addStructuredResponse(data) {
        const templates = {
            prospect: this.renderProspectResponse,
            account_plan: this.renderAccountPlan,
            deal_strategy: this.renderDealStrategy,
            interview: this.renderInterviewPrep,
            boss_strategy: this.renderBossStrategy,
            meeting: this.renderMeetingPrep,
            email: this.renderEmailTemplate
        };
        
        const renderer = templates[data.response_type] || this.renderGeneralResponse;
        const html = renderer.call(this, data);
        
        const messageHtml = `
            <div class="message mb-4">
                <div class="flex items-start gap-3">
                    <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 rounded-full flex-shrink-0">
                    <div class="flex-1">
                        <p class="text-sm font-medium text-gray-900 mb-1">Arti</p>
                        ${html}
                    </div>
                </div>
            </div>
        `;
        
        this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
        this.scrollToBottom();
        
        // Render any mermaid charts
        if (data.mermaid_chart) {
            setTimeout(() => this.renderMermaidCharts(), 100);
        }
    }
    
    renderProspectResponse(data) {
        const { summary, prospects = [], software_plays = [], capabilities = [], naics_codes = [], recommendations = [] } = data;
        
        return `
            <div class="space-y-3">
                <!-- Summary Card -->
                <div class="output-card">
                    <button class="copy-btn" data-content="${this.escapeHtml(summary)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-gray-900 mb-2">Market Opportunity</h3>
                    <div class="text-sm text-gray-700 leading-relaxed">${marked.parse(summary)}</div>
                </div>
                
                <!-- Top Prospects -->
                ${prospects.length > 0 ? `
                <div class="output-card">
                    <button class="copy-btn" data-content="${this.formatListForCopy(prospects)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-gray-900 mb-3">Top Prospects</h3>
                    <div class="space-y-2">
                        ${prospects.map((p, i) => `
                            <div class="action-item">
                                <div class="action-number">${i + 1}</div>
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">${p.company}</p>
                                    <p class="text-sm text-gray-600 mt-1">${p.value}</p>
                                    ${p.contact ? `<p class="text-xs text-gray-500 mt-1">Contact: ${p.contact}</p>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <!-- Capabilities & NAICS -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    ${capabilities.length > 0 ? `
                    <div class="output-card">
                        <h4 class="font-medium text-gray-900 mb-2">Key Capabilities</h4>
                        <ul class="space-y-1">
                            ${capabilities.map(c => `
                                <li class="text-sm text-gray-700 flex items-start gap-2">
                                    <svg class="w-4 h-4 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>
                                    <span>${c}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${naics_codes.length > 0 ? `
                    <div class="output-card">
                        <h4 class="font-medium text-gray-900 mb-2">NAICS Codes</h4>
                        <ul class="space-y-1">
                            ${naics_codes.map(n => `
                                <li class="text-sm text-gray-700">${n}</li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
                
                <!-- Recommendations -->
                ${recommendations.length > 0 ? `
                <div class="output-card">
                    <button class="copy-btn" data-content="${this.formatListForCopy(recommendations)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-gray-900 mb-3">Next Steps</h3>
                    <div class="space-y-2">
                        ${recommendations.map((r, i) => `
                            <div class="flex items-start gap-2">
                                <span class="text-purple-500 font-bold">→</span>
                                <p class="text-sm text-gray-700 flex-1">${r}</p>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            </div>
        `;
    }
    
    renderAccountPlan(data) {
        const { 
            executive_summary = '', 
            account_overview = {},
            stakeholder_map = [],
            opportunities = [],
            risks = [],
            action_plan = [],
            metrics = {}
        } = data;
        
        return `
            <div class="space-y-3">
                <!-- Executive Summary -->
                <div class="output-card bg-gradient-to-br from-purple-50 to-white">
                    <button class="copy-btn" data-content="${this.escapeHtml(executive_summary)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-purple-900 mb-2">Executive Summary</h3>
                    <div class="text-sm text-gray-700">${marked.parse(executive_summary)}</div>
                </div>
                
                <!-- Key Metrics -->
                ${metrics && Object.keys(metrics).length > 0 ? `
                <div class="grid grid-cols-2 sm:grid-cols-4 gap-3">
                    ${Object.entries(metrics).map(([key, value]) => `
                        <div class="metric-card">
                            <div class="metric-value">${value}</div>
                            <div class="metric-label">${key.replace(/_/g, ' ')}</div>
                        </div>
                    `).join('')}
                </div>
                ` : ''}
                
                <!-- Stakeholder Map -->
                ${stakeholder_map.length > 0 ? `
                <div class="output-card">
                    <h3 class="font-semibold text-gray-900 mb-3">Key Stakeholders</h3>
                    <div class="space-y-3">
                        ${stakeholder_map.map(s => `
                            <div class="border-l-4 ${s.influence === 'champion' ? 'border-green-500' : s.influence === 'blocker' ? 'border-red-500' : 'border-gray-300'} pl-3">
                                <div class="flex items-center gap-2">
                                    <p class="font-medium text-gray-900">${s.name || 'Unknown'}</p>
                                    <span class="text-xs px-2 py-0.5 rounded-full ${s.influence === 'champion' ? 'bg-green-100 text-green-700' : s.influence === 'blocker' ? 'bg-red-100 text-red-700' : 'bg-gray-100 text-gray-700'}">
                                        ${s.influence || 'neutral'}
                                    </span>
                                </div>
                                <p class="text-sm text-gray-600">${s.role || ''}</p>
                                ${s.notes ? `<p class="text-xs text-gray-500 mt-1">${s.notes}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <!-- Opportunities & Risks -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    ${opportunities.length > 0 ? `
                    <div class="output-card">
                        <h4 class="font-medium text-gray-900 mb-2">Opportunities</h4>
                        <ul class="space-y-2">
                            ${opportunities.map(o => `
                                <li class="text-sm text-gray-700 flex items-start gap-2">
                                    <span class="text-green-500 mt-0.5">+</span>
                                    <span>${o}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                    
                    ${risks.length > 0 ? `
                    <div class="output-card">
                        <h4 class="font-medium text-gray-900 mb-2">Risks</h4>
                        <ul class="space-y-2">
                            ${risks.map(r => `
                                <li class="text-sm text-gray-700 flex items-start gap-2">
                                    <span class="text-red-500 mt-0.5">!</span>
                                    <span>${r}</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    ` : ''}
                </div>
                
                <!-- 90-Day Action Plan -->
                ${action_plan.length > 0 ? `
                <div class="output-card">
                    <button class="copy-btn" data-content="${this.formatActionPlan(action_plan)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-gray-900 mb-3">90-Day Action Plan</h3>
                    <div class="space-y-3">
                        ${action_plan.map((action, i) => `
                            <div class="action-item">
                                <div class="action-number">${i + 1}</div>
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">${action.task}</p>
                                    <div class="flex items-center gap-4 mt-1">
                                        <span class="text-xs text-gray-500">Due: ${action.timeline || 'TBD'}</span>
                                        <span class="text-xs text-gray-500">Owner: ${action.owner || 'You'}</span>
                                    </div>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
            </div>
        `;
    }
    
    renderDealStrategy(data) {
        const { 
            situation_analysis = '',
            key_moves = [],
            competitive_strategy = {},
            talking_points = [],
            email_template = '',
            mermaid_chart = '',
            next_steps = ''
        } = data;
        
        return `
            <div class="space-y-3">
                <!-- Situation Analysis -->
                <div class="output-card">
                    <button class="copy-btn" data-content="${this.escapeHtml(situation_analysis)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-gray-900 mb-2">Situation Analysis</h3>
                    <div class="text-sm text-gray-700">${marked.parse(situation_analysis)}</div>
                </div>
                
                <!-- Key Moves -->
                ${key_moves.length > 0 ? `
                <div class="output-card">
                    <h3 class="font-semibold text-gray-900 mb-3">Your Next Moves</h3>
                    <div class="space-y-3">
                        ${key_moves.map((move, i) => `
                            <div class="action-item">
                                <div class="action-number">${i + 1}</div>
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">${move.action}</p>
                                    <p class="text-sm text-gray-600 mt-1">${move.why}</p>
                                    ${move.when ? `<p class="text-xs text-gray-500 mt-1">Timing: ${move.when}</p>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <!-- Strategy Visual -->
                ${mermaid_chart ? `
                <div class="output-card">
                    <h3 class="font-semibold text-gray-900 mb-3">Deal Strategy</h3>
                    <div class="strategy-visual">
                        <div class="mermaid">${mermaid_chart}</div>
                    </div>
                </div>
                ` : ''}
                
                <!-- Email Template -->
                ${email_template ? `
                <div class="output-card">
                    <button class="copy-btn" data-content="${this.escapeHtml(email_template)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-gray-900 mb-2">Email Template</h3>
                    <div class="email-template">${email_template}</div>
                </div>
                ` : ''}
                
                <!-- Next Steps -->
                ${next_steps ? `
                <div class="bg-purple-50 rounded-lg p-4">
                    <p class="text-sm text-purple-900">
                        <span class="font-semibold">Remember:</span> ${next_steps}
                    </p>
                </div>
                ` : ''}
            </div>
        `;
    }
    
    renderInterviewPrep(data) {
        const {
            overview = '',
            likely_questions = [],
            star_examples = [],
            questions_to_ask = [],
            preparation_checklist = [],
            confidence_builders = []
        } = data;
        
        return `
            <div class="space-y-3">
                <!-- Overview -->
                <div class="output-card bg-gradient-to-br from-green-50 to-white">
                    <h3 class="font-semibold text-green-900 mb-2">Interview Strategy</h3>
                    <div class="text-sm text-gray-700">${marked.parse(overview)}</div>
                </div>
                
                <!-- Likely Questions -->
                ${likely_questions.length > 0 ? `
                <div class="output-card">
                    <button class="copy-btn" data-content="${this.formatListForCopy(likely_questions)}">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                        </svg>
                    </button>
                    <h3 class="font-semibold text-gray-900 mb-3">Questions They'll Ask</h3>
                    <div class="space-y-2">
                        ${likely_questions.map((q, i) => `
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <p class="font-medium text-gray-900 text-sm">${i + 1}. ${q.question}</p>
                                ${q.approach ? `<p class="text-xs text-gray-600 mt-2">Approach: ${q.approach}</p>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
                ` : ''}
                
                <!-- STAR Examples -->
                ${star_examples.length > 0 ? `
                <div class="output-card">
                <h3 class="font-semibold text-gray-900 mb-3">Your STAR Stories</h3>
                <div class="space-y-3">
                    ${star_examples.map((example, i) => `
                        <div class="border-l-4 border-purple-500 pl-3">
                            <p class="font-medium text-gray-900">${example.situation}</p>
                            <p class="text-sm text-gray-600 mt-1"><strong>Task:</strong> ${example.task}</p>
                            <p class="text-sm text-gray-600 mt-1"><strong>Action:</strong> ${example.action}</p>
                            <p class="text-sm text-gray-600 mt-1"><strong>Result:</strong> ${example.result}</p>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            <!-- Questions to Ask -->
            ${questions_to_ask.length > 0 ? `
            <div class="output-card">
                <h3 class="font-semibold text-gray-900 mb-3">Questions You Should Ask</h3>
                <ul class="space-y-2">
                    ${questions_to_ask.map(q => `
                        <li class="text-sm text-gray-700 flex items-start gap-2">
                            <span class="text-purple-500 mt-0.5">?</span>
                            <span>${q}</span>
                        </li>
                    `).join('')}
                </ul>
            </div>
            ` : ''}
            
            <!-- Preparation Checklist -->
            ${preparation_checklist.length > 0 ? `
            <div class="output-card">
                <h3 class="font-semibold text-gray-900 mb-3">Pre-Interview Checklist</h3>
                <div class="space-y-2">
                    ${preparation_checklist.map(item => `
                        <label class="flex items-start gap-3 cursor-pointer">
                            <input type="checkbox" class="mt-0.5 rounded border-gray-300 text-purple-500 focus:ring-purple-500">
                            <span class="text-sm text-gray-700">${item}</span>
                        </label>
                    `).join('')}
                </div>
            </div>
            ` : ''}
        </div>
    `;
}

renderBossStrategy(data) {
    const {
        situation_assessment = '',
        immediate_tactics = [],
        documentation_plan = [],
        communication_scripts = [],
        long_term_strategy = '',
        self_care = []
    } = data;
    
    return `
        <div class="space-y-3">
            <!-- Situation Assessment -->
            <div class="output-card">
                <h3 class="font-semibold text-gray-900 mb-2">What You're Dealing With</h3>
                <div class="text-sm text-gray-700">${marked.parse(situation_assessment)}</div>
            </div>
            
            <!-- Immediate Tactics -->
            ${immediate_tactics.length > 0 ? `
            <div class="output-card">
                <h3 class="font-semibold text-gray-900 mb-3">Immediate Protection Tactics</h3>
                <div class="space-y-3">
                    ${immediate_tactics.map((tactic, i) => `
                        <div class="action-item">
                            <div class="action-number">${i + 1}</div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-900">${tactic.action}</p>
                                <p class="text-sm text-gray-600 mt-1">${tactic.why}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            <!-- Documentation Plan -->
            ${documentation_plan.length > 0 ? `
            <div class="output-card">
                <button class="copy-btn" data-content="${this.formatListForCopy(documentation_plan)}">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                    </svg>
                </button>
                <h3 class="font-semibold text-gray-900 mb-3">Documentation Strategy</h3>
                <ul class="space-y-2">
                    ${documentation_plan.map(item => `
                        <li class="text-sm text-gray-700 flex items-start gap-2">
                            <svg class="w-4 h-4 text-red-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 8a6 6 0 01-7.743 5.743L10 14l-1 1-1 1H6v2H2v-4l4.257-4.257A6 6 0 1118 8zm-6-4a1 1 0 100 2 2 2 0 012 2 1 1 0 102 0 4 4 0 00-4-4z" clip-rule="evenodd"></path>
                            </svg>
                            <span>${item}</span>
                        </li>
                    `).join('')}
                </ul>
            </div>
            ` : ''}
            
            <!-- Communication Scripts -->
            ${communication_scripts.length > 0 ? `
            <div class="output-card">
                <h3 class="font-semibold text-gray-900 mb-3">Scripts for Difficult Conversations</h3>
                <div class="space-y-3">
                    ${communication_scripts.map(script => `
                        <div class="bg-gray-50 rounded-lg p-3">
                            <p class="font-medium text-gray-900 text-sm mb-2">${script.scenario}</p>
                            <div class="email-template text-xs">${script.response}</div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            <!-- Self Care -->
            ${self_care.length > 0 ? `
            <div class="output-card bg-gradient-to-br from-blue-50 to-white">
                <h3 class="font-semibold text-blue-900 mb-3">Taking Care of Yourself</h3>
                <ul class="space-y-2">
                    ${self_care.map(item => `
                        <li class="text-sm text-gray-700 flex items-start gap-2">
                            <span class="text-blue-500 mt-0.5">♥</span>
                            <span>${item}</span>
                        </li>
                    `).join('')}
                </ul>
            </div>
            ` : ''}
            
            <!-- Long-term Strategy -->
            ${long_term_strategy ? `
            <div class="bg-purple-50 rounded-lg p-4">
                <h4 class="font-semibold text-purple-900 mb-2">Your Exit Strategy</h4>
                <p class="text-sm text-purple-800">${long_term_strategy}</p>
            </div>
            ` : ''}
        </div>
    `;
}

renderGeneralResponse(data) {
    const { quick_take = '', key_moves = [], talking_points = [], email_template = '', next_steps = '' } = data;
    
    return `
        <div class="space-y-3">
            ${quick_take ? `
            <div class="output-card">
                <div class="text-sm text-gray-700">${marked.parse(quick_take)}</div>
            </div>${key_moves.length > 0 ? `
            <div class="output-card">
                <h3 class="font-semibold text-gray-900 mb-3">Action Items</h3>
                <div class="space-y-3">
                    ${key_moves.map((move, i) => `
                        <div class="action-item">
                            <div class="action-number">${i + 1}</div>
                            <div class="flex-1">
                                <p class="font-medium text-gray-900">${move.action}</p>
                                <p class="text-sm text-gray-600 mt-1">${move.why}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
            ` : ''}
            
            ${email_template ? `
            <div class="output-card">
                <button class="copy-btn" data-content="${this.escapeHtml(email_template)}">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3"></path>
                    </svg>
                </button>
                <h3 class="font-semibold text-gray-900 mb-2">Email Template</h3>
                <div class="email-template">${email_template}</div>
            </div>
            ` : ''}
            
            ${next_steps ? `
            <div class="bg-purple-50 rounded-lg p-4">
                <p class="text-sm text-purple-900">
                    <span class="font-semibold">Remember:</span> ${next_steps}
                </p>
            </div>
            ` : ''}
        </div>
    `;
}

addSuggestions(suggestions) {
    const suggestionsHtml = `
        <div class="px-3 mt-3">
            <div class="flex gap-2 flex-wrap">
                ${suggestions.map(s => `
                    <button class="suggestion-pill">
                        ${this.escapeHtml(s)}
                    </button>
                `).join('')}
            </div>
        </div>
    `;
    
    const lastMessage = this.elements.chatMessages.lastElementChild;
    if (lastMessage) {
        lastMessage.insertAdjacentHTML('beforeend', suggestionsHtml);
    }
    
    this.scrollToBottom();
}

showTyping() {
    const typingId = `typing-${Date.now()}`;
    const typingHtml = `
        <div class="message mb-4" id="${typingId}">
            <div class="flex items-start gap-3">
                <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 rounded-full flex-shrink-0">
                <div class="bg-white rounded-2xl px-4 py-3 shadow-sm border border-gray-100">
                    <div class="flex gap-1">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
    this.scrollToBottom();
    
    return typingId;
}

removeTyping(typingId) {
    const typingElement = document.getElementById(typingId);
    if (typingElement) {
        typingElement.remove();
    }
}

async copyContent(button) {
    const content = button.dataset.content || button.closest('.output-card').innerText;
    
    try {
        await navigator.clipboard.writeText(content);
        
        // Visual feedback
        const originalHtml = button.innerHTML;
        button.classList.add('copied');
        button.innerHTML = `
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
            </svg>
        `;
        
        setTimeout(() => {
            button.classList.remove('copied');
            button.innerHTML = originalHtml;
        }, 2000);
        
    } catch (err) {
        console.error('Copy failed:', err);
        // Fallback for mobile
        const textArea = document.createElement('textarea');
        textArea.value = content;
        textArea.style.position = 'fixed';
        textArea.style.left = '-999999px';
        document.body.appendChild(textArea);
        textArea.select();
        
        try {
            document.execCommand('copy');
            button.classList.add('copied');
            setTimeout(() => button.classList.remove('copied'), 2000);
        } catch (err) {
            alert('Copy failed. Please try selecting the text manually.');
        }
        
        document.body.removeChild(textArea);
    }
}

scrollToBottom() {
    requestAnimationFrame(() => {
        const messages = this.elements.chatMessages;
        messages.scrollTop = messages.scrollHeight;
    });
}

focusInput() {
    this.elements.chatInput.focus();
}

clearChat() {
    this.chatHistory = [];
    this.elements.chatMessages.innerHTML = '';
    
    // Re-add welcome message
    this.addMessage("Hey! I'm Arti. I've been in federal sales for 30+ years. Tell me what's going on and I'll help you work through it. What's got you stuck today?", 'assistant');
    
    // Re-add quick actions
    const quickActionsHtml = `
        <div class="mt-3 flex flex-wrap gap-2">
            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700" data-action="prospect">Find Prospects</button>
            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700" data-action="account-plan">Account Plan</button>
            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700" data-action="unstick-deal">Unstick Deal</button>
            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700" data-action="interview">Interview Prep</button>
            <button class="quick-action px-3 py-1.5 rounded-full text-xs font-medium text-gray-700" data-action="boss-issue">Boss Issues</button>
        </div>
    `;
    
    const lastMessage = this.elements.chatMessages.lastElementChild;
    if (lastMessage) {
        lastMessage.querySelector('.flex-1').insertAdjacentHTML('beforeend', quickActionsHtml);
    }
    
    this.focusInput();
}

showMenu() {
    this.elements.menuModal.classList.remove('hidden');
    requestAnimationFrame(() => {
        this.elements.menuModal.querySelector('div').classList.remove('translate-y-full');
    });
}

hideMenu() {
    this.elements.menuModal.querySelector('div').classList.add('translate-y-full');
    setTimeout(() => {
        this.elements.menuModal.classList.add('hidden');
    }, 300);
}

showAbout() {
    const aboutHtml = `
        <div class="output-card mb-4">
            <div class="flex items-center gap-3 mb-3">
                <img src="/images/oldmark.jpg" alt="Mark" class="w-12 h-12 rounded-full object-cover">
                <div>
                    <h3 class="font-semibold text-gray-900">Hi, I'm Mark</h3>
                    <p class="text-sm text-gray-600">Creator of Arti</p>
                </div>
            </div>
            <div class="text-sm text-gray-700 space-y-3">
                <p>I built Arti to be the federal sales coach I wish I'd had. Someone who's been there, done that, and can help you navigate the unique challenges of selling to the government.</p>
                <p>Arti combines 30+ years of federal sales experience with AI to give you practical, actionable advice when you need it most.</p>
                <div class="bg-gray-50 rounded-lg p-3 mt-3">
                    <p class="text-xs text-gray-600 mb-2"><strong>Privacy:</strong> Your conversations aren't stored. Each session is processed in real-time and discarded.</p>
                    <p class="text-xs text-gray-600"><strong>Tech:</strong> Powered by advanced AI models including Gemini, Claude, and GPT-4.</p>
                </div>
                <a href="https://calendly.com/markflournoy/30min" target="_blank" class="block mt-4 text-center bg-purple-500 text-white px-4 py-2 rounded-lg font-medium text-sm">
                    Let's talk fed sales →
                </a>
            </div>
        </div>
    `;
    
    this.addMessage(aboutHtml, 'system');
}

async share() {
    const shareData = {
        title: 'Arti - Federal Sales Coach',
        text: 'Get unstuck with AI-powered federal sales coaching',
        url: 'https://askarti.com'
    };
    
    try {
        if (navigator.share) {
            await navigator.share(shareData);
        } else {
            await navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`);
            alert('Link copied to clipboard!');
        }
    } catch (err) {
        console.error('Share failed:', err);
    }
}

async renderMermaidCharts() {
    try {
        await mermaid.run();
    } catch (err) {
        console.error('Mermaid rendering failed:', err);
    }
}

escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

formatListForCopy(items) {
    if (Array.isArray(items)) {
        return items.map((item, i) => {
            if (typeof item === 'string') {
                return `${i + 1}. ${item}`;
            } else if (item.company) {
                return `${i + 1}. ${item.company}: ${item.value}`;
            } else if (item.question) {
                return `${i + 1}. ${item.question}`;
            }
            return `${i + 1}. ${JSON.stringify(item)}`;
        }).join('\n');
    }
    return items;
}

formatActionPlan(actions) {
    return actions.map((action, i) => {
        return `${i + 1}. ${action.task}\n   Due: ${action.timeline || 'TBD'}\n   Owner: ${action.owner || 'You'}`;
    }).join('\n\n');
}
}
// Initialize the app
const artiChat = new ArtiChat();
</script>
</body>
</html>