<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://askarti.com/">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti.">
    <meta name="twitter:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Favicons -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#523f9e">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/images/asklite.png" as="image">
    <link rel="preload" href="/images/arti_right.png" as="image">
    
    <!-- Styles and Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C6BBE',
                        customPurple: {
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            500: '#7C6BBE',
                            700: '#5A4E8C',
                            900: '#403866'
                        }
                    }
                }
            }
        }
    </script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        
        .loader {
            border: 2px solid #e5e7eb;
            border-top: 2px solid #7C6BBE;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in { 
            animation: fadeIn 0.5s ease-in-out; 
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .quick-prompt:hover {
            background-color: rgba(124, 107, 190, 0.1);
            transform: scale(1.02);
        }
        
        .sponsor-ad {
            background: linear-gradient(135deg, rgba(124, 107, 190, 0.05) 0%, rgba(124, 107, 190, 0.02) 100%);
            border: 1px solid rgba(124, 107, 190, 0.1);
            transition: all 0.3s ease;
        }
        
        .sponsor-ad:hover {
            background: linear-gradient(135deg, rgba(124, 107, 190, 0.08) 0%, rgba(124, 107, 190, 0.04) 100%);
            border-color: rgba(124, 107, 190, 0.2);
            transform: translateY(-1px);
        }
        
        .dashboard-card {
            background-color: white;
            border-radius: 0.75rem;
            border: 1px solid #e5e7eb;
            padding: 1.5rem;
            box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
        }
        
        .mermaid-container { 
            text-align: center; 
            min-height: 200px;
            position: relative;
        }
        
        .mermaid { 
            display: inline-block; 
            max-width: 100%;
        }
        
        .mermaid-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .modal-backdrop {
            transition: opacity 0.2s ease-out;
        }
        
        .modal-content {
            transform: scale(0.95);
            opacity: 0;
            transition: all 0.2s ease-out;
        }
        
        .modal-content.show {
            transform: scale(1);
            opacity: 1;
        }
		/* Add to the existing styles */
.dashboard-card li {
    word-break: break-word;
}

/* Ensure minimum width for company names */
.min-w-0 {
    min-width: 0;
}

/* Better text truncation if needed */
.truncate-text {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-20">
        <header class="text-center mb-4">
            <a href="/" aria-label="AskArti Home" class="inline-block">
                <img src="/images/asklite.png" alt="AskArti" class="h-16 w-auto md:h-20 lg:h-24">
            </a>
        </header>

        <main class="dashboard-card mb-3">
            <div class="mb-4">
                <label for="situation-input" class="block text-lg font-semibold text-gray-900 mb-2 text-center">
                    Hi, I'm Arti, your 24/7 Sales Buddy. What's blocking your deal?
                </label>
                <textarea 
                    id="situation-input" 
                    rows="3" 
                    class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary resize-none placeholder-gray-500"
                    placeholder="Champion ghosted me after seeing pricing. $2M deal at DHS. Q4 commit."
                    maxlength="500"></textarea>
                <div class="text-xs text-gray-500 mt-1">
                    <span class="hint-text">The more details you give Arti, like agency, $ amount, or who's involved, the better the advice. Don't like an answer? Just Ask Arti again.</span>
                </div>
            </div>

            <div class="flex flex-wrap gap-2 justify-center mb-4">
                <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                        data-text="Buyer at VA ghosted me after I sent pricing. CISO loves our competitor.">
                    Buyer Went Dark
                </button>
                <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                        data-text="Demo crashed at DOJ yesterday. CTO walked out. How to recover?">
                    Demo Crashed
                </button>
                <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                        data-text="Partner reps and Account reps fighting over deals, pipeline, and revenue recognition.">
                    Partner Drama
                </button>
                <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                        data-text="Meeting DHS CIO next week and don't have a Champion. How to position our cybersecurity platform?">
                    Meeting Prep
                </button>
                <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                        data-text="AWS federal sales interview next week. Help me prep.">
                    Interview Prep
                </button>
                <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                        data-text="Prospect for janitorial services at VA.">
                    Prospecting
                </button>
            </div>

            <div class="text-center">
                <button id="ask-btn" class="bg-customPurple-500 hover:bg-customPurple-700 text-white font-semibold py-3 px-8 rounded-full transition-all inline-flex items-center gap-2 shadow-lg hover:shadow-xl">
                    <span id="btn-text">Ask Arti</span>
                    <div id="loader" class="loader hidden"></div>
                </button>
            </div>
        </main>

        <!-- Loading Message -->
        <div id="loading-message-container" class="text-center py-4 hidden">
            <p id="loading-message" class="text-gray-600"></p>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="bg-red-50 border border-red-200 rounded-lg p-6 text-center mb-4 hidden">
            <p class="text-red-700 font-medium mb-2">Something went wrong</p>
            <p class="text-red-600 text-sm" id="error-details">We're having trouble connecting to Arti. Please try again in a moment.</p>
            <button id="retry-btn" class="mt-3 bg-red-100 hover:bg-red-200 text-red-700 font-medium py-2 px-4 rounded-lg text-sm">
                Try Again
            </button>
        </div>

        <!-- Results -->
        <div id="results-container"></div>

        <!-- Footer -->
        <footer class="text-center mt-12 space-y-4">
            <div class="flex justify-center gap-6 text-sm">
                <button id="about-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">About</button>
                <button id="share-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Share</button>
                <a href="mailto:mark@subhoo.com" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Contact</a>
            </div>

            <div class="sponsor-ad rounded-lg p-3 mb-4 text-sm bg-white border border-gray-200 not-italic text-left leading-normal text-gray-700">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs font-medium text-gray-600 bg-gray-100 px-2 py-1 rounded-full">SPONSOR</span>
                    <span class="text-gray-800 font-semibold">Hey there! Enjoyin' these results?</span>
                </div>
                <p class="text-sm leading-relaxed text-gray-700">
                    By the time I pay off all my scientists, all the lab coats, and my Lambda bill…I'm losin' money every time you press that Ask Arti button.
                </p>
                <p class="mt-2 text-xs italic text-gray-500">
                    Don't let my loss be your loss. Sponsor this ad for the low low price of $99/mo.
                </p>
                <p class="mt-2 text-xs text-customPurple-600 font-medium">
                    <a href="mailto:mark@subhoo.com" class="hover:underline">Contact me to reserve this premium spot →</a>
                </p>
            </div>

            <p class="text-xs text-gray-400">
                AskArti.com results are provided for informational and educational purposes only and do not constitute professional business advice. AI can make errors or provide recommendations that may not suit your specific situation. Please consult qualified professionals before making important business decisions.
            </p>

            <br>

            <p class="text-xs text-gray-400">© 2025 AskArti. Made for Sellers by Sellers.</p>

            <div class="mt-4 flex justify-center">
                <a href="https://aws.amazon.com/what-is-cloud-computing" target="_blank" rel="noopener noreferrer">
                    <img src="https://d0.awsstatic.com/logos/powered-by-aws.png" alt="Powered by AWS Cloud Computing" style="width: 80px; height: auto;">
                </a>
            </div>
        </footer>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 modal-backdrop">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 modal-content">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <img src="images/oldmark.jpg" alt="Mark Flournoy" class="w-12 h-12 rounded-full object-cover border-2 border-customPurple-200">
                    <h2 class="text-xl font-bold text-gray-900">Hi, I'm Mark</h2>
                </div>
                <button id="close-about" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700">
                <p>I've spent over 30 years working with the federal government as a mission owner, COTR, and seller.</p>
                <p>I built AskArti to help federal salespeople learn how to use AI in a practical way to better support their customers. Arti's not perfect, so use your judgment, but he's available 24/7 when you need to talk through a stuck deal or prep for a tough meeting.</p>
                
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="bg-gray-50 rounded-lg p-4 text-sm">
                        <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-customPurple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Privacy & Technology
                        </h3>
                        <p class="text-gray-600 mb-2">AskArti uses models that may include Gemini, Claude, and ChatGPT. These models may use API inputs to improve responses.</p>
                        <p class="text-gray-600">We do not store, log, or persist any prompt or response data. All processing occurs in-memory using AWS Lambda and is discarded after execution.</p>
                    </div>
                </div>
                
                <div class="pt-4">
                    <a href="https://calendly.com/markflournoy/30min" target="_blank" class="block w-full bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors">
                        Let's chat about AI or Fed Sales →
                    </a>
                </div>
            </div>
        </div>
    </div>

<script>
// Configuration
const CONFIG = {
    API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
    REQUEST_TIMEOUT: 25000,
    MAX_RETRIES: 2,
    RETRY_DELAY: 2000,
    MAX_INPUT_LENGTH: 500,
    MIN_REQUEST_INTERVAL: 2000,
    LOADING_MESSAGES: [
        "Hang on. I'm...Working Backwards", 
        "...Diving Deep", 
        "...Unpacking This", 
        "...Putting a Pin in it", 
        "...Circling Back", 
        "...Thinking Big"
    ]
};

// Application class for better organization
class AskArti {
    constructor() {
        this.elements = this.getElements();
        this.state = {
            pendingRequest: false,
            lastRequestTime: 0,
            loadingInterval: null,
            abortController: null,
            lastQuery: ''
        };
        this.init();
    }

    getElements() {
        return {
            situationInput: document.getElementById('situation-input'),
            askBtn: document.getElementById('ask-btn'),
            btnText: document.getElementById('btn-text'),
            loader: document.getElementById('loader'),
            loadingMessageContainer: document.getElementById('loading-message-container'),
            loadingMessage: document.getElementById('loading-message'),
            errorMessage: document.getElementById('error-message'),
            errorDetails: document.getElementById('error-details'),
            retryBtn: document.getElementById('retry-btn'),
            resultsContainer: document.getElementById('results-container'),
            aboutBtn: document.getElementById('about-btn'),
            aboutModal: document.getElementById('about-modal'),
            closeAbout: document.getElementById('close-about'),
            shareBtn: document.getElementById('share-btn'),
            quickPromptBtns: document.querySelectorAll('.quick-prompt')
        };
    }

    init() {
       this.initializeMermaid();
       this.setupEventListeners();
       this.elements.situationInput.focus();
   }

   initializeMermaid() {
       mermaid.initialize({ 
           startOnLoad: false,
           securityLevel: 'strict',
           theme: 'default',
           flowchart: {
               htmlLabels: true,
               curve: 'linear'
           }
       });
   }

   setupEventListeners() {
       // Quick prompts
       this.elements.quickPromptBtns.forEach(btn => {
           btn.addEventListener('click', (e) => {
               this.elements.situationInput.value = e.currentTarget.dataset.text;
               this.getAdvice();
           });
       });

       // Main button
       this.elements.askBtn.addEventListener('click', () => this.getAdvice());
       
       // Enter key
       this.elements.situationInput.addEventListener('keydown', (e) => {
           if (e.key === 'Enter' && !e.shiftKey) {
               e.preventDefault();
               this.getAdvice();
           }
       });

       // Retry
       this.elements.retryBtn.addEventListener('click', () => {
           this.elements.errorMessage.classList.add('hidden');
           if (this.state.lastQuery) {
               this.elements.situationInput.value = this.state.lastQuery;
               this.getAdvice();
           }
       });

       // Share
       this.elements.shareBtn.addEventListener('click', () => this.share());

       // About modal
       this.elements.aboutBtn.addEventListener('click', () => this.showModal());
       this.elements.closeAbout.addEventListener('click', () => this.hideModal());
       this.elements.aboutModal.addEventListener('click', (e) => {
           if (e.target === this.elements.aboutModal) this.hideModal();
       });

       // Escape key
       document.addEventListener('keydown', (e) => {
           if (e.key === 'Escape') this.hideModal();
       });
   }

   setLoading(loading) {
       this.elements.btnText.style.display = loading ? 'none' : 'inline';
       this.elements.loader.style.display = loading ? 'block' : 'none';
       this.elements.askBtn.disabled = loading;
       this.elements.errorMessage.classList.add('hidden');
       
       if (loading) {
           this.showLoadingMessages();
       } else {
           this.hideLoadingMessages();
       }
   }

   showLoadingMessages() {
       this.elements.loadingMessageContainer.classList.remove('hidden');
       this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[0];
       
       let messageIndex = 0;
       this.state.loadingInterval = setInterval(() => {
           messageIndex = (messageIndex + 1) % CONFIG.LOADING_MESSAGES.length;
           this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[messageIndex];
       }, 2000);
   }

   hideLoadingMessages() {
       clearInterval(this.state.loadingInterval);
       this.elements.loadingMessageContainer.classList.add('hidden');
   }

   showError(message) {
       this.hideLoadingMessages();
       this.elements.errorMessage.classList.remove('hidden');
       this.elements.errorDetails.textContent = message;
       this.setLoading(false);
   }

   showTemporaryMessage(message, type = 'info') {
       this.elements.loadingMessageContainer.classList.remove('hidden');
       this.elements.loadingMessage.textContent = message;
       
       const colorClasses = {
           error: 'text-red-700 font-medium',
           warning: 'text-orange-700 font-medium',
           info: 'text-gray-600'
       };
       
       this.elements.loadingMessage.className = colorClasses[type] || colorClasses.info;
       
       setTimeout(() => {
           this.elements.loadingMessageContainer.classList.add('hidden');
       }, 2000);
   }

   async getAdvice() {
       const situation = this.elements.situationInput.value.trim();
       
       // Rate limiting
       const now = Date.now();
       if (now - this.state.lastRequestTime < CONFIG.MIN_REQUEST_INTERVAL) {
           this.showTemporaryMessage("Please wait a moment before asking again", 'warning');
           return;
       }
       
       // Validation
       if (!situation) {
           this.showTemporaryMessage("Drop your situation in the box above 👆", 'error');
           return;
       }
       
       // Prevent duplicate requests
       if (this.state.pendingRequest) return;
       
       this.state.lastRequestTime = now;
       this.state.lastQuery = situation;
       this.state.pendingRequest = true;
       
       // Clear previous results and show loading
       this.elements.resultsContainer.innerHTML = '';
       this.setLoading(true);
       
       try {
           const data = await this.makeRequest(situation);
           this.displayAdvice(data);
       } catch (error) {
           console.error('Request failed:', error);
           this.showError(error.message || "We're having trouble connecting to Arti. Please try again.");
       } finally {
           this.state.pendingRequest = false;
           this.setLoading(false);
       }
   }

   async makeRequest(situation) {
       this.state.abortController = new AbortController();
       
       const timeoutId = setTimeout(() => {
           this.state.abortController.abort();
       }, CONFIG.REQUEST_TIMEOUT);
       
       try {
           const response = await fetch(CONFIG.API_ENDPOINT, {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ situation }),
               signal: this.state.abortController.signal
           });
           
           clearTimeout(timeoutId);
           
           if (!response.ok) {
               throw new Error(`Server error (${response.status})`);
           }
           
           const data = await response.json();
           
           if (data.error) {
               throw new Error(data.message || data.error);
           }
           
           return data;
       } catch (error) {
           if (error.name === 'AbortError') {
               throw new Error('Request timed out. Please try again.');
           }
           throw error;
       }
   }

   displayAdvice(data) {
       const { response_type } = data;
       
       try {
           if (response_type === 'prospect') {
               this.displayProspectAdvice(data);
           } else {
               this.displayGeneralAdvice(data);
           }
           
           // Add action buttons
           this.addActionButtons();
           
           // Smooth scroll to results
           this.elements.resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
           
       } catch (error) {
           console.error('Display error:', error);
           this.showError("Failed to display results. Please try again.");
       }
   }

   displayProspectAdvice(data) {
    const { 
        summary = '',
        top_s_is = [],
        top_software_and_cloud = [],
        company_capabilities = [],
        naics_codes = [],
        prospect_recommendations = []
    } = data;
    
    const renderRankedList = (items) => {
        if (!items || items.length === 0) return '<p class="text-sm text-gray-500">No data available</p>';
        return `<ul class="space-y-1">${items.map((item, index) => `
            <li class="flex items-center gap-3 py-2 border-t border-gray-100 first:border-t-0 first:pt-0">
                <span class="text-xs font-bold text-customPurple-700 bg-customPurple-100 w-6 h-6 flex items-center justify-center rounded-full flex-shrink-0">${index + 1}</span>
                <span class="flex-1 font-medium text-gray-800 min-w-0 pr-2">${item.company || 'Unknown'}</span>
                <span class="text-sm font-semibold text-gray-600 flex-shrink-0">${item.value || 'N/A'}</span>
            </li>
        `).join('')}</ul>`;
    };
    
    const html = `
    <div class="fade-in space-y-6">
        <div class="dashboard-card bg-gradient-to-r from-customPurple-100 to-customPurple-200">
            <h3 class="text-xl font-bold text-customPurple-900 mb-2">Key Market Insights</h3>
            <div class="text-customPurple-900/90">${marked.parse(summary)}</div>
        </div>

        <div class="dashboard-card">
            <h3 class="font-bold text-gray-900 mb-3">Top Contractors</h3>
            ${renderRankedList(top_s_is)}
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div class="dashboard-card">
                <h3 class="font-bold text-gray-900 mb-3">Mission Needs</h3>
                <ul class="space-y-2 text-sm">${company_capabilities.map(c => `
                    <li class="flex gap-2">
                        <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span>${c}</span>
                    </li>`).join('')}
                </ul>
            </div>
            
            <div class="dashboard-card">
                <h3 class="font-bold text-gray-900 mb-3">Relevant NAICS Codes</h3>
                <ul class="space-y-2 text-sm">${naics_codes.map(n => {
                    // Handle both string format and object format
                    const naicsText = typeof n === 'string' ? n : (n.code ? `${n.code} - ${n.description || ''}` : 'Unknown');
                    return `
                    <li class="flex gap-2">
                        <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                        </svg>
                        <span class="break-words">${naicsText}</span>
                    </li>`;
                }).join('')}
                </ul>
            </div>
        </div>

        <div class="dashboard-card">
            <h3 class="font-bold text-gray-900 mb-3">Potential Software Plays</h3>
            ${renderRankedList(top_software_and_cloud)}
        </div>

        <div class="dashboard-card">
            <h3 class="font-bold text-gray-900 mb-3">Strategic Recommendations</h3>
            <ul class="space-y-2 text-sm">${prospect_recommendations.map(r => `
                <li class="flex gap-3">
                    <span class="text-customPurple-500 font-bold text-lg flex-shrink-0 -mt-1">→</span>
                    <span>${r}</span>
                </li>`).join('')}
            </ul>
        </div>
    </div>`;
    
    this.elements.resultsContainer.innerHTML = html;
}

   displayGeneralAdvice(data) {
       const { 
           quick_take = '',
           key_moves = [],
           mermaid_chart = '',
           talking_points = [],
           email_template = '',
           next_steps = '',
           response_type = 'deal'
       } = data;
       
       const html = `
       <div class="fade-in space-y-6">
           <div class="bg-gradient-to-r from-customPurple-100 to-customPurple-200 rounded-xl p-6 flow-root">
               <img src="/images/arti_right.png" alt="Arti" class="h-12 w-12 float-left mr-4 mb-2">
               <div class="text-customPurple-900/80 space-y-2">${marked.parse(quick_take)}</div>
           </div>

           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
               <div class="dashboard-card">
                   <h3 class="font-bold text-gray-900 mb-4">Your Next 3 Moves</h3>
                   <div class="space-y-3">${key_moves.slice(0, 3).map((m, i) => `
                       <div class="flex gap-3">
                           <span class="flex-shrink-0 w-7 h-7 bg-customPurple-200 text-customPurple-700 rounded-full flex items-center justify-center text-sm font-bold">${i + 1}</span>
                           <div class="flex-1">
                               <p class="font-medium text-gray-900">${m.action}</p>
                               <p class="text-sm text-gray-600 mt-1">${m.why}</p>
                           </div>
                       </div>`).join('')}
                   </div>
               </div>
               
               <div class="dashboard-card">
                   <h3 class="font-bold text-gray-900 mb-4">Game Plan</h3>
                   ${mermaid_chart ? `
                       <div class="mermaid-container">
                           <div class="mermaid-loading">
                               <div class="loader"></div>
                           </div>
                           <div id="mermaid-diagram" class="mermaid" style="opacity: 0;">${mermaid_chart}</div>
                       </div>` : 
                       '<div class="p-4 bg-gray-50 rounded-lg text-center"><p class="text-gray-600">Visual game plan not available</p></div>'
                   }
               </div>
           </div>

           ${(talking_points?.length > 0 || email_template) ? `
           <div class="dashboard-card">
               <h3 class="font-bold text-gray-900 mb-4">Communications</h3>
               <div class="grid grid-cols-1 ${email_template && talking_points?.length > 0 ? 'md:grid-cols-2' : ''} gap-6">
                   ${talking_points?.length > 0 ? `
                       <div>
                           <h4 class="font-semibold text-gray-800 mb-3">
                               ${response_type === 'interview' ? 'What They May Ask' : 'What to Ask'}
                           </h4>
                           <ul class="space-y-2 text-sm">${talking_points.map(t => `
                               <li class="flex gap-2">
                                   <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                       <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                   </svg>${t}
                               </li>`).join('')}
                           </ul>
                       </div>` : ''}
                   
                   ${email_template ? `
                       <div>
                           <h4 class="font-semibold text-gray-800 mb-3">Email Template</h4>
                           <div class="bg-gray-50 rounded-lg p-4 font-mono text-sm text-gray-700 whitespace-pre-wrap border">${email_template}</div>
                       </div>` : ''}
               </div>
           </div>` : ''}
           
           ${next_steps ? `
               <div class="bg-customPurple-200/60 p-4 rounded-lg text-sm text-customPurple-900">
                   <b class="font-semibold">Remember:</b> ${next_steps}
               </div>` : ''}
       </div>`;
       
       this.elements.resultsContainer.innerHTML = html;
  }     
       // Render mermaid chart with proper timing
       if (mermaid_chart) {
           this.renderMermaidChart();
       }
   }

   async renderMermaidChart() {
    try {
        // Give DOM time to settle
        await new Promise(resolve => setTimeout(resolve, 100));
        
        const element = document.getElementById('mermaid-diagram');
        if (!element) return;
        
        // Sanitize the mermaid chart content
        let chartContent = element.textContent;
        
        // Fix common Mermaid syntax issues
        chartContent = this.sanitizeMermaidChart(chartContent);
        
        // Update the element with sanitized content
        element.textContent = chartContent;
        
        // Run mermaid
        await mermaid.run();
        
        // Fade in the chart
        element.style.opacity = '1';
        element.style.transition = 'opacity 0.3s ease-in';
        
        // Hide loader
        const loader = element.parentElement.querySelector('.mermaid-loading');
        if (loader) loader.style.display = 'none';
        
    } catch (error) {
        console.error('Mermaid rendering error:', error);
        const container = document.querySelector('.mermaid-container');
        if (container) {
            container.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Game plan visualization unavailable</div>';
        }
    }
}

sanitizeMermaidChart(chart) {
    // Replace problematic characters in node labels
    return chart.replace(/\[([^\]]+)\]/g, (match, label) => {
        // Escape special characters that break Mermaid parsing
        const sanitized = label
            .replace(/\(/g, '❨')  // Replace ( with unicode alternative
            .replace(/\)/g, '❩')  // Replace ) with unicode alternative
            .replace(/&/g, 'and') // Replace & with 'and'
            .replace(/'/g, ''')   // Replace ' with smart quote
            .replace(/"/g, '"')   // Replace " with smart quote
            .replace(/</g, '‹')   // Replace < with unicode alternative
            .replace(/>/g, '›')   // Replace > with unicode alternative
            .replace(/\|/g, '┃')  // Replace | with unicode alternative
            .replace(/\{/g, '❴')  // Replace { with unicode alternative
            .replace(/\}/g, '❵')  // Replace } with unicode alternative
            .replace(/\[/g, '⟦')  // Replace [ with unicode alternative
            .replace(/\]/g, '⟧')  // Replace ] with unicode alternative
            .replace(/\#/g, '♯')  // Replace # with unicode alternative
            .replace(/\$/g, '＄')  // Replace $ with unicode alternative
            .replace(/\%/g, '％')  // Replace % with unicode alternative
            .replace(/\^/g, '＾')  // Replace ^ with unicode alternative
            .replace(/\*/g, '✱')  // Replace * with unicode alternative
            .replace(/\+/g, '＋')  // Replace + with unicode alternative
            .replace(/\=/g, '＝')  // Replace = with unicode alternative
            .replace(/\~/g, '∼')  // Replace ~ with unicode alternative
            .replace(/\`/g, '｀')  // Replace ` with unicode alternative
            .replace(/\n/g, ' ')  // Replace newlines with spaces
            .replace(/\r/g, ' ')  // Replace carriage returns with spaces
            .replace(/\s+/g, ' ') // Collapse multiple spaces
            .trim();              // Trim whitespace
        
        return `[${sanitized}]`;
    });
}

   addActionButtons() {
       const buttonsHtml = `
           <div class="mt-8 flex flex-col sm:flex-row gap-3">
               <button onclick="app.copyResults()" class="flex-1 bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                   Copy to Clipboard
               </button>
               <button onclick="app.startOver()" class="flex-1 bg-white hover:bg-gray-50 text-gray-700 font-medium py-3 px-6 rounded-lg border border-gray-200 transition-colors">
                   Ask Another Question
               </button>
           </div>`;
       
       this.elements.resultsContainer.insertAdjacentHTML('beforeend', buttonsHtml);
   }

   copyResults() {
       const content = this.elements.resultsContainer.innerText;
       
       if (!content || content.trim() === '') {
           alert('No content to copy');
           return;
       }
       
       navigator.clipboard.writeText(content)
           .then(() => {
               const btn = this.elements.resultsContainer.querySelector('button');
               const originalText = btn.textContent;
               btn.textContent = 'Copied!';
               setTimeout(() => btn.textContent = originalText, 2000);
           })
           .catch(() => alert('Copy failed. Please try selecting and copying manually.'));
   }

   startOver() {
       if (this.state.abortController) {
           this.state.abortController.abort();
       }
       
       this.elements.situationInput.value = '';
       this.elements.resultsContainer.innerHTML = '';
       this.hideLoadingMessages();
       this.elements.errorMessage.classList.add('hidden');
       
       clearInterval(this.state.loadingInterval);
       this.state.pendingRequest = false;
       
       this.elements.situationInput.focus();
       window.scrollTo({ top: 0, behavior: 'smooth' });
   }

   share() {
       const shareData = {
           title: 'AskArti',
           text: 'Check out this Fed Sales Bot',
           url: 'https://askarti.com'
       };
       
       if (navigator.share) {
           navigator.share(shareData).catch(console.error);
       } else {
           navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`)
               .then(() => {
                   this.elements.shareBtn.textContent = 'Link Copied!';
                   setTimeout(() => this.elements.shareBtn.textContent = 'Share', 2000);
               })
               .catch(() => alert('Please copy the URL manually: https://askarti.com'));
       }
   }

   showModal() {
       this.elements.aboutModal.classList.remove('hidden');
       requestAnimationFrame(() => {
           this.elements.aboutModal.querySelector('.modal-content').classList.add('show');
       });
   }

   hideModal() {
       const content = this.elements.aboutModal.querySelector('.modal-content');
       content.classList.remove('show');
       setTimeout(() => this.elements.aboutModal.classList.add('hidden'), 200);
   }
}

// Initialize app
const app = new AskArti();
</script>
</body>
</html>