<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://askarti.com/">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti.">
    <meta name="twitter:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Favicons -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#523f9e">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/images/asklite.png" as="image">
    <link rel="preload" href="/images/arti_right.png" as="image">
    
    <!-- Styles and Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C6BBE',
                        customPurple: {
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            500: '#7C6BBE',
                            700: '#5A4E8C',
                            900: '#403866'
                        }
                    }
                }
            }
        }
    </script>
    
<style>
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
    }

    .loader {
        border: 2px solid #e5e7eb;
        border-top: 2px solid #7C6BBE;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .quick-prompt:hover {
        background-color: rgba(124, 107, 190, 0.1);
        transform: scale(1.02);
    }

    .sponsor-ad {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.05), rgba(124, 107, 190, 0.02));
        border: 1px solid rgba(124, 107, 190, 0.1);
        transition: all 0.3s ease;
    }

    .sponsor-ad:hover {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.08), rgba(124, 107, 190, 0.04));
        border-color: rgba(124, 107, 190, 0.2);
        transform: translateY(-1px);
    }

    .dashboard-card {
        background-color: white;
        border-radius: 0.75rem;
        border: 1px solid #e5e7eb;
        padding: 1.5rem;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .mermaid-container {
        text-align: center;
        min-height: 200px;
        position: relative;
    }

    .mermaid {
        display: inline-block;
        max-width: 100%;
    }

    .mermaid-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }

    .modal-backdrop {
        transition: opacity 0.2s ease-out;
    }

    .modal-content {
        transform: scale(0.95);
        opacity: 0;
        transition: all 0.2s ease-out;
    }

    .modal-content.show {
        transform: scale(1);
        opacity: 1;
    }

    .dashboard-card ul {
        max-width: 100%;
    }

    .dashboard-card li {
        word-break: break-word;
    }

    .dashboard-card .flex {
        min-width: 0;
    }

    .mode-btn {
        background-color: #e5e7eb;
        color: #6b7280;
    }

    .mode-btn.active {
        background-color: #7C6BBE;
        color: white;
    }

    .mode-content {
        transition: opacity 0.2s ease-in-out;
    }

    .chat-container {
        height: 60dvh;
        max-height: 500px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
    }

    @supports not (height: 100dvh) {
      .chat-container {
        height: 60vh;
      }
    }

    .chat-container::-webkit-scrollbar {
        width: 6px;
    }

    .chat-container::-webkit-scrollbar-track {
        background: #f3f4f6;
        border-radius: 3px;
    }

    .chat-container::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
    }

    .chat-message-user {
        background-color: #7C6BBE;
        color: white;
    }

    .chat-message-arti {
        background-color: white;
        color: #1f2937;
        border: 1px solid #e5e7eb;
    }

    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 12px 16px;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        background-color: #9ca3af;
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
        0%, 80%, 100% {
            transform: scale(0.8);
            opacity: 0.5;
        }
        40% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .chat-suggestion {
        transition: all 0.2s ease;
        border: 1px solid rgba(124, 107, 190, 0.3);
    }

    .chat-suggestion:hover {
        background-color: rgba(124, 107, 190, 0.1);
        transform: scale(1.02);
        border-color: rgba(124, 107, 190, 0.5);
    }

    /* Mobile layout improvements */
    @media (max-width: 640px) {
        .dashboard-card {
            padding: 1rem;
        }

        .chat-container {
            height: 60dvh;
        }

        .quick-prompt {
            font-size: 0.875rem;
            padding: 0.5rem 1rem;
        }

        .mode-btn {
            font-size: 0.875rem;
            min-height: 44px;
            flex: 1;
        }

        input[type="text"],
        input[type="email"],
        textarea {
            font-size: 16px !important; /* Prevent zoom on iOS */
        }

        #chat-input {
            min-height: 44px;
        }
    }

    /* iOS Safari viewport fix */
    @supports (-webkit-touch-callout: none) {
        .chat-container {
            height: 60dvh;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            -webkit-overflow-scrolling: touch;
        }
    }
</style>

</head>
<body class="bg-gray-50 text-gray-900">
    <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-20">
        <header class="text-center mb-4">
            <a href="/" aria-label="AskArti Home" class="inline-block">
                <img src="/images/asklite.png" alt="AskArti" class="h-16 w-auto md:h-20 lg:h-24">
            </a>
        </header>

        <main class="dashboard-card mb-3">
            <!-- Mode Toggle -->
            <div class="mode-toggle mb-4 flex justify-center gap-2">
                <button class="mode-btn px-4 py-2 rounded-lg font-medium transition-all active" data-mode="quick">
                    Quick Advice
                </button>
                <button class="mode-btn px-4 py-2 rounded-lg font-medium transition-all" data-mode="chat">
                    Chat with Arti
                </button>
            </div>

            <!-- Quick Mode (current interface) -->
            <div id="quick-mode" class="mode-content">
                <div class="mb-4">
                    <label for="situation-input" class="block text-lg font-semibold text-gray-900 mb-2 text-center">
                        Hi, I'm Arti, your 24/7 Sales Buddy. What's blocking your deal?
                    </label>
                    <textarea 
                        id="situation-input" 
                        rows="3" 
                        class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary resize-none placeholder-gray-500"
                        placeholder="Champion ghosted me after seeing pricing. $2M deal at DHS. Q4 commit."
                        maxlength="500"></textarea>
                    <div class="text-xs text-gray-500 mt-1">
                        <span class="hint-text">Don't like the results? Try "Chat with Arti".</span>
                    </div>
                </div>

                <div class="flex flex-wrap gap-2 justify-center mb-4">
                    <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                            data-text="Buyer at VA ghosted me after I sent pricing. CISO loves our competitor.">
                        Buyer Went Dark
                    </button>
                    <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                            data-text="Demo crashed at DOJ yesterday. CTO walked out. How to recover?">
                        Demo Crashed
                    </button>
                    <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                            data-text="Partner reps and Account reps fighting over deals, pipeline, and revenue recognition.">
							Partner Drama
                   </button>
                   <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                           data-text="Meeting DHS CIO next week and don't have a Champion. How to position our cybersecurity platform?">
                       Meeting Prep
                   </button>
                   <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                           data-text="AWS federal sales interview next week. Help me prep.">
                       Interview Prep
                   </button>
                   <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                           data-text="Prospect for janitorial services at VA.">
                       Prospecting
                   </button>
               </div>

               <div class="text-center">
                   <button id="ask-btn" class="bg-customPurple-500 hover:bg-customPurple-700 text-white font-semibold py-3 px-8 rounded-full transition-all inline-flex items-center gap-2 shadow-lg hover:shadow-xl">
                       <span id="btn-text">Ask Arti</span>
                       <div id="loader" class="loader hidden"></div>
                   </button>
               </div>
           </div>

            <!-- Chat Mode -->
            <div id="chat-mode" class="mode-content hidden">
                <div class="chat-container h-[60vh] sm:h-96 max-h-[400px] overflow-y-auto mb-4 bg-gray-50 rounded-lg p-3 sm:p-4" style="height: 60dvh;">
                    <div id="chat-messages" class="space-y-3 sm:space-y-4">
                        <div class="flex justify-start">
                            <div class="bg-white rounded-lg px-3 py-2 sm:px-4 sm:py-3 max-w-[90%] sm:max-w-[80%] shadow-sm">
                                <p class="text-gray-800 text-sm sm:text-base">Hey! I'm Arti. Tell me what's going on with your deal and I'll help you work through it. What's the situation?</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex gap-2 sticky bottom-0 bg-white pt-2 z-10">
                    <input 
                        type="text" 
                        id="chat-input"
                        inputmode="text"
                        autocomplete="off"
                        autocorrect="on"
                        autocapitalize="sentences"
                        spellcheck="true"
                        class="flex-1 p-2.5 sm:p-3 text-[16px] sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary min-h-[44px]"
                        placeholder="Type your message..."
                        maxlength="500">
                    <button 
                        id="chat-send-btn" 
                        class="bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg transition-all text-sm sm:text-base min-h-[44px] whitespace-nowrap"
                        style="touch-action: manipulation;">
                        Send
                    </button>
                    <button 
                        id="reset-chat-btn" 
                        class="bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium px-2 sm:px-3 py-2.5 sm:py-3 rounded-lg transition-all text-sm sm:text-base min-h-[44px] ml-1"
                        title="Start a new chat"
                        style="touch-action: manipulation;">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                        </svg>
                    </button>
                </div>
            </div>
        </main>

        <!-- Loading Message -->
        <div id="loading-message-container" class="text-center py-4 hidden">
            <p id="loading-message" class="text-gray-600"></p>
        </div>

        <!-- Error Message -->
        <div id="error-message" class="bg-red-50 border border-red-200 rounded-lg p-6 text-center mb-4 hidden">
            <p class="text-red-700 font-medium mb-2">Something went wrong</p>
            <p class="text-red-600 text-sm" id="error-details">We're having trouble connecting to Arti. Please try again in a moment.</p>
            <button id="retry-btn" class="mt-3 bg-red-100 hover:bg-red-200 text-red-700 font-medium py-2 px-4 rounded-lg text-sm">
                Try Again
            </button>
        </div>

        <!-- Results -->
        <div id="results-container"></div>

        <!-- Footer -->
        <footer class="text-center mt-8 sm:mt-12 space-y-3 sm:space-y-4 pb-20">
            <div class="flex justify-center gap-6 text-sm">
                <button id="about-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">About</button>
                <button id="share-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Share</button>
                <a href="mailto:mark@subhoo.com" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Contact</a>
            </div>

            <div class="sponsor-ad rounded-lg p-3 mb-4 text-sm bg-white border border-gray-200 not-italic text-left leading-normal text-gray-700">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs font-medium text-gray-600 bg-gray-100 px-2 py-1 rounded-full">SPONSOR</span>
                    <span class="text-gray-800 font-semibold">Hey there! Enjoyin' these results?</span>
                </div>
                <p class="text-sm leading-relaxed text-gray-700">
                    By the time I pay off all my scientists, all the lab coats, and my Lambda billâ€¦I'm losin' money every time you press that Ask Arti button.
                </p>
                <p class="mt-2 text-xs italic text-gray-500">
                    Don't let my loss be your loss. Sponsor this ad for the low low price of $99/mo.
                </p>
                <p class="mt-2 text-xs text-customPurple-600 font-medium">
                    <a href="mailto:mark@subhoo.com" class="hover:underline">Contact me to reserve this premium spot â†’</a>
                </p>
            </div>

            <p class="text-xs text-gray-400">
                AskArti.com results are provided for informational and educational purposes only and do not constitute professional business advice. AI can make errors or provide recommendations that may not suit your specific situation. Please consult qualified professionals before making important business decisions.
            </p>

            <br>

            <p class="text-xs text-gray-400">Â© 2025 AskArti. Made for Sellers by Sellers.</p>
        </footer>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 modal-backdrop">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 modal-content">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <img src="images/oldmark.jpg" alt="Mark Flournoy" class="w-12 h-12 rounded-full object-cover border-2 border-customPurple-200">
                    <h2 class="text-xl font-bold text-gray-900">Hi, I'm Mark</h2>
                </div>
                <button id="close-about" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700">
                <p>I built AskArti to help salespeople use AI in a practical way to better support federal customers. Arti's not perfect, so use your judgment, but he's available 24/7 when you need to talk through a stuck deal or prep for a tough meeting.</p>
                
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="bg-gray-50 rounded-lg p-4 text-sm">
                        <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-customPurple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Privacy & Technology
                        </h3>
                        <p class="text-gray-600 mb-2">AskArti uses models that may include Gemini, Claude, and ChatGPT. These models may use API inputs to improve responses. We do not store, log, or persist any prompt or response data. All processing occurs in-memory using AWS Lambda and is discarded after execution.</p>
                    </div>
                </div>
                
                <div class="pt-4">
                    <a href="https://calendly.com/markflournoy/30min" target="_blank" class="block w-full bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors">
                        Let's chat about AI or Fed Sales â†’
                    </a>
                </div>
            </div>
        </div>
    </div>

<script>
// Configuration
const CONFIG = {
   API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
   REQUEST_TIMEOUT: 25000,
   MAX_RETRIES: 2,
   RETRY_DELAY: 2000,
   MAX_INPUT_LENGTH: 500,
   MIN_REQUEST_INTERVAL: 2000,
   LOADING_MESSAGES: [
       "Hang on. I'm...Working Backwards", 
       "...Diving Deep", 
       "...Unpacking This", 
       "...Putting a Pin in it", 
       "...Circling Back", 
       "...Thinking Big"
   ]
};

// Application class for better organization
class AskArti {
   constructor() {
    this.elements = this.getElements();
    this.state = {
        pendingRequest: false,
        lastRequestTime: 0,
        loadingInterval: null,
        abortController: null,
        lastQuery: '',
        currentMode: 'quick',
        chatHistory: [],
        messageCount: 0,
        lastChatMessage: '',
        errorRetries: 0,
        hasCompletedFirstRequest: false,
        hasCompletedSuccessfulRequest: false
    };
    this.init();
}

   getElements() {
       return {
           situationInput: document.getElementById('situation-input'),
           askBtn: document.getElementById('ask-btn'),
           btnText: document.getElementById('btn-text'),
           loader: document.getElementById('loader'),
           loadingMessageContainer: document.getElementById('loading-message-container'),
           loadingMessage: document.getElementById('loading-message'),
           errorMessage: document.getElementById('error-message'),
           errorDetails: document.getElementById('error-details'),
           retryBtn: document.getElementById('retry-btn'),
           resultsContainer: document.getElementById('results-container'),
           aboutBtn: document.getElementById('about-btn'),
           aboutModal: document.getElementById('about-modal'),
           closeAbout: document.getElementById('close-about'),
           shareBtn: document.getElementById('share-btn'),
           quickPromptBtns: document.querySelectorAll('.quick-prompt'),
           modeButtons: document.querySelectorAll('.mode-btn'),
           quickMode: document.getElementById('quick-mode'),
           chatMode: document.getElementById('chat-mode'),
           chatMessages: document.getElementById('chat-messages'),
           chatInput: document.getElementById('chat-input'),
           chatSendBtn: document.getElementById('chat-send-btn'),
           resetChatBtn: document.getElementById('reset-chat-btn')
       };
   }

   init() {
       this.initializeMermaid();
       this.setupEventListeners();
       this.elements.situationInput.focus();
   }

   initializeMermaid() {
       mermaid.initialize({ 
           startOnLoad: false,
           securityLevel: 'strict',
           theme: 'default',
           flowchart: {
               htmlLabels: true,
               curve: 'linear'
           }
       });
   }

   setupEventListeners() {
       // Quick prompts
       // Update the setupEventListeners method:
// Quick prompts
this.elements.quickPromptBtns.forEach(btn => {
    btn.addEventListener('click', (e) => {
        // Prevent multiple clicks
        if (btn.dataset.loading === 'true' || this.state.pendingRequest) {
            return;
        }
        
        // Mark button as loading
        btn.dataset.loading = 'true';
        const originalText = btn.textContent;
        btn.textContent = 'Loading...';
        
        // Set the input value
        this.elements.situationInput.value = e.currentTarget.dataset.text;
        
        // Process the request
        this.getAdvice()
            .finally(() => {
                // Reset button state after request completes
                btn.dataset.loading = 'false';
                btn.textContent = originalText;
            });
    });
});
       // Main button
       this.elements.askBtn.addEventListener('click', () => this.getAdvice());
       
       // Enter key
       this.elements.situationInput.addEventListener('keydown', (e) => {
           if (e.key === 'Enter' && !e.shiftKey) {
               e.preventDefault();
               this.getAdvice();
           }
       });

       // Retry
       this.elements.retryBtn.addEventListener('click', () => {
           this.elements.errorMessage.classList.add('hidden');
           if (this.state.lastQuery) {
               this.elements.situationInput.value = this.state.lastQuery;
               this.getAdvice();
           }
       });
       
       // Reset chat button
       this.elements.resetChatBtn.addEventListener('click', () => this.resetChat());
       
       // Share
       this.elements.shareBtn.addEventListener('click', () => this.share());

       // About modal
       this.elements.aboutBtn.addEventListener('click', () => this.showModal());
       this.elements.closeAbout.addEventListener('click', () => this.hideModal());
       this.elements.aboutModal.addEventListener('click', (e) => {
           if (e.target === this.elements.aboutModal) this.hideModal();
       });

       // Escape key
       document.addEventListener('keydown', (e) => {
           if (e.key === 'Escape') this.hideModal();
       });

       // Mode toggle
       this.elements.modeButtons.forEach(btn => {
           btn.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode));
       });

       // Chat events
       this.elements.chatSendBtn.addEventListener('click', () => this.sendChatMessage());
       this.elements.chatInput.addEventListener('keydown', (e) => {
           if (e.key === 'Enter' && !e.shiftKey) {
               e.preventDefault();
               this.sendChatMessage();
           }
       });
   }

   switchMode(mode) {
       this.state.currentMode = mode;
       
       // Update button states
       this.elements.modeButtons.forEach(btn => {
           btn.classList.toggle('active', btn.dataset.mode === mode);
       });

       // Show/hide content
       if (mode === 'quick') {
           this.elements.quickMode.classList.remove('hidden');
           this.elements.chatMode.classList.add('hidden');
           this.elements.situationInput.focus();
       } else {
           this.elements.quickMode.classList.add('hidden');
           this.elements.chatMode.classList.remove('hidden');
           this.elements.chatInput.focus();
       }
   }

   addChatMessage(content, isUser = false) {
       const now = new Date();
       const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
       
       const messageHtml = `
           <div class="flex ${isUser ? 'justify-end' : 'justify-start'}">
               <div class="${isUser ? 'chat-message-user' : 'chat-message-arti'} 
                           rounded-lg px-4 py-3 max-w-[80%] shadow-sm">
                   ${isUser ? content : marked.parse(content)}
                   <div class="text-xs ${isUser ? 'text-white/70' : 'text-gray-400'} mt-1 text-right">${timeString}</div>
               </div>
           </div>
       `;
       
       this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
       this.scrollChatToBottom();
   }

   showTypingIndicator() {
       const typingHtml = `
           <div id="typing-indicator" class="flex justify-start">
               <div class="bg-white rounded-lg shadow-sm typing-indicator">
                   <div class="typing-dot"></div>
                   <div class="typing-dot"></div>
                   <div class="typing-dot"></div>
               </div>
           </div>
       `;
       this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
       this.scrollChatToBottom();
   }

   hideTypingIndicator() {
       const indicator = document.getElementById('typing-indicator');
       if (indicator) indicator.remove();
   }
   
   resetChat() {
       // Clear chat history
       this.state.chatHistory = [];
       this.state.messageCount = 0;
       this.state.lastChatMessage = '';
       this.state.errorRetries = 0;
       
       // Clear chat UI
       this.elements.chatMessages.innerHTML = '';
       this.elements.chatInput.value = '';
       
       // Add welcome message
       const welcomeMessage = `
           <div class="flex justify-start">
               <div class="bg-white rounded-lg px-3 py-2 sm:px-4 sm:py-3 max-w-[90%] sm:max-w-[80%] shadow-sm">
                   <p class="text-gray-800 text-sm sm:text-base">Hey! I'm Arti. Tell me what's going on with your deal and I'll help you work through it. What's the situation?</p>
               </div>
           </div>
       `;
       this.elements.chatMessages.innerHTML = welcomeMessage;
       
       // Focus on input
       this.elements.chatInput.focus();
   }
   
   scrollChatToBottom() {
       const scrollContainer = document.querySelector('.chat-container');
       if (!scrollContainer) return;

       requestAnimationFrame(() => {
           scrollContainer.scrollTop = scrollContainer.scrollHeight;
           setTimeout(() => {
               scrollContainer.scrollTop = scrollContainer.scrollHeight;
           }, 100); // Handles late content rendering like images or Mermaid charts
       });
   }

   createTimeoutSignal(timeoutMs) {
       const controller = new AbortController();
       setTimeout(() => controller.abort(), timeoutMs);
       return controller.signal;
   }

   async makeChatRequest(message) {
       // Process conversation history with smart truncation
       let conversationContext = this.state.chatHistory;
       
       // If history is getting long, keep only more recent exchanges but preserve some context
       const fullHistoryLength = JSON.stringify(conversationContext).length;
       if (fullHistoryLength > 4000) {
           // Keep most recent exchanges
           conversationContext = this.state.chatHistory.slice(-15);
       }
       
       console.log('Chat History Length:', this.state.chatHistory.length);
       console.log('Message Count:', this.state.messageCount);
       console.log('Context Length:', JSON.stringify(conversationContext).length);
       
       // Add retry mechanism with exponential backoff
       let retries = 0;
       const maxRetries = 2;
       
       while (retries <= maxRetries) {
           try {
               const response = await fetch(CONFIG.API_ENDPOINT, {
                   method: 'POST',
                   headers: { 'Content-Type': 'application/json' },
                   body: JSON.stringify({ 
                       situation: message,
                       mode: 'chat',
                       conversationHistory: conversationContext
                   }),
                   signal: this.createTimeoutSignal(CONFIG.REQUEST_TIMEOUT)
               });

               if (!response.ok) {
                   const errorText = await response.text();
                   console.error('Chat API Error:', response.status, errorText);
                   throw new Error(`Server error (${response.status}): ${errorText}`);
               }

               let data;
               try {
                   data = await response.json();
               } catch (jsonError) {
                   console.error('JSON parse error:', jsonError);
                   throw new Error('Failed to parse server response');
               }
               
               if (data.error) {
                   console.error('Chat API returned error:', data);
                   throw new Error(data.message || data.error);
               }
               
               // Validate response structure here
               if (!data.message) {
                   console.error('Invalid response structure:', data);
                   throw new Error('Invalid response from server');
               }
               
               return data;
           } catch (error) {
               console.error(`Chat request failed (attempt ${retries + 1}/${maxRetries + 1}):`, error);
               
               // If we've reached max retries, throw the error
               if (retries === maxRetries) {
                   throw error;
               }
               
               // Otherwise, wait before retrying
               const waitTime = Math.pow(2, retries) * 1000; // Exponential backoff
               await new Promise(resolve => setTimeout(resolve, waitTime));
               retries++;
               
               // Log that we're retrying
               console.log(`Retrying request, attempt ${retries + 1}/${maxRetries + 1}`);
           }
       }
   }

   async sendChatMessage() {
       const message = this.elements.chatInput.value.trim();
       if (!message || this.state.pendingRequest) return;

       // Add more robust input sanitization
       const sanitizedMessage = message
           .replace(/<\/?[^>]+(>|$)/g, "") // Remove any HTML tags
           .trim();
           
       if (!sanitizedMessage) {
           this.showTemporaryMessage("Please enter a valid message", "warning");
           return;
       }

       // Validate message length
       if (sanitizedMessage.length > CONFIG.MAX_INPUT_LENGTH) {
           this.addChatMessage("That message is a bit long. Try breaking it into smaller parts.", false);
           return;
       }

       // Save message for potential retry
       this.state.lastChatMessage = sanitizedMessage;

       // Add user message
       this.addChatMessage(sanitizedMessage, true);
       this.elements.chatInput.value = '';
       
       // Add to chat history
       this.state.chatHistory.push({ role: 'user', content: sanitizedMessage });
       this.state.messageCount++;

       // Show typing indicator
       this.showTypingIndicator();
       this.state.pendingRequest = true;

       try {
           const response = await this.makeChatRequest(sanitizedMessage);
           
           // Add a short, random delay to make the typing feel more natural
           const typingDelay = 500 + Math.random() * 1000; // 0.5 to 1.5 seconds
           await new Promise(resolve => setTimeout(resolve, typingDelay));
           
           this.hideTypingIndicator();
           
           // Validate response structure
           if (!response || typeof response !== 'object') {
               throw new Error('Invalid response format');
           }

           const messageContent = response.message;
           if (!messageContent) {
               console.error('Missing message in response:', response);
               throw new Error('No message in response');
           }
           
           // Add Arti's response
           this.addChatMessage(messageContent);
           this.state.chatHistory.push({ role: 'assistant', content: messageContent });

           // Reset error retry counter on success
           this.state.errorRetries = 0;

           // Add follow-up suggestions if provided
           if (response.suggestions && Array.isArray(response.suggestions) && response.suggestions.length > 0) {
               this.addFollowUpSuggestions(response.suggestions);
           }

       } catch (error) {
           this.hideTypingIndicator();
           console.error('Chat error details:', error);
           
           // Increment error counter
           this.state.errorRetries++;
           
           // More specific error messages
           let errorMessage = "I'm having trouble connecting right now.";
           let errorType = "connection";
           
           if (error.message.includes('timeout') || error.name === 'AbortError') {
               errorMessage = "That took too long to process. Please try a shorter message.";
               errorType = "timeout";
           } else if (error.message.includes('400')) {
               errorMessage = "There was an issue with your message format. Please try rephrasing.";
               errorType = "format";
           } else if (error.message.includes('500') || error.message.includes('server')) {
               errorMessage = "I'm having server issues. Please try again in a moment.";
               errorType = "server";
           } else if (error.message.includes('parse') || error.message.includes('Invalid response')) {
               errorMessage = "I received an invalid response from the server. Let's try again.";
               errorType = "parsing";
           }
           
           // Add retry button with error message
           const errorHtml = `
               <div class="flex justify-start">
                   <div class="bg-red-50 rounded-lg px-4 py-3 max-w-[90%] shadow-sm border border-red-200">
                       <p class="text-red-700 text-sm">${errorMessage}</p>
                       <button id="chat-retry-btn" class="mt-2 text-xs bg-red-100 hover:bg-red-200 text-red-700 font-medium py-1 px-2 rounded">
                           Retry message
                       </button>
                   </div>
               </div>
           `;
           this.elements.chatMessages.insertAdjacentHTML('beforeend', errorHtml);
           this.scrollChatToBottom();
           
           // Add event listener to the retry button
           document.getElementById('chat-retry-btn').addEventListener('click', () => this.retryLastChatMessage());
           
           // For certain types of errors, automatically retry once after a delay
           if ((errorType === "server" || errorType === "connection" || errorType === "parsing") && this.state.errorRetries <= 1) {
               setTimeout(() => {
                   const retryButton = document.getElementById('chat-retry-btn');
                   if (retryButton) {
                       // Only auto-retry if the button still exists (user hasn't manually retried)
                       this.retryLastChatMessage();
                   }
               }, 3000);
           }
           
           // If we've had multiple server errors, provide a fallback response
           if (this.state.errorRetries >= 2) {
               this.provideFallbackResponse();
           }
       } finally {
           this.state.pendingRequest = false;
       }
   }

   provideFallbackResponse() {
       const fallbackResponses = [
           "I'm having some trouble connecting to my systems right now. Could you try again in a moment?",
           "Sorry about that - I seem to be having a technical hiccup. Let's try again.",
           "My server connection is unstable at the moment. Please try again shortly.",
           "I apologize for the interruption. Let's get back on track - could you repeat your last question?"
       ];
       
       const randomResponse = fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
       
       // Add the fallback response as if it came from Arti
       this.addChatMessage(randomResponse);
       
       // Add a simple set of suggestions
       const suggestionsHtml = `
           <div class="mt-4 px-2">
               <p class="text-xs text-gray-500 mb-2 text-center">Would you like to:</p>
               <div class="flex gap-2 flex-wrap justify-center">
                   <button class="chat-suggestion px-3 py-1.5 bg-blue-50 hover:bg-blue-100 rounded-full text-sm text-blue-700 hover:text-blue-800 transition-all"
                           onclick="app.resetChat()">
                       Start a new conversation
                   </button>
                   <button class="chat-suggestion px-3 py-1.5 bg-blue-50 hover:bg-blue-100 rounded-full text-sm text-blue-700 hover:text-blue-800 transition-all"
                           onclick="app.retryLastChatMessage()">
                       Try again
                   </button>
               </div>
           </div>
       `;
       this.elements.chatMessages.insertAdjacentHTML('beforeend', suggestionsHtml);
       this.scrollChatToBottom();
   }

   async retryLastChatMessage() {
       if (!this.state.lastChatMessage || this.state.pendingRequest) return;
       
       // Remove the error message with retry button
       const errorElement = document.getElementById('chat-retry-btn')?.closest('.flex');
       if (errorElement) {
           errorElement.remove();
       }
       
       // Set the message back in the input field and send it
       this.elements.chatInput.value = this.state.lastChatMessage;
       this.sendChatMessage();
   }

   addFollowUpSuggestions(suggestions) {
       const suggestionsHtml = `
           <div class="mt-4 px-2">
               <p class="text-xs text-gray-500 mb-2 text-center">Tell me more or tap a suggestion:</p>
               <div class="flex gap-2 flex-wrap justify-center">
                   ${suggestions.map(s => `
                       <button class="chat-suggestion px-3 py-1.5 bg-blue-50 hover:bg-blue-100 rounded-full text-sm text-blue-700 hover:text-blue-800 transition-all"
                               onclick="app.useSuggestion('${s.replace(/'/g, "\\'")}')">
                           ${s}
                       </button>
                   `).join('')}
               </div>
           </div>
       `;
       this.elements.chatMessages.insertAdjacentHTML('beforeend', suggestionsHtml);
       this.scrollChatToBottom();
   }

   useSuggestion(suggestion) {
       this.elements.chatInput.value = suggestion;
       this.sendChatMessage();
   }

   setLoading(loading) {
       this.elements.btnText.style.display = loading ? 'none' : 'inline';
       this.elements.loader.style.display = loading ? 'block' : 'none';
       this.elements.askBtn.disabled = loading;
       this.elements.errorMessage.classList.add('hidden');
       
       if (loading) {
           this.showLoadingMessages();
       } else {
           this.hideLoadingMessages();
       }
   }

   showLoadingMessages() {
       this.elements.loadingMessageContainer.classList.remove('hidden');
       this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[0];
       
       let messageIndex = 0;
       this.state.loadingInterval = setInterval(() => {
           messageIndex = (messageIndex + 1) % CONFIG.LOADING_MESSAGES.length;
           this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[messageIndex];
       }, 2000);
   }

   hideLoadingMessages() {
       clearInterval(this.state.loadingInterval);
       this.elements.loadingMessageContainer.classList.add('hidden');
   }

   showError(message) {
       this.hideLoadingMessages();
       this.elements.errorMessage.classList.remove('hidden');
       this.elements.errorDetails.textContent = message;
       this.setLoading(false);
   }

   showTemporaryMessage(message, type = 'info', duration = 2000) {
       this.elements.loadingMessageContainer.classList.remove('hidden');
       this.elements.loadingMessage.textContent = message;
       
       const colorClasses = {
           error: 'text-red-700 font-medium',
           warning: 'text-orange-700 font-medium',
           info: 'text-gray-600'
       };
       
       this.elements.loadingMessage.className = colorClasses[type] || colorClasses.info;
       
       setTimeout(() => {
           this.elements.loadingMessageContainer.classList.add('hidden');
       }, duration);
   }

   // Update the getAdvice method in the AskArti class:
async getAdvice() {
    const situation = this.elements.situationInput.value.trim();
    
    // Rate limiting
    const now = Date.now();
    if (now - this.state.lastRequestTime < CONFIG.MIN_REQUEST_INTERVAL) {
        this.showTemporaryMessage("Easy there, killer. Give me a sec to catch my breath.", 'warning');
        return;
    }
    
    // Validation
    if (!situation) {
        this.showTemporaryMessage("Drop your situation in the box above ðŸ‘†", 'error');
        return;
    }
    
    // Prevent duplicate requests
    if (this.state.pendingRequest) return;
    
    this.state.lastRequestTime = now;
    this.state.lastQuery = situation;
    this.state.pendingRequest = true;
    
    // Clear previous results and show loading
    this.elements.resultsContainer.innerHTML = '';
    this.setLoading(true);
    
    try {
        // Add a small delay before the first request to ensure everything is initialized
        if (!this.state.hasCompletedFirstRequest) {
            await new Promise(resolve => setTimeout(resolve, 100));
            this.state.hasCompletedFirstRequest = true;
        }
        
        const data = await this.makeRequest(situation);
        
        // Ensure data is valid
        if (!data || typeof data !== 'object' || !data.response_type) {
            throw new Error('Invalid response data');
        }
        
        this.displayAdvice(data);
    } catch (error) {
        console.error('Request failed:', error);
        this.showError(error.message || "We're having trouble connecting to Arti. Please try again.");
        
        // Retry after a small delay for first-time failures
        if (!this.state.hasCompletedSuccessfulRequest) {
            setTimeout(() => {
                if (this.state.lastQuery === situation) {
                    console.log('Auto-retrying first request...');
                    this.state.pendingRequest = false;
                    this.getAdvice();
                }
            }, 1500);
        }
    } finally {
        this.state.pendingRequest = false;
        this.setLoading(false);
    }
}

   async makeRequest(situation) {
       this.state.abortController = new AbortController();
       
       const timeoutId = setTimeout(() => {
           this.state.abortController.abort();
       }, CONFIG.REQUEST_TIMEOUT);
       
       try {
           const response = await fetch(CONFIG.API_ENDPOINT, {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ situation }),
               signal: this.state.abortController.signal
           });
           
           clearTimeout(timeoutId);
           
           if (!response.ok) {
               throw new Error(`Server error (${response.status})`);
           }
           
           const data = await response.json();
           
           if (data.error) {
               throw new Error(data.message || data.error);
           }
           
           return data;
       } catch (error) {
           if (error.name === 'AbortError') {
               throw new Error('Request timed out. Please try again.');
           }
           throw error;
       }
   }

   displayAdvice(data) {
    const { response_type } = data;
    
    try {
        if (response_type === 'prospect') {
            this.displayProspectAdvice(data);
        } else {
            this.displayGeneralAdvice(data);
        }
        
        // Add action buttons
        this.addActionButtons();
        
        // Smooth scroll to results
        this.elements.resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        
        // Mark that we've completed a successful request
        this.state.hasCompletedSuccessfulRequest = true;
        
    } catch (error) {
        console.error('Display error:', error);
        this.showError("Failed to display results. Please try again.");
    }
}

   displayProspectAdvice(data) {
       const { 
           summary = '',
           top_s_is = [],
           top_software_and_cloud = [],
           company_capabilities = [],
           naics_codes = [],
           prospect_recommendations = []
       } = data;
       
       const renderSimpleList = (items) => {
           if (!items || items.length === 0) return '<p class="text-sm text-gray-500">No data available</p>';
           
           return `
           <div class="space-y-2">
               ${items.map((item, index) => `
                   <div class="border-l-4 border-customPurple-500 pl-3 py-1">
                       <div class="font-medium text-gray-900">
                           <span class="text-customPurple-600 font-bold">${index + 1}</span> 
                           ${item.company || 'Unknown'}
                       </div>
                       <div class="text-sm text-gray-600">${item.value || 'N/A'}</div>
                   </div>
               `).join('')}
           </div>`;
       };
       
       const html = `
       <div class="fade-in space-y-6">
	   <div class="dashboard-card bg-gradient-to-r from-customPurple-100 to-customPurple-200">
               <h3 class="text-xl font-bold text-customPurple-900 mb-2">Key Market Insights</h3>
               <div class="text-customPurple-900/90">${marked.parse(summary)}</div>
           </div>

           <div class="dashboard-card">
               <h3 class="font-bold text-gray-900 mb-4 text-lg">Top Contractors</h3>
               ${renderSimpleList(top_s_is)}
           </div>
           
           <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
               <div class="dashboard-card">
                   <h3 class="font-bold text-gray-900 mb-3">Mission Needs</h3>
                   <ul class="space-y-2 text-sm">${company_capabilities.map(c => `
                       <li class="flex gap-2">
                           <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                               <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                           </svg>
                           <span>${c}</span>
                       </li>`).join('')}
                   </ul>
               </div>
               
               <div class="dashboard-card">
                   <h3 class="font-bold text-gray-900 mb-3">Relevant NAICS Codes</h3>
                   <ul class="space-y-2 text-sm">${naics_codes.map(n => {
                       const naicsText = typeof n === 'string' ? n : (n.code ? `${n.code} - ${n.description || ''}` : 'Unknown');
                       return `
                       <li class="flex gap-2">
                           <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                               <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                           </svg>
                           <span>${naicsText}</span>
                       </li>`;
                   }).join('')}
                   </ul>
               </div>
           </div>

           <div class="dashboard-card">
               <h3 class="font-bold text-gray-900 mb-4 text-lg">Potential Software Plays</h3>
               ${renderSimpleList(top_software_and_cloud)}
           </div>

           <div class="dashboard-card">
               <h3 class="font-bold text-gray-900 mb-3">Strategic Recommendations</h3>
               <ul class="space-y-3 text-sm">${prospect_recommendations.map(r => `
                   <li class="flex gap-3">
                       <span class="text-customPurple-500 font-bold text-lg flex-shrink-0">â†’</span>
                       <span>${r}</span>
                   </li>`).join('')}
               </ul>
           </div>
       </div>`;
       
       this.elements.resultsContainer.innerHTML = html;
   }

   displayGeneralAdvice(data) {
       const { 
           quick_take = '',
           key_moves = [],
           mermaid_chart = '',
           talking_points = [],
           email_template = '',
           next_steps = '',
           response_type = 'deal'
       } = data;
       
       const html = `
       <div class="fade-in space-y-6">
           <div class="bg-gradient-to-r from-customPurple-100 to-customPurple-200 rounded-xl p-6 flow-root">
               <img src="/images/arti_right.png" alt="Arti" class="h-12 w-12 float-left mr-4 mb-2">
               <div class="text-customPurple-900/80 space-y-2">${marked.parse(quick_take)}</div>
           </div>

           <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
               <div class="dashboard-card">
                   <h3 class="font-bold text-gray-900 mb-4">Your Next 3 Moves</h3>
                   <div class="space-y-3">${key_moves.slice(0, 3).map((m, i) => `
                       <div class="flex gap-3">
                           <span class="flex-shrink-0 w-7 h-7 bg-customPurple-200 text-customPurple-700 rounded-full flex items-center justify-center text-sm font-bold">${i + 1}</span>
                           <div class="flex-1">
                               <p class="font-medium text-gray-900">${m.action}</p>
                               <p class="text-sm text-gray-600 mt-1">${m.why}</p>
                           </div>
                       </div>`).join('')}
                   </div>
               </div>
               
               <div class="dashboard-card">
                   <h3 class="font-bold text-gray-900 mb-4">Game Plan</h3>
                   ${mermaid_chart ? `
                       <div class="mermaid-container">
                           <div class="mermaid-loading">
                               <div class="loader"></div>
                           </div>
                           <div id="mermaid-diagram" class="mermaid" style="opacity: 0;">${mermaid_chart}</div>
                       </div>` : 
                       '<div class="p-4 bg-gray-50 rounded-lg text-center"><p class="text-gray-600">Visual game plan not available</p></div>'
                   }
               </div>
           </div>

           ${(talking_points?.length > 0 || email_template) ? `
           <div class="dashboard-card">
               <h3 class="font-bold text-gray-900 mb-4">Communications</h3>
               <div class="grid grid-cols-1 ${email_template && talking_points?.length > 0 ? 'md:grid-cols-2' : ''} gap-6">
                   ${talking_points?.length > 0 ? `
                       <div>
                           <h4 class="font-semibold text-gray-800 mb-3">
                               ${response_type === 'interview' ? 'What They May Ask' : 'What to Ask'}
                           </h4>
                           <ul class="space-y-2 text-sm">${talking_points.map(t => `
                               <li class="flex gap-2">
                                   <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                       <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                   </svg>${t}
                               </li>`).join('')}
                           </ul>
                       </div>` : ''}
                   
                   ${email_template ? `
                       <div>
                           <h4 class="font-semibold text-gray-800 mb-3">Email Template</h4>
                           <div class="bg-gray-50 rounded-lg p-4 font-mono text-sm text-gray-700 whitespace-pre-wrap border">${email_template}</div>
                       </div>` : ''}
               </div>
           </div>` : ''}
           
           ${next_steps ? `
               <div class="bg-customPurple-200/60 p-4 rounded-lg text-sm text-customPurple-900">
                   <b class="font-semibold">Remember:</b> ${next_steps}
               </div>` : ''}
       </div>`;
       
       this.elements.resultsContainer.innerHTML = html;
       
       // Render mermaid chart with proper timing
       if (mermaid_chart) {
           this.renderMermaidChart();
       }
   }

   async renderMermaidChart() {
       try {
           // Give DOM time to settle
           await new Promise(resolve => setTimeout(resolve, 100));
           
           const element = document.getElementById('mermaid-diagram');
           if (!element) return;
           
           // Run mermaid
           await mermaid.run();
           
           // Fade in the chart
           element.style.opacity = '1';
           element.style.transition = 'opacity 0.3s ease-in';
           
           // Hide loader
           const loader = element.parentElement.querySelector('.mermaid-loading');
           if (loader) loader.style.display = 'none';
           
       } catch (error) {
           console.error('Mermaid rendering error:', error);
           const container = document.querySelector('.mermaid-container');
           if (container) {
               container.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Game plan visualization unavailable</div>';
           }
       }
   }

   addActionButtons() {
       const buttonsHtml = `
           <div class="mt-8 flex flex-col sm:flex-row gap-3">
               <button onclick="app.copyResults()" class="flex-1 bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                   Copy to Clipboard
               </button>
               <button onclick="app.startOver()" class="flex-1 bg-white hover:bg-gray-50 text-gray-700 font-medium py-3 px-6 rounded-lg border border-gray-200 transition-colors">
                   Ask Another Question
               </button>
           </div>`;
       
       this.elements.resultsContainer.insertAdjacentHTML('beforeend', buttonsHtml);
   }

   copyResults() {
       const content = this.elements.resultsContainer.innerText;
       
       if (!content || content.trim() === '') {
           alert('No content to copy');
           return;
       }
       
       navigator.clipboard.writeText(content)
           .then(() => {
               const btn = this.elements.resultsContainer.querySelector('button');
               const originalText = btn.textContent;
               btn.textContent = 'Copied!';
               setTimeout(() => btn.textContent = originalText, 2000);
           })
           .catch(() => alert('Copy failed. Please try selecting and copying manually.'));
   }

   startOver() {
       if (this.state.abortController) {
           this.state.abortController.abort();
       }
       
       // Clear based on current mode
       if (this.state.currentMode === 'quick') {
           this.elements.situationInput.value = '';
           this.elements.situationInput.focus();
       } else {
           // In chat mode, just clear the input
           this.elements.chatInput.value = '';
           this.elements.chatInput.focus();
       }
       
       this.elements.resultsContainer.innerHTML = '';
       this.hideLoadingMessages();
       this.elements.errorMessage.classList.add('hidden');
       
       clearInterval(this.state.loadingInterval);
       this.state.pendingRequest = false;
       
       window.scrollTo({ top: 0, behavior: 'smooth' });
   }

   share() {
       const shareData = {
           title: 'AskArti',
           text: 'Check out this Fed Sales Bot',
           url: 'https://askarti.com'
       };
       
       if (navigator.share) {
           navigator.share(shareData).catch(console.error);
       } else {
           navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`)
               .then(() => {
                   this.elements.shareBtn.textContent = 'Link Copied!';
                   setTimeout(() => this.elements.shareBtn.textContent = 'Share', 2000);
               })
               .catch(() => alert('Please copy the URL manually: https://askarti.com'));
       }
   }

   showModal() {
       this.elements.aboutModal.classList.remove('hidden');
       requestAnimationFrame(() => {
           this.elements.aboutModal.querySelector('.modal-content').classList.add('show');
       });
   }

   hideModal() {
       const content = this.elements.aboutModal.querySelector('.modal-content');
       content.classList.remove('show');
       setTimeout(() => this.elements.aboutModal.classList.add('hidden'), 200);
   }
}

// Initialize app
const app = new AskArti();
</script>
</body>
</html>