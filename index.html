<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskArti - Your Fed Sales Therapist</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="When your boss wants impossible quota, your customer ghosts you, and your stakeholders vanish - Arti gets it. Real federal sales advice from someone who's been in the trenches.">
    <meta name="keywords" content="federal sales, government sales, deal therapy, sales burnout, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="AskArti - Your Federal Sales Therapist">
    <meta property="og:description" content="When federal sales is breaking you down, Arti builds you back up. No BS. No buzzwords. Just real talk.">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://askarti.com/">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Therapist">
    <meta name="twitter:description" content="Real federal sales advice from someone who gets it.">
    <meta name="twitter:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Favicons -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#7C6BBE">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/images/asklite.png" as="image">
    <link rel="preload" href="/images/arti_right.png" as="image">
    
    <!-- Styles and Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C6BBE',
                        customPurple: {
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            500: '#7C6BBE',
                            700: '#5A4E8C',
                            900: '#403866'
                        },
                        accountBlue: {
                            100: '#E6F0F9',
                            500: '#4A77B3',
                            700: '#345C96'
                        }
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 4s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-in-out',
                        'bounce-slow': 'bounce 3s infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' }
                        },
                        slideIn: {
                            '0%': { transform: 'translateX(-100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>
    
<style>
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        min-height: 100vh;
    }

    /* Mobile-first responsive design */
    .container-mobile {
        padding: 0.75rem;
        margin: 0 auto;
        max-width: 100%;
    }

    @media (min-width: 640px) {
        .container-mobile {
            padding: 1rem;
            max-width: 640px;
        }
    }

    @media (min-width: 768px) {
        .container-mobile {
            padding: 1.5rem;
            max-width: 768px;
        }
    }

    @media (min-width: 1024px) {
        .container-mobile {
            padding: 2rem;
            max-width: 1024px;
        }
    }

    /* Enhanced loader */
    .loader {
        border: 3px solid #e5e7eb;
        border-top: 3px solid #7C6BBE;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
    }

    @media (min-width: 640px) {
        .loader {
            width: 24px;
            height: 24px;
        }
    }

    .loader-text {
        animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Mobile-optimized chat bubbles */
    .chat-message-user {
        background: linear-gradient(135deg, #7C6BBE 0%, #5A4E8C 100%);
        color: white;
        position: relative;
        box-shadow: 0 2px 10px rgba(124, 107, 190, 0.3);
        font-size: 0.875rem;
        line-height: 1.4;
    }

    @media (min-width: 640px) {
        .chat-message-user {
            font-size: 1rem;
            line-height: 1.5;
        }
    }

    .chat-message-user::after {
        content: '';
        position: absolute;
        right: -6px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-left: 6px solid #5A4E8C;
        border-top: 6px solid transparent;
        border-bottom: 6px solid transparent;
    }

    @media (min-width: 640px) {
        .chat-message-user::after {
            right: -8px;
            border-left: 8px solid #5A4E8C;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
        }
    }

    .chat-message-arti {
        background: white;
        color: #1f2937;
        border: 1px solid #e5e7eb;
        position: relative;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        font-size: 0.875rem;
        line-height: 1.4;
    }

    @media (min-width: 640px) {
        .chat-message-arti {
            font-size: 1rem;
            line-height: 1.5;
        }
    }

    .chat-message-arti::after {
        content: '';
        position: absolute;
        left: -6px;
        top: 50%;
        transform: translateY(-50%);
        width: 0;
        height: 0;
        border-right: 6px solid white;
        border-top: 6px solid transparent;
        border-bottom: 6px solid transparent;
    }

    @media (min-width: 640px) {
        .chat-message-arti::after {
            left: -8px;
            border-right: 8px solid white;
            border-top: 8px solid transparent;
            border-bottom: 8px solid transparent;
        }
    }

    /* Mobile-first therapy card */
    .therapy-card {
        background: white;
        border-radius: 0.75rem;
        padding: 1rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        border: 1px solid rgba(124, 107, 190, 0.1);
        transition: all 0.3s ease;
    }

    @media (min-width: 640px) {
        .therapy-card {
            border-radius: 1rem;
            padding: 1.5rem;
        }
    }

    .therapy-card:hover {
        box-shadow: 0 8px 30px rgba(0, 0, 0, 0.12);
        transform: translateY(-2px);
    }

    /* Mobile-optimized typing indicator */
    .typing-indicator {
        display: flex;
        gap: 3px;
        padding: 12px 16px;
        background: white;
        border-radius: 16px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    @media (min-width: 640px) {
        .typing-indicator {
            gap: 4px;
            padding: 16px 20px;
            border-radius: 20px;
        }
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        background: linear-gradient(135deg, #7C6BBE 0%, #5A4E8C 100%);
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
    }

    @media (min-width: 640px) {
        .typing-dot {
            width: 10px;
            height: 10px;
        }
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    .typing-dot:nth-child(3) { animation-delay: 0s; }

    @keyframes typing {
        0%, 80%, 100% {
            transform: scale(0.8);
            opacity: 0.5;
        }
        40% {
            transform: scale(1.2);
            opacity: 1;
        }
    }

    /* Mobile-optimized mermaid container */
    .mermaid-container {
        text-align: center;
        min-height: 150px;
        position: relative;
        background: linear-gradient(135deg, #f9fafb 0%, #f3f4f6 100%);
        border-radius: 0.5rem;
        padding: 0.75rem;
    }

    @media (min-width: 640px) {
        .mermaid-container {
            min-height: 200px;
            border-radius: 0.75rem;
            padding: 1rem;
        }
    }

    /* Mobile-first sponsor ad */
    .sponsor-ad {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.05), rgba(124, 107, 190, 0.02));
        border: 2px dashed rgba(124, 107, 190, 0.2);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        font-size: 0.8125rem;
    }

    @media (min-width: 640px) {
        .sponsor-ad {
            font-size: 0.875rem;
        }
    }

    .sponsor-ad::before {
        content: 'ðŸ’¸';
        position: absolute;
        top: -15px;
        right: -15px;
        font-size: 40px;
        opacity: 0.1;
        transform: rotate(-15deg);
    }
	@media (min-width: 640px) {
        .sponsor-ad::before {
            top: -20px;
            right: -20px;
            font-size: 60px;
        }
    }

    .sponsor-ad:hover {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.08), rgba(124, 107, 190, 0.04));
        border-color: rgba(124, 107, 190, 0.3);
        transform: translateY(-1px);
    }

    /* Mobile-first input optimization */
    input[type="text"],
    input[type="email"],
    textarea {
        font-size: 16px !important; /* Prevents zoom on iOS */
    }

    /* Mobile-first chat container */
    .chat-container-mobile {
        height: 50vh;
        max-height: 350px;
        min-height: 250px;
    }

    @media (min-width: 640px) {
        .chat-container-mobile {
            height: 60vh;
            max-height: 500px;
            min-height: 350px;
        }
    }

    @media (min-width: 1024px) {
        .chat-container-mobile {
            height: 65vh;
            max-height: 600px;
        }
    }

    /* CRM-style table styling - mobile responsive */
    .crm-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 0.75rem;
    }

    @media (min-width: 640px) {
        .crm-table {
            font-size: 0.875rem;
        }
    }

    .crm-table th,
    .crm-table td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #e5e7eb;
    }

    @media (min-width: 640px) {
        .crm-table th,
        .crm-table td {
            padding: 12px;
        }
    }

    .crm-table th {
        background-color: #f9fafb;
        font-weight: 600;
        color: #374151;
        text-transform: uppercase;
        font-size: 0.625rem;
        letter-spacing: 0.05em;
    }

    @media (min-width: 640px) {
        .crm-table th {
            font-size: 0.75rem;
        }
    }

    .crm-section {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 8px;
        padding: 12px;
        margin-bottom: 12px;
    }

    @media (min-width: 640px) {
        .crm-section {
            padding: 20px;
            margin-bottom: 16px;
        }
    }

    .crm-header {
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border: 1px solid #e2e8f0;
        border-radius: 8px;
        padding: 16px;
        margin-bottom: 16px;
    }

    @media (min-width: 640px) {
        .crm-header {
            padding: 24px;
            margin-bottom: 24px;
        }
    }

    .status-badge {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 9999px;
        font-size: 0.625rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.05em;
    }

    @media (min-width: 640px) {
        .status-badge {
            padding: 4px 12px;
            font-size: 0.75rem;
        }
    }

    .status-high { background-color: #fef2f2; color: #991b1b; }
    .status-medium { background-color: #fefce8; color: #92400e; }
    .status-low { background-color: #f0fdf4; color: #166534; }
    .status-champion { background-color: #ecfdf5; color: #047857; }
    .status-neutral { background-color: #f8fafc; color: #475569; }
    .status-blocker { background-color: #fef2f2; color: #dc2626; }

    /* Mobile-first typography */
    .therapy-card h3 {
        font-size: 1rem;
        font-weight: 800;
        color: #1f2937;
    }

    @media (min-width: 640px) {
        .therapy-card h3 {
            font-size: 1.1rem;
        }
    }

    .therapy-card p, 
    .therapy-card li, 
    .therapy-card td,
    .therapy-card .prose {
        font-size: 0.8125rem;
        line-height: 1.6;
        color: #374151;
    }

    @media (min-width: 640px) {
        .therapy-card p, 
        .therapy-card li, 
        .therapy-card td,
        .therapy-card .prose {
            font-size: 0.9rem;
            line-height: 1.65;
        }
    }

    .therapy-card strong {
        color: #111827;
        font-weight: 700;
    }

    /* Mobile-first button styling */
    .btn-mobile {
        padding: 12px 16px;
        font-size: 0.875rem;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.2s ease;
    }

    @media (min-width: 640px) {
        .btn-mobile {
            padding: 14px 20px;
            font-size: 1rem;
            border-radius: 14px;
        }
    }

    .btn-mobile:active {
        transform: scale(0.98);
    }

    /* Quick tap target sizes for mobile */
    .tap-target {
        min-height: 44px;
        min-width: 44px;
    }

    /* Mobile-first modal */
    .modal-mobile {
        margin: 1rem;
        max-height: calc(100vh - 2rem);
        overflow-y: auto;
    }

    @media (min-width: 640px) {
        .modal-mobile {
            margin: 2rem;
            max-height: calc(100vh - 4rem);
        }
    }
</style>
</head>
<body class="bg-gradient-to-br from-gray-50 to-gray-100 text-gray-900 min-h-screen">
    <div class="container-mobile pt-4 pb-16">
        <!-- Mobile-first header -->
        <header class="text-center mb-4 animate-fade-in">
            <a href="/" aria-label="AskArti Home" class="inline-block group">
                <img src="/images/asklite.png" alt="AskArti" class="h-12 w-auto sm:h-16 md:h-20 lg:h-24 transition-transform group-hover:scale-105">
            </a>
            <p class="mt-2 text-xs sm:text-sm text-gray-600 font-medium">
                <span id="greeting-text" class="transition-all">Your Federal Sales Therapist</span>
            </p>
        </header>

        <main class="therapy-card mb-4 animate-slide-in">
            <!-- Mobile-optimized chat interface -->
            <div id="chat-interface">
                <div class="chat-container-mobile overflow-y-auto mb-3 rounded-lg p-3 sm:p-4 transition-all bg-gradient-to-br from-gray-50 to-slate-100" id="chat-container">
                    <div id="chat-messages" class="space-y-3">
                        <!-- Welcome message optimized for mobile -->
                        <div class="flex items-start gap-2 sm:gap-3">
                            <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 sm:w-10 sm:h-10 rounded-full animate-bounce-slow flex-shrink-0">
                            <div class="chat-message-arti rounded-xl sm:rounded-2xl px-3 py-2 sm:px-4 sm:py-3 max-w-[85%] animate-fade-in">
                                <p class="text-gray-800 leading-relaxed">
                                    <strong>Hey there.</strong> I'm Arti. Need help selling to the feds? 
                                    <br><br>
                                    <em>What agency are you targeting and what are you selling?</em> 
                                    <span class="text-gray-500 text-xs block mt-2">The more specific, the better plan I can build...</span>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Mobile-first input area -->
                <div class="flex gap-2 sticky bottom-0 bg-white/80 backdrop-blur-sm pt-2 z-10 rounded-lg">
                    <button 
                        id="clear-chat-btn"
                        class="tap-target p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 rounded-lg transition-all group flex-shrink-0"
                        title="Start fresh">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5 transition-transform group-hover:scale-110" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                    <input 
                        type="text" 
                        id="chat-input"
                        inputmode="text"
                        autocomplete="off"
                        autocorrect="on"
                        autocapitalize="sentences"
                        spellcheck="true"
                        class="flex-1 p-3 text-base border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary tap-target transition-all hover:border-gray-300"
                        placeholder="e.g., Need help selling AI to DHS..."
                        maxlength="500">
                    <button 
                        id="chat-send-btn" 
                        class="bg-gradient-to-r from-customPurple-500 to-customPurple-700 hover:from-customPurple-600 hover:to-customPurple-800 text-white font-medium px-4 py-3 rounded-lg transition-all tap-target whitespace-nowrap transform hover:scale-105 active:scale-95">
                        <span class="flex items-center gap-2">
                            <span class="hidden xs:inline">Send</span>
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                        </span>
                    </button>
                </div>

                <!-- Dynamic plan button that appears when AI detects plan intent -->
                <div id="plan-button-container" class="hidden animate-fade-in mt-3 p-3 border-t border-gray-200">
                    <button id="generate-plan-btn" onclick="app.generateAccountPlan()"
                            class="w-full bg-gradient-to-r from-accountBlue-500 to-accountBlue-700 hover:from-accountBlue-600 hover:to-accountBlue-800 text-white font-bold btn-mobile text-center flex items-center justify-center gap-2 transition-all transform hover:scale-105 shadow-lg tap-target">
                        <svg class="w-4 h-4 sm:w-5 sm:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                        </svg>
                        <span class="text-sm sm:text-base">Generate Strategic Account Plan</span>
                    </button>
                </div>
            </div>
        </main>

        <!-- Mobile-optimized loading -->
        <div id="loading-message-container" class="text-center py-3 hidden">
            <div class="inline-flex items-center gap-2 sm:gap-3 bg-white px-4 py-2 sm:px-6 sm:py-3 rounded-full shadow-lg">
                <div class="loader"></div>
                <p id="loading-message" class="text-gray-700 font-medium loader-text text-sm sm:text-base"></p>
            </div>
        </div>

        <!-- Mobile-optimized error -->
        <div id="error-message" class="bg-gradient-to-r from-red-50 to-pink-50 border-2 border-red-200 rounded-lg p-4 sm:p-6 text-center mb-4 hidden">
            <p class="text-red-700 font-bold mb-2 text-base sm:text-lg">Oof. Technical Difficulties.</p>
            <p class="text-red-600 text-sm" id="error-details">Even my servers need therapy sometimes. Let's try this again.</p>
            <button id="retry-btn" class="mt-3 bg-red-100 hover:bg-red-200 text-red-700 font-medium btn-mobile text-sm transition-all transform hover:scale-105 tap-target">
                Deep Breath & Retry
            </button>
        </div>

        <!-- Results container -->
        <div id="results-container"></div>
        
        <!-- Account Plan Results -->
        <div id="account-plan-container" class="hidden mt-4 space-y-3 sm:space-y-4"></div>

        <!-- Mobile-first footer -->
        <footer class="text-center mt-8 sm:mt-12 space-y-3 sm:space-y-4 pb-16 sm:pb-20">
            <div class="flex justify-center gap-4 sm:gap-6 text-xs sm:text-sm flex-wrap">
                <button id="about-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium transition-all hover:underline tap-target">About Arti</button>
                <button id="share-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium transition-all hover:underline tap-target">Share</button>
                <a href="mailto:mark@subhoo.com" class="text-customPurple-500 hover:text-customPurple-700 font-medium transition-all hover:underline tap-target">Contact</a>
            </div>

            <!-- Mobile-optimized sponsor ad -->
            <div class="sponsor-ad rounded-lg p-3 sm:p-4 mb-4 bg-white border-2 border-dashed not-italic text-left leading-relaxed">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs font-bold text-gray-600 bg-gradient-to-r from-yellow-200 to-amber-200 px-2 py-1 rounded-full uppercase">Sponsor</span>
                    <span class="text-gray-800 font-bold text-sm sm:text-base">Hey, stressed seller!</span>
                </div>
                <p class="text-xs sm:text-sm leading-relaxed text-gray-700">
                    Every time you vent to Arti, I'm paying for the therapy session. My AWS bill is starting to look like your Q4 quota - 
                    <strong>completely unrealistic</strong>. 
                </p>
                <p class="mt-2 text-xs italic text-gray-600">
                    Help me help you. Sponsor this spot for just $99/mo. 
                    <br>That's like 2 overpriced airport drinks. Worth it.
                </p>
                <p class="mt-3 text-xs sm:text-sm text-customPurple-600 font-bold">
                    <a href="mailto:mark@subhoo.com" class="hover:underline tap-target">
                        Save my sanity (and Lambda bill) â†’
                    </a>
                </p>
            </div>

            <p class="text-xs text-gray-500 max-w-2xl mx-auto leading-relaxed px-2">
                <strong>Therapy Disclaimer:</strong> AskArti provides emotional support and strategic advice for federal sales professionals. 
                Not a replacement for actual therapy (though sometimes it feels like you need both). 
                AI-powered insights may occasionally hallucinate - just like your quota.
            </p>

            <p class="text-xs text-gray-400 font-medium px-2">
                Â© 2025 AskArti Â· Built by sellers who've been burned Â· For sellers currently on fire ðŸ”¥
            </p>
        </footer>
    </div>

    <!-- Mobile-optimized About Modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl sm:rounded-2xl shadow-2xl w-full max-w-sm sm:max-w-md modal-mobile transform transition-all">
            <div class="p-4 sm:p-6">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                        <img src="images/oldmark.jpg" alt="Mark Flournoy" class="w-12 h-12 sm:w-14 sm:h-14 rounded-full object-cover border-3 border-customPurple-200 animate-float">
                        <div>
                            <h2 class="text-lg sm:text-xl font-bold text-gray-900">Hey, I'm Mark</h2>
                            <p class="text-xs text-gray-600">Fellow Fed Sales Survivor</p>
                        </div>
                    </div>
                    <button id="close-about" class="text-gray-400 hover:text-gray-600 transition-colors tap-target">
                        <svg class="h-5 w-5 sm:h-6 sm:w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                    </button>
                </div>
                <div class="space-y-3 sm:space-y-4 text-gray-700 text-sm sm:text-base">
                    <p class="leading-relaxed">
                        I built AskArti after too many nights staring at the ceiling, wondering why my champion went dark 
                        and whether I'd hit my impossible quota.
                    </p>
                    <p class="leading-relaxed">
                        Sound familiar? Yeah, I thought so.
                    </p>
                    <p class="text-sm leading-relaxed">
                        Arti's not perfect (what in federal sales is?), but he's here 24/7 when you need to vent, 
                        strategize, or just remember that you're not losing your mind - federal sales is just Like Thatâ„¢.
                    </p>
                    
                    <div class="pt-3 sm:pt-4 border-t border-gray-200">
                        <div class="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg p-3 sm:p-4 text-sm">
                            <h3 class="font-semibold text-gray-800 mb-2 flex items-center text-sm sm:text-base">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-customPurple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" />
                                </svg>
                                Your Data = Your Business
                            </h3>
                            <p class="text-gray-600 text-xs sm:text-sm">
                                Zero storage. Zero tracking. Zero BS. 
                                Everything happens in-memory and vanishes faster than your stakeholder's promises.
                            </p>
                        </div>
                    </div>
                    
                    <div class="pt-3 sm:pt-4">
                        <a href="https://calendly.com/markflournoy/30min" target="_blank" 
                           class="block w-full bg-gradient-to-r from-customPurple-500 to-customPurple-700 hover:from-customPurple-600 hover:to-customPurple-800 text-white font-bold btn-mobile text-center transition-all transform hover:scale-105 tap-target">
                            Let's Commiserate Over Coffee â˜•
                        </a>
                        <p class="text-xs text-center text-gray-500 mt-2">
                            Virtual coffee. Real federal sales talk.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

<script>
// Mobile-first configuration
const CONFIG = {
   API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
   REQUEST_TIMEOUT: 25000,
   MAX_RETRIES: 2,
   RETRY_DELAY: 2000,
   MAX_INPUT_LENGTH: 500,
   MIN_REQUEST_INTERVAL: 2000,
   LOADING_MESSAGES: [
       "Reading between the lines...",
       "Channeling my inner COTR...",
       "Consulting the FAR...",
       "Finding the real decision maker...",
       "Translating government speak...",
       "Brewing strong coffee...",
       "Activating empathy mode..."
   ]
};

// Enhanced Application class with mobile optimizations
class AskArti {
   constructor() {
       this.elements = this.getElements();
       this.state = {
           pendingRequest: false,
           lastRequestTime: 0,
           loadingInterval: null,
           abortController: null,
           lastQuery: '',
           chatHistory: [],
           messageCount: 0,
           sessionStart: Date.now()
       };
       this.init();
   }

   getElements() {
       return {
           chatMessages: document.getElementById('chat-messages'),
           chatInput: document.getElementById('chat-input'),
           chatSendBtn: document.getElementById('chat-send-btn'),
           clearChatBtn: document.getElementById('clear-chat-btn'),
           loadingMessageContainer: document.getElementById('loading-message-container'),
           loadingMessage: document.getElementById('loading-message'),
           errorMessage: document.getElementById('error-message'),
           errorDetails: document.getElementById('error-details'),
           retryBtn: document.getElementById('retry-btn'),
           resultsContainer: document.getElementById('results-container'),
           accountPlanContainer: document.getElementById('account-plan-container'),
           aboutBtn: document.getElementById('about-btn'),
           aboutModal: document.getElementById('about-modal'),
           closeAbout: document.getElementById('close-about'),
           shareBtn: document.getElementById('share-btn'),
           greetingText: document.getElementById('greeting-text'),
           chatContainer: document.getElementById('chat-container'),
           planButtonContainer: document.getElementById('plan-button-container')
       };
   }

   init() {
       this.initializeMermaid();
       this.setupEventListeners();
       this.updateGreeting();
       this.elements.chatInput.focus();
       this.optimizeForMobile();
   }

   optimizeForMobile() {
       // Detect mobile and add specific optimizations
       const isMobile = window.innerWidth <= 768;
       
       if (isMobile) {
           // Prevent zoom on input focus for iOS
           document.addEventListener('touchstart', {}, true);
           
           // Add mobile-specific event listeners
           this.elements.chatInput.addEventListener('focus', () => {
               // Small delay to ensure keyboard is up
               setTimeout(() => {
                   this.scrollChatToBottom();
               }, 300);
           });
       }
       
       // Handle orientation changes
       window.addEventListener('orientationchange', () => {
           setTimeout(() => {
               this.scrollChatToBottom();
           }, 500);
       });
   }

   updateGreeting() {
       const hour = new Date().getHours();
       const day = new Date().getDay();
       
       let greeting;
       if (day === 0 || day === 6) {
           greeting = "Weekend warrior?";
       } else if (hour < 12) {
           greeting = "Early bird or rough night?";
       } else if (hour < 17) {
           greeting = "Midday crisis?";
       } else if (hour < 21) {
           greeting = "Still grinding?";
       } else {
           greeting = "Burning midnight oil?";
       }
       
       this.elements.greetingText.textContent = greeting;
   }

   initializeMermaid() {
       mermaid.initialize({ 
           startOnLoad: false,
           securityLevel: 'strict',
           theme: 'default',
           flowchart: {
               htmlLabels: true,
               curve: 'basis'
           }
       });
   }

   setupEventListeners() {
       // Chat events
       this.elements.chatSendBtn.addEventListener('click', () => this.sendChatMessage());
       this.elements.chatInput.addEventListener('keydown', (e) => {
           if (e.key === 'Enter' && !e.shiftKey) {
               e.preventDefault();
               this.sendChatMessage();
           }
       });

       this.elements.chatInput.addEventListener('input', (e) => {
           if (this.elements.chatSendBtn.querySelector('.retry-icon')) {
               this.resetSendButton();
           }
       });

       // Clear chat with confirmation
       this.elements.clearChatBtn.addEventListener('click', () => {
           if (this.state.messageCount > 1) {
               if (confirm('Start fresh?')) {
                   this.clearChat();
               }
           } else {
               this.clearChat();
           }
       });

       // Retry
       this.elements.retryBtn.addEventListener('click', () => {
           this.elements.errorMessage.classList.add('hidden');
           if (this.state.lastQuery) {
               this.sendChatMessage();
           }
       });

       // Share - mobile optimized
       this.elements.shareBtn.addEventListener('click', () => this.share());

       // About modal
       this.elements.aboutBtn.addEventListener('click', () => this.showModal());
       this.elements.closeAbout.addEventListener('click', () => this.hideModal());
       this.elements.aboutModal.addEventListener('click', (e) => {
           if (e.target === this.elements.aboutModal) this.hideModal();
       });

       // Escape key
       document.addEventListener('keydown', (e) => {
           if (e.key === 'Escape') this.hideModal();
       });
   }

   clearChat() {
       // Reset everything
       this.state.chatHistory = [];
       this.state.messageCount = 0;
       
       // Reset UI
       this.updateGreeting();
       
       // Clear messages but keep welcome
       this.elements.chatMessages.innerHTML = `
           <div class="flex items-start gap-2 sm:gap-3">
               <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 sm:w-10 sm:h-10 rounded-full animate-bounce-slow flex-shrink-0">
               <div class="chat-message-arti rounded-xl sm:rounded-2xl px-3 py-2 sm:px-4 sm:py-3 max-w-[85%] animate-fade-in">
                   <p class="text-gray-800 leading-relaxed">
                       <strong>Fresh start.</strong> Sometimes that's exactly what we need.
                       <br><br>
                       <em>What agency are you targeting and what are you selling?</em>
                   </p>
               </div>
           </div>`;
       
       // Clear other elements
       this.elements.chatInput.value = '';
       this.elements.resultsContainer.innerHTML = '';
       this.elements.accountPlanContainer.classList.add('hidden');
       this.elements.accountPlanContainer.innerHTML = '';
       this.elements.planButtonContainer.classList.add('hidden');
       
       this.elements.chatInput.focus();
       this.showTemporaryMessage('Clean slate. Let\'s go.', 'info');
   }

   addChatMessage(content, isUser = false) {
       const messageHtml = isUser ? `
           <div class="flex justify-end animate-slide-in">
               <div class="chat-message-user rounded-xl sm:rounded-2xl px-3 py-2 sm:px-4 sm:py-3 max-w-[85%] shadow-lg">
                   ${content}
               </div>
           </div>
       ` : `
           <div class="flex items-start gap-2 sm:gap-3 animate-slide-in">
               <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 sm:w-10 sm:h-10 rounded-full flex-shrink-0">
               <div class="chat-message-arti rounded-xl sm:rounded-2xl px-3 py-2 sm:px-4 sm:py-3 max-w-[85%]">
                   ${marked.parse(content)}
               </div>
           </div>
       `;
       
       this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
       this.scrollChatToBottom();
   }

   showTypingIndicator() {
       const typingHtml = `
           <div id="typing-indicator" class="flex items-start gap-2 sm:gap-3 animate-fade-in">
               <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 sm:w-10 sm:h-10 rounded-full opacity-50 flex-shrink-0">
               <div class="typing-indicator">
                   <div class="typing-dot"></div>
                   <div class="typing-dot"></div>
                   <div class="typing-dot"></div>
               </div>
           </div>
       `;
       this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
       this.scrollChatToBottom();
   }

   hideTypingIndicator() {
       const indicator = document.getElementById('typing-indicator');
       if (indicator) indicator.remove();
   }

   showLoadingMessage() {
       const message = CONFIG.LOADING_MESSAGES[Math.floor(Math.random() * CONFIG.LOADING_MESSAGES.length)];
       this.elements.loadingMessage.textContent = message;
       this.elements.loadingMessageContainer.classList.remove('hidden');
   }

   hideLoadingMessage() {
       this.elements.loadingMessageContainer.classList.add('hidden');
   }

   scrollChatToBottom() {
       const scrollContainer = document.querySelector('.chat-container-mobile');
       if (!scrollContainer) return;

       requestAnimationFrame(() => {
           scrollContainer.scrollTop = scrollContainer.scrollHeight;
           setTimeout(() => {
               scrollContainer.scrollTop = scrollContainer.scrollHeight;
           }, 100);
       });
   }

   async sendChatMessage() {
       const message = this.elements.chatInput.value.trim();
       
       if (this.state.pendingRequest) return;
       
       if (!message && this.state.lastQuery) {
           this.retryLastMessage();
           return;
       }
       
       if (!message) return;

       // Add user message to chat
       this.addChatMessage(message, true);
       this.elements.chatInput.value = '';
       this.state.lastQuery = message;
       
       // Add to chat history
       this.state.chatHistory.push({ role: 'user', content: message });
       this.state.messageCount++;

       // Show typing indicator
       this.showTypingIndicator();
       this.showLoadingMessage();
       this.state.pendingRequest = true;

       try {
           const response = await this.makeChatRequest(message);
           this.hideTypingIndicator();
           this.hideLoadingMessage();
           
           // Check if this is a factual answer
           if (response.response_type === 'factual_answer' && response.answer) {
               // Format the factual answer nicely
               const formattedAnswer = `**Here's what I know:**\n\n${response.answer}`;
               this.addChatMessage(formattedAnswer, false);
               this.state.chatHistory.push({ role: 'assistant', content: formattedAnswer });
           } else {
               // Add Arti's response
               this.addChatMessage(response.message || "I hear you. Tell me more about what's happening.", false);
               this.state.chatHistory.push({ role: 'assistant', content: response.message });

               // Show plan button if AI detected plan intent
               if (response.show_plan_button) {
                   this.elements.planButtonContainer.classList.remove('hidden');
               }
           }

           // Clear lastQuery on success
           this.state.lastQuery = '';

       } catch (error) {
           console.error('Chat request failed:', error);
           this.hideTypingIndicator();
           this.hideLoadingMessage();
           this.addChatMessage("Connection issues. Even my servers are ghosting me now. Try again?", false);
           
           // Update send button for retry
           this.elements.chatSendBtn.innerHTML = `
               <span class="flex items-center gap-2">
                   <svg class="w-4 h-4 retry-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                   </svg>
                   <span class="hidden xs:inline">Retry</span>
               </span>
           `;
           this.elements.chatSendBtn.classList.add('bg-gradient-to-r', 'from-yellow-500', 'to-amber-600');
       } finally {
           this.state.pendingRequest = false;
       }
   }

   resetSendButton() {
       this.elements.chatSendBtn.innerHTML = `
           <span class="flex items-center gap-2">
               <span class="hidden xs:inline">Send</span>
               <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
               </svg>
           </span>
       `;
       this.elements.chatSendBtn.className = 'bg-gradient-to-r from-customPurple-500 to-customPurple-700 hover:from-customPurple-600 hover:to-customPurple-800 text-white font-medium px-4 py-3 rounded-lg transition-all tap-target whitespace-nowrap transform hover:scale-105 active:scale-95';
   }

   async makeChatRequest(message) {
       const contextToSend = this.state.chatHistory.length > 20 
           ? [this.state.chatHistory[0], ...this.state.chatHistory.slice(-19)]
           : this.state.chatHistory;
       
       try {
           const response = await fetch(CONFIG.API_ENDPOINT, {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ 
                   situation: message,
                   mode: 'chat',
                   conversationHistory: contextToSend,
                   currentDate: new Date().toISOString().split('T')[0],
                   sessionDuration: Math.floor((Date.now() - this.state.sessionStart) / 1000)
               })
           });

           if (!response.ok) throw new Error('Request failed');
           return await response.json();
       } catch (error) {
           console.error('API request failed:', error);
           throw error;
       }
   }
async generateAccountPlan() {
       if (this.state.pendingRequest) return;
       this.elements.planButtonContainer.classList.add('hidden');
       this.elements.resultsContainer.innerHTML = '';
       
       // Show loading
       this.showTemporaryMessage('Crafting your strategic account plan...', 'info');
       this.elements.accountPlanContainer.innerHTML = `
           <div class="therapy-card text-center p-6 sm:p-8 animate-pulse-slow">
               <div class="loader mx-auto mb-4"></div>
               <p class="text-base sm:text-lg font-medium text-gray-700">Building your strategic account plan...</p>
               <p class="text-sm text-gray-500 mt-2">This is going to be good.</p>
           </div>
       `;
       this.elements.accountPlanContainer.classList.remove('hidden');
       
       // Smooth scroll
       this.elements.accountPlanContainer.scrollIntoView({ behavior: 'smooth' });
       
       this.state.pendingRequest = true;
       try {
           let contextToSend = this.state.chatHistory;
           const maxContextSize = 20;
           if (contextToSend.length > maxContextSize) {
               contextToSend = [
                   contextToSend[0],
                   ...contextToSend.slice(-maxContextSize + 1)
               ];
           }
           
           const response = await fetch(CONFIG.API_ENDPOINT, {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ 
                   situation: "Generate account plan",
                   mode: 'account_plan',
                   conversationHistory: contextToSend,
                   currentDate: new Date().toISOString().split('T')[0]
               })
           });
           
           if (!response.ok) throw new Error('Request failed');
           
           const data = await response.json();
           
           // Handle context gathering mode
           if (data.mode === 'context_gathering') {
               this.elements.accountPlanContainer.classList.add('hidden');
               this.hideLoadingMessage();
               
               // Add the context gathering message to chat
               this.addChatMessage(data.message, false);
               this.state.chatHistory.push({ role: 'assistant', content: data.message });
               
               // Add follow-up suggestions if provided
               if (data.suggestions && data.suggestions.length > 0) {
                   this.addFollowUpSuggestions(data.suggestions);
               }
               
               this.showTemporaryMessage("I need a bit more info to create the best plan for you.", 'info');
               return;
           }
           
           this.displayMobileCRMAccountPlan(data);
           this.showTemporaryMessage("Account plan generated! Time to execute.", 'info');
           
       } catch (error) {
           console.error('Account plan generation failed:', error);
           this.elements.accountPlanContainer.innerHTML = `
               <div class="therapy-card text-center p-4 sm:p-6">
                   <p class="text-red-600 mb-3 font-medium">Plan generation hit a snag.</p>
                   <p class="text-gray-600 text-sm mb-4">Even my AI needs a coffee break sometimes.</p>
                   <button onclick="app.generateAccountPlan()" class="bg-gradient-to-r from-red-100 to-pink-100 hover:from-red-200 hover:to-pink-200 text-red-700 font-medium btn-mobile transition-all transform hover:scale-105 tap-target">
                       Try Again
                   </button>
               </div>
           `;
       } finally {
           this.state.pendingRequest = false;
       }
   }

   addFollowUpSuggestions(suggestions) {
       const suggestionsHtml = `
           <div class="flex justify-center gap-2 mt-4 flex-wrap animate-fade-in">
               <p class="w-full text-center text-xs text-gray-500 mb-2">You might say...</p>
               ${suggestions.map(s => `
                   <button class="px-3 py-2 bg-gradient-to-r from-gray-100 to-slate-100 hover:from-gray-200 hover:to-slate-200 rounded-full text-xs sm:text-sm text-gray-700 font-medium transition-all transform hover:scale-105 tap-target"
                           onclick="app.elements.chatInput.value='${s.replace(/'/g, "\\'")}'; app.sendChatMessage();">
                       ${s}
                   </button>
               `).join('')}
           </div>
       `;
       this.elements.chatMessages.insertAdjacentHTML('beforeend', suggestionsHtml);
       this.scrollChatToBottom();
   }
   displayMobileCRMAccountPlan(data) {
       const { 
           account_name,
           account_tier,
           total_opportunity_value,
           probability_to_close,
           executive_summary,
           account_overview,
           stakeholder_analysis,
           opportunity_breakdown,
           strategic_initiatives,
           risk_mitigation,
           success_metrics,
           next_30_days,
           assumptions_made,
           mermaid_chart
       } = data;

       if (!account_name) {
           this.elements.accountPlanContainer.innerHTML = `<div class="therapy-card text-center p-6 sm:p-8"><p class="text-gray-800 font-bold">Could not generate an account plan from the conversation. Please provide more context.</p></div>`;
           return;
       }

       let html = `
           <div class="crm-header mb-4 sm:mb-6 animate-fade-in">
               <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-4 gap-3">
                   <div class="flex-1">
                       <h1 class="text-xl sm:text-2xl lg:text-3xl font-bold text-gray-900 mb-2">${account_name}</h1>
                       <div class="flex flex-wrap gap-2 sm:gap-4">
                           <span class="status-badge status-high">${account_tier || 'Strategic'}</span>
                           <span class="text-sm sm:text-lg font-semibold text-gray-700">${total_opportunity_value || 'TBD'}</span>
                           <span class="text-sm sm:text-lg font-semibold text-green-700">${probability_to_close || 'TBD'}</span>
                       </div>
                   </div>
                   <button onclick="app.copyAccountPlan()" class="bg-customPurple-500 hover:bg-customPurple-600 text-white btn-mobile transition-colors tap-target">
                       Copy Plan
                   </button>
               </div>
               <p class="text-gray-700 text-sm sm:text-lg leading-relaxed">${executive_summary || 'No summary available.'}</p>
           </div>

           <div class="space-y-3 sm:space-y-4 mb-4 sm:mb-6">
               ${account_overview ? `
               <div class="crm-section">
                   <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Account Overview</h3>
                   <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4">
                       <div>
                           <h4 class="font-semibold text-gray-700 text-xs sm:text-sm mb-1">Decision Cycle</h4>
                           <p class="text-gray-600 text-sm">${account_overview.decision_cycle || 'TBD'}</p>
                       </div>
                       <div>
                           <h4 class="font-semibold text-gray-700 text-xs sm:text-sm mb-1">Budget Cycle</h4>
                           <p class="text-gray-600 text-sm">${account_overview.budget_cycle || 'TBD'}</p>
                       </div>
                       <div>
                           <h4 class="font-semibold text-gray-700 text-xs sm:text-sm mb-1">Competitive Landscape</h4>
                           <p class="text-gray-600 text-sm">${account_overview.competitive_landscape || 'TBD'}</p>
                       </div>
                       <div>
                           <h4 class="font-semibold text-gray-700 text-xs sm:text-sm mb-1">Relationship Strength</h4>
                           <p class="text-gray-600 text-sm">${account_overview.relationship_strength || 'TBD'}</p>
                       </div>
                   </div>
               </div>
               ` : ''}

               ${stakeholder_analysis?.length > 0 ? `
               <div class="crm-section">
                   <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Stakeholder Analysis</h3>
                   <div class="space-y-3 sm:hidden">
                       ${stakeholder_analysis.map(s => {
                           const statusClass = s.relationship_status?.toLowerCase() === 'champion' ? 'status-champion' : 
                                              s.relationship_status?.toLowerCase() === 'blocker' ? 'status-blocker' : 'status-neutral';
                           const influenceClass = s.influence_level?.toLowerCase() === 'high' ? 'status-high' : 
                                                 s.influence_level?.toLowerCase() === 'medium' ? 'status-medium' : 'status-low';
                           return `
                           <div class="border border-gray-200 rounded-lg p-3">
                               <div class="flex justify-between items-start mb-2">
                                   <h4 class="font-medium text-sm">${s.name || 'TBD'}</h4>
                                   <span class="status-badge ${statusClass}">${s.relationship_status || 'TBD'}</span>
                               </div>
                               <div class="flex justify-between text-xs text-gray-600 mb-2">
                                   <span>${s.role || 'TBD'}</span>
                                   <span class="status-badge ${influenceClass}">${s.influence_level || 'TBD'}</span>
                               </div>
                               <p class="text-xs text-gray-600">${s.next_action || 'TBD'}</p>
                           </div>`;
                       }).join('')}
                   </div>
                   <div class="overflow-x-auto hidden sm:block">
                       <table class="crm-table">
                           <thead>
                               <tr>
                                   <th>Name/Title</th>
                                   <th>Role</th>
                                   <th>Status</th>
                                   <th>Influence</th>
                                   <th>Next Action</th>
                               </tr>
                           </thead>
                           <tbody>
                               ${stakeholder_analysis.map(s => {
                                   const statusClass = s.relationship_status?.toLowerCase() === 'champion' ? 'status-champion' : 
                                                      s.relationship_status?.toLowerCase() === 'blocker' ? 'status-blocker' : 'status-neutral';
                                   const influenceClass = s.influence_level?.toLowerCase() === 'high' ? 'status-high' : 
                                                         s.influence_level?.toLowerCase() === 'medium' ? 'status-medium' : 'status-low';
                                   return `
                                   <tr>
                                       <td class="font-medium">${s.name || 'TBD'}</td>
                                       <td>${s.role || 'TBD'}</td>
                                       <td><span class="status-badge ${statusClass}">${s.relationship_status || 'TBD'}</span></td>
                                       <td><span class="status-badge ${influenceClass}">${s.influence_level || 'TBD'}</span></td>
                                       <td class="text-sm">${s.next_action || 'TBD'}</td>
                                   </tr>`;
                               }).join('')}
                           </tbody>
                       </table>
                   </div>
               </div>
               ` : ''}

               ${opportunity_breakdown?.length > 0 ? `
               <div class="crm-section">
                   <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Opportunity Breakdown</h3>
                   <div class="space-y-3 sm:space-y-4">
                       ${opportunity_breakdown.map(opp => `
                           <div class="border border-gray-200 rounded-lg p-3 sm:p-4">
                               <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start mb-2 gap-2">
                                   <h4 class="font-semibold text-gray-900 text-sm sm:text-base">${opp.opportunity_name || 'Unnamed Opportunity'}</h4>
                                   <div class="text-left sm:text-right">
                                       <div class="font-bold text-customPurple-700 text-sm sm:text-base">${opp.value || 'TBD'}</div>
                                       <div class="text-xs sm:text-sm text-gray-600">${opp.probability || 'TBD'} probability</div>
                                   </div>
                               </div>
                               <div class="grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-4 text-xs sm:text-sm">
                                   <div>
                                       <span class="font-medium text-gray-700">Timeline:</span>
                                       <p class="text-gray-600">${opp.timeline || 'TBD'}</p>
                                   </div>
                                   <div>
                                       <span class="font-medium text-gray-700">Stage:</span>
                                       <p class="text-gray-600">${opp.stage || 'TBD'}</p>
                                   </div>
                                   <div>
                                       <span class="font-medium text-gray-700">Position:</span>
                                       <p class="text-gray-600">${opp.competitive_position || 'TBD'}</p>
                                   </div>
                               </div>
                               ${opp.key_requirements ? `
                               <div class="mt-3">
                                   <span class="font-medium text-gray-700 text-xs sm:text-sm">Key Requirements:</span>
                                   <p class="text-gray-600 text-xs sm:text-sm">${opp.key_requirements}</p>
                               </div>
                               ` : ''}
                           </div>
                       `).join('')}
                   </div>
               </div>
               ` : ''}

               <div class="grid grid-cols-1 lg:grid-cols-2 gap-3 sm:gap-4">
                   ${strategic_initiatives?.length > 0 ? `
                   <div class="crm-section">
                       <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Strategic Initiatives</h3>
                       <ul class="space-y-2 sm:space-y-3">
                           ${strategic_initiatives.map((initiative, i) => `
                               <li class="flex gap-2 sm:gap-3">
                                   <span class="flex-shrink-0 w-5 h-5 sm:w-6 sm:h-6 bg-customPurple-700 text-white rounded-full flex items-center justify-center text-xs font-bold">${i + 1}</span>
                                   <span class="text-gray-700 text-xs sm:text-sm">${initiative}</span>
                               </li>
                           `).join('')}
                       </ul>
                   </div>
                   ` : ''}

                   ${risk_mitigation?.length > 0 ? `
                   <div class="crm-section">
                       <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Risk Mitigation</h3>
                       <div class="space-y-2 sm:space-y-3">
                           ${risk_mitigation.map(risk => {
                               const riskClass = risk.probability?.toLowerCase() === 'high' ? 'status-high' : 
                                               risk.probability?.toLowerCase() === 'medium' ? 'status-medium' : 'status-low';
                               return `
                               <div class="border-l-4 border-red-400 pl-3">
                                   <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center mb-1 gap-1">
                                       <h4 class="font-medium text-gray-900 text-xs sm:text-sm">${risk.risk || 'Unknown Risk'}</h4>
                                       <span class="status-badge ${riskClass} self-start sm:self-center">${risk.probability || 'TBD'}</span>
                                   </div>
                                   <p class="text-gray-600 text-xs sm:text-sm">${risk.mitigation_strategy || 'No mitigation defined'}</p>
                               </div>`;
                           }).join('')}
                       </div>
                   </div>
                   ` : ''}
               </div>

               ${success_metrics?.length > 0 ? `
               <div class="crm-section">
                   <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Success Metrics</h3>
                   <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 sm:gap-3">
                       ${success_metrics.map(metric => `
                           <div class="bg-gray-50 rounded-lg p-3">
                               <h4 class="font-medium text-gray-900 text-xs sm:text-sm">${metric.metric || 'Unknown Metric'}</h4>
                               <div class="flex flex-col sm:flex-row sm:justify-between text-xs mt-1 gap-1">
                                   <span class="text-gray-600">Target: ${metric.target || 'TBD'}</span>
                                   <span class="text-gray-600">${metric.timeline || 'TBD'}</span>
                               </div>
                               <p class="text-gray-500 text-xs mt-1">${metric.tracking_method || 'TBD'}</p>
                           </div>
                       `).join('')}
                   </div>
               </div>
               ` : ''}

               ${assumptions_made?.length > 0 ? `
               <div class="crm-section bg-yellow-50 border-yellow-200">
                   <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 flex items-center gap-2">
                       <svg class="w-4 h-4 sm:w-5 sm:h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                           <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                       </svg>
                       Key Assumptions Made
                   </h3>
                   <ul class="space-y-1 sm:space-y-2">
                       ${assumptions_made.map(assumption => `
                           <li class="flex gap-2 text-xs sm:text-sm text-yellow-800">
                               <span class="text-yellow-600 flex-shrink-0">âš </span>
                               <span>${assumption}</span>
                           </li>
                       `).join('')}
                   </ul>
                   <p class="text-xs text-yellow-700 mt-2 sm:mt-3 italic">Please validate these assumptions to improve plan accuracy.</p>
               </div>
               ` : ''}

               ${next_30_days?.length > 0 ? `
               <div class="crm-section">
                   <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Next 30 Days - Action Items</h3>
                   <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 sm:gap-4">
                       ${next_30_days.map((action, i) => `
                           <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-3 sm:p-4">
                               <div class="flex items-center gap-2 mb-2">
                                   <span class="w-5 h-5 sm:w-6 sm:h-6 bg-yellow-400 text-yellow-900 rounded-full flex items-center justify-center text-xs font-bold">${i + 1}</span>
                                   <span class="font-medium text-yellow-900 text-xs sm:text-sm">Priority ${i + 1}</span>
                               </div>
                               <p class="text-yellow-800 text-xs sm:text-sm">${action}</p>
                           </div>
                       `).join('')}
                   </div>
               </div>
               ` : ''}

               ${mermaid_chart ? `
               <div class="crm-section">
                   <h3 class="text-base sm:text-lg font-bold text-gray-900 mb-3 sm:mb-4">Stakeholder Map</h3>
                   <div class="mermaid-container">
                       <div class="mermaid-loading flex justify-center items-center absolute inset-0">
                           <div class="loader"></div>
                       </div>
                       <div class="mermaid opacity-0">${mermaid_chart}</div>
                   </div>
               </div>
               ` : ''}
           </div>
       `;

       this.elements.accountPlanContainer.innerHTML = html;
       
       if (mermaid_chart) {
           this.renderMermaidChart();
       }
   }
  
   copyAccountPlan() {
       const content = this.elements.accountPlanContainer.innerText;
       
       if (!content || content.trim() === '') {
           this.showTemporaryMessage('Nothing to copy yet!', 'error');
           return;
       }
       
       navigator.clipboard.writeText(content)
           .then(() => {
               this.showTemporaryMessage('Account plan copied! ðŸ’ª', 'info');
           })
           .catch(() => alert('Copy failed. Try selecting and copying manually.'));
   }

   renderMermaidChart() {
       try {
           setTimeout(async () => {
               const diagrams = document.querySelectorAll('.mermaid:not([data-processed="true"])');

               if (diagrams.length === 0) return;

               await mermaid.run({ nodes: diagrams });

               diagrams.forEach(element => {
                   element.style.opacity = '1';
                   const container = element.closest('.mermaid-container');
                   if (container) {
                       const loader = container.querySelector('.mermaid-loading');
                       if (loader) {
                           loader.style.display = 'none';
                       }
                   }
               });
           }, 300);
       } catch (error) {
           console.error('Mermaid rendering error:', error);
           const containers = document.querySelectorAll('.mermaid-container');
           containers.forEach(container => {
               if (!container.querySelector('[data-processed="true"]')) {
                   container.innerHTML = '<div class="p-4 sm:p-6 bg-gray-100 text-gray-700 rounded-lg text-center text-sm">Visualization got stage fright.</div>';
               }
           });
       }
   }

   share() {
       const shareData = {
           title: 'AskArti - Federal Sales Therapist',
           text: 'When federal sales is breaking you down, Arti builds you back up.',
           url: 'https://askarti.com'
       };
       
       if (navigator.share) {
           navigator.share(shareData).catch(console.error);
       } else {
           navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`)
               .then(() => {
                   this.elements.shareBtn.textContent = 'Copied! ðŸ“‹';
                   setTimeout(() => this.elements.shareBtn.textContent = 'Share', 2000);
               })
               .catch(() => alert('Please copy the URL manually: https://askarti.com'));
       }
   }
   
   showTemporaryMessage(message, type = 'info') {
       this.elements.loadingMessageContainer.classList.remove('hidden');
       this.elements.loadingMessage.textContent = message;
       
       // Remove loader for temporary messages
       const loader = this.elements.loadingMessageContainer.querySelector('.loader');
       if (loader) loader.style.display = 'none';
       
       const colorClasses = {
           error: 'text-red-700 font-bold',
           warning: 'text-orange-700 font-bold',
           info: 'text-gray-700 font-medium'
       };
       
       this.elements.loadingMessage.className = colorClasses[type] || colorClasses.info;
       
       setTimeout(() => {
           this.elements.loadingMessageContainer.classList.add('hidden');
           if (loader) loader.style.display = 'block';
       }, 3000);
   }

   showModal() {
       this.elements.aboutModal.classList.remove('hidden');
       // Prevent body scroll on mobile
       document.body.style.overflow = 'hidden';
       requestAnimationFrame(() => {
           this.elements.aboutModal.querySelector('.modal-mobile').classList.add('show');
       });
   }

   hideModal() {
       const content = this.elements.aboutModal.querySelector('.modal-mobile');
       content.classList.remove('show');
       // Restore body scroll
       document.body.style.overflow = '';
       setTimeout(() => this.elements.aboutModal.classList.add('hidden'), 200);
   }

   // Method to retry the last message
   retryLastMessage() {
       if (!this.state.lastQuery || this.state.pendingRequest) return;
       
       this.resetSendButton();
       
       // Show we're retrying
       this.addChatMessage(`${this.state.lastQuery} <em class="text-xs text-purple-200">(Let's try this again...)</em>`, true);
       
       this.showTypingIndicator();
       this.showLoadingMessage();
       this.state.pendingRequest = true;
       
       this.makeChatRequest(this.state.lastQuery)
           .then(response => {
               this.hideTypingIndicator();
               this.hideLoadingMessage();
               
               // Check if this is a factual answer
               if (response.response_type === 'factual_answer' && response.answer) {
                   const formattedAnswer = `**Here's what I know:**\n\n${response.answer}`;
                   this.addChatMessage(formattedAnswer, false);
                   this.state.chatHistory.push({ role: 'assistant', content: formattedAnswer });
               } else {
                   this.addChatMessage(response.message || "Got it. Tell me more.", false);
                   this.state.chatHistory.push({ role: 'assistant', content: response.message });

                   // Show plan button if AI detected plan intent
                   if (response.show_plan_button) {
                       this.elements.planButtonContainer.classList.remove('hidden');
                   }
               }
               
               this.state.lastQuery = '';
           })
           .catch(error => {
               console.error('Retry failed:', error);
               this.hideTypingIndicator();
               this.hideLoadingMessage();
               this.addChatMessage("Still having connection issues. Maybe the universe is telling us to take a break?", false);
           })
           .finally(() => {
               this.state.pendingRequest = false;
           });
   }
}

// Initialize the therapy session
const app = new AskArti();

// Add mobile-specific optimizations
document.addEventListener('DOMContentLoaded', () => {
   // Prevent zoom on double tap for iOS
   let lastTouchEnd = 0;
   document.addEventListener('touchend', function (event) {
       const now = (new Date()).getTime();
       if (now - lastTouchEnd <= 300) {
           event.preventDefault();
       }
       lastTouchEnd = now;
   }, false);

   // Handle viewport changes on mobile
   const setVH = () => {
       const vh = window.innerHeight * 0.01;
       document.documentElement.style.setProperty('--vh', `${vh}px`);
   };
   
   setVH();
   window.addEventListener('resize', setVH);
   window.addEventListener('orientationchange', () => {
       setTimeout(setVH, 500);
   });
});

// Add some personality to page visibility changes
document.addEventListener('visibilitychange', () => {
   if (!document.hidden && app.state.messageCount > 0) {
       app.updateGreeting();
   }
});

// Random motivational console messages
const consoleMessages = [
   '%cðŸŽ¯ Remember: Every "no" is one step closer to "yes"!',
   '%cðŸ’ª Federal sales warrior mode: ACTIVATED',
   '%cðŸš€ Your quota doesn\'t stand a chance',
   '%câ˜• Coffee break? You\'ve earned it.',
   '%cðŸ† Champions adjust. You\'ve got this!'
];

console.log(
   consoleMessages[Math.floor(Math.random() * consoleMessages.length)],
   'color: #7C6BBE; font-weight: bold; font-size: 14px;'
);

// Add service worker for better mobile performance (optional)
if ('serviceWorker' in navigator) {
   window.addEventListener('load', () => {
       navigator.serviceWorker.register('/sw.js')
           .then((registration) => {
               console.log('SW registered: ', registration);
           })
           .catch((registrationError) => {
               console.log('SW registration failed: ', registrationError);
           });
   });
}
</script>
</body>
</html>