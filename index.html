<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    <meta property="og:image:alt" content="AskArti Logo">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://askarti.com/">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="twitter:image" content="https://askarti.com/images/asklite.png">
    <meta name="twitter:image:alt" content="AskArti Logo">
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#523f9e">
    <link rel="icon" type="image/png" sizes="192x192" href="/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/images/android-chrome-512x512.png">
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/images/asklite.png" as="image">
    <link rel="preload" href="/images/arti_right.png" as="image">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C6BBE',
                        customPurple: {
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            500: '#7C6BBE',
                            700: '#5A4E8C',
                            900: '#403866'
                        }
                    }
                }
            }
        }
    </script>
    <style>
    body { font-family: 'Inter', sans-serif; }
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .sponsor-ad {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.05) 0%, rgba(124, 107, 190, 0.02) 100%);
        border: 1px solid rgba(124, 107, 190, 0.1);
        transition: all 0.3s ease;
    }
    .sponsor-ad:hover {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.08) 0%, rgba(124, 107, 190, 0.04) 100%);
        border-color: rgba(124, 107, 190, 0.2);
        transform: translateY(-1px);
    }
    .dashboard-card {
         background-color: white;
         border-radius: 0.75rem;
         border: 1px solid #e5e7eb;
         padding: 1.5rem;
         box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    }
    .user-message {
        background-color: #7C6BBE;
        color: white;
        margin-left: auto;
    }
    .arti-message {
        background-color: #f3f4f6;
        color: #1f2937;
    }
    #chat-messages::-webkit-scrollbar {
        width: 6px;
    }
    #chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
    }
    #chat-messages::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 3px;
    }
    #chat-messages::-webkit-scrollbar-thumb:hover {
        background: #555;
    }
    .typing-dot {
        animation: bounce 1.4s infinite;
    }
    .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
    }
    .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
    }
    @keyframes bounce {
        0%, 60%, 100% { transform: translateY(0); }
        30% { transform: translateY(-10px); }
    }
    .mermaid {
        display: flex;
        justify-content: center;
        background: white;
        padding: 1rem;
    }
    .suggested-question {
        transition: all 0.2s ease;
    }
    .suggested-question:hover {
        transform: translateY(-1px);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
</style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-20">
        <header class="text-center mb-4">
            <a href="/" aria-label="AskArti Home" class="inline-block">
                <img src="/images/asklite.png" alt="AskArti" class="h-16 w-auto md:h-20 lg:h-24">
            </a>
        </header>

<main class="dashboard-card mb-3 h-[600px] flex flex-col">
    <div class="border-b border-gray-200 pb-3 mb-4">
        <div class="flex items-center gap-3">
            <img src="/images/arti_right.png" alt="Arti" class="w-10 h-10">
            <div>
                <h2 class="font-semibold text-gray-900">Chat with Arti</h2>
                <p class="text-sm text-gray-600">Your Federal Sales Buddy</p>
            </div>
            <div class="ml-auto flex items-center gap-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <span class="w-2 h-2 bg-green-400 rounded-full mr-1.5 animate-pulse"></span>
                    Online
                </span>
                <button id="clear-chat" class="text-gray-400 hover:text-gray-600" title="Clear chat">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <div id="chat-messages" class="flex-1 overflow-y-auto space-y-4 mb-4 scroll-smooth px-2">
        <div class="flex gap-3">
            <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 rounded-full flex-shrink-0">
            <div class="flex-1">
                <div class="bg-gray-100 rounded-lg p-4 max-w-[80%]">
                    <p class="text-gray-800 mb-2">Hey there! I'm Arti. I spent 30+ years in federal sales - from pounding the pavement as a junior rep to running federal divisions. I've seen it all: the good RFPs, the bad protests, and the ugly demos that crashed in front of the CIO.</p>
                    <p class="text-gray-800">What's on your mind today? Deal stuck? Prepping for a big meeting? Need to vent about procurement? Or just want to talk strategy? I'm all ears!</p>
                </div>
                <div class="mt-2 flex flex-wrap gap-2">
                    <button class="suggested-question text-xs bg-white border border-gray-300 rounded-full px-3 py-1 hover:bg-gray-50 hover:border-customPurple-300" data-question="I have a $2M deal at DHS that's stuck. The champion went dark after pricing. What should I do?">
                        Deal is stuck
                    </button>
                    <button class="suggested-question text-xs bg-white border border-gray-300 rounded-full px-3 py-1 hover:bg-gray-50 hover:border-customPurple-300" data-question="How do I find the real decision maker at VA? I keep getting shuffled around.">
                        Finding decision makers
                    </button>
                    <button class="suggested-question text-xs bg-white border border-gray-300 rounded-full px-3 py-1 hover:bg-gray-50 hover:border-customPurple-300" data-question="Can you show me a typical federal sales process flowchart?">
                        Show me the process
                    </button>
                    <button class="suggested-question text-xs bg-white border border-gray-300 rounded-full px-3 py-1 hover:bg-gray-50 hover:border-customPurple-300" data-question="What are the top federal contractors in cybersecurity?">
                        Market intelligence
                    </button>
                </div>
                <div class="text-xs text-gray-500 mt-2 italic">Arti is here and ready to help</div>
            </div>
        </div>
    </div>

    <div class="border-t border-gray-200 pt-4">
        <div class="flex gap-3">
            <input 
                type="text" 
                id="chat-input" 
                class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary"
                placeholder="Just talk to me like you would a trusted colleague..."
                maxlength="1000"
            >
            <button id="send-btn" class="bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium px-6 py-2 rounded-lg transition-colors flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                <span>Send</span>
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                </svg>
            </button>
        </div>
        <div class="text-xs text-gray-500 mt-2 text-center">
            <svg class="inline w-3 h-3 mr-1" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
            </svg>
            This conversation is private. Arti doesn't store or share your discussions.
        </div>
    </div>
</main>

<!-- Session Metrics (hidden by default) -->
<div id="session-metrics" class="hidden fixed bottom-4 right-4 bg-white rounded-lg shadow-lg p-4 max-w-xs">
    <h3 class="font-semibold text-gray-900 mb-2">Session Impact</h3>
    <div class="space-y-2 text-sm">
        <div class="flex justify-between">
            <span class="text-gray-600">Time Connected:</span>
            <span class="font-medium" id="session-time">0 min</span>
        </div>
        <div class="flex justify-between">
            <span class="text-gray-600">Messages Exchanged:</span>
            <span class="font-medium" id="message-count">0</span>
        </div>
        <div class="flex justify-between">
            <span class="text-gray-600">Insights Shared:</span>
            <span class="font-medium" id="insight-count">0</span>
        </div>
        <div class="flex justify-between">
            <span class="text-gray-600">Visualizations:</span>
            <span class="font-medium" id="viz-count">0</span>
        </div>
    </div>
    <button class="mt-3 text-xs text-gray-500 hover:text-gray-700" onclick="document.getElementById('session-metrics').classList.add('hidden')">
        Dismiss
    </button>
</div>

<footer class="text-center mt-12 space-y-4">
    <div class="flex justify-center gap-6 text-sm">
        <button id="about-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">About</button>
        <button id="share-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Share</button>
        <button id="metrics-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Session Stats</button>
        <a href="mailto:mark@subhoo.com" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Contact</a>
    </div>
    
    <div class="sponsor-ad rounded-lg p-3 mb-4 text-sm bg-white border border-gray-200 not-italic text-left leading-normal text-gray-700 max-w-md mx-auto">
        <div class="flex items-center gap-2 mb-2">
            <span class="text-xs font-medium text-gray-600 bg-gray-100 px-2 py-1 rounded-full">SPONSOR</span>
            <span class="text-gray-800 font-semibold">Hey there! Enjoyin' these results?</span>
        </div>
        <p class="text-sm leading-relaxed text-gray-700">
            By the time I pay off all my scientists, all the lab coats, and my Lambda bill…I'm losin' money every time you chat with Arti.
        </p>
        <p class="mt-2 text-xs italic text-gray-500">
            Don't let my loss be your loss. Sponsor this ad for the low low price of $99/mo.
        </p>
        <p class="mt-2 text-xs text-customPurple-600 font-medium">
            <a href="mailto:mark@subhoo.com" class="hover:underline">Contact me to reserve this premium spot →</a>
        </p>
    </div>

    <p class="text-xs text-gray-400">
        AskArti.com results are provided for informational and educational purposes only and do not constitute professional business advice. AI can make errors or provide recommendations that may not suit your specific situation. Please consult qualified professionals before making important business decisions.
    </p>

    <br>

    <p class="text-xs text-gray-400">© 2025 AskArti. Made for Sellers by Sellers.</p>

    <div class="mt-4 flex justify-center">
        <a href="https://aws.amazon.com/what-is-cloud-computing" target="_blank" rel="noopener noreferrer">
            <img src="https://d0.awsstatic.com/logos/powered-by-aws.png" alt="Powered by AWS Cloud Computing" style="width: 80px; height: auto;">
        </a>
    </div>
</footer>

    </div>

    <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <img src="images/oldmark.jpg" alt="Mark Flournoy" class="w-12 h-12 rounded-full object-cover border-2 border-customPurple-200">
                    <h2 class="text-xl font-bold text-gray-900">Hi, I'm Mark</h2>
                </div>
                <button id="close-about" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700">
                <p>I've spent over 30 years working with the federal government as a mission owner, COTR, and seller.</p>
                <p>I built AskArti to help federal salespeople use AI in a practical way to better support their customers. Arti's not perfect, so use your judgment, but he's available 24/7 whenever you need ideas.</p>
                
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="bg-gray-50 rounded-lg p-4 text-sm">
                        <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-customPurple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Privacy & Technology
                        </h3>
                        <p class="text-gray-600 mb-2">AskArti uses models that may include Gemini, Claude, and ChatGPT. These models may use API inputs to improve responses. We do not store, log, or persist any prompt or response data. All processing occurs in-memory using AWS Lambda and is discarded after execution.</p>
                    </div>
                </div>
                
                <div class="pt-4">
                    <a href="https://calendly.com/markflournoy/30min" target="_blank" class="block w-full bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors">
                        Let's chat about AI or Fed Sales →
                    </a>
                </div>
            </div>
        </div>
    </div>

<script>
    // Configuration
    const CONFIG = {
        API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
        MAX_RETRIES: 2,
        RETRY_DELAY: 2000,
    };

    // Initialize Mermaid
    mermaid.initialize({ 
        startOnLoad: false,
        theme: 'neutral',
        themeVariables: {
            primaryColor: '#7C6BBE',
            primaryTextColor: '#fff',
            primaryBorderColor: '#5A4E8C',
            lineColor: '#5A4E8C',
            secondaryColor: '#E8E4F7',
            tertiaryColor: '#fff'
        }
    });

    // Global State
    const conversationState = {
        history: [],
        isTyping: false,
        sessionStart: Date.now(),
        metrics: {
            messagesExchanged: 0,
            insightsProvided: 0,
            visualizationsShared: 0
        }
    };

    // --- DOM Elements ---
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendBtn = document.getElementById('send-btn');
    const clearChatBtn = document.getElementById('clear-chat');
    const aboutBtn = document.getElementById('about-btn');
    const shareBtn = document.getElementById('share-btn');
    const metricsBtn = document.getElementById('metrics-btn');
    const aboutModal = document.getElementById('about-modal');
    const closeAboutBtn = document.getElementById('close-about');
    const sessionMetricsDiv = document.getElementById('session-metrics');
    
    // --- Core Chat Functions ---

    /**
     * Analyzes user mood from message content
     */
    function analyzeUserMood(message) {
        return {
            frustrated: /frustrated|annoying|stupid|hate|sick of|fed up/i.test(message),
            urgent: /asap|urgent|now|today|immediately|quick/i.test(message),
            confused: /confused|don't understand|lost|help|what do you mean/i.test(message),
            excited: /excited|great|awesome|love|fantastic|excellent/i.test(message)
        };
    }

    /**
     * Appends a message to the chat log.
     */
    function addMessage(content, isUser = false, responseData = null) {
        const messageWrapper = document.createElement('div');
        messageWrapper.className = 'flex gap-3 fade-in';

        if (isUser) {
            messageWrapper.innerHTML = `
                <div class="flex-1 flex justify-end">
                    <div class="bg-customPurple-500 text-white rounded-lg p-4 max-w-[80%]">
                        <p>${escapeHtml(content)}</p>
                    </div>
                </div>
            `;
        } else {
            let messageContent = `
                <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 rounded-full flex-shrink-0">
                <div class="flex-1">
                    <div class="bg-gray-100 rounded-lg p-4 max-w-[80%]">
                        <div class="prose prose-sm max-w-none">${marked.parse(content)}</div>
                    </div>`;

            // Add quick wins if provided
            if (responseData?.quick_wins && responseData.quick_wins.length > 0) {
                messageContent += `
                    <div class="mt-3 bg-green-50 border border-green-200 rounded-lg p-3 max-w-[80%]">
                        <h4 class="text-sm font-semibold text-green-900 mb-2 flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.293l-3-3a1 1 0 00-1.414 1.414L10.586 9.5H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z"/>
                            </svg>
                            Quick Wins
                        </h4>
                        <ul class="space-y-1">
                            ${responseData.quick_wins.map(win => `
                                <li class="text-sm text-green-800 flex items-start">
                                    <span class="text-green-600 mr-2">→</span>
                                    ${escapeHtml(win)}
                                </li>
                            `).join('')}
                        </ul>
                    </div>`;
                conversationState.metrics.insightsProvided++;
            }

            // Add hidden factors if provided
            if (responseData?.hidden_factors && responseData.hidden_factors.length > 0) {
                messageContent += `
                    <div class="mt-3 bg-amber-50 border border-amber-200 rounded-lg p-3 max-w-[80%]">
                        <h4 class="text-sm font-semibold text-amber-900 mb-2 flex items-center">
                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M10 12a2 2 0 100-4 2 2 0 000 4z"/>
                                <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd"/>
                            </svg>
                            Things You Might Not Have Considered
                        </h4>
                        <ul class="space-y-1">
                            ${responseData.hidden_factors.map(factor => `
                                <li class="text-sm text-amber-800">• ${escapeHtml(factor)}</li>
                            `).join('')}
                        </ul>
                    </div>`;
                conversationState.metrics.insightsProvided++;
            }

            // Add confidence score if provided
            if (responseData?.confidence_score) {
                messageContent += `
                    <div class="mt-3 inline-flex items-center bg-purple-100 text-purple-800 text-sm rounded-full px-3 py-1">
                        <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        ${escapeHtml(responseData.confidence_score)}
                    </div>`;
            }

            // Add personal anecdote if provided
           if (responseData?.personal_anecdote) {
               messageContent += `
                   <div class="mt-3 bg-blue-50 border-l-4 border-blue-400 px-4 py-3 rounded-r-lg max-w-[80%]">
                       <p class="text-sm text-blue-800 italic">
                           <span class="font-medium">Story time:</span> ${escapeHtml(responseData.personal_anecdote)}
                       </p>
                   </div>`;
           }

           // Add practical tip if provided
           if (responseData?.practical_tip) {
               messageContent += `
                   <div class="mt-3 bg-indigo-50 rounded-lg p-3 max-w-[80%]">
                       <p class="text-sm text-indigo-800">
                           <span class="font-semibold">💡 Pro tip:</span> ${escapeHtml(responseData.practical_tip)}
                       </p>
                   </div>`;
           }

           // Add mood-based response indicator
           const mood = analyzeUserMood(conversationState.history[conversationState.history.length - 1]?.user || '');
           let moodText = 'Arti is engaged and thinking';
           if (mood.frustrated) moodText = 'Arti senses your frustration and is here to help';
           if (mood.urgent) moodText = 'Arti understands the urgency';
           if (mood.confused) moodText = 'Arti is here to clarify things';
           if (mood.excited) moodText = 'Arti shares your enthusiasm';

           messageContent += `
                   <div class="text-xs text-gray-500 mt-2 italic">${moodText}</div>
               </div>`;
           
           messageWrapper.innerHTML = messageContent;
           
           // Add visualization if provided
           if (responseData?.visualization) {
               setTimeout(() => {
                   const vizElement = renderChatVisualization(responseData.visualization);
                   messageWrapper.querySelector('.flex-1').appendChild(vizElement);
                   conversationState.metrics.visualizationsShared++;
               }, 100);
           }
       }
       
       chatMessages.appendChild(messageWrapper);
       chatMessages.scrollTop = chatMessages.scrollHeight;
   }

   /**
    * Creates an HTML element for visualizations (Mermaid or ApexCharts)
    */
   function renderChatVisualization(visualization) {
       const { type, title, data } = visualization;
       const chartId = `chart-${Date.now()}`;
       const chartContainer = document.createElement('div');
       chartContainer.className = "mt-3 bg-white rounded-lg border border-gray-200 p-4 max-w-[80%]";
       
       // Handle Mermaid diagrams
       if (type.startsWith('mermaid_')) {
           chartContainer.innerHTML = `
               <h4 class="font-semibold text-gray-900 mb-3">${escapeHtml(title)}</h4>
               <div class="mermaid" id="${chartId}">${data.content}</div>
           `;
           
           // Initialize mermaid for this specific diagram
           setTimeout(() => {
               try {
                   mermaid.init(undefined, document.getElementById(chartId));
               } catch (e) {
                   console.error('Mermaid rendering error:', e);
                   document.getElementById(chartId).innerHTML = '<p class="text-sm text-red-600">Unable to render diagram</p>';
               }
           }, 0);
           
           return chartContainer;
       }
       
       // Handle ApexCharts
       chartContainer.innerHTML = `
           <h4 class="font-semibold text-gray-900 mb-3">${escapeHtml(title)}</h4>
           <div id="${chartId}" style="min-height: 300px;"></div>
       `;
       
       setTimeout(() => {
           try {
               const options = getChartConfig(type, data);
               new ApexCharts(document.querySelector(`#${chartId}`), options).render();
           } catch (e) {
               console.error('ApexCharts rendering error:', e);
               document.querySelector(`#${chartId}`).innerHTML = '<p class="text-sm text-red-600">Unable to render chart</p>';
           }
       }, 100);
       
       return chartContainer;
   }

   /**
    * Returns the configuration object for different chart types
    */
   function getChartConfig(type, data) {
       const commonOptions = {
           chart: { 
               toolbar: { show: false }, 
               zoom: { enabled: false },
               fontFamily: 'Inter, sans-serif'
           },
           colors: ['#7C6BBE', '#5A4E8C', '#E8E4F7', '#9F8FDB', '#C2B5F0'],
       };
       
       const configs = {
           apex_line: {
               ...commonOptions,
               series: data.series || [],
               chart: { ...commonOptions.chart, type: 'line', height: 280 },
               xaxis: { categories: data.categories || [] },
               stroke: { curve: 'smooth', width: 2 },
               markers: { size: 4 }
           },
           apex_bar: {
               ...commonOptions,
               series: data.series || [],
               chart: { ...commonOptions.chart, type: 'bar', height: 280 },
               xaxis: { categories: data.categories || [] },
               plotOptions: { 
                   bar: { 
                       horizontal: false, 
                       columnWidth: '55%',
                       borderRadius: 4
                   } 
               },
               dataLabels: { enabled: false }
           },
           apex_radar: {
               ...commonOptions,
               series: data.series || [],
               chart: { ...commonOptions.chart, type: 'radar', height: 320 },
               xaxis: { categories: data.categories || [] },
               yaxis: { show: false },
               markers: { size: 4 }
           },
           apex_heatmap: {
               ...commonOptions,
               series: data.series || [],
               chart: { ...commonOptions.chart, type: 'heatmap', height: 280 },
               dataLabels: { enabled: true },
               xaxis: { categories: data.xCategories || [] },
               plotOptions: {
                   heatmap: {
                       shadeIntensity: 0.5,
                       colorScale: { ranges: [
                           { from: 0, to: 25, color: '#E8E4F7' },
                           { from: 26, to: 50, color: '#C2B5F0' },
                           { from: 51, to: 75, color: '#9F8FDB' },
                           { from: 76, to: 100, color: '#7C6BBE' }
                       ]}
                   }
               }
           },
           apex_pie: {
               ...commonOptions,
               series: data.values || [],
               chart: { ...commonOptions.chart, type: 'pie', height: 280 },
               labels: data.labels || [],
               legend: { position: 'bottom' },
               responsive: [{
                   breakpoint: 480,
                   options: { 
                       chart: { width: 200 }, 
                       legend: { position: 'bottom' } 
                   }
               }]
           }
       };
       
       return configs[type] || configs.apex_line;
   }

   /**
    * Handles the entire process of sending a message and receiving a response
    */
   async function handleSendMessage() {
       const message = chatInput.value.trim();
       if (!message) return;

       // Disable input while processing
       sendBtn.disabled = true;
       chatInput.disabled = true;

       // Add user message
       addMessage(message, true);
       chatInput.value = '';
       
       // Update conversation history
       conversationState.history.push({ user: message });
       conversationState.metrics.messagesExchanged++;
       
       // Analyze mood and show appropriate typing indicator
       const mood = analyzeUserMood(message);
       let typingMessage = "Arti is thinking...";
       if (mood.frustrated) typingMessage = "Taking a deep breath with you...";
       if (mood.urgent) typingMessage = "Getting you quick answers...";
       if (mood.confused) typingMessage = "Let me clarify this for you...";
       
       showTypingIndicator(typingMessage);

       try {
           const response = await fetchWithRetry(CONFIG.API_ENDPOINT, {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({
                   message: message,
                   conversationHistory: conversationState.history.slice(-5)
               })
           });

           if (!response.ok) {
               throw new Error(`API Error: ${response.statusText}`);
           }

           const data = await response.json();
           removeTypingIndicator();
           
           // Add Arti's response
           addMessage(data.message, false, data);
           
           // Update conversation history
           if (data.message) {
               conversationState.history.push({ assistant: data.message });
           }

           // Add follow-up questions if provided
           if (data.follow_up_questions && data.follow_up_questions.length > 0) {
               setTimeout(() => {
                   addFollowUpQuestions(data.follow_up_questions);
               }, 500);
           }

           // Update session metrics
           updateSessionMetrics();

       } catch (error) {
           console.error('Failed to get response:', error);
           removeTypingIndicator();
           
           const errorMessage = mood.frustrated 
               ? "I know this is frustrating - technology fails me too sometimes. Let me shake off these digital cobwebs. What were you trying to tell me?"
               : "Well, this is embarrassing. My circuits are crossed right now. Mind trying again? Sometimes a fresh start helps.";
           
           addMessage(errorMessage, false);
       } finally {
           // Re-enable inputs
           sendBtn.disabled = false;
           chatInput.disabled = false;
           chatInput.focus();
       }
   }

   /**
    * Fetch with retry logic
    */
   async function fetchWithRetry(url, options, retries = CONFIG.MAX_RETRIES) {
       for (let i = 0; i <= retries; i++) {
           try {
               const response = await fetch(url, options);
               return response;
           } catch (error) {
               if (i === retries) throw error;
               await new Promise(resolve => setTimeout(resolve, CONFIG.RETRY_DELAY * (i + 1)));
           }
       }
   }

   /**
    * Shows typing indicator
    */
   function showTypingIndicator(message = "Arti is thinking...") {
       if (document.getElementById('typing-indicator')) return;
       
       const typingDiv = document.createElement('div');
       typingDiv.id = 'typing-indicator';
       typingDiv.className = 'flex gap-3';
       typingDiv.innerHTML = `
           <img src="/images/arti_right.png" alt="Arti" class="w-8 h-8 rounded-full flex-shrink-0">
           <div>
               <div class="bg-gray-100 rounded-lg p-4 inline-flex items-center gap-2">
                   <div class="flex gap-1">
                       <span class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></span>
                       <span class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></span>
                       <span class="w-2 h-2 bg-gray-400 rounded-full typing-dot"></span>
                   </div>
                   <span class="text-sm text-gray-600 ml-2">${escapeHtml(message)}</span>
               </div>
           </div>`;
       chatMessages.appendChild(typingDiv);
       chatMessages.scrollTop = chatMessages.scrollHeight;
   }

   /**
    * Removes typing indicator
    */
   function removeTypingIndicator() {
       const indicator = document.getElementById('typing-indicator');
       if (indicator) indicator.remove();
   }

   /**
    * Adds follow-up question buttons
    */
   function addFollowUpQuestions(questions) {
       const questionsDiv = document.createElement('div');
       questionsDiv.className = 'flex gap-3 mt-2 fade-in';
       questionsDiv.innerHTML = `
           <div class="w-8 h-8 flex-shrink-0"></div>
           <div class="flex-1">
               <p class="text-xs text-gray-500 mb-2">Keep the conversation going:</p>
               <div class="flex flex-wrap gap-2">
                   ${questions.map(q => `
                       <button class="suggested-question text-xs bg-white border border-gray-300 rounded-full px-3 py-1 hover:bg-gray-50 hover:border-customPurple-300" data-question="${escapeHtml(q)}">
                           ${escapeHtml(q)}
                       </button>
                   `).join('')}
               </div>
           </div>`;
       chatMessages.appendChild(questionsDiv);
       
       // Add event listeners
       questionsDiv.querySelectorAll('.suggested-question').forEach(btn => {
           btn.addEventListener('click', (e) => {
               chatInput.value = e.target.dataset.question;
               handleSendMessage();
           });
       });
   }

   /**
    * Updates session metrics display
    */
   function updateSessionMetrics() {
       const duration = Math.floor((Date.now() - conversationState.sessionStart) / 60000);
       document.getElementById('session-time').textContent = `${duration} min`;
       document.getElementById('message-count').textContent = conversationState.metrics.messagesExchanged;
       document.getElementById('insight-count').textContent = conversationState.metrics.insightsProvided;
       document.getElementById('viz-count').textContent = conversationState.metrics.visualizationsShared;
   }

   /**
    * Clears the chat history
    */
   function clearChat() {
       if (confirm('Clear all chat history? This cannot be undone.')) {
           chatMessages.innerHTML = '';
           conversationState.history = [];
           conversationState.sessionStart = Date.now();
           conversationState.metrics = {
               messagesExchanged: 0,
               insightsProvided: 0,
               visualizationsShared: 0
           };
           
           // Re-add welcome message
           addMessage("Alright, fresh start! What's on your mind?", false);
       }
   }

   /**
    * Utility function to escape HTML
    */
   function escapeHtml(unsafe) {
       return unsafe
           .replace(/&/g, "&amp;")
           .replace(/</g, "&lt;")
           .replace(/>/g, "&gt;")
           .replace(/"/g, "&quot;")
           .replace(/'/g, "&#039;");
   }

   // --- Event Listeners ---
   function setupEventListeners() {
       // Chat functionality
       sendBtn.addEventListener('click', handleSendMessage);
       chatInput.addEventListener('keydown', (e) => {
           if (e.key === 'Enter' && !e.shiftKey) {
               e.preventDefault();
               handleSendMessage();
           }
       });

       // Clear chat
       clearChatBtn.addEventListener('click', clearChat);

       // Initial suggested questions
       document.querySelectorAll('.suggested-question').forEach(btn => {
           btn.addEventListener('click', (e) => {
               chatInput.value = e.target.dataset.question;
               handleSendMessage();
           });
       });

       // About Modal
       aboutBtn.addEventListener('click', () => aboutModal.classList.remove('hidden'));
       closeAboutBtn.addEventListener('click', () => aboutModal.classList.add('hidden'));
       aboutModal.addEventListener('click', (e) => {
           if (e.target === aboutModal) aboutModal.classList.add('hidden');
       });

       // Session Metrics
       metricsBtn.addEventListener('click', () => {
           updateSessionMetrics();
           sessionMetricsDiv.classList.toggle('hidden');
       });

       // Share Button
       shareBtn.addEventListener('click', () => {
           const shareData = { 
               title: 'AskArti - Federal Sales Mentor', 
               text: "Get federal sales advice from a 30-year veteran. Check out AskArti!", 
               url: "https://askarti.com" 
           };
           
           if (navigator.share) {
               navigator.share(shareData).catch(err => console.error('Share failed:', err));
           } else {
               navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`).then(() => {
                   shareBtn.textContent = 'Link Copied!';
                   setTimeout(() => { shareBtn.textContent = 'Share'; }, 2000);
               }).catch(err => {
                   console.error('Copy failed:', err);
                   alert('Copy the link: https://askarti.com');
               });
           }
       });

       // Global keydown
       document.addEventListener('keydown', (e) => {
           if (e.key === 'Escape') {
               aboutModal.classList.add('hidden');
               sessionMetricsDiv.classList.add('hidden');
           }
       });

       // Auto-focus on input
       chatInput.focus();
   }

   // Initialize the application
   document.addEventListener('DOMContentLoaded', setupEventListeners);
</script>
</body>
</html>