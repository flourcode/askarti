<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti.">
    <meta property="og:image" content="https://askarti.com/images/arti_right.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti.">
    <meta name="twitter:image" content="https://askarti.com/images/arti_right.png">
    
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <meta name="theme-color" content="#ffffff">
    
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/images/arti_right.png" as="image">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script> 
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'brand-purple': '#7C6BBE',
                        'brand-gray': {
                            50: '#F9FAFB',
                            100: '#F3F4F6',
                            200: '#E5E7EB',
                            400: '#9CA3AF',
                            600: '#4B5563',
                            800: '#1F2937',
                            900: '#111827',
                        },
                        'brand-yellow': {
                            bg: '#FEF9C3',
                            text: '#854D0E',
                            border: '#FDE68A',
                        },
                        'brand-blue': {
                            bg: '#DBEAFE',
                            text: '#1E40AF',
                            border: '#BFDBFE',
                        },
                        'brand-green': {
                            bg: '#D1FAE5',
                            text: '#065F46',
                            border: '#A7F3D0',
                        }
                    }
                }
            }
        }
    </script>

<style>
   :root {
       --brand-purple: #7C6BBE;
       --brand-gray-50: #F9FAFB;
       --brand-gray-100: #F3F4F6;
       --brand-gray-800: #1F2937;
   }
   html {
       scroll-behavior: smooth;
   }
   body {
       background-color: var(--brand-gray-50);
       font-family: 'Inter', sans-serif;
       color: var(--brand-gray-800);
       -webkit-font-smoothing: antialiased;
       -moz-osx-font-smoothing: grayscale;
   }
   .main-container {
       max-width: 768px;
       margin: 0 auto;
       padding: 1rem;
   }
   .fade-in {
       animation: fadeIn 0.5s ease-in-out;
   }
   @keyframes fadeIn {
       from { opacity: 0; transform: translateY(10px); }
       to { opacity: 1; transform: translateY(0); }
   }
   
   /* --- Enhanced Card Styles --- */
   .io-card {
       background-color: white;
       border-radius: 1rem;
       border: 1px solid #E5E7EB;
       padding: 1.5rem;
       box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
       transition: box-shadow 0.2s ease;
   }
   .io-card:focus-within {
       box-shadow: 0 0 0 2px var(--brand-purple);
   }
   .results-card {
       background-color: white;
       border-radius: 1rem;
       border: 1px solid #E5E7EB;
       overflow: hidden;
       margin-top: 1.5rem;
   }
   .results-card-header {
       padding: 1rem 1.5rem;
       border-bottom: 1px solid #E5E7EB;
   }
   .results-card-body {
       padding: 1.5rem;
   }
   
   /* --- Enhanced Typography --- */
   h1, h2, h3, h4, h5, h6 {
       font-weight: 700;
       margin-bottom: 1rem;
   }
   p, li, span {
       font-weight: 400;
       line-height: 1.6;
   }
   .results-card-body > div {
       margin-bottom: 1.5rem;
   }
   
   /* --- Form Elements --- */
   textarea, input[type="text"] {
       font-size: 16px !important; /* Prevent iOS zoom */
       transition: all 0.2s ease;
   }
   .textarea-container {
    position: relative;
}
.clear-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background-color: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(229, 231, 235, 0.7);
    border-radius: 0.375rem;
    padding: 0.25rem;
    min-width: 28px;
    min-height: 28px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #6B7280;
    cursor: pointer;
    transition: all 0.2s ease;
    opacity: 0;
    visibility: hidden;
    backdrop-filter: blur(8px);
}
.clear-btn:hover {
    background-color: rgba(255, 255, 255, 0.95);
    border-color: rgba(156, 163, 175, 0.8);
    color: #374151;
    transform: scale(1.05);
}
.clear-btn:active {
    transform: scale(0.95);
}
.clear-btn.show {
    opacity: 1;
    visibility: visible;
}
   
   /* --- Enhanced Quick Prompts --- */
   .quick-prompt {
       transition: all 0.2s ease-in-out;
       border: 1px solid var(--brand-gray-100);
       padding: 0.75rem 1rem;
       min-height: 44px;
       display: flex;
       align-items: center;
       justify-content: center;
       text-align: center;
   }
   .quick-prompt:hover {
       transform: translateY(-2px);
       box-shadow: 0 4px 8px rgba(0,0,0,0.1);
       border-color: #E5E7EB;
   }
   .quick-prompt:active {
       transform: scale(0.95);
   }
   
   /* --- Enhanced Button Styles --- */
   .btn {
       display: inline-flex;
       align-items: center;
       justify-content: center;
       font-weight: 600;
       border-radius: 0.75rem;
       padding: 0.75rem 1.5rem;
       min-height: 44px;
       min-width: 44px;
       transition: all 0.2s ease;
       cursor: pointer;
       user-select: none;
       -webkit-tap-highlight-color: transparent;
   }
   .btn:active {
       transform: scale(0.95);
   }
   .btn-primary {
       background-color: var(--brand-purple);
       color: white;
       box-shadow: 0 2px 4px rgba(0,0,0,0.1);
   }
   .btn-primary:hover {
       background-color: #6959a7;
       transform: translateY(-1px);
       box-shadow: 0 4px 8px rgba(0,0,0,0.15);
   }
   .btn-primary:active {
       transform: scale(0.95);
       box-shadow: 0 2px 4px rgba(0,0,0,0.1);
   }
   .btn-secondary {
       background-color: white;
       color: #374151;
       border: 1px solid #D1D5DB;
       box-shadow: 0 1px 3px rgba(0,0,0,0.1);
   }
   .btn-secondary:hover {
       background-color: #F9FAFB;
       border-color: #9CA3AF;
       transform: translateY(-1px);
       box-shadow: 0 4px 8px rgba(0,0,0,0.1);
   }
   .btn-secondary:active {
       transform: scale(0.95);
       box-shadow: 0 1px 3px rgba(0,0,0,0.1);
   }
   
   /* --- Enhanced Copy Button --- */
   .copy-btn {
       position: absolute;
       top: 0.5rem;
       right: 0.5rem;
       background-color: rgba(255, 255, 255, 0.7);
       border: 1px solid #E5E7EB;
       border-radius: 0.5rem;
       padding: 0.5rem;
       min-width: 44px;
       min-height: 44px;
       display: flex;
       align-items: center;
       justify-content: center;
       font-size: 0.75rem;
       color: #4B5563;
       cursor: pointer;
       transition: all 0.2s ease;
       user-select: none;
       -webkit-tap-highlight-color: transparent;
   }
   .copy-btn:hover {
       background-color: white;
       border-color: #9CA3AF;
       transform: translateY(-1px);
       box-shadow: 0 2px 4px rgba(0,0,0,0.1);
   }
   .copy-btn:active {
       transform: scale(0.95);
   }
   .copy-btn.copied {
       background-color: #10B981;
       color: white;
       border-color: #10B981;
   }
   .copy-btn.copied:hover {
       background-color: #059669;
       border-color: #059669;
   }
   
   /* --- Copy Flash Animation --- */
   @keyframes copyFlash {
       0% { background-color: rgba(16, 185, 129, 0.1); }
       50% { background-color: rgba(16, 185, 129, 0.3); }
       100% { background-color: rgba(16, 185, 129, 0.1); }
   }
   .copy-flash {
       animation: copyFlash 0.6s ease-in-out;
   }
   
   /* --- Mode Button Enhancements --- */
   .mode-btn {
       min-height: 44px;
       transition: all 0.2s ease;
       -webkit-tap-highlight-color: transparent;
   }
   .mode-btn:active {
       transform: scale(0.95);
   }
   
   /* --- Recommended Button Style --- */
   .btn-recommended {
       border-width: 2px;
       border-color: var(--brand-purple);
       box-shadow: 0 4px 12px rgba(124, 107, 190, 0.2);
   }
   
   /* --- Loader --- */
   .loader {
       border: 2px solid rgba(255, 255, 255, 0.3);
       border-top: 2px solid white;
       border-radius: 50%;
       width: 1.25rem;
       height: 1.25rem;
       animation: spin 1s linear infinite;
   }
   .btn-secondary .loader {
       border-color: rgba(0, 0, 0, 0.1);
       border-top-color: var(--brand-purple);
   }
   @keyframes spin {
       0% { transform: rotate(0deg); }
       100% { transform: rotate(360deg); }
   }
   
   /* --- Chat specific styles --- */
   .chat-container {
       height: 60dvh;
       max-height: 500px;
       overflow-y: auto;
       padding: 1rem;
       background-color: #F9FAFB;
       border-radius: 1rem;
       border: 1px solid #E5E7EB;
   }
   .chat-message-user {
       background-color: var(--brand-purple);
       color: white;
       border-radius: 1rem 1rem 0.25rem 1rem;
   }
   .chat-message-arti {
       background-color: white;
       color: #1f2937;
       border: 1px solid #e5e7eb;
       border-radius: 1rem 1rem 1rem 0.25rem;
   }
   
   /* --- Enhanced Checkmark Icon --- */
   .checkmark {
       width: 16px;
       height: 16px;
       stroke: currentColor;
       stroke-width: 2;
       stroke-linecap: round;
       stroke-linejoin: round;
       fill: none;
   }
   
   /* --- Responsive & Mobile --- */
@media (max-width: 640px) {
    .main-container { 
        padding: 0.5rem; 
        padding-bottom: 0.5rem;
    }
    .io-card, .results-card-body { 
        padding: 0.75rem; 
    }
    .results-card-header {
        padding: 0.75rem 1rem;
    }
    .results-card-body > div {
        margin-bottom: 1rem;
    }
    .btn { 
        padding: 0.75rem 1rem; 
        font-size: 0.9rem; 
    }
    .copy-btn { 
        padding: 0.625rem;
        min-width: 48px;
        min-height: 48px;
    }
    .clear-btn {
        padding: 0.25rem; 
        min-width: 32px; 
        min-height: 32px; 
    }
    .quick-prompt {
        padding: 0.5rem 0.625rem;
        min-height: 36px;
        font-size: 0.8rem;
    }
    .mt-4 { margin-top: 0.5rem; }
    .mt-6 { margin-top: 0.75rem; }
    .chat-container {
        height: 45dvh;
        max-height: 350px;
        padding: 0.75rem;
    }
    .mode-btn {
        padding: 0.5rem 0.75rem;
        font-size: 0.8rem;
        min-height: 40px;
    }
    header {
        margin-bottom: 0.5rem;
    }
    header img {
        height: 4rem;
    }
    footer {
        margin-top: 2rem;
    }
    /* Reduce spacing on mobile */
    .space-y-3 > * + * { margin-top: 0.5rem; }
    .space-y-4 > * + * { margin-top: 0.75rem; }
    .space-y-6 > * + * { margin-top: 1rem; }
    .space-y-8 > * + * { margin-top: 1.25rem; }
}
/* Auto-expanding textarea */
.auto-expand {
    min-height: calc(3 * 1.5em + 1.5rem); /* 3 rows + padding */
    max-height: calc(6 * 1.5em + 1.5rem); /* 6 rows + padding */
    transition: height 0.2s ease;
    overflow-y: hidden;
    resize: none;
}

.auto-expand.scrollable {
    overflow-y: auto;
    transition: none; /* Remove transition when scrolling is needed */
}
</style>

</head>
<body class="bg-brand-gray-50">

   <div class="main-container pt-4 pb-20">
       
       <header class="text-center mb-3">
    <a href="/" aria-label="AskArti Home" class="inline-block">
        <img src="/images/asklite.png" alt="AskArti Logo" class="h-20 w-auto mx-auto sm:h-24">
    </a>
</header>

       <main id="main-content">
             <div id="quick-mode" class="mode-content fade-in">
                <div class="io-card">
                    <label for="situation-input" class="block text-sm font-bold text-brand-gray-700 mb-3" id="greeting-label">
                        Hey, I'm Arti! You can ask me anything.
                    </label>
                    <div class="textarea-container">
                        <textarea 
    id="situation-input" 
    rows="3"
    class="w-full p-3 pr-12 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-purple focus:border-brand-purple resize-none placeholder-gray-500 auto-expand"
    placeholder='e.g., "Create a sales playbook for selling AI services to HHS." Or start with a sample prompt.'
    maxlength="2500"></textarea>
<button id="clear-btn" class="clear-btn" title="Clear input" aria-label="Clear input">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
    </svg>
</button>
                    </div>
                    <div class="text-xs text-gray-500 mt-1.5">
    <span class="hint-text">💡 Click a sample below and swap in your agency, company, or goals. Add "playbook", "earnings", "prospect" or "news" to your prompt for specific plans.</span>
    <span id="char-count" class="hidden">0/2500</span>
</div>

                    <div class="mt-4">
    <div class="flex flex-wrap gap-2">
        <button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Create a comprehensive sales playbook for selling cloud migration services to the Department of Veterans Affairs. Focus on healthcare modernization, data analytics, and patient experience improvements. Include key stakeholders like CIOs, CTOs, and healthcare administrators.">Sales Playbook</button>
		<button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Buyer at VA ghosted me after I sent pricing. CISO loves our competitor.">Deal Strategy</button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Internal partner and account reps are fighting over customer access, pipeline, and revenue. Sales are hurting.">Partner Drama</button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Today, the Chief Digital and Artificial Intelligence Office (CDAO) announced contract awards to leading U.S. frontier AI companies to accelerate Department of Defense (DoD) adoption of advanced AI capabilities to address critical national security challenges. The awards to Anthropic, Google, OpenAI, and xAI – each with a $200M ceiling – will enable the Department to leverage the technology and talent of U.S. frontier AI companies to develop agentic AI workflows across a variety of mission areas.">Breaking News</button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="SEATTLE—(BUSINESS WIRE) May 1, 2025—Amazon.com, Inc. (NASDAQ: AMZN) today announced quarterly earnings results for its first quarter ended March 31, 2025. Net sales increased 9% to $155.7 billion in the first quarter, compared with $143.3 billion in first quarter 2024. AWS segment sales increased 17% year-over-year to $29.3 billion. Operating income increased to $18.4 billion in the first quarter. We're pleased with the start to 2025, especially our pace of innovation, said Andy Jassy, President and CEO, Amazon.">Market Analysis</button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-50 hover:bg-gray-100 rounded-full text-sm text-gray-700" data-text="Just took over Fed Sales at Staples. Help me prospect for office supplies at the VA.">Prospecting</button>
    </div>
</div>

                    <div class="mt-4 border-t border-gray-200 pt-4">
    <button id="game-plan-btn" class="btn btn-primary w-full">
        <span id="game-plan-text">Get My Game Plan</span>
        <div id="game-plan-loader" class="loader hidden"></div>
    </button>
</div>
                </div>
            </div>
		
            <div id="chat-mode" class="mode-content hidden fade-in">
                <div class="io-card">
                    <div class="chat-container mb-4" id="chat-container">
                        <div id="chat-messages" class="space-y-4">
                            <div class="flex justify-start">
                                <div class="chat-message-arti p-3 text-sm max-w-[85%]">
                                    <p id="chat-greeting">Hey! I'm Arti. I can help with stuck deals, boss problems, or whatever's on your mind. If you need a structured plan, flip to the "Game Plans" tab.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" class="flex-1 p-3 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-brand-purple focus:border-brand-purple" placeholder="Type your message..." maxlength="2000">
                        <button id="chat-send-btn" class="btn btn-primary px-4">
                           <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd" /></svg>
                        </button>
                    </div>
                </div>
				</div>
       </main>

        <div id="loading-message-container" class="text-center py-6 hidden">
            <p id="loading-message" class="text-gray-600 font-medium"></p>
        </div>
        <div id="error-message" class="bg-red-100 border border-red-300 rounded-lg p-4 text-center my-6 hidden">
            <p class="text-red-800 font-semibold mb-1">¯\_(ツ)_/¯ Oops, that didn't work.</p>
            <p class="text-red-700 text-sm" id="error-details">We're having trouble connecting to Arti.</p>
        </div>

       <div id="results-container" class="fade-in"></div>

       <div class="mt-8 text-center">
           <p class="text-sm text-gray-500 mb-2">Need something different? Switch modes.</p>
           <div class="io-card max-w-sm mx-auto p-2">
                <div class="flex bg-brand-gray-100 p-1 rounded-xl">
                    <button class="mode-btn flex-1 px-3 py-2 rounded-lg font-semibold text-sm transition-all active" data-mode="quick">
                        ⚡️ Game Plans
                    </button>
                    <button class="mode-btn flex-1 px-3 py-2 rounded-lg font-semibold text-sm transition-all" data-mode="chat">
                        💬 Chat with Arti
                    </button>
                </div>
           </div>
       </div>
       <footer class="text-center mt-12 text-xs text-gray-500">
    <div class="flex justify-center gap-4 mb-4">
        <a href="#" id="about-btn" class="font-medium text-brand-purple hover:underline">About AskArti</a>
        <a href="mailto:mark@subhoo.com" class="font-medium text-brand-purple hover:underline">Contact</a>
    </div>
    <p class="mb-3 text-gray-600">
    You're interacting with an AI assistant trained through June 2024. AskArti offers general guidance for informational purposes only and isn't a substitute for professional advice. Always evaluate recommendations carefully before making decisions.
</p>
    <p>
        For Federal Sellers by Federal Sellers.
        <br>
        Powered by AWS.
        <br>
        © 2025 AskArti.com.
    </p>
</footer>

  </div>
  
  <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
      <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
          <div class="flex justify-between items-start mb-4">
              <h2 class="text-xl font-bold text-gray-900">About AskArti</h2>
              <button id="close-about" class="text-gray-400 hover:text-gray-600">
                  <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
              </button>
          </div>
          <div class="space-y-4 text-gray-700 text-sm">
              <p>AskArti is your 24/7 AI sales coach, designed for federal sales professionals. Get instant advice on stuck deals, meeting preparation, and sales strategy.</p>
              <div class="mt-4 pt-4 border-t">
                  <h3 class="font-semibold text-gray-800 mb-2">Privacy & Technology</h3>
                  <p class="text-gray-600">AskArti uses advanced AI models. We do not store, log, or persist any conversation data. All processing occurs in-memory and is discarded.</p>
              </div>
          </div>
      </div>
  </div>
<script>
// --- Time-based greeting functionality ---
function getTimeBasedGreeting() {
   const hour = new Date().getHours();
   const name = "I'm Arti!";
   
   if (hour >= 5 && hour < 12) {
       return `Good morning! ${name} Ready to tackle the day?`;
   } else if (hour >= 12 && hour < 17) {
       return `Good afternoon! ${name} How can I help?`;
   } else if (hour >= 17 && hour < 21) {
       return `Good evening! ${name} What's on your mind?`;
   } else {
       return `Burning the midnight oil? ${name} I'm here to help.`;
   }
}

function updateGreetings() {
   const greeting = getTimeBasedGreeting();
   const greetingLabel = document.getElementById('greeting-label');
   const chatGreeting = document.getElementById('chat-greeting');
   
   if (greetingLabel) {
       greetingLabel.textContent = greeting;
   }
   
   if (chatGreeting) {
       const chatText = greeting.replace('Hey, I\'m Arti!', 'I\'m Arti.');
       chatGreeting.textContent = `${chatText} I can help with stuck deals, boss problems, or whatever's on your mind. If you need a structured plan, flip to the "Game Plans" tab.`;
   }
}

// --- Mode Toggle Active State ---
const modeButtons = document.querySelectorAll('.mode-btn');
modeButtons.forEach(btn => {
   btn.addEventListener('click', () => {
       modeButtons.forEach(b => b.classList.remove('active', 'bg-white', 'text-brand-purple'));
       btn.classList.add('active', 'bg-white', 'text-brand-purple');
       const inactiveBtn = [...modeButtons].find(b => !b.classList.contains('active'));
       if(inactiveBtn) {
           inactiveBtn.classList.add('text-gray-600');
           inactiveBtn.classList.remove('bg-white', 'text-brand-purple');
       }
   });
});
document.querySelector('.mode-btn[data-mode="quick"]').classList.add('bg-white', 'text-brand-purple');
document.querySelector('.mode-btn[data-mode="chat"]').classList.add('text-gray-600');

const CONFIG = {
 API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
 REQUEST_TIMEOUT: 30000,
 MAX_RETRIES: 2,
 RETRY_DELAY: 2000,
 MAX_INPUT_LENGTH: 2500,
 MIN_REQUEST_INTERVAL: 2000,
 LOADING_MESSAGES: [
     "Hang on. I'm...Working Backwards", 
     "...Diving Deep", 
     "...Unpacking This", 
     "...Putting a Pin in it", 
     "...Circling Back", 
     "...Thinking Big"
 ]
};

class AskArti {
 constructor() {
  this.elements = this.getElements();
  this.state = {
      pendingRequest: false,
      lastRequestTime: 0,
      loadingInterval: null,
      abortController: null,
      lastQuery: '',
      currentMode: 'quick',
      chatHistory: [],
  };
  this.init();
}

 getElements() {
    return {
        situationInput: document.getElementById('situation-input'),
        clearBtn: document.getElementById('clear-btn'),
        gamePlanBtn: document.getElementById('game-plan-btn'),
        gamePlanText: document.getElementById('game-plan-text'),
        gamePlanLoader: document.getElementById('game-plan-loader'),
        charCount: document.getElementById('char-count'),
        loadingMessageContainer: document.getElementById('loading-message-container'),
        loadingMessage: document.getElementById('loading-message'),
        errorMessage: document.getElementById('error-message'),
        errorDetails: document.getElementById('error-details'),
        resultsContainer: document.getElementById('results-container'),
        aboutBtn: document.getElementById('about-btn'),
        aboutModal: document.getElementById('about-modal'),
        closeAbout: document.getElementById('close-about'),
        quickPromptBtns: document.querySelectorAll('.quick-prompt'),
        modeButtons: document.querySelectorAll('.mode-btn'),
        quickMode: document.getElementById('quick-mode'),
        chatMode: document.getElementById('chat-mode'),
        chatMessages: document.getElementById('chat-messages'),
        chatInput: document.getElementById('chat-input'),
        chatSendBtn: document.getElementById('chat-send-btn'),
    };
}

 init() {
    updateGreetings();
    
    mermaid.initialize({ startOnLoad: false, securityLevel: 'strict', theme: 'base', themeVariables: {
          primaryColor: '#F3F4F6',
          primaryTextColor: '#1F2937',
          primaryBorderColor: '#D1D5DB',
          lineColor: '#6B7280',
          textColor: '#111827',
          fontSize: '14px'
    }});
    this.setupEventListeners();
    this.setupAutoExpand(); // Add this line
    this.elements.situationInput.focus();
    this.updateCharCount();
}

   updateCharCount() {
       if (!this.elements.situationInput) return;
       const current = this.elements.situationInput.value.length;
       const max = CONFIG.MAX_INPUT_LENGTH;
       this.elements.charCount.textContent = `${current}/${max}`;
       
       if (current > 0) {
           this.elements.clearBtn.classList.add('show');
       } else {
           this.elements.clearBtn.classList.remove('show');
       }
   }

   

   clearInput() {
    this.elements.situationInput.value = '';
    this.elements.situationInput.style.height = 'auto'; // Reset height
    this.elements.situationInput.classList.remove('scrollable');
    this.updateCharCount();
    this.elements.situationInput.focus();
}

   setupEventListeners() {
    this.elements.situationInput.addEventListener('input', () => {
        this.updateCharCount();
    });
    this.elements.situationInput.addEventListener('focus', () => {
        this.updateCharCount();
    });

    this.elements.situationInput.addEventListener('blur', () => {
        this.elements.clearBtn.classList.remove('show');
    });
    this.elements.clearBtn.addEventListener('click', () => this.clearInput());

    this.elements.quickPromptBtns.forEach(btn => {
        btn.addEventListener('click', (e) => {
            const button = e.currentTarget;
            this.elements.situationInput.value = button.dataset.text;
            this.updateCharCount();
            this.getAdvice(null, this.elements.gamePlanBtn);
        });
    });

    this.elements.gamePlanBtn.addEventListener('click', (e) => this.getAdvice(null, e.currentTarget));

    this.elements.situationInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.getAdvice(null, this.elements.gamePlanBtn);
        }
    });

    // Rest of your event listeners remain the same...
    this.elements.aboutBtn.addEventListener('click', () => this.showModal());
    this.elements.closeAbout.addEventListener('click', () => this.hideModal());
    this.elements.aboutModal.addEventListener('click', (e) => {
        if (e.target === this.elements.aboutModal) this.hideModal();
    });
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') this.hideModal();
    });

    this.elements.modeButtons.forEach(btn => {
        btn.addEventListener('click', (e) => this.switchMode(e.target.dataset.mode));
    });

    this.elements.chatSendBtn.addEventListener('click', () => this.sendChatMessage());
    this.elements.chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            this.sendChatMessage();
        }
    });
}

setupAutoExpand() {
    const textarea = this.elements.situationInput;
    
    const adjustHeight = () => {
        // Reset height to auto to get the correct scrollHeight
        textarea.style.height = 'auto';
        
        const minHeight = parseFloat(getComputedStyle(textarea).lineHeight) * 3 + 24; 
        const maxHeight = parseFloat(getComputedStyle(textarea).lineHeight) * 6 + 24; 
        
        let newHeight = Math.max(minHeight, textarea.scrollHeight);
        
        if (newHeight > maxHeight) {
            newHeight = maxHeight;
            textarea.classList.add('scrollable');
        } else {
            textarea.classList.remove('scrollable');
        }
        
        textarea.style.height = newHeight + 'px';
    };
    
    // Adjust on input
    textarea.addEventListener('input', adjustHeight);
    
    // Adjust on paste (with slight delay to ensure content is pasted)
    textarea.addEventListener('paste', () => {
        setTimeout(adjustHeight, 10);
    });
    
    // Initial adjustment
    adjustHeight();
}
   switchMode(mode) {
       this.state.currentMode = mode;
       this.elements.resultsContainer.innerHTML = '';
       this.elements.errorMessage.classList.add('hidden');
       this.hideLoadingMessages();

       if (mode === 'quick') {
           this.elements.quickMode.classList.remove('hidden');
           this.elements.chatMode.classList.add('hidden');
           this.elements.situationInput.focus();
       } else {
           this.elements.quickMode.classList.add('hidden');
           this.elements.chatMode.classList.remove('hidden');
           this.elements.chatInput.focus();
       }
   }

   addChatMessage(content, isUser = false) {
       let processedContent = isUser ? content : marked.parse(content.replace(/<action>(.*?)<\/action>/g, '<span class="bg-yellow-50 px-1 py-0.5 rounded">$1</span>'));
       const messageClass = isUser ? 'chat-message-user justify-end' : 'chat-message-arti justify-start';
       const alignClass = isUser ? 'justify-end' : 'justify-start';

       const messageHtml = `
           <div class="flex ${alignClass} fade-in">
               <div class="${messageClass} p-3 text-sm max-w-[85%]">
                   ${processedContent}
               </div>
           </div>
       `;
       this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
       this.scrollChatToBottom();
   }
   
   showTypingIndicator() {
       const typingHtml = `<div id="typing-indicator" class="flex justify-start"><div class="chat-message-arti p-3 text-sm">...</div></div>`;
       this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
       this.scrollChatToBottom();
   }

   hideTypingIndicator() {
       const indicator = document.getElementById('typing-indicator');
       if (indicator) indicator.remove();
   }

   scrollChatToBottom() {
       const chatContainer = document.getElementById('chat-container');
       if (chatContainer) {
           chatContainer.scrollTop = chatContainer.scrollHeight;
       }
   }

   async sendChatMessage() {
       const message = this.elements.chatInput.value.trim();
       if (!message || this.state.pendingRequest) return;

       this.state.pendingRequest = true;
       this.addChatMessage(message, true);
       this.state.chatHistory.push({ role: 'user', content: message });
       this.elements.chatInput.value = '';
       this.showTypingIndicator();

       try {
           const response = await fetch(CONFIG.API_ENDPOINT, {
               method: 'POST',
               headers: { 'Content-Type': 'application/json' },
               body: JSON.stringify({ situation: message, mode: 'chat', conversationHistory: this.state.chatHistory }),
           });
           if (!response.ok) throw new Error(`Server error (${response.status})`);
           
           const data = await response.json();
           this.hideTypingIndicator();
           this.addChatMessage(data.message);
           this.state.chatHistory.push({ role: 'assistant', content: data.message });

       } catch (error) {
           this.hideTypingIndicator();
           this.addChatMessage("Sorry, I'm having trouble connecting right now. Please try again in a moment.", false);
       } finally {
           this.state.pendingRequest = false;
       }
   }

   setButtonLoading(loading, clickedButton) {
    this.state.pendingRequest = loading;
    this.elements.errorMessage.classList.add('hidden');

    this.elements.gamePlanBtn.disabled = loading;

    if (loading) {
        this.elements.gamePlanText.classList.add('hidden');
        this.elements.gamePlanLoader.classList.remove('hidden');
    } else {
        this.elements.gamePlanText.classList.remove('hidden');
        this.elements.gamePlanLoader.classList.add('hidden');
    }
}

   showLoadingMessages() {
       this.elements.loadingMessageContainer.classList.remove('hidden');
       let i = 0;
       this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[i];
       this.state.loadingInterval = setInterval(() => {
           i = (i + 1) % CONFIG.LOADING_MESSAGES.length;
           this.elements.loadingMessage.textContent = CONFIG.LOADING_MESSAGES[i];
       }, 2000);
   }

   hideLoadingMessages() {
       clearInterval(this.state.loadingInterval);
       this.elements.loadingMessageContainer.classList.add('hidden');
   }

   showError(message) {
       this.elements.errorMessage.classList.remove('hidden');
       this.elements.errorDetails.textContent = message;
   }
   
   async getAdvice(forceType = null, clickedButton = null) {
    let situation = this.elements.situationInput.value.trim();
    situation = situation.replace(/[""]/g, '"').replace(/['']/g, "'");
    if (!situation) { this.showError("Please type or paste something into the box above."); return; }
    if (this.state.pendingRequest) return;
    
    const buttonToLoad = clickedButton || this.elements.gamePlanBtn; // Fixed this line

    this.state.lastQuery = situation;
    this.elements.resultsContainer.innerHTML = '';
    this.setButtonLoading(true, buttonToLoad);
    this.showLoadingMessages();

    try {
        const body = { situation };
        if (forceType) body.forceType = forceType;

        const response = await fetch(CONFIG.API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(body),
        });
        
        if (!response.ok) {
            let errorMessage = `Server error: ${response.status}`;
            try {
                const errorData = await response.json();
                errorMessage = errorData.error || errorData.message || errorMessage;
            } catch (parseError) {
                console.error('Error parsing error response:', parseError);
            }
            throw new Error(errorMessage);
        }
        
        const data = await response.json();
        if(data.error) throw new Error(data.message || data.error);
        
        this.displayAdvice(data);

    } catch (error) {
        console.error('Request failed:', error);
        this.showError(error.message || "An unknown error occurred.");
    } finally {
        this.setButtonLoading(false, buttonToLoad);
        this.hideLoadingMessages();
    }
}

   displayAdvice(data) {
       const { response_type } = data;
       let html = '';

       if (response_type === 'playbook') {
           html = this.renderSalesPlaybook(data);
       } else if (response_type === 'news') {
           html = this.renderNewsAdvice(data);
       } else if (response_type === 'investment') {
           html = this.renderMarketAnalysis(data);
       } else if (response_type === 'prospect') {
           html = this.renderProspectAdvice(data);
       } else {
           html = this.renderGeneralAdvice(data);
       }
       
       this.elements.resultsContainer.innerHTML = html;
       
       this.setupInteractiveElements();

       if (data.mermaid_chart) {
           this.renderMermaidChart().then(() => {
               this.setupMermaidDownloadButton();
           });
       }
       this.elements.resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
   }

   renderSalesPlaybook(data) {
    const { 
        sales_play_title, sales_play_summary, key_services, key_partners, target_personas,
        competitive_positioning, success_metrics, timeline_milestones, insider_tips, 
        risk_mitigation, next_actions 
    } = data;

    const renderList = (items, icon = '') => {
        if (!items || items.length === 0) return '<p class="text-sm text-gray-500">No data available.</p>';
        return items.map(item => `
            <li class="flex items-start">
                ${icon ? `<div class="flex-shrink-0 w-5 h-5 mr-3 mt-1">${icon}</div>` : ''}
                <span class="text-sm text-gray-700 leading-relaxed">${item}</span>
            </li>
        `).join('');
    };
    
    const renderPersonas = (personas) => {
        if (!personas || personas.length === 0) return '<p class="text-sm text-gray-500">No persona data available.</p>';
        return `
            <div x-data="{ activeTab: 0 }">
                <div class="flex border-b border-gray-200">
                    ${personas.map((p, index) => `
                        <button @click="activeTab = ${index}" :class="{ 'border-brand-purple text-brand-purple': activeTab === ${index}, 'border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300': activeTab !== ${index} }" class="py-4 px-1 text-center border-b-2 font-medium text-sm flex-1">${p.persona_title}</button>
                    `).join('')}
                </div>
                ${personas.map((p, index) => `
                    <div x-show="activeTab === ${index}" class="pt-4 space-y-4">
                        <div>
                            <h5 class="font-semibold text-gray-800 mb-2">Business Priorities</h5>
                            <ul class="space-y-1">${renderList(p.business_priorities, '<svg class="w-5 h-5 text-brand-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002-2h2a2 2 0 002 2h-4M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>')}</ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-800 mb-2">Conversation Starters</h5>
                            <ul class="space-y-1">${renderList(p.conversation_starters, '<svg class="w-5 h-5 text-brand-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>')}</ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-gray-800 mb-2">Objections & Responses</h5>
                            <div class="space-y-3">
                                ${p.objections_responses.map(o => `
                                    <div class="border-l-4 border-gray-300 pl-4 py-2">
                                        <p class="font-medium text-gray-800 text-sm mb-1"><strong>Objection:</strong> "${o.objection}"</p>
                                        <p class="text-gray-600 text-sm"><strong>Response:</strong> ${o.response}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
        `;
    };

    return `
    <div class="results-card">
        <div class="results-card-header bg-gray-50">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-semibold text-brand-purple">Sales Playbook</p>
                    <h2 class="font-bold text-xl text-gray-900 mt-1">${sales_play_title}</h2>
                </div>
            </div>
        </div>
        <div class="results-card-body space-y-8" id="playbook-content">
                
                <div class="border-l-4 border-brand-purple pl-4 py-2">
                    <h3 class="font-bold text-gray-900 mb-2">Executive Summary</h3>
                    <p class="text-gray-700 leading-relaxed">${sales_play_summary}</p>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-bold text-gray-900 mb-3">Success Metrics</h3>
                        <ul class="space-y-2">${renderList(success_metrics || ['Define success metrics'], '<svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>')}</ul>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-bold text-gray-900 mb-3">Timeline Milestones</h3>
                        <ul class="space-y-2">${renderList(timeline_milestones || ['Define timeline'], '<svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>')}</ul>
                    </div>
                </div>

                ${competitive_positioning ? `
                <div class="bg-yellow-50 border-l-4 border-yellow-400 p-4">
                    <h3 class="font-bold text-yellow-800 mb-2">Competitive Positioning</h3>
                    <p class="text-yellow-700 leading-relaxed">${competitive_positioning}</p>
                </div>
                ` : ''}

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h3 class="font-bold text-gray-900 mb-3">Key Services</h3>
                        <ul class="space-y-2">${renderList(key_services)}</ul>
                    </div>
                    <div>
                        <h3 class="font-bold text-gray-900 mb-3">Strategic Partners</h3>
                        <ul class="space-y-2">${renderList(key_partners)}</ul>
                    </div>
                </div>

                <div class="bg-white border border-gray-200 rounded-lg p-4">
                    <h3 class="font-bold text-lg text-gray-900 mb-4">Stakeholder Guide</h3>
                    ${renderPersonas(target_personas)}
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    ${insider_tips ? `
                    <div class="bg-gray-50 rounded-lg p-4">
                        <h3 class="font-bold text-gray-900 mb-3">Insider Tips</h3>
                        <ul class="space-y-2">${renderList(insider_tips, '<svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>')}</ul>
                    </div>
                    ` : ''}
                    
                    ${risk_mitigation ? `
                    <div class="bg-red-50 rounded-lg p-4">
                        <h3 class="font-bold text-red-800 mb-3">Risk Mitigation</h3>
                        <ul class="space-y-2">${renderList(risk_mitigation, '<svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>')}</ul>
                    </div>
                    ` : ''}
                </div>

                ${next_actions ? `
                <div class="border-2 border-brand-purple rounded-lg p-4 bg-brand-purple/5">
                    <h3 class="font-bold text-gray-900 mb-3">Next 7 Days</h3>
                    <ul class="space-y-2">${renderList(next_actions, '<svg class="w-5 h-5 text-brand-purple" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path></svg>')}</ul>
                </div>
                ` : ''}
            </div>
        </div>
    </div>
    `;
}

setupCopyPlaybookButton() {
    const copyBtn = document.querySelector('.copy-playbook-btn');
    if (!copyBtn) return;

    copyBtn.addEventListener('click', () => {
        const playbookContent = document.getElementById('playbook-content');
        if (!playbookContent) return;

        // Create clean text version
        const cleanText = this.convertPlaybookToText(playbookContent);
        
        navigator.clipboard.writeText(cleanText).then(() => {
            const originalContent = copyBtn.innerHTML;
            copyBtn.classList.add('copied');
            copyBtn.innerHTML = `
                <svg class="checkmark w-4 h-4 mr-1" viewBox="0 0 24 24">
                    <path d="M9 12l2 2 4-4"></path>
                </svg>
                Copied!
            `;
            
            setTimeout(() => {
                copyBtn.classList.remove('copied');
                copyBtn.innerHTML = originalContent;
            }, 2000);
        }).catch(err => {
            console.error('Failed to copy playbook: ', err);
        });
    });
}

convertPlaybookToText(element) {
    let text = '';
    const title = document.querySelector('.results-card-header h2')?.textContent || 'Sales Playbook';
    text += `${title}\n${'='.repeat(title.length)}\n\n`;

    const sections = element.children;

    for (const section of sections) {
        const heading = section.querySelector('h3');
        if (!heading) continue;

        const sectionTitle = heading.textContent.trim();
        text += `## ${sectionTitle}\n\n`;

        // Handle Stakeholder Guide (tabs)
        if (sectionTitle === 'Stakeholder Guide') {
            const personaTabs = section.querySelectorAll('[x-show]');
            personaTabs.forEach(tab => {
                const personaTitle = section.querySelector(`button:nth-child(${parseInt(tab.getAttribute('x-show').split(' ')[2]) + 1})`).textContent.trim();
                text += `### ${personaTitle}\n\n`;
                
                const subSections = tab.querySelectorAll('div > div');
                subSections.forEach(sub => {
                    const subTitle = sub.querySelector('h5').textContent.trim();
                    text += `**${subTitle}:**\n`;
                    const items = sub.querySelectorAll('li span');
                    items.forEach(item => {
                        text += `- ${item.textContent.trim()}\n`;
                    });
                    text += '\n';
                });
            });
        }
        // Handle regular lists and paragraphs
        else {
            const lists = section.querySelectorAll('ul');
            lists.forEach(list => {
                const items = list.querySelectorAll('li span');
                if (items.length > 0) {
                     items.forEach(item => {
                        text += `- ${item.textContent.trim()}\n`;
                    });
                } else { // Fallback for simple lists
                    const simpleItems = list.querySelectorAll('li');
                    simpleItems.forEach(item => {
                        text += `- ${item.textContent.trim()}\n`;
                    });
                }
            });

            const paragraphs = section.querySelectorAll('p');
            paragraphs.forEach(p => {
                if(p.textContent.trim() && p.textContent.trim() !== sectionTitle) {
                     text += `${p.textContent.trim()}\n`;
                }
            });
            text += '\n';
        }
    }
    
    return text.trim();
}
   renderMarketAnalysis(data) {
       const {
           investment_thesis, financial_health, market_position, growth_catalysts,
           identified_risks, management_outlook, key_financial_metrics, bull_case, bear_case, next_steps
       } = data;

       return `
           <div class="results-card">
               <div class="results-card-header flex items-center gap-4 bg-brand-blue-bg">
                   <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                   <h2 class="font-bold text-lg text-brand-blue-text">Market Analysis Summary</h2>
               </div>
               <div class="results-card-body space-y-8">
                   <div class="p-4 bg-brand-blue-bg/50 rounded-lg text-brand-blue-text">
                       ${marked.parse(investment_thesis)}
                   </div>

                   <div>
                       <h3 class="font-bold mb-3">Key Financial Metrics</h3>
                       <div class="flex flex-wrap gap-2">
                           ${key_financial_metrics && key_financial_metrics.length > 0 ? key_financial_metrics.map(metric => `
                               <span class="text-sm font-medium bg-gray-100 text-gray-800 px-3 py-1.5 rounded-lg">${metric}</span>`
                           ).join('') : '<p class="text-gray-500 text-sm">None mentioned.</p>'}
                       </div>
                   </div>

                   <div class="space-y-3 text-sm">
                       <p><strong>Financial Health:</strong> ${financial_health || 'Not detailed.'}</p>
                       <p><strong>Market Position:</strong> ${market_position || 'Not detailed.'}</p>
                       <p><strong>Management Outlook:</strong> ${management_outlook || 'Not detailed.'}</p>
                   </div>

                   <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                       <div>
                          <h4 class="font-bold text-green-700 mb-3">Growth Catalysts</h4>
                          <ul class="space-y-2 text-sm">${growth_catalysts && growth_catalysts.length > 0 ? growth_catalysts.map(c => `<li class="flex gap-2 items-start"><span class="text-green-500 mt-1">▲</span><span>${c}</span></li>`).join('') : '<li>None identified.</li>'}</ul>
                       </div>
                       <div>
                          <h4 class="font-bold text-red-700 mb-3">Identified Risks</h4>
                          <ul class="space-y-2 text-sm">${identified_risks && identified_risks.length > 0 ? identified_risks.map(r => `<li class="flex gap-2 items-start"><span class="text-red-500 mt-1">▼</span><span>${r}</span></li>`).join('') : '<li>None identified.</li>'}</ul>
                       </div>
                   </div>

                   <div>
                       <h3 class="font-bold mb-3">Bull vs. Bear Case</h3>
                       <div class="space-y-4">
                            <div class="p-3 bg-green-50 border-l-4 border-green-400">
                               <p class="font-bold text-green-800">Bull Case</p>
                               <p class="text-sm text-gray-700">${bull_case}</p>
                            </div>
                            <div class="p-3 bg-red-50 border-l-4 border-red-400">
                               <p class="font-bold text-red-800">Bear Case</p>
                               <p class="text-sm text-gray-700">${bear_case}</p>
                            </div>
                       </div>
                   </div>
                   
                   <div class="pt-4 border-t">
                       <p class="text-sm font-bold text-gray-800">${next_steps}</p>
                   </div>
                   
                   <div class="p-3 mt-4 text-xs text-gray-500 bg-gray-50 rounded-lg border border-gray-200">
                       <strong>Disclaimer:</strong> This content is for informational purposes only and does not constitute financial or investment advice. It is not a recommendation to buy or sell any security. You should always conduct your own research and consult a qualified financial professional before making any investment decisions.
                   </div>
               </div>
           </div>
       `;
   }
   
   renderGeneralAdvice(data) {
       const { quick_take, key_moves, mermaid_chart, talking_points, email_template, next_steps, response_type } = data;
       const title = response_type === 'interview' ? 'Your Interview Plan' : 'Your Game Plan';
       const talkingPointsTitle = response_type === 'interview' ? 'What They May Ask' : 'Key Questions to Ask';

       return `
           <div class="results-card">
               <div class="results-card-header flex items-center gap-4">
                   <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                   <h2 class="font-bold text-lg text-brand-gray-900">${title}</h2>
               </div>
               <div class="results-card-body space-y-8">
                   <div class="p-4 bg-brand-purple/10 rounded-lg text-brand-purple/90">${marked.parse(quick_take)}</div>
                   <div>
                       <h3 class="font-bold mb-3">Your Next 3 Moves</h3>
                       <div class="space-y-3">${key_moves.map((m, i) => `
                           <div class="flex gap-3 items-start">
                               <span class="flex-shrink-0 w-6 h-6 bg-brand-purple text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">${i + 1}</span>
                              <div>
                                  <p class="font-medium text-gray-900">${m.action}</p>
                                  <p class="text-sm text-gray-600">${m.why}</p>
                              </div>
                          </div>`).join('')}
                      </div>
                  </div>
                  ${mermaid_chart ? `
                  <div>
                      <h3 class="font-bold mb-2">Visual Strategy</h3>
                      <div class="mermaid-container p-4 bg-white border rounded-lg">
                         <div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div>
                      </div>
                      <div class="flex justify-end gap-2 mt-2">
                         <button class="btn btn-secondary text-xs py-1 px-2" id="download-png-btn">Download PNG</button>
                      </div>
                  </div>` : ''}
                  ${talking_points?.length > 0 ? `
                  <div>
                      <h3 class="font-bold mb-2">${talkingPointsTitle}</h3>
                      <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">${talking_points.map(t => `<li>${t}</li>`).join('')}</ul>
                  </div>
                  ` : ''}
                  ${email_template ? `
                  <div>
                      <h3 class="font-bold mb-2">Email Template</h3>
                      <div class="relative">
                          <div class="copy-target bg-gray-50 rounded-lg p-3 font-mono text-xs text-gray-700 whitespace-pre-wrap border">${email_template}</div>
                           <button class="copy-btn" title="Copy to clipboard">
                              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                           </button>
                      </div>
                  </div>
                  ` : ''}
              </div>
          </div>
      `;
  }
  
  renderProspectAdvice(data) {
      const { summary, top_s_is, top_software_and_cloud, company_capabilities, naics_codes, prospect_recommendations } = data;
      const renderList = (items) => {
           if (!items || items.length === 0) return '<p class="text-sm text-gray-500">No data available</p>';
           return `<div class="space-y-3">${items.map(item => `
              <div class="p-3 bg-gray-50 border rounded-md">
                  <p class="font-bold text-sm text-gray-800">${item.company || 'N/A'}</p>
                  <p class="text-xs text-gray-600">${item.value || ''}</p>
              </div>
           `).join('')}</div>`;
      };

      return `
           <div class="results-card">
              <div class="results-card-header flex items-center gap-4 bg-brand-green-bg">
                  <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                  <h2 class="font-bold text-lg text-brand-green-text">Prospecting Intelligence</h2>
              </div>
              <div class="results-card-body space-y-8">
                  <div class="p-4 bg-brand-green-bg/50 rounded-lg text-brand-green-text">${marked.parse(summary)}</div>
                  <div>
                      <h3 class="font-bold mb-3">Top Contractors (SIs)</h3>
                      ${renderList(top_s_is)}
                  </div>
                  <div>
                      <h3 class="font-bold mb-3">Top Software & Cloud Partners</h3>
                      ${renderList(top_software_and_cloud)}
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                         <h4 class="font-bold text-gray-800 mb-3">Relevant Capabilities</h4>
                         <ul class="space-y-2 text-sm">${company_capabilities.map(c => `<li class="flex gap-2 items-center"><svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${c}</li>`).join('')}</ul>
                      </div>
                      <div>
                         <h4 class="font-bold text-gray-800 mb-3">NAICS Codes</h4>
                         <ul class="space-y-2 text-sm">${naics_codes.map(n => `<li class="flex gap-2 items-center"><svg class="w-4 h-4 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"></path></svg>${n.code ? `${n.code} - ${n.description}`: n}</li>`).join('')}</ul>
                      </div>
                  </div>
                  <div>
                      <h3 class="font-bold mb-3">Recommendations</h3>
                      <div class="p-4 bg-gray-50 border rounded-lg text-sm space-y-2">${prospect_recommendations.map(r => `<p>${r}</p>`).join('')}</div>
                  </div>
              </div>
          </div>
      `;
  }

  renderNewsAdvice(data) {
      const { 
          quick_take, background, implications, suggested_opening_lines, immediate_actions, strategic_moves, mermaid_chart,
          key_people_and_titles, suggested_discovery_questions, money_keywords 
      } = data;
      
      return `
          <div class="results-card">
              <div class="results-card-header flex items-center gap-4 bg-brand-blue-bg">
                  <img src="/images/arti_right.png" alt="Arti" class="h-10 w-10 rounded-full border-2 border-white">
                  <h2 class="font-bold text-lg text-brand-blue-text">News Analysis Summary</h2>
              </div>
              <div class="results-card-body space-y-8">
                  <div class="p-4 bg-brand-blue-bg/50 rounded-lg text-brand-blue-text">${marked.parse(quick_take)}</div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                          <h3 class="font-bold mb-3">Key People & Titles</h3>
                          <div class="space-y-2 text-sm">
                              ${key_people_and_titles && key_people_and_titles.length > 0 ? key_people_and_titles.map(person => `
                                  <div class="flex items-center gap-2">
                                      <svg class="h-4 w-4 text-gray-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" /></svg>
                                      <span>${person}</span>
                                  </div>`).join('') : '<p class="text-gray-500">None mentioned.</p>'}
                          </div>
                      </div>
                      <div>
                          <h3 class="font-bold mb-3">Money Keywords</h3>
                          <div class="flex flex-wrap gap-2">
                              ${money_keywords && money_keywords.length > 0 ? money_keywords.map(keyword => `
                                  <span class="text-xs font-medium bg-green-100 text-green-800 px-2.5 py-1 rounded-full">${keyword}</span>`
                              ).join('') : '<p class="text-gray-500">No funding keywords found.</p>'}
                          </div>
                      </div>
                  </div>
                  <div>
                      <h3 class="font-bold mb-3">Suggested Discovery Questions</h3>
                      <div class="space-y-2">
                          ${suggested_discovery_questions && suggested_discovery_questions.length > 0 ? suggested_discovery_questions.map(q => `
                              <div class="p-3 bg-gray-50 border rounded-md text-sm text-gray-800 flex gap-2">
                                  <span class="font-bold text-brand-purple">Q.</span>
                                  <span>${q}</span>
                              </div>`).join('') : '<p class="text-gray-500">No questions suggested.</p>'}
                      </div>
                  </div>
                  <div>
                      <h3 class="font-bold mb-3">Email Openers</h3>
                      <div class="space-y-2">${suggested_opening_lines.map((line, i) => `
                          <div class="relative p-3 bg-gray-50 border rounded-md text-sm text-gray-700">
                               <span class="copy-target"><strong>Option ${i + 1}:</strong> ${line}</span>
                               <button class="copy-btn" title="Copy to clipboard">
                                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                               </button>
                          </div>`).join('')}
                      </div>
                  </div>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                      <div>
                          <h4 class="font-bold text-gray-800 mb-3">Immediate Actions</h4>
                          <div class="space-y-3">${immediate_actions.map((action, i) => `
                              <div class="flex gap-3 items-start">
                                  <span class="flex-shrink-0 w-6 h-6 bg-red-500 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">${i + 1}</span>
                                  <div>
                                      <p class="font-medium text-sm text-gray-900">${action.action}</p>
                                      <p class="text-xs text-gray-600">${action.why}</p>
                                  </div>
                              </div>`).join('')}
                          </div>
                      </div>
                      <div>
                          <h4 class="font-bold text-gray-800 mb-3">Strategic Moves</h4>
                          <div class="space-y-3">${strategic_moves.map((move, i) => `
                              <div class="flex gap-3 items-start">
                                  <span class="flex-shrink-0 w-6 h-6 bg-blue-500 text-white rounded-full flex items-center justify-center text-xs font-bold mt-1">${i + 1}</span>
                                  <div>
                                      <p class="font-medium text-sm text-gray-900">${move.action}</p>
                                      <p class="text-xs text-gray-600">${move.why}</p>
                                  </div>
                              </div>`).join('')}
                          </div>
                      </div>
                  </div>
                  ${mermaid_chart ? `
                  <div>
                      <h3 class="font-bold mb-2">GTM Flow</h3>
                      <div class="mermaid-container p-4 bg-white border rounded-lg">
                          <div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div>
                      </div>
                      <div class="flex justify-end gap-2 mt-2">
                         <button class="btn btn-secondary text-xs py-1 px-2" id="download-png-btn">Download PNG</button>
                      </div>
                  </div>` : ''}
              </div>
          </div>
      `;
  }

  setupInteractiveElements() {
      this.setupCopyButtons();
	  this.setupCopyPlaybookButton();
  }

  setupCopyButtons() {
      const copyButtons = this.elements.resultsContainer.querySelectorAll('.copy-btn');
      copyButtons.forEach(btn => {
          btn.addEventListener('click', (e) => {
              const target = e.currentTarget.parentElement.querySelector('.copy-target');
              if (target) {
                  navigator.clipboard.writeText(target.innerText).then(() => {
                      const originalContent = e.currentTarget.innerHTML;
                      e.currentTarget.classList.add('copied');
                      e.currentTarget.innerHTML = `
                          <svg class="checkmark" viewBox="0 0 24 24">
                              <path d="M9 12l2 2 4-4"></path>
                          </svg>
                          <span>Copied!</span>
                      `;
                      
                      const parent = e.currentTarget.parentElement;
                      parent.classList.add('copy-flash');
                      
                      setTimeout(() => {
                          e.currentTarget.classList.remove('copied');
                          e.currentTarget.innerHTML = originalContent;
                          parent.classList.remove('copy-flash');
                      }, 2000);
                  }).catch(err => {
                      console.error('Failed to copy text: ', err);
                  });
              }
          });
      });
  }

  setupMermaidDownloadButton() {
      const downloadPngBtn = document.getElementById('download-png-btn');

      if (downloadPngBtn) {
          downloadPngBtn.addEventListener('click', () => this.downloadMermaidAsPNG());
      }
  }

  downloadMermaidAsPNG() {
      const mermaidContainer = document.querySelector('.mermaid-container');
      if (!mermaidContainer || typeof html2canvas === 'undefined') {
          console.error("Mermaid container or html2canvas library not found.");
          return;
      }
      html2canvas(mermaidContainer, { backgroundColor: '#ffffff' }).then(canvas => {
          const a = document.createElement("a");
          a.href = canvas.toDataURL("image/png");
          a.download = "askarti-diagram.png";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
      });
  }

  async renderMermaidChart() {
      try {
          await mermaid.run({
              nodes: document.querySelectorAll('.mermaid'),
          });
      } catch (error) {
          console.error('Mermaid rendering error:', error);
          const container = document.querySelector('.mermaid-container');
          if (container) container.innerHTML = '<p class="text-red-500 text-sm">Could not render visual plan.</p>';
      }
  }

  showModal() { 
      this.elements.aboutModal.classList.remove('hidden'); 
  }
  
  hideModal() { 
      this.elements.aboutModal.classList.add('hidden'); 
  }
}

// Initialize the app when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
  const app = new AskArti();
});
</script>
</body>
</html>