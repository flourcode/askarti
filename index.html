<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    <!-- Primary Meta Tags -->
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    <meta property="og:image:alt" content="AskArti Logo">
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://askarti.com/">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="twitter:image" content="https://askarti.com/images/asklite.png">
    <meta name="twitter:image:alt" content="AskArti Logo">
    <!-- Favicon files -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#523f9e">
    <!-- Chrome Android icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/images/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/images/android-chrome-512x512.png">
    <!-- Resource hints for faster loading -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Preload critical assets -->
    <link rel="preload" href="/images/asklite.png" as="image">
    <link rel="preload" href="/images/arti_right.png" as="image">
    <!-- Styles and scripts with optimized loading -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js" defer></script>
    <!-- Required for modals and visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" media="print" onload="this.media='all'">
    <noscript><link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet"></noscript>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C6BBE',
                        customPurple: {
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            500: '#7C6BBE',
                            700: '#5A4E8C',
                            900: '#403866'
                        }
                    }
                }
            }
        }
    </script>
    <style>
    body { font-family: 'Inter', sans-serif; }
    .loader {
        border: 2px solid #e5e7eb;
        border-top: 2px solid #7C6BBE;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .fade-in { animation: fadeIn 0.5s ease-in-out; }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .quick-prompt:hover {
        background-color: rgba(124, 107, 190, 0.1);
        transform: scale(1.02);
    }
    .sponsor-ad {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.05) 0%, rgba(124, 107, 190, 0.02) 100%);
        border: 1px solid rgba(124, 107, 190, 0.1);
        transition: all 0.3s ease;
    }
    .sponsor-ad:hover {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.08) 0%, rgba(124, 107, 190, 0.04) 100%);
        border-color: rgba(124, 107, 190, 0.2);
        transform: translateY(-1px);
    }
    .dashboard-card {
         background-color: white;
         border-radius: 0.75rem;
         border: 1px solid #e5e7eb;
         padding: 1.5rem;
         box-shadow: 0 1px 2px 0 rgb(0 0 0 / 0.05);
    }
    .mermaid-container { text-align: center; }
    .mermaid { display: inline-block; max-width: 100%;}
    .hint-text {
        opacity: 0.8;
        transition: opacity 0.2s ease;
    }
    #situation-input:focus ~ .hint-text {
        opacity: 1;
    }
    /* Modal animation styles */
    .modal-backdrop {
        transition: opacity 0.2s ease-out;
    }
    .modal-backdrop.show {
        opacity: 1;
    }
    .modal-content {
        transform: scale(0.95);
        opacity: 0;
        transition: all 0.2s ease-out;
    }
    .modal-content.show {
        transform: scale(1);
        opacity: 1;
    }
	#char-count {
    display: none !important;
}
    /* Widget tab styles */
    .widget-tab {
        position: relative;
        transition: all 0.2s ease;
    }
    .widget-tab.active {
        color: #7C6BBE;
        border-bottom-color: #7C6BBE;
    }
    .qual-option-label input:checked + span {
        background-color: #7C6BBE;
        color: white;
    }
</style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-20">
        <header class="text-center mb-4">
            <a href="/" aria-label="AskArti Home" class="inline-block">
                <img src="/images/asklite.png" alt="AskArti" class="h-16 w-auto md:h-20 lg:h-24">
            </a>
        </header>
        <main class="dashboard-card mb-3">
    <div class="mb-4">
    <label for="situation-input" class="block text-lg font-semibold text-gray-900 mb-2 text-center">
        Hi, I'm Arti, your 24/7 Sales Buddy. What's blocking your deal?
    </label>
    <textarea 
        id="situation-input" 
        rows="3" 
        class="w-full p-4 text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary resize-none placeholder-gray-500"
        placeholder="Champion ghosted me after seeing pricing. $2M deal at DHS. Q4 commit."
        maxlength="500"></textarea>
    <div class="text-xs text-gray-500 mt-1 flex justify-between items-center">
        <span class="hint-text">The more details you give Arti, like agency, $ amount, or who's involved, the better the advice. Don't like an answer? Just press Ask Arti again like a Vegas slot machine.</span>
        <span id="char-count" class="opacity-0 transition-opacity duration-200">0/500</span>
    </div>
</div>
    <div class="flex flex-wrap gap-2 justify-center mb-4">
        <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium"
                data-text="Buyer at VA ghosted me after pricing. $1.5M cloud deal. CISO loves our competitor.">
            Buyer Went Dark
        </button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium"
                data-text="Demo crashed at DOJ yesterday. CTO walked out. How do I recover?">
            Demo Crashed
        </button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium"
                data-text="Partner reps and Account reps fighting over deals, pipeline, and revenue. It's hurting sales.">
            Partner Drama
        </button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium"
                data-text="Meeting DHS CIO next week and don't have a Champion. How do I have a meeting that results in a sale?">
            Meeting Prep
        </button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium"
                data-text="AWS federal sales interview next week. Help me with the Leadership Principles. Help me prep.">
            Interview Prep
        </button>
        <button class="quick-prompt px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium"
                data-text="Prospect for janitorial services at the VA.">
            Prospecting
        </button>
    </div>
    <div class="text-center">
        <button id="ask-btn" class="bg-customPurple-500 hover:bg-customPurple-700 text-white font-semibold py-3 px-8 rounded-full transition-all inline-flex items-center gap-2 shadow-lg hover:shadow-xl">
            <span id="btn-text">Ask Arti</span>
            <div id="loader" class="loader hidden"></div>
        </button>
    </div>
</main>
<!-- Loading Message Area -->
<div id="loading-message-container" class="text-center py-4 hidden">
    <p id="loading-message" class="text-gray-600"></p>
</div>
<!-- Error Message Area -->
<div id="error-message" class="bg-red-50 border border-red-200 rounded-lg p-6 text-center mb-4 hidden">
    <p class="text-red-700 font-medium mb-2">Something went wrong</p>
    <p class="text-red-600 text-sm" id="error-details">We're having trouble connecting to Arti. Please try again in a moment.</p>
    <button id="retry-btn" class="mt-3 bg-red-100 hover:bg-red-200 text-red-700 font-medium py-2 px-4 rounded-lg text-sm">
        Try Again
    </button>
</div>
<!-- Results Area -->
<div id="results-container"></div>
<!-- Footer -->
<footer class="text-center mt-12 space-y-4">
    <div class="flex justify-center gap-6 text-sm">
        <button id="about-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">About</button>
        <button id="share-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Share</button>
        <a href="mailto:mark@subhoo.com" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Contact</a>
    </div>
<div class="sponsor-ad rounded-lg p-3 mb-4 text-sm bg-white border border-gray-200 not-italic text-left leading-normal text-gray-700">
    <div class="flex items-center gap-2 mb-2">
        <span class="text-xs font-medium text-gray-600 bg-gray-100 px-2 py-1 rounded-full">SPONSOR</span>
        <span class="text-gray-800 font-semibold">Hey there! Enjoyin' these results?</span>
    </div>
    <p class="text-sm leading-relaxed text-gray-700">
        By the time I pay off all my scientists, all the lab coats, and my Lambda billâ€¦I'm losin' money every time you press that Ask Arti button.
    </p>
    <p class="mt-2 text-xs italic text-gray-500">
        Don't let my loss be your loss. Sponsor this ad for the low low price of $99/mo.
    </p>
<p class="mt-2 text-xs text-customPurple-600 font-medium">
        <a href="mailto:mark@subhoo.com" class="hover:underline">Contact me to reserve this premium spot â†’</a>
    </p>
</div>
    <!-- Disclaimer -->
    <p class="text-xs text-gray-400">
        AskArti.com results are provided for informational and educational purposes only and do not constitute professional business advice. AI can make errors or provide recommendations that may not suit your specific situation. Please consult qualified professionals before making important business decisions.
    </p>
    <br>
    <p class="text-xs text-gray-400">Â© 2025 AskArti. Made for Sellers by Sellers.</p>
    <!-- AWS Logo -->
    <div class="mt-4 flex justify-center">
        <a href="https://aws.amazon.com/what-is-cloud-computing" target="_blank" rel="noopener noreferrer">
            <img src="https://d0.awsstatic.com/logos/powered-by-aws.png" alt="Powered by AWS Cloud Computing" style="width: 80px; height: auto;">
        </a>
    </div>
</footer>
    </div>
    <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
    <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
        <div class="flex justify-between items-start mb-4">
            <div class="flex items-center gap-3">
                <img src="images/oldmark.jpg" alt="Mark Flournoy" class="w-12 h-12 rounded-full object-cover border-2 border-customPurple-200">
                <h2 class="text-xl font-bold text-gray-900">Hi, I'm Mark</h2>
            </div>
            <button id="close-about" class="text-gray-400 hover:text-gray-600">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
        <div class="space-y-4 text-gray-700">
            <p>I've spent over 30 years working with the federal government as a mission owner, COTR, and seller.</p>
<p>I built AskArti to help federal salespeople use AI in a practical way to better support their customers. Arti's not perfect, so use your judgment, but he's available 24/7 whenever you need ideas.</p>
            <div class="mt-6 pt-4 border-t border-gray-200">
                <div class="bg-gray-50 rounded-lg p-4 text-sm">
                    <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-customPurple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Privacy & Technology
                    </h3>
                    <p class="text-gray-600 mb-2">AskArti uses models that may include Gemini, Claude, and ChatGPT. These models may use API inputs to improve responses.</p>
                    <p class="text-gray-600">We do not store, log, or persist any prompt or response data. All processing occurs in-memory using AWS Lambda and is discarded after execution.</p>
                </div>
            </div>
            <div class="pt-4">
                <a href="https://calendly.com/markflournoy/30min" target="_blank" class="block w-full bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors">
                    Let's chat about AI or Fed Sales â†’
                </a>
            </div>
        </div>
    </div>
</div>
<script>
    // Configuration
    const CONFIG = {
        API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
        REQUEST_TIMEOUT: 25000, // 25 seconds timeout
        MAX_RETRIES: 2,
        RETRY_DELAY: 2000, // 2 seconds between retries
        MAX_INPUT_LENGTH: 500,
        DEFAULT_LOADING_MESSAGES: [
            "Hang on. I'm...Working Backwards", 
            "...Diving Deep", 
            "...Unpacking This", 
            "...Putting a Pin in it", 
            "...Circling Back", 
            "...Thinking Big"
        ],
        ERROR_FALLBACK_MESSAGE: "We're having trouble with Arti right now. Please try again in a moment."
    };
    // DOM Elements
    const elements = {
        situationInput: document.getElementById('situation-input'),
        charCount: document.getElementById('char-count'),
        askBtn: document.getElementById('ask-btn'),
        btnText: document.getElementById('btn-text'),
        loader: document.getElementById('loader'),
        loadingMessageContainer: document.getElementById('loading-message-container'),
        loadingMessage: document.getElementById('loading-message'),
        errorMessage: document.getElementById('error-message'),
        errorDetails: document.getElementById('error-details'),
        retryBtn: document.getElementById('retry-btn'),
        resultsContainer: document.getElementById('results-container'),
        aboutBtn: document.getElementById('about-btn'),
        aboutModal: document.getElementById('about-modal'),
        closeAbout: document.getElementById('close-about'),
        shareBtn: document.getElementById('share-btn'),
        quickPromptBtns: document.querySelectorAll('.quick-prompt')
    };
    // Global state
	let state = {
    currentRequest: null,
    loadingInterval: null,
    loadingStage: 0,
    retryCount: 0,
    lastQuery: '',
    abortController: null,
    pendingRequest: false,
    lastCallTime: 0,  // Add this line
    mermaidInitialized: false
};

    // Initialize Mermaid with safe default config and comprehensive error handling
    function initializeMermaid() {
        try {
            mermaid.initialize({ 
                startOnLoad: false,
                securityLevel: 'strict',
                theme: 'neutral',
                logLevel: 'fatal',
                fontFamily: 'Inter',
                flowchart: {
                    htmlLabels: true,
                    curve: 'linear',
                    padding: 15
                },
                errorFn: (errorMsg, id) => {
                    console.error(`Mermaid error in diagram ${id}: ${errorMsg}`);
                    const element = document.getElementById(id);
                    if (element) {
                        element.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Game plan visualization couldn\'t be displayed</div>';
                    }
                }
            });
            console.log("Mermaid initialized successfully");
            state.mermaidInitialized = true;
            return true;
        } catch (e) {
            console.error('Failed to initialize mermaid:', e);
            state.mermaidInitialized = false;
            return false;
        }
    }

    // Initialize Mermaid on page load
    initializeMermaid();

    // Enhanced function to render mermaid with better error handling and retries
    async function renderMermaidChart(retryCount = 0) {
        const MAX_RETRIES = 3;
        const RETRY_DELAY = 300; // ms
        
        if (retryCount > MAX_RETRIES) {
            console.error("Max retries exceeded for Mermaid rendering");
            const diagramElement = document.getElementById('mermaid-diagram');
            if (diagramElement) {
                diagramElement.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Game plan visualization couldn\'t be displayed after multiple attempts</div>';
            }
            return false;
        }
        
        try {
            // Check if the element exists
            const diagramElement = document.getElementById('mermaid-diagram');
            if (!diagramElement) {
                console.log(`Mermaid diagram element not found, retry ${retryCount}`);
                // Wait and retry if element isn't ready yet
                setTimeout(() => renderMermaidChart(retryCount + 1), RETRY_DELAY);
                return false;
            }
            
            // Get the chart definition and sanitize it
            let definition = diagramElement.textContent || '';
            
            // Basic validation of the Mermaid syntax
            if (!definition || !definition.trim() || !definition.includes('graph')) {
                console.error("Invalid or empty Mermaid definition");
                diagramElement.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Invalid game plan structure</div>';
                return false;
            }
            
            // Ensure no leading/trailing spaces that might cause parsing issues
            definition = definition.trim();
            
            // Advanced syntax error catching - look for common issues
            const commonErrors = [
                { pattern: /-->-->/g, fix: '-->' },
                { pattern: /-->(\w)/g, fix: '--> $1' },
                { pattern: /(\w)-->/g, fix: '$1 -->' },
                { pattern: /\s{2,}/g, fix: ' ' },
                { pattern: /\n\n+/g, fix: '\n' }
            ];
            
            commonErrors.forEach(({pattern, fix}) => {
                definition = definition.replace(pattern, fix);
            });
            
            // Try rendering with a timeout to avoid freezing the UI
            console.log(`Attempting to render Mermaid chart (attempt ${retryCount + 1})`);
            
            // Set diagram content to the sanitized version
            diagramElement.textContent = definition;
            
            // Reinitialize Mermaid if needed (helps with repeated renders)
            if (retryCount > 0 || !state.mermaidInitialized) {
                initializeMermaid();
            }
            
            // Attempt to run with promise timeout
            const renderPromise = new Promise((resolve, reject) => {
                try {
                    // Clear any previous mermaid renders in this element
                    diagramElement.removeAttribute('data-processed');
                    
                    // Small delay before rendering to ensure DOM is ready
                    setTimeout(async () => {
                        try {
                            await mermaid.run();
                            resolve(true);
                        } catch (e) {
                            reject(e);
                        }
                    }, 50);
                } catch (e) {
                    reject(e);
                }
            });
            
            // Add timeout to the render promise
            const timeoutPromise = new Promise((_, reject) => {
                setTimeout(() => reject(new Error("Mermaid render timeout")), 3000);
            });
            
            // Race the render against the timeout
            await Promise.race([renderPromise, timeoutPromise]);
            console.log("Mermaid chart rendered successfully");
            return true;
        } catch (e) {
            console.error("Mermaid rendering error:", e);
            
            if (retryCount < MAX_RETRIES) {
                console.log(`Retrying Mermaid render, attempt ${retryCount + 1}`);
                // Wait and retry
                setTimeout(() => renderMermaidChart(retryCount + 1), RETRY_DELAY);
                return false;
            } else {
                const diagramElement = document.getElementById('mermaid-diagram');
                if (diagramElement) {
                    diagramElement.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Game plan visualization couldn\'t be displayed</div>';
                }
                return false;
            }
        }
    }

    // Input validation and character count
    function setupInputValidation() {
elements.situationInput.addEventListener('input', function() {
    const maxLength = CONFIG.MAX_INPUT_LENGTH;
    const currentLength = this.value.length;
    // Update character count
    elements.charCount.textContent = `${currentLength}/${maxLength}`;
    // Show character count when typing begins
    if (currentLength > 0) {
        elements.charCount.classList.remove('opacity-0');
        elements.charCount.classList.add('opacity-100');
    } else {
        elements.charCount.classList.remove('opacity-100');
        elements.charCount.classList.add('opacity-0');
    }
    // Visual feedback when approaching limit
    if (currentLength >= maxLength * 0.9) {
        elements.charCount.classList.add('text-orange-500');
    } else {
        elements.charCount.classList.remove('text-orange-500');
    }
    // Enforce max length (backup for maxlength attribute)
    if (currentLength > maxLength) {
        this.value = this.value.substring(0, maxLength);
        elements.charCount.textContent = `${maxLength}/${maxLength}`;
        elements.charCount.classList.add('text-red-500');
    } else {
        elements.charCount.classList.remove('text-red-500');
    }
});
    }
    // Show/hide loading state
    function setLoading(loading) {
        elements.btnText.style.display = loading ? 'none' : 'inline';
        elements.loader.style.display = loading ? 'block' : 'none';
        elements.askBtn.disabled = loading;
        elements.errorMessage.classList.add('hidden');
        if (loading) {
            elements.loadingMessageContainer.classList.remove('hidden');
            if (elements.loadingMessage) {
                elements.loadingMessage.textContent = CONFIG.DEFAULT_LOADING_MESSAGES[0];
                elements.loadingMessage.classList.remove('text-red-700', 'font-medium');
            }
            // Clear any existing interval
            clearInterval(state.loadingInterval);
            // Start new loading message rotation
            state.loadingStage = 0;
            state.loadingInterval = setInterval(() => {
                state.loadingStage = (state.loadingStage + 1) % CONFIG.DEFAULT_LOADING_MESSAGES.length;
                if (elements.loadingMessage) {
                    elements.loadingMessage.textContent = CONFIG.DEFAULT_LOADING_MESSAGES[state.loadingStage];
                }
            }, 2000);
        } else {
            clearInterval(state.loadingInterval);
        }
    }
    // Show error message
    function showError(message, isRetryable = true) {
        elements.loadingMessageContainer.classList.add('hidden');
        elements.errorMessage.classList.remove('hidden');
        elements.errorDetails.textContent = message || CONFIG.ERROR_FALLBACK_MESSAGE;
        elements.retryBtn.style.display = isRetryable ? 'inline-block' : 'none';
        setLoading(false);
    }
    // Make the API request with timeout and retry logic
    async function makeRequest(situation, retryCount = 0) {
        if (state.pendingRequest) {
            return; // Prevent duplicate requests
        }
        state.pendingRequest = true;
        state.lastQuery = situation;
        state.abortController = new AbortController();
        try {
            // Set up timeout
            const timeoutId = setTimeout(() => {
                state.abortController.abort();
            }, CONFIG.REQUEST_TIMEOUT);
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ situation }),
                signal: state.abortController.signal
            });
            clearTimeout(timeoutId);
            if (!response.ok) {
                throw new Error(`API returned status: ${response.status}`);
            }
            const data = await response.json();
            state.pendingRequest = false;
            return data;
        } catch (error) {
            state.pendingRequest = false;
            console.error('Request error:', error);
            // Handle timeout or network errors
            if (error.name === 'AbortError') {
                throw new Error('Request timed out. The server might be busy.');
            }
            // Retry logic
            if (retryCount < CONFIG.MAX_RETRIES) {
                await new Promise(resolve => setTimeout(resolve, CONFIG.RETRY_DELAY));
                return makeRequest(situation, retryCount + 1);
            }
            throw error;
        }
    }
    // Generate fallback advice when API fails
    function generateFallbackAdvice(situation) {
        // Simplified context detection
        const context = {
            agency: situation.match(/dhs|va|dod|army|navy|usaf|air force|marines|uscis/i)?.[0]?.toUpperCase() || 'Unknown Agency',
            amount: situation.match(/\$(\d+)([kmb])?/i) ? 'Specified' : 'Unknown',
            blocker: 'Unknown Issue'
        };
        // Determine response type based on keywords
        let responseType = 'deal';
        if (situation.match(/interview|job|hiring|resume|star/i)) responseType = 'interview';
        if (situation.match(/prospect|lead|naics|sell into/i)) responseType = 'prospect';
        if (situation.match(/meeting|presentation|qbr|brief/i)) responseType = 'meeting';
        // Basic fallback responses by type
        const fallbacks = {
            deal: {
                response_type: 'deal',
                quick_take: "Let's get your deal unstuck. I'm working with limited connectivity right now, but here are proven tactics for federal deals.",
                key_moves: [
                    { action: "Test your champion with a specific request", why: "If they won't make introductions or share information, they're not a real champion" },
                    { action: "Create urgency with fiscal year timeline", why: "Federal money has a shelf life - remind them when funds expire" },
                    { action: "Find multiple paths to power", why: "Never single-thread a federal deal" }
                ],
                mermaid_chart: "graph TD\n    A[Test Champion] --> B{Real Champion?}\n    B -->|Yes| C[Leverage Relationship]\n    B -->|No| D[Find New Champion]\n    C --> E[Close Deal]\n    D --> A",
                next_steps: "Federal deals move at their own pace. Stay professional, be persistent, and keep multiple options open."
            },
            meeting: {
                response_type: 'meeting',
                quick_take: "Federal meetings require thorough preparation. Here's what works based on decades of government experience.",
                key_moves: [
                    { action: "Research every attendee's role and tenure", why: "Know who has power vs. who has influence" },
                    { action: "Prepare 3 mission-focused success stories", why: "They care about outcomes, not features" },
                    { action: "Plan your specific asks and next steps", why: "Never leave without clear commitments" }
                ],
                talking_points: [
                    "What would make this meeting a success from your perspective?",
                    "Who else should be involved in these discussions?",
                    "How does this align with your mission priorities this fiscal year?"
                ],
                next_steps: "Make their job easier and you'll win their business."
            },
            prospect: {
                response_type: 'prospect',
                summary: "Here's a starting point for your federal prospecting strategy. When connectivity improves, ask again for more detailed intelligence.",
                top_s_is: [
                    {company: "Booz Allen Hamilton", value: "$1B+"},
                    {company: "GDIT", value: "$800M+"},
                    {company: "Leidos", value: "$750M+"}
                ],
                top_software_and_cloud: [
                    {company: "Microsoft", value: "$600M+"},
                    {company: "Amazon Web Services", value: "$500M+"},
                    {company: "Oracle", value: "$400M+"}
                ],
                company_capabilities: [
                    "Custom application development",
                    "Data management and analytics",
                    "Cloud migration services"
                ],
                naics_codes: [
                    "541512 - Computer Systems Design Services",
                    "541511 - Custom Computer Programming Services",
                    "518210 - Data Processing, Hosting, and Related Services"
                ],
                prospect_recommendations: [
                    "Research GWACs and IDIQs that your target agency uses most frequently",
                    "Identify key incumbent contractors at your target agency",
                    "Connect with Small Business Liaison Officers at large primes for partnership opportunities"
                ],
                market_insights: "Federal fiscal year-end (July-September) represents 30-40% of annual contract awards. Time your outreach accordingly."
            },
            interview: {
                response_type: 'interview',
                quick_take: "Federal sales interviews test your ability to navigate complexity. Here's how to showcase your expertise.",
                key_moves: [
                    { action: "Quantify your achievements with dollar amounts and timeframes", why: "Shows you understand federal scale and timing" },
                    { action: "Prepare STAR stories about navigating procurement challenges", why: "Demonstrates you can handle the unique federal sales cycle" },
                    { action: "Research their current federal contracts and clients", why: "Shows you did your homework and understand their business" }
                ],
                talking_points: [
                    "What does success look like for this role in the first 90 days?",
                    "How does your team collaborate with partners and federal contracting officers?",
                    "What are the most common roadblocks your federal customers face in the procurement process?"
                ],
                next_steps: "Your federal experience is a differentiator. Own it, quantify it, and explain how it transfers to this role."
            }
        };
        return fallbacks[responseType] || fallbacks.deal;
    }
async function getAdvice() {
    // Declare a local variable instead of modifying the parameter
    let situationText = elements.situationInput.value.trim();
    // Add client-side rate limiting
    const now = Date.now();
    const MIN_CALL_INTERVAL = 2000; // 2 seconds minimum between calls
    if (now - state.lastCallTime < MIN_CALL_INTERVAL) {
        elements.loadingMessageContainer.classList.remove('hidden');
        elements.loadingMessage.textContent = "Please wait a moment before asking again"; 
        elements.loadingMessage.classList.add('text-orange-700', 'font-medium');
        setTimeout(() => {
            elements.loadingMessageContainer.classList.add('hidden');
        }, 2000);
        return;
    }
    state.lastCallTime = now;
    // Validate input
    if (!situationText) {
        elements.loadingMessageContainer.classList.remove('hidden');
        elements.loadingMessage.textContent = "Drop your situation in the box above ðŸ‘†"; 
        elements.loadingMessage.classList.add('text-red-700', 'font-medium');
        return;
    }
    // Clear previous results and show loading state
    setLoading(true);
    elements.resultsContainer.innerHTML = '';
    state.retryCount = 0;
    try {
        // Make API request
        const data = await makeRequest(situationText);
        // Hide loading message
        elements.loadingMessageContainer.classList.add('hidden');
        // Display results
        displayAdvice(data);
    } catch (error) {
        console.error('Error:', error);
        // Try fallback if API fails completely
        try {
            const fallbackData = generateFallbackAdvice(situationText);
            elements.loadingMessageContainer.classList.add('hidden');
            displayAdvice(fallbackData);
            // Show a subtle notice that we're using fallback data
            const fallbackNotice = document.createElement('div');
            fallbackNotice.className = 'text-center text-sm text-orange-600 mt-2 mb-4';
            fallbackNotice.textContent = "Using backup advice while our servers catch up. Refresh for full insights.";
            elements.resultsContainer.insertAdjacentElement('afterbegin', fallbackNotice);
        } catch (fallbackError) {
            // If even fallback fails, show a generic error
            showError("We're having trouble generating advice right now. Please try again in a moment.");
        }
    } finally {
        setLoading(false);
    }
}
async function displayAdvice(data) {
    const { response_type } = data;
    // Extract seller_type early (new code)
    const sellerType = data.seller_type || '';
    let html = '';
    try {
        if (response_type === 'prospect') {
            // Prospect response rendering with fallbacks for each section
            const { 
                summary = "Strategic insight for your federal prospecting efforts.",
                top_s_is = [],
                top_software_and_cloud = [],
                company_capabilities = [],
                naics_codes = [],
                prospect_recommendations = [],
                market_insights = "Focus on relationship building and understanding agency mission needs."
            } = data;
            const renderRankedList = (items) => {
    if (!items || items.length === 0) return '<p class="text-sm text-gray-500">No specific companies found.</p>';
    return `<ul class="space-y-1">${items.map((item, index) => `
        <li class="flex items-center gap-3 py-2 border-t border-gray-100 first:border-t-0 first:pt-0">
            <span class="text-xs font-bold text-customPurple-700 bg-customPurple-100 w-6 h-6 flex items-center justify-center rounded-full flex-shrink-0">${index + 1}</span>
            <span class="flex-1 font-medium text-gray-800">${item.company || 'Company'}</span>
            <span class="text-sm font-semibold text-gray-600">${item.value || 'N/A'}</span>
        </li>
    `).join('')}</ul>`;
};
            html = `
            <div class="fade-in space-y-6">
    <div class="bg-gradient-to-r from-customPurple-100 to-customPurple-200 rounded-xl p-6">
        <h3 class="text-xl font-bold text-customPurple-900 mb-2">Intelligence Briefing</h3>
        <div class="text-customPurple-900/80">${marked.parse(summary || '')}</div>
    </div>

    <!-- Two columns grid layout for both top and bottom sections -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Top Contractors -->
        <div class="dashboard-card">
            <h3 class="font-bold text-gray-900 mb-3">Top Contractors</h3>
            ${renderRankedList(top_s_is)}
        </div>
        
        <!-- Potential Software Plays -->
        <div class="dashboard-card">
            <h3 class="font-bold text-gray-900 mb-3">Potential Software Plays</h3>
            ${renderRankedList(top_software_and_cloud)}
        </div>
        
        <!-- Mission Needs -->
        <div class="dashboard-card">
            <h3 class="font-bold text-gray-900 mb-3">Mission Needs</h3>
            <ul class="space-y-2 text-sm">${(company_capabilities || []).map(c => `<li class="flex gap-2"><svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>${c}</li>`).join('')}</ul>
        </div>
        
        <!-- Relevant NAICS Codes -->
        <div class="dashboard-card">
            <h3 class="font-bold text-gray-900 mb-3">Relevant NAICS Codes</h3>
            <ul class="space-y-2 text-sm">${(naics_codes || []).map(n => `<li class="flex gap-2"><svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>${n}</li>`).join('')}</ul>
        </div>
    </div>

    <!-- Full width cards for recommendations and insights -->
    <div class="dashboard-card">
        <h3 class="font-bold text-gray-900 mb-3">Strategic Recommendations</h3>
        <ul class="space-y-2 text-sm">${(prospect_recommendations || []).map(r => `<li class="flex gap-3"><span class="text-customPurple-500 font-bold text-lg flex-shrink-0 -mt-1">â†’</span><span>${r}</span></li>`).join('')}</ul>
    </div>
    <div class="dashboard-card">
        <h3 class="font-bold text-gray-900 mb-2">Key Market Insight</h3>
        <p class="text-gray-700">${market_insights || 'N/A'}</p>
    </div>
</div>`;
        } else {
            // Deal, meeting, or interview response with fallbacks for each field
            const { 
                quick_take = "Here are tactical steps to move your federal sales situation forward.",
                key_moves = [],
                mermaid_chart = '',
                talking_points = [],
                email_template = '',
                next_steps = ''
            } = data;
            // Ensure key_moves has valid structure
            const safeKeyMoves = Array.isArray(key_moves) && key_moves.length > 0 ? 
                key_moves : [
                    { action: "Clarify the true decision criteria", why: "Federal decisions rarely match the stated requirements" },
                    { action: "Map the full stakeholder landscape", why: "Identify all influencers, not just the formal decision makers" },
                    { action: "Document your federal past performance", why: "Proof of government success is your strongest selling point" }
                ];
            html = `
            <div class="fade-in space-y-6">
                <div class="bg-gradient-to-r from-customPurple-100 to-customPurple-200 rounded-xl p-6 flow-root">
                    <img src="/images/arti_right.png" alt="Arti" class="h-12 w-12 float-left mr-4 mb-2">
                    <div class="text-customPurple-900/80 space-y-2">${marked.parse(quick_take || '')}</div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="dashboard-card">
                        <h3 class="font-bold text-gray-900 mb-4">Your Next 3 Moves</h3>
                        <div class="space-y-3">${safeKeyMoves.slice(0, 3).map((m, i) => `<div class="flex gap-3"><span class="flex-shrink-0 w-7 h-7 bg-customPurple-200 text-customPurple-700 rounded-full flex items-center justify-center text-sm font-bold">${i + 1}</span><div class="flex-1"><p class="font-medium text-gray-900">${m.action || 'Take strategic action'}</p><p class="text-sm text-gray-600 mt-1">${m.why || 'To improve your position'}</p></div></div>`).join('')}</div>
                    </div>
                    <div class="dashboard-card">
                        <h3 class="font-bold text-gray-900 mb-4">Game Plan</h3>
                        ${mermaid_chart ? 
                            `<div class="mermaid-container"><div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div></div>` : 
                            `<div class="p-4 bg-gray-50 rounded-lg text-center">
                                <p class="text-gray-600">A visual game plan is not available for this scenario.</p>
                            </div>`
                        }
                    </div>
                </div>
                ${(talking_points && talking_points.length > 0) || email_template ? `
                <div class="dashboard-card">
                    <h3 class="font-bold text-gray-900 mb-4">Communications</h3>
                    <div class="grid grid-cols-1 ${email_template && talking_points && talking_points.length > 0 ? 'md:grid-cols-2' : ''} gap-6">
                        ${talking_points && talking_points.length > 0 ? `<div><h4 class="font-semibold text-gray-800 mb-3">${response_type === 'interview' ? 'What They May Ask' : 'What to Ask'}</h4><ul class="space-y-2 text-sm">${talking_points.map(t => `<li class="flex gap-2"><svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>${t}</li>`).join('')}</ul></div>` : ''}
                        ${email_template ? `<div><h4 class="font-semibold text-gray-800 mb-3">Email Template</h4><div class="bg-gray-50 rounded-lg p-4 font-mono text-sm text-gray-700 whitespace-pre-wrap border">${email_template}</div></div>` : ''}
                    </div>
                </div>
                ` : ''}
                ${next_steps ? `<div class="bg-customPurple-200/60 p-4 rounded-lg text-sm text-customPurple-900"><b class="font-semibold">Remember:</b> ${next_steps}</div>` : ''}
            </div>`;
        }
        // Add action buttons
        html += `
            <div class="mt-8 flex flex-col sm:flex-row gap-3">
                <button onclick="copyAll()" class="flex-1 bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">Copy to Clipboard</button>
                <button onclick="startOver()" class="flex-1 bg-white hover:bg-gray-50 text-gray-700 font-medium py-3 px-6 rounded-lg border border-gray-200 transition-colors">Ask Another Question</button>
            </div>`;
        elements.resultsContainer.innerHTML = html;
        elements.resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        // Add seller type badge after DOM update (new code)
        if (sellerType && !(situationText.toLowerCase().includes('leadership principle') || 
                    situationText.toLowerCase().includes('leadership principles') || 
                    (situationText.toLowerCase().includes('aws') && situationText.toLowerCase().includes('lp')))) {
    setTimeout(() => {
        try {
            const sellerTypeBadge = document.createElement('div');
            sellerTypeBadge.className = 'text-xs font-medium text-gray-500 mb-2';
            sellerTypeBadge.textContent = `Advice tailored for ${sellerType.replace(/_/g, ' ')} context`;
            const firstResultElement = elements.resultsContainer.querySelector('.fade-in');
            if (firstResultElement && firstResultElement.firstChild) {
                firstResultElement.insertBefore(sellerTypeBadge, firstResultElement.firstChild.nextSibling);
            }
        } catch (badgeError) {
            console.log('Non-critical error adding context badge:', badgeError);
        }
    }, 100);
}
        // Try to render mermaid chart if present
        if (response_type !== 'prospect' && data.mermaid_chart) {
            try {
                // Allow a small delay for the DOM to fully render
                setTimeout(() => {
                    renderMermaidChart(0);
                }, 100);
            } catch (e) {
                console.error("Mermaid chart rendering error:", e);
                // Replace with error message
                const diagramElement = document.getElementById('mermaid-diagram');
                if (diagramElement) {
                    diagramElement.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Game plan visualization couldn\'t be displayed</div>';
                }
            }
        }
    } catch (error) {
        // Handle general display errors
        console.error('Display error:', error);
        elements.resultsContainer.innerHTML = `
            <div class="bg-white border border-gray-200 rounded-lg p-6 text-center">
                <h3 class="font-bold text-gray-900 mb-3">Federal Sales Advice</h3>
                <p class="text-gray-700 mb-4">We've got insights for you, but had trouble formatting them. Here's the core advice:</p>
                <div class="p-4 bg-gray-50 rounded-lg text-left mb-4">
                    <p class="font-medium">${data.quick_take || 'Focus on understanding the true needs behind the stated requirements.'}</p>
                </div>
                <button onclick="startOver()" class="bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">Ask Another Question</button>
            </div>
        `;
    }
}
    // Copy all results to clipboard
    window.copyAll = () => {
        try {
            const contentEl = document.getElementById('results-container');
            const text = contentEl.innerText;
            if (!text || text.trim() === '') {
                alert('No content to copy');
                return;
            }
            navigator.clipboard.writeText(text)
                .then(() => {
                    // Visual feedback for successful copy
                    const copyBtn = document.querySelector('#results-container button');
                    if (copyBtn) {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'Copied!';
                        setTimeout(() => copyBtn.textContent = originalText, 2000);
                    } else {
                        alert('Results copied to clipboard!');
                    }
                })
                .catch(err => {
                    console.error('Copy failed:', err);
                    alert('Copy failed. Please try again.');
                });
        } catch (error) {
            console.error('Copy error:', error);
            alert('Could not copy the results. Please try selecting and copying manually.');
        }
    };
    // Reset for a new question
    window.startOver = () => {
        // Cancel any pending requests
        if (state.abortController) {
            state.abortController.abort();
        }
        // Clear state and UI
        elements.situationInput.value = '';
        elements.resultsContainer.innerHTML = '';
        elements.loadingMessageContainer.classList.add('hidden');
        elements.errorMessage.classList.add('hidden');
        elements.charCount.classList.add('hidden');
        if (elements.loadingMessage) {
            elements.loadingMessage.classList.remove('text-red-700', 'font-medium');
        }
        clearInterval(state.loadingInterval);
        state.pendingRequest = false;
        // Focus on input
        elements.situationInput.focus();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    // Set up event listeners
    function setupEventListeners() {
        // Quick prompt buttons
        elements.quickPromptBtns.forEach(btn => {
            btn.addEventListener('click', (e) => {
                elements.situationInput.value = e.currentTarget.dataset.text;
                elements.askBtn.click();
            });
        });
        // Share button
        elements.shareBtn.addEventListener('click', () => {
            const text = "Check out this Fed Sales Bot";
            const url = "https://askarti.com";
            try {
                if (navigator.share) {
                    navigator.share({ title: 'AskArti', text, url })
                        .catch(err => console.error('Share failed:', err));
                } else {
                    navigator.clipboard.writeText(`${text} ${url}`)
                        .then(() => {
                            elements.shareBtn.textContent = 'Link Copied!';
                            setTimeout(() => { elements.shareBtn.textContent = 'Share'; }, 2000);
                        })
                        .catch(err => console.error('Copy failed:', err));
                }
            } catch (error) {
                console.error('Share error:', error);
                alert('Could not share. Please copy the URL manually.');
            }
        });
        // About modal
        elements.aboutBtn.addEventListener('click', () => elements.aboutModal.classList.remove('hidden'));
        elements.closeAbout.addEventListener('click', () => elements.aboutModal.classList.add('hidden'));
        elements.aboutModal.addEventListener('click', (e) => {
            if (e.target === elements.aboutModal) elements.aboutModal.classList.add('hidden');
        });
        // Main action button
        elements.askBtn.addEventListener('click', getAdvice);
        // Retry button
        elements.retryBtn.addEventListener('click', () => {
            elements.errorMessage.classList.add('hidden');
            if (state.lastQuery) {
                elements.situationInput.value = state.lastQuery;
                getAdvice();
            }
        });
        // Enter key in textarea
        elements.situationInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                getAdvice();
            }
        });
        // Keyboard shortcut to escape modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                elements.aboutModal.classList.add('hidden');
            }
        });
    }
    // Initialize everything
    function init() {
        setupInputValidation();
        setupEventListeners();
        elements.situationInput.focus();
    }
    // Start the application
    init();
</script>
</body>
</html>