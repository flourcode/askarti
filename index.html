<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    <!-- Meta Tags -->
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://askarti.com/">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti.">
    <meta name="twitter:image" content="https://askarti.com/images/asklite.png">
    <!-- Favicons -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#7C6BBE">
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <!-- Preload critical assets -->
    <link rel="preload" href="/images/asklite.png" as="image">
    <link rel="preload" href="/images/arti_right.png" as="image">
    <!-- Styles and Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#7C6BBE',
                        customPurple: {
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            500: '#7C6BBE',
                            700: '#5A4E8C',
                            900: '#403866'
                        },
                        accountBlue: {
                            100: '#E6F0F9',
                            500: '#4A77B3',
                            700: '#345C96'
                        }
                    }
                }
            }
        }
    </script>
<style>
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #f9fafb;
    }
    .loader {
        border: 2px solid #e5e7eb;
        border-top: 2px solid #7C6BBE;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .quick-scenario:hover {
        background-color: rgba(124, 107, 190, 0.1);
        transform: scale(1.02);
    }
    .sponsor-ad {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.05), rgba(124, 107, 190, 0.02));
        border: 1px solid rgba(124, 107, 190, 0.1);
        transition: all 0.3s ease;
    }
    .sponsor-ad:hover {
        background: linear-gradient(135deg, rgba(124, 107, 190, 0.08), rgba(124, 107, 190, 0.04));
        border-color: rgba(124, 107, 190, 0.2);
        transform: translateY(-1px);
    }
    .dashboard-card {
        background-color: white;
        border-radius: 0.75rem;
        border: 1px solid #e5e7eb;
        padding: 1.5rem;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }
    .mermaid-container {
        text-align: center;
        min-height: 200px;
        position: relative;
    }
    .mermaid {
        display: inline-block;
        max-width: 100%;
    }
    .mermaid-loading {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
    }
    .modal-backdrop {
        transition: opacity 0.2s ease-out;
    }
    .modal-content {
        transform: scale(0.95);
        opacity: 0;
        transition: all 0.2s ease-out;
    }
    .modal-content.show {
        transform: scale(1);
        opacity: 1;
    }
    .dashboard-card ul {
        max-width: 100%;
    }
    .dashboard-card li {
        word-break: break-word;
    }
    .dashboard-card .flex {
        min-width: 0;
    }
    .chat-container {
        height: 60dvh;
        max-height: 500px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        background-color: white;
    }
    @supports not (height: 100dvh) {
        .chat-container {
            height: 60vh;
        }
    }
    .chat-container::-webkit-scrollbar {
        width: 6px;
    }
    .chat-container::-webkit-scrollbar-track {
        background: #f3f4f6;
        border-radius: 3px;
    }
    .chat-container::-webkit-scrollbar-thumb {
        background: #d1d5db;
        border-radius: 3px;
    }
    .chat-message-user {
        background-color: #7C6BBE;
        color: white;
    }
    .chat-message-arti {
        background-color: white;
        color: #1f2937;
        border: 1px solid #e5e7eb;
    }
    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 12px 16px;
    }
    .typing-dot {
        width: 8px;
        height: 8px;
        background-color: #9ca3af;
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
    }
    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }
    @keyframes typing {
        0%, 80%, 100% {
            transform: scale(0.8);
            opacity: 0.5;
        }
        40% {
            transform: scale(1);
            opacity: 1;
        }
    }
    .chat-suggestion:hover {
        background-color: rgba(124, 107, 190, 0.1);
        transform: scale(1.02);
    }
    .account-plan-card {
        background-color: white;
        border-radius: 0.75rem;
        padding: 1.25rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        border: 1px solid #e5e7eb;
        margin-bottom: 1rem;
        transition: all 0.2s ease;
    }
    .account-plan-card:hover {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        transform: translateY(-2px);
    }
    /* Mobile layout improvements */
    @media (max-width: 640px) {
        .dashboard-card {
            padding: 1rem;
        }
        .chat-container {
            height: 50dvh;
        }
        .quick-scenario {
            font-size: 0.8125rem;
            padding: 0.375rem 0.75rem;
        }
        input[type="text"],
        input[type="email"],
        textarea {
            font-size: 16px !important;
        }
        #chat-input {
            min-height: 44px;
        }
    }
    /* iOS Safari viewport fix */
    @supports (-webkit-touch-callout: none) {
        .chat-container {
            height: 50dvh;
        }
        html, body {
            height: 100%;
            overflow-x: hidden;
        }
        body {
            -webkit-overflow-scrolling: touch;
        }
    }
    @media print {
        body {
            background-color: white;
        }
        .account-plan-container {
            display: block !important;
        }
        .account-plan-card {
            box-shadow: none;
            border: 1px solid #ccc;
            break-inside: avoid;
        }
        header, footer, .dashboard-card, #chat-interface, button, .no-print {
            display: none !important;
        }
    }
</style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-20">
        <header class="text-center mb-4">
            <a href="/" aria-label="AskArti Home" class="inline-block">
                <img src="/images/asklite.png" alt="AskArti" class="h-16 w-auto md:h-20 lg:h-24">
            </a>
        </header>
        <main class="dashboard-card mb-3">
            <!-- Unified chat interface -->
            <div id="chat-interface">
                <div class="chat-container h-[60vh] sm:h-96 max-h-[400px] overflow-y-auto mb-4 bg-white rounded-lg p-3 sm:p-4">
                    <div id="chat-messages" class="space-y-3 sm:space-y-4">
                        <div class="flex justify-start">
                            <div class="bg-white rounded-lg px-3 py-2 sm:px-4 sm:py-3 max-w-[90%] sm:max-w-[80%] shadow-sm">
                                <p class="text-gray-800 text-sm sm:text-base">
                                    Hey! I'm Arti. Tell me what's going on with your deal - or tap a scenario below for a quick game plan.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Input area with clear button -->
                <div class="flex gap-2 sticky bottom-0 bg-white pt-2 z-10">
                    <button 
                        id="clear-chat-btn"
                        class="p-2.5 text-gray-400 hover:text-gray-600 hover:bg-gray-100 rounded-lg transition-all"
                        title="Clear chat">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                        </svg>
                    </button>
                    <input 
                        type="text" 
                        id="chat-input"
                        inputmode="text"
                        autocomplete="off"
                        autocorrect="on"
                        autocapitalize="sentences"
                        spellcheck="true"
                        class="flex-1 p-2.5 sm:p-3 text-[16px] sm:text-base border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary min-h-[44px]"
                        placeholder="Type your situation or tap below for quick analysis..."
                        maxlength="500">
                    <button 
                        id="chat-send-btn" 
                        class="bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium px-4 sm:px-6 py-2.5 sm:py-3 rounded-lg transition-all text-sm sm:text-base min-h-[44px] whitespace-nowrap">
                        Send
                    </button>
                </div>
                <!-- Quick scenarios - always visible -->
                <div class="mt-4">
                    <div class="flex flex-wrap gap-2 justify-center">
                        <button class="quick-scenario px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                                onclick="app.quickAnalysis('Buyer at VA ghosted me after I sent pricing. CISO loves our competitor.')">
                            Buyer Went Dark
                        </button>
                        <button class="quick-scenario px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                                onclick="app.quickAnalysis('Meeting DHS CIO next week. No champion. How to position our cybersecurity platform?')">
                            Meeting Prep
                        </button>
                        <button class="quick-scenario px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                                onclick="app.quickAnalysis('AWS federal sales interview next week. Help me prep.')">
                            Interview Prep
                        </button>
                        <button class="quick-scenario px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                                onclick="app.quickAnalysis('Partner reps and Account reps fighting over deals, pipeline, and revenue recognition.')">
                            Partner Drama
                        </button>
                        <button class="quick-scenario px-3 py-1.5 bg-accountBlue-100 hover:bg-accountBlue-100 rounded-full text-sm text-accountBlue-700 font-medium transition-all"
                                onclick="app.autoCreateAccountPlan()">
                            Create Account Plan
                        </button>
                    </div>
                </div>
            </div>
        </main>
        <!-- Loading Message -->
        <div id="loading-message-container" class="text-center py-4 hidden">
            <p id="loading-message" class="text-gray-600"></p>
        </div>
        <!-- Error Message -->
        <div id="error-message" class="bg-red-50 border border-red-200 rounded-lg p-6 text-center mb-4 hidden">
            <p class="text-red-700 font-medium mb-2">Something went wrong</p>
            <p class="text-red-600 text-sm" id="error-details">We're having trouble connecting to Arti. Please try again in a moment.</p>
            <button id="retry-btn" class="mt-3 bg-red-100 hover:bg-red-200 text-red-700 font-medium py-2 px-4 rounded-lg text-sm">
                Try Again
            </button>
        </div>
        <!-- Results -->
        <div id="results-container"></div>
        <!-- Account Plan Results -->
        <div id="account-plan-container" class="hidden mt-6 space-y-4"></div>
        <!-- Footer -->
        <footer class="text-center mt-8 sm:mt-12 space-y-3 sm:space-y-4 pb-20">
            <div class="flex justify-center gap-6 text-sm">
                <button id="about-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">About</button>
                <button id="share-btn" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Share</button>
                <a href="mailto:mark@subhoo.com" class="text-customPurple-500 hover:text-customPurple-700 font-medium">Contact</a>
            </div>
            <div class="sponsor-ad rounded-lg p-3 mb-4 text-sm bg-white border border-gray-200 not-italic text-left leading-normal text-gray-700">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs font-medium text-gray-600 bg-gray-100 px-2 py-1 rounded-full">SPONSOR</span>
                    <span class="text-gray-800 font-semibold">Hey there! Enjoyin' these results?</span>
                </div>
                <p class="text-sm leading-relaxed text-gray-700">
                    By the time I pay off all my scientists, all the lab coats, and my Lambda bill…I'm losin' money every time you press that Ask Arti button.
                </p>
                <p class="mt-2 text-xs italic text-gray-500">
                    Don't let my loss be your loss. Sponsor this ad for the low low price of $99/mo.
                </p>
                <p class="mt-2 text-xs text-customPurple-600 font-medium">
                    <a href="mailto:mark@subhoo.com" class="hover:underline">Contact me to reserve this premium spot →</a>
                </p>
            </div>
            <p class="text-xs text-gray-400">
                AskArti.com results are provided for informational and educational purposes only and do not constitute professional business advice. AI can make errors or provide recommendations that may not suit your specific situation. Please consult qualified professionals before making important business decisions.
            </p>
            <br>
            <p class="text-xs text-gray-400">© 2025 AskArti. Made for Sellers by Sellers.</p>
        </footer>
    </div>
    <!-- About Modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 modal-backdrop">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 modal-content">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <img src="images/oldmark.jpg" alt="Mark Flournoy" class="w-12 h-12 rounded-full object-cover border-2 border-customPurple-200">
                    <h2 class="text-xl font-bold text-gray-900">Hi, I'm Mark</h2>
                </div>
                <button id="close-about" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700">
                <p>I built AskArti to help federal salespeople learn how to use AI in a practical way to better support their customers. Arti's not perfect, so use your judgment, but he's available 24/7 when you need to talk through a stuck deal or prep for a tough meeting.</p>
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="bg-gray-50 rounded-lg p-4 text-sm">
                        <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-customPurple-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Privacy & Technology
                        </h3>
                        <p class="text-gray-600 mb-2">AskArti uses models that may include Gemini, Claude, and ChatGPT. These models may use API inputs to improve responses. We do not store, log, or persist any prompt or response data. All processing occurs in-memory using AWS Lambda and is discarded after execution.</p>
                    </div>
                </div>
                <div class="pt-4">
                    <a href="https://calendly.com/markflournoy/30min" target="_blank" class="block w-full bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors">
                        Let's chat about AI or Fed Sales →
                    </a>
                </div>
            </div>
        </div>
    </div>
<script>
// Configuration
const CONFIG = {
    API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
    REQUEST_TIMEOUT: 25000,
    MAX_RETRIES: 2,
    RETRY_DELAY: 2000,
    MAX_INPUT_LENGTH: 500,
    MIN_REQUEST_INTERVAL: 2000,
    LOADING_MESSAGES: [
        "Hang on. I'm...Working Backwards", 
        "...Diving Deep", 
        "...Unpacking This", 
        "...Putting a Pin in it", 
        "...Circling Back", 
        "...Thinking Big"
    ]
};
// Application class
class AskArti {
    constructor() {
        this.elements = this.getElements();
        this.state = {
            pendingRequest: false,
            lastRequestTime: 0,
            loadingInterval: null,
            abortController: null,
            lastQuery: '',
            chatHistory: [],
            messageCount: 0
        };
        this.init();
    }
    getElements() {
        return {
            chatMessages: document.getElementById('chat-messages'),
            chatInput: document.getElementById('chat-input'),
            chatSendBtn: document.getElementById('chat-send-btn'),
            clearChatBtn: document.getElementById('clear-chat-btn'),
            loadingMessageContainer: document.getElementById('loading-message-container'),
            loadingMessage: document.getElementById('loading-message'),
            errorMessage: document.getElementById('error-message'),
            errorDetails: document.getElementById('error-details'),
            retryBtn: document.getElementById('retry-btn'),
            resultsContainer: document.getElementById('results-container'),
            accountPlanContainer: document.getElementById('account-plan-container'),
            aboutBtn: document.getElementById('about-btn'),
            aboutModal: document.getElementById('about-modal'),
            closeAbout: document.getElementById('close-about'),
            shareBtn: document.getElementById('share-btn')
        };
    }
    init() {
        this.initializeMermaid();
        this.setupEventListeners();
        this.elements.chatInput.focus();
    }
    initializeMermaid() {
        mermaid.initialize({ 
            startOnLoad: false,
            securityLevel: 'strict',
            theme: 'default',
            flowchart: {
                htmlLabels: true,
                curve: 'linear'
            }
        });
    }
    setupEventListeners() {
        // Chat events
        this.elements.chatSendBtn.addEventListener('click', () => this.sendChatMessage());
        this.elements.chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.sendChatMessage();
            }
        });
        // Reset send button when user types something new
        this.elements.chatInput.addEventListener('input', () => {
            if (this.elements.chatSendBtn.classList.contains('bg-yellow-600')) {
                this.resetSendButton();
            }
        });
        // Clear chat - silently clear without confirmation
        this.elements.clearChatBtn.addEventListener('click', () => this.clearChat());
        // Retry
        this.elements.retryBtn.addEventListener('click', () => {
            this.elements.errorMessage.classList.add('hidden');
            if (this.state.lastQuery) {
                this.sendChatMessage();
            }
        });
        // Share
        this.elements.shareBtn.addEventListener('click', () => this.share());
        // About modal
        this.elements.aboutBtn.addEventListener('click', () => this.showModal());
        this.elements.closeAbout.addEventListener('click', () => this.hideModal());
        this.elements.aboutModal.addEventListener('click', (e) => {
            if (e.target === this.elements.aboutModal) this.hideModal();
        });
        // Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') this.hideModal();
        });
    }
    clearChat() {
        // Clear chat history without confirmation
        this.state.chatHistory = [];
        this.state.messageCount = 0;
        // Clear messages but keep welcome
        this.elements.chatMessages.innerHTML = `
            <div class="flex justify-start">
                <div class="bg-white rounded-lg px-3 py-2 sm:px-4 sm:py-3 max-w-[90%] sm:max-w-[80%] shadow-sm">
                    <p class="text-gray-800 text-sm sm:text-base">
                        Hey! I'm Arti. Tell me what's going on with your deal - or tap a scenario below for a quick game plan.
                    </p>
                </div>
            </div>`;
        // Clear input and results
        this.elements.chatInput.value = '';
        this.elements.resultsContainer.innerHTML = '';
        this.elements.accountPlanContainer.classList.add('hidden');
        this.elements.accountPlanContainer.innerHTML = '';
        // Remove generate plan button if it exists
        const generatePlanContainer = document.getElementById('generate-plan-container');
        if (generatePlanContainer) {
            generatePlanContainer.remove();
        }
        this.elements.chatInput.focus();
        // Small visual feedback
        this.showTemporaryMessage('Conversation cleared', 'info');
    }
    // Auto-create account plan with pre-populated message
    autoCreateAccountPlan() {
        // Directly enter the text and submit
        this.elements.chatInput.value = "Create an account plan for selling GenAI to DHS";
        this.sendChatMessage();
        // Add the generate plan button right away
        setTimeout(() => {
            if (!document.getElementById('generate-plan-btn')) {
                const generateBtnHtml = `
                    <div id="generate-plan-container" class="flex justify-center mt-4 mb-2">
                        <button id="generate-plan-btn" onclick="app.generateAccountPlan()" 
                        class="bg-accountBlue-500 hover:bg-accountBlue-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2 transition-all">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                            </svg>
                            Generate Account Plan
                        </button>
                    </div>
                `;
                this.elements.chatMessages.insertAdjacentHTML('beforeend', generateBtnHtml);
            }
            // After a brief delay, generate the account plan
            setTimeout(() => {
                this.generateAccountPlan();
            }, 1000);
        }, 1500);
    }
    async quickAnalysis(scenario) {
        // Add user message to chat
        this.addChatMessage(scenario, true);
        // Show typing
        this.showTypingIndicator();
        this.state.pendingRequest = true;
        try {
            // Add to chat history
            this.state.chatHistory.push({ role: 'user', content: scenario });
            this.state.messageCount++;
            // Make request for structured response
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    situation: scenario,
                    currentDate: new Date().toISOString().split('T')[0]
                })
            });
            const data = await response.json();
            this.hideTypingIndicator();
            // Add response to chat
            const responseMessage = `I've analyzed your scenario: *${data.quick_take}*\n\nI've created a detailed plan for you below.`;
            this.addChatMessage(responseMessage, false);
            // Add to chat history
            this.state.chatHistory.push({ role: 'assistant', content: responseMessage });
            // Display full structured response
            this.displayAdvice(data);
            this.elements.resultsContainer.scrollIntoView({ behavior: 'smooth' });
        } catch (error) {
            console.error('Quick analysis failed:', error);
            this.hideTypingIndicator();
            this.addChatMessage("I'm having trouble generating that analysis. Please try again or rephrase your scenario.", false);
        } finally {
            this.state.pendingRequest = false;
        }
    }
    addChatMessage(content, isUser = false) {
        const messageHtml = `
            <div class="flex ${isUser ? 'justify-end' : 'justify-start'}">
                <div class="${isUser ? 'chat-message-user' : 'chat-message-arti'} 
                           rounded-lg px-3 py-2 sm:px-4 sm:py-3 max-w-[90%] sm:max-w-[80%] shadow-sm">
                    ${isUser ? content : marked.parse(content)}
                </div>
            </div>
        `;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
        this.scrollChatToBottom();
    }
    showTypingIndicator() {
        const typingHtml = `
            <div id="typing-indicator" class="flex justify-start">
                <div class="bg-white rounded-lg shadow-sm typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        `;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
        this.scrollChatToBottom();
    }
    hideTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
    }
    scrollChatToBottom() {
        const scrollContainer = document.querySelector('.chat-container');
        if (!scrollContainer) return;
        requestAnimationFrame(() => {
            scrollContainer.scrollTop = scrollContainer.scrollHeight;
            setTimeout(() => {
                scrollContainer.scrollTop = scrollContainer.scrollHeight;
            }, 100);
        });
    }
async sendChatMessage() {
        // Use the input field's value, or the last failed query if the input is empty
        const message = this.elements.chatInput.value.trim() || this.state.lastQuery;

        // Exit if there is no message to send or a request is already pending
        if (!message || this.state.pendingRequest) return;
        
        // --- Start of a new, clean request ---
        this.state.pendingRequest = true;
        this.state.lastQuery = message; // Save the current message in case it needs to be retried
        this.resetSendButton(); // Ensure the button is in its normal state
        
        // Add the user's message to the UI
        // Only add it if it's not a retry of the exact same message already showing
        const chatMessages = this.elements.chatMessages.innerText;
        if (!chatMessages.includes(message)) {
            this.addChatMessage(message, true);
        }

        this.elements.chatInput.value = '';
        this.showTypingIndicator();

        // Add to chat history only if it's a new message
        if (this.state.chatHistory.length === 0 || this.state.chatHistory[this.state.chatHistory.length - 1].content !== message) {
            this.state.chatHistory.push({ role: 'user', content: message });
            this.state.messageCount++;
        }
        
        try {
            const response = await this.makeChatRequest(message);
            this.hideTypingIndicator();
            
            // Add Arti's response
            this.addChatMessage(response.message || "I'm not sure how to respond to that. Could you rephrase?");
            this.state.chatHistory.push({ role: 'assistant', content: response.message });
            
            // Clear lastQuery on success
            this.state.lastQuery = '';
            
            // Add follow-up suggestions if provided
            if (response.suggestions && response.suggestions.length > 0) {
                this.addFollowUpSuggestions(response.suggestions);
            }

        } catch (error) {
            console.error('Chat request failed:', error);
            this.hideTypingIndicator();
            this.addChatMessage("I'm having trouble connecting right now. Click Send again to retry.", false);
            
            // Change send button to indicate retry functionality
            this.elements.chatSendBtn.innerHTML = `<span>Retry</span>`;
            this.elements.chatSendBtn.classList.add('bg-yellow-600', 'hover:bg-yellow-700');
            this.elements.chatSendBtn.classList.remove('bg-customPurple-500', 'hover:bg-customPurple-700');

        } finally {
            this.state.pendingRequest = false;
        }
    }
    // Method to reset send button to original state
    resetSendButton() {
        this.elements.chatSendBtn.innerHTML = `<span>Send</span>`;
        this.elements.chatSendBtn.classList.remove('bg-yellow-600', 'hover:bg-yellow-700');
        this.elements.chatSendBtn.classList.add('bg-customPurple-500', 'hover:bg-customPurple-700');
    }

    async makeChatRequest(message) {
        // Send the FULL conversation history instead of truncating it
        // This ensures the AI model has complete context
        const conversationContext = this.state.chatHistory;
        // Include a safety mechanism to prevent the context from growing too large
        // If the context gets too large, we'll keep the first message (for initial context)
        // and the most recent messages (for recent context)
        const maxContextSize = 20; // Maximum number of messages to include
        let contextToSend = conversationContext;
        if (conversationContext.length > maxContextSize) {
            // Keep the first message plus the most recent messages
            contextToSend = [
                conversationContext[0],
                ...conversationContext.slice(-maxContextSize + 1)
            ];
        }
        try {
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    situation: message,
                    mode: 'chat',
                    conversationHistory: contextToSend,
                    currentDate: new Date().toISOString().split('T')[0] // Add current date
                })
            });
            if (!response.ok) throw new Error('Request failed');
            return await response.json();
        } catch (error) {
            console.error('API request failed:', error);
            throw error;
        }
    }
    addFollowUpSuggestions(suggestions) {
        const suggestionsHtml = `
            <div class="flex justify-center gap-2 mt-4 flex-wrap">
               ${suggestions.map(s => `
                   <button class="chat-suggestion px-3 py-1.5 bg-gray-100 hover:bg-gray-200 rounded-full text-sm text-gray-700 font-medium transition-all"
                           onclick="app.elements.chatInput.value='${s.replace(/'/g, "\\'")}'; app.sendChatMessage();">
                       ${s}
                   </button>
               `).join('')}
            </div>
        `;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', suggestionsHtml);
        this.scrollChatToBottom();
    }
    async generateAccountPlan() {
        if (this.state.pendingRequest) return;
        // Show loading message
        this.showTemporaryMessage('Creating your account plan...', 'info');
        this.elements.accountPlanContainer.innerHTML = `
            <div class="account-plan-card text-center p-6">
                <div class="loader mx-auto mb-3"></div>
                <p>Creating your account plan...</p>
            </div>
        `;
        this.elements.accountPlanContainer.classList.remove('hidden');
        // Smooth scroll to account plan area
        this.elements.accountPlanContainer.scrollIntoView({ behavior: 'smooth' });
        this.state.pendingRequest = true;
        try {
            // Use the full conversation history for better context
            let contextToSend = this.state.chatHistory;
            // Same safety mechanism as in makeChatRequest
            const maxContextSize = 20;
            if (contextToSend.length > maxContextSize) {
                contextToSend = [
                    contextToSend[0],
                    ...contextToSend.slice(-maxContextSize + 1)
                ];
            }
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    situation: "Generate account plan",
                    mode: 'account_plan',
                    conversationHistory: contextToSend,
                    currentDate: new Date().toISOString().split('T')[0] // Add current date
                })
            });
            if (!response.ok) throw new Error('Request failed');
            const data = await response.json();
            this.displayModernAccountPlan(data);
        } catch (error) {
            console.error('Account plan generation failed:', error);
            this.elements.accountPlanContainer.innerHTML = `
                <div class="account-plan-card text-center">
                    <p class="text-red-600 mb-3">Sorry, I couldn't generate your account plan at this time.</p>
                    <button onclick="app.generateAccountPlan()" class="bg-red-100 hover:bg-red-200 text-red-700 font-medium py-2 px-4 rounded-lg text-sm">
                        Try Again
                    </button>
                </div>
            `;
        } finally {
            this.state.pendingRequest = false;
        }
    }
    // Add this helper function to validate and fix dates
    validateAndFixDate(dateString) {
        // If it's "Ongoing", that's valid
        if (dateString === "Ongoing" || dateString.toLowerCase() === "ongoing") {
            return "Ongoing";
        }
        // Try to parse the date
        const dateRegex = /(\d{4}-\d{2}-\d{2})/;
        const match = dateString.match(dateRegex);
        if (match) {
            const extractedDate = match[1];
            const date = new Date(extractedDate);
            const currentDate = new Date();
            // If date is valid and in the past, add 1 year
            if (!isNaN(date) && date < currentDate) {
                date.setFullYear(currentDate.getFullYear() + 1);
                return date.toISOString().split('T')[0]; // Format as YYYY-MM-DD
            }
            // If date is valid and in the future, keep it
            if (!isNaN(date) && date > currentDate) {
                return extractedDate;
            }
        }
        // Default: return a date 3 months in the future
        const futureDate = new Date();
        futureDate.setMonth(futureDate.getMonth() + 3);
        return futureDate.toISOString().split('T')[0];
    }
    displayModernAccountPlan(data) {
        const { 
            account_name,
            objectives,
            stakeholders,
            opportunities,
            challenges,
            success_metrics,
            action_items,
            mermaid_chart
        } = data;
        if (!account_name) {
            this.elements.accountPlanContainer.innerHTML = `
                <div class="account-plan-card text-center p-6">
                    <svg class="w-12 h-12 text-yellow-500 mb-2 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    <p class="text-gray-800 font-medium mb-2">Insufficient Information</p>
                    <p class="text-gray-600 mb-3">I need more details about your account to create a comprehensive plan.</p>
                    <p class="text-sm text-gray-500">Try telling me more about your target agency, products, and goals in our chat.</p>
                </div>
            `;
            return;
        }
        let html = `
            <div class="mb-2 flex justify-between items-center">
                <h2 class="text-xl font-bold text-gray-900">${account_name} - Account Plan</h2>
                <div class="flex gap-2">
                    <button onclick="app.copyAccountPlan()" class="text-gray-600 hover:text-gray-800 bg-gray-100 hover:bg-gray-200 p-2 rounded-lg" title="Copy to clipboard">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m0 0h2a2 2 0 012 2v3m2 4H10m0 0l3-3m-3 3l3 3" />
                        </svg>
                    </button>
                    <button onclick="window.print()" class="text-gray-600 hover:text-gray-800 bg-gray-100 hover:bg-gray-200 p-2 rounded-lg" title="Print account plan">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2z" />
                        </svg>
                    </button>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <!-- Objectives Card -->
                <div class="account-plan-card">
                    <div class="flex items-center gap-2 mb-3">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" />
                        </svg>
                        <h3 class="font-semibold text-gray-800">Key Objectives</h3>
                    </div>
                    <ul class="space-y-2 pl-2">
                        ${objectives?.map(o => `
                            <li class="flex items-start gap-2">
                                <span class="text-blue-500 font-bold mt-1">→</span>
                                <span class="text-gray-700">${o}</span>
                            </li>
                        `).join('') || '<li class="text-gray-500">No objectives defined</li>'}
                    </ul>
                </div>
                <!-- Challenges Card -->
                <div class="account-plan-card">
                    <div class="flex items-center gap-2 mb-3">
                        <svg class="w-5 h-5 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                        </svg>
                        <h3 class="font-semibold text-gray-800">Challenges</h3>
                    </div>
                    <ul class="space-y-2 pl-2">
                        ${challenges?.map(c => `
                            <li class="flex items-start gap-2">
                                <span class="text-red-500 font-bold mt-1">•</span>
                                <span class="text-gray-700">${c}</span>
                            </li>
                        `).join('') || '<li class="text-gray-500">No challenges identified</li>'}
                    </ul>
                </div>
            </div>
            <!-- Stakeholders Card -->
            <div class="account-plan-card mb-4">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="w-5 h-5 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                    </svg>
                    <h3 class="font-semibold text-gray-800">Key Stakeholders</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Name/Role</th>
                                <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Influence</th>
                                <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Notes</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            ${stakeholders?.map(s => `
                                <tr>
                                    <td class="py-2 px-3 text-sm text-gray-800 font-medium">${s.name || 'Unknown'}</td>
                                    <td class="py-2 px-3">
                                        <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                            s.influence?.toLowerCase() === 'high' ? 'bg-green-100 text-green-800' :
                                            s.influence?.toLowerCase() === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                            'bg-gray-100 text-gray-800'
                                        }">${s.influence || 'Unknown'}</span>
                                    </td>
                                    <td class="py-2 px-3 text-sm text-gray-600">${s.notes || '-'}</td>
                                </tr>
                            `).join('') || `
                                <tr>
                                    <td colspan="3" class="py-3 px-3 text-center text-gray-500 text-sm">No stakeholders identified</td>
                                </tr>
                            `}
                        </tbody>
                    </table>
                </div>
            </div>
            <!-- Opportunities Card -->
            <div class="account-plan-card mb-4">
                <div class="flex items-center gap-2 mb-3">
                    <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
                    </svg>
                    <h3 class="font-semibold text-gray-800">Opportunities</h3>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full">
                        <thead>
                            <tr class="border-b border-gray-200">
                                <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Opportunity</th>
                                <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Value</th>
                                <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                                <th class="py-2 px-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Next Steps</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            ${opportunities?.map(o => `
                                <tr>
                                    <td class="py-2 px-3 text-sm text-gray-800 font-medium">${o.name || 'Unknown'}</td>
                                    <td class="py-2 px-3 text-sm font-medium text-gray-900">${o.value || '-'}</td>
                                    <td class="py-2 px-3 text-sm text-gray-600">${o.status || '-'}</td>
                                    <td class="py-2 px-3 text-sm text-gray-600">${o.next_steps || '-'}</td>
                                </tr>
                            `).join('') || `
                                <tr>
                                    <td colspan="4" class="py-3 px-3 text-center text-gray-500 text-sm">No opportunities identified</td>
                                </tr>
                            `}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                <!-- Success Metrics Card -->
                <div class="account-plan-card">
                    <div class="flex items-center gap-2 mb-3">
                        <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <h3 class="font-semibold text-gray-800">Success Metrics</h3>
                    </div>
                    <ul class="space-y-2 pl-2">
                        ${success_metrics?.map(m => `
                            <li class="flex items-start gap-2">
                                <span class="text-green-500 font-bold mt-1">✓</span>
                                <span class="text-gray-700">${m}</span>
                            </li>
                        `).join('') || '<li class="text-gray-500">No success metrics defined</li>'}
                    </ul>
                </div>
                <!-- Action Items Card -->
                <div class="account-plan-card">
                    <div class="flex items-center gap-2 mb-3">
                        <svg class="w-5 h-5 text-customPurple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
                        </svg>
                        <h3 class="font-semibold text-gray-800">Action Items</h3>
                    </div>
                    <ul class="space-y-2 pl-2">
                        ${action_items?.map(a => {
                            // Find due dates in the action item text and fix them if needed
                            let processedItem = a;
                            const dueDateMatch = a.match(/Due Date: ([^)]+)/);
                            if (dueDateMatch) {
                                const originalDate = dueDateMatch[1].trim();
                                const fixedDate = this.validateAndFixDate(originalDate);
                                // Only replace if different
                                if (originalDate !== fixedDate) {
                                    processedItem = a.replace(`Due Date: ${originalDate}`, `Due Date: ${fixedDate}`);
                                }
                            }
                            return `
                            <li class="flex items-start gap-2">
                                <span class="text-customPurple-500 font-bold mt-1">▶</span>
                                <span class="text-gray-700">${processedItem}</span>
                            </li>`;
                        }).join('') || '<li class="text-gray-500">No action items defined</li>'}
                    </ul>
                </div>
            </div>
        `;
        // Add mermaid chart if available
        if (mermaid_chart) {
            html += `
                <div class="account-plan-card">
                    <div class="flex items-center gap-2 mb-3">
                        <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1" />
                        </svg>
                        <h3 class="font-semibold text-gray-800">Stakeholder Map</h3>
                    </div>
                    <div class="mermaid-container bg-white rounded-lg p-4">
                        <div class="flex justify-center items-center absolute inset-0" id="mermaid-loading">
                            <div class="loader"></div>
                        </div>
                        <div id="mermaid-diagram" class="mermaid opacity-0">
                            ${mermaid_chart}
                        </div>
                    </div>
                </div>
            `;
        }
        this.elements.accountPlanContainer.innerHTML = html;
        // Render mermaid chart if present
        if (mermaid_chart) {
            this.renderMermaidChart();
        }
    }
    copyAccountPlan() {
        const content = this.elements.accountPlanContainer.innerText;
        if (!content || content.trim() === '') {
            alert('No account plan to copy');
            return;
        }
        navigator.clipboard.writeText(content)
            .then(() => {
                this.showTemporaryMessage('Account plan copied to clipboard!', 'info');
            })
            .catch(() => alert('Copy failed. Please try selecting and copying manually.'));
    }
    renderMermaidChart() {
        try {
            setTimeout(async () => {
                const element = document.getElementById('mermaid-diagram');
                if (!element) return;
                // Run mermaid rendering
                await mermaid.run();
                // Show the chart
                element.style.opacity = '1';
                element.style.transition = 'opacity 0.3s ease-in';
                // Hide loader
                const loader = document.getElementById('mermaid-loading');
                if (loader) loader.style.display = 'none';
            }, 300);
        } catch (error) {
            console.error('Mermaid rendering error:', error);
            const container = document.querySelector('.mermaid-container');
            if (container) {
                container.innerHTML = '<div class="p-4 bg-gray-100 text-gray-700 rounded text-center">Visualization unavailable</div>';
            }
        }
    }
    displayAdvice(data) {
        const { response_type } = data;
        try {
            if (response_type === 'prospect') {
                this.displayProspectAdvice(data);
            } else {
                this.displayGeneralAdvice(data);
            }
            // Add action buttons
            this.addActionButtons();
        } catch (error) {
            console.error('Display error:', error);
            this.elements.resultsContainer.innerHTML = `
                <div class="dashboard-card text-center">
                    <p class="text-red-600 mb-3">Sorry, I couldn't display the results. Please try again.</p>
                </div>
            `;
        }
    }
    displayProspectAdvice(data) {
        const { 
            summary = '',
            top_s_is = [],
            top_software_and_cloud = [],
            company_capabilities = [],
            naics_codes = [],
            prospect_recommendations = []
        } = data;
        const renderSimpleList = (items) => {
            if (!items || items.length === 0) return '<p class="text-sm text-gray-500">No data available</p>';
            return `
            <div class="space-y-2">
                ${items.map((item, index) => `
                    <div class="border-l-4 border-customPurple-500 pl-3 py-1">
                        <div class="font-medium text-gray-900">
                            <span class="text-customPurple-600 font-bold">${index + 1}</span> 
                            ${item.company || 'Unknown'}
                        </div>
                        <div class="text-sm text-gray-600">${item.value || 'N/A'}</div>
                    </div>
                `).join('')}
            </div>`;
        };
        const html = `
        <div class="fade-in space-y-6">
            <div class="dashboard-card bg-gradient-to-r from-customPurple-100 to-customPurple-200">
                <h3 class="text-xl font-bold text-gray-900 mb-2">Key Market Insights</h3>
                <div class="text-gray-800">${marked.parse(summary)}</div>
            </div>
            <div class="dashboard-card">
                <h3 class="font-bold text-gray-900 mb-4 text-lg">Top Contractors</h3>
                ${renderSimpleList(top_s_is)}
            </div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div class="dashboard-card">
                    <h3 class="font-bold text-gray-900 mb-3">Mission Needs</h3>
                    <ul class="space-y-2 text-sm">${company_capabilities.map(c => `
                        <li class="flex gap-2">
                            <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span>${c}</span>
                        </li>`).join('')}
                    </ul>
                </div>
                <div class="dashboard-card">
                    <h3 class="font-bold text-gray-900 mb-3">Relevant NAICS Codes</h3>
                    <ul class="space-y-2 text-sm">${naics_codes.map(n => {
                        const naicsText = typeof n === 'string' ? n : (n.code ? `${n.code} - ${n.description || ''}` : 'Unknown');
                        return `
                        <li class="flex gap-2">
                            <svg class="w-5 h-5 text-green-500 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                            </svg>
                            <span>${naicsText}</span>
                        </li>`;
                    }).join('')}
                    </ul>
                </div>
            </div>
            <div class="dashboard-card">
                <h3 class="font-bold text-gray-900 mb-4 text-lg">Potential Software Plays</h3>
                ${renderSimpleList(top_software_and_cloud)}
            </div>
            <div class="dashboard-card">
                <h3 class="font-bold text-gray-900 mb-3">Strategic Recommendations</h3>
                <ul class="space-y-3 text-sm">${prospect_recommendations.map(r => `
                    <li class="flex gap-3">
                        <span class="text-customPurple-500 font-bold text-lg flex-shrink-0">→</span>
                        <span>${r}</span>
                    </li>`).join('')}
                </ul>
            </div>
        </div>`;
        this.elements.resultsContainer.innerHTML = html;
    }
    displayGeneralAdvice(data) {
        const { 
            quick_take = '',
            key_moves = [],
            mermaid_chart = '',
            talking_points = [],
            email_template = '',
            next_steps = '',
            response_type = 'deal'
        } = data;
        const html = `
        <div class="fade-in space-y-6">
            <div class="bg-gradient-to-r from-gray-50 to-customPurple-100 rounded-xl p-6 flow-root">
                <img src="/images/arti_right.png" alt="Arti" class="h-12 w-12 float-left mr-4 mb-2">
                <div class="text-gray-800 space-y-2">${marked.parse(quick_take)}</div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="dashboard-card">
                    <h3 class="font-bold text-gray-900 mb-4">Your Next 3 Moves</h3>
                    <div class="space-y-3">${key_moves.slice(0, 3).map((m, i) => `
                        <div class="flex gap-3">
                            <span class="flex-shrink-0 w-7 h-7 bg-customPurple-200 text-customPurple-700 rounded-full flex items-center justify-center text-sm font-bold">${i + 1}</span>
                            <div class="flex-1">
                                <p class="font-medium text-gray-900">${m.action}</p>
                                <p class="text-sm text-gray-600 mt-1">${m.why}</p>
                            </div>
                        </div>`).join('')}
                    </div>
                </div>
                <div class="dashboard-card">
                    <h3 class="font-bold text-gray-900 mb-4">Game Plan</h3>
                    ${mermaid_chart ? `
                        <div class="mermaid-container">
                            <div class="mermaid-loading">
                                <div class="loader"></div>
                            </div>
                            <div id="mermaid-diagram" class="mermaid" style="opacity: 0;">${mermaid_chart}</div>
                        </div>` : 
                        '<div class="p-4 bg-gray-50 rounded-lg text-center"><p class="text-gray-600">Visual game plan not available</p></div>'
                    }
                </div>
            </div>
            ${(talking_points?.length > 0 || email_template) ? `
            <div class="dashboard-card">
                <h3 class="font-bold text-gray-900 mb-4">Communications</h3>
                <div class="grid grid-cols-1 ${email_template && talking_points?.length > 0 ? 'md:grid-cols-2' : ''} gap-6">
                    ${talking_points?.length > 0 ? `
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">
                                ${response_type === 'interview' ? 'What They May Ask' : 'What to Ask'}
                            </h4>
                            <ul class="space-y-2 text-sm">${talking_points.map(t => `
                                <li class="flex gap-2">
                                    <svg class="w-5 h-5 text-green-500 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
                                    </svg>${t}
                                </li>`).join('')}
                            </ul>
                        </div>` : ''}
                    ${email_template ? `
                        <div>
                            <h4 class="font-semibold text-gray-800 mb-3">Email Template</h4>
                            <div class="bg-gray-50 rounded-lg p-4 font-mono text-sm text-gray-700 whitespace-pre-wrap border">${email_template}</div>
                        </div>` : ''}
                </div>
            </div>` : ''}
            ${next_steps ? `
                <div class="bg-customPurple-100 p-4 rounded-lg text-sm text-gray-800">
                    <b class="font-semibold">Remember:</b> ${next_steps}
                </div>` : ''}
        </div>`;
        this.elements.resultsContainer.innerHTML = html;
        // Render mermaid chart if present
        if (mermaid_chart) {
            this.renderMermaidChart();
        }
    }
    addActionButtons() {
        const buttonsHtml = `
            <div class="mt-8 flex flex-col sm:flex-row gap-3">
                <button onclick="app.copyResults()" class="flex-1 bg-customPurple-500 hover:bg-customPurple-700 text-white font-medium py-3 px-6 rounded-lg transition-colors">
                    Copy to Clipboard
                </button>
                <button onclick="app.clearChat()" class="flex-1 bg-white hover:bg-gray-50 text-gray-700 font-medium py-3 px-6 rounded-lg border border-gray-200 transition-colors">
                    Start New Conversation
                </button>
            </div>`;
        this.elements.resultsContainer.insertAdjacentHTML('beforeend', buttonsHtml);
    }
    copyResults() {
        const content = this.elements.resultsContainer.innerText;
        if (!content || content.trim() === '') {
            alert('No content to copy');
            return;
        }
        navigator.clipboard.writeText(content)
            .then(() => {
                const btn = this.elements.resultsContainer.querySelector('button');
                const originalText = btn.textContent;
                btn.textContent = 'Copied!';
                setTimeout(() => btn.textContent = originalText, 2000);
            })
            .catch(() => alert('Copy failed. Please try selecting and copying manually.'));
    }
    share() {
        const shareData = {
            title: 'AskArti',
            text: 'Check out this Fed Sales Bot',
            url: 'https://askarti.com'
        };
        if (navigator.share) {
            navigator.share(shareData).catch(console.error);
        } else {
            navigator.clipboard.writeText(`${shareData.text} ${shareData.url}`)
                .then(() => {
                    this.elements.shareBtn.textContent = 'Link Copied!';
                    setTimeout(() => this.elements.shareBtn.textContent = 'Share', 2000);
                })
                .catch(() => alert('Please copy the URL manually: https://askarti.com'));
        }
    }
    showTemporaryMessage(message, type = 'info') {
        this.elements.loadingMessageContainer.classList.remove('hidden');
        this.elements.loadingMessage.textContent = message;
        const colorClasses = {
            error: 'text-red-700 font-medium',
            warning: 'text-orange-700 font-medium',
            info: 'text-gray-600'
        };
        this.elements.loadingMessage.className = colorClasses[type] || colorClasses.info;
        setTimeout(() => {
            this.elements.loadingMessageContainer.classList.add('hidden');
        }, 2000);
    }
    showModal() {
        this.elements.aboutModal.classList.remove('hidden');
        requestAnimationFrame(() => {
            this.elements.aboutModal.querySelector('.modal-content').classList.add('show');
        });
    }
    hideModal() {
        const content = this.elements.aboutModal.querySelector('.modal-content');
        content.classList.remove('show');
        setTimeout(() => this.elements.aboutModal.classList.add('hidden'), 200);
    }
}
// Initialize app
const app = new AskArti();
</script>
</body>
</html>