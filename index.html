<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskArti - Your 24/7 Federal Sales Coach</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides guidance, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://askarti.com/">
    <meta property="og:title" content="AskArti - Your Federal Sales Coach">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti.">
    <meta property="og:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:url" content="https://askarti.com/">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Coach">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti.">
    <meta name="twitter:image" content="https://askarti.com/images/asklite.png">
    
    <!-- Favicons -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <link rel="manifest" href="/site.webmanifest">
    <meta name="theme-color" content="#7C6BBE">
    
    <!-- Preconnect -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Preload critical assets -->
    <link rel="preload" href="/images/asklite.png" as="image">
    <link rel="preload" href="/images/arti_right.png" as="image">
    
    <!-- Styles and Scripts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: {
                            50: '#F6F4FB',
                            100: '#E8E4F7',
                            200: '#D8D2EF',
                            300: '#C8C0E7',
                            400: '#B7ACDF',
                            500: '#9688D0',
                            600: '#7C6BBE',
                            700: '#6354A6',
                            800: '#524686',
                            900: '#403866'
                        }
                    }
                }
            }
        }
    </script>
    
<style>
    body {
        font-family: 'Inter', sans-serif;
        margin: 0;
        padding: 0;
        background-color: #F6F4FB;
        color: #1F2937;
    }

    .loader {
        border: 2px solid #E8E4F7;
        border-top: 2px solid #7C6BBE;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .chat-container {
        height: 70vh;
        max-height: 500px;
        overflow-y: auto;
        -webkit-overflow-scrolling: touch;
        background-color: #F6F4FB;
        border-radius: 0.75rem;
        border: 1px solid rgba(124, 107, 190, 0.1);
    }

    @supports (height: 100dvh) {
        .chat-container {
            height: 70dvh;
        }
    }

    .chat-container::-webkit-scrollbar {
        width: 6px;
    }

    .chat-container::-webkit-scrollbar-track {
        background: #F6F4FB;
        border-radius: 3px;
    }

    .chat-container::-webkit-scrollbar-thumb {
        background: #D8D2EF;
        border-radius: 3px;
    }

    .chat-message-user {
        background-color: #7C6BBE;
        color: white;
        border-radius: 1rem 1rem 0.25rem 1rem;
        padding: 0.75rem 1rem;
        max-width: 80%;
        margin-left: auto;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .chat-message-arti {
        background-color: white;
        color: #1F2937;
        border-radius: 1rem 1rem 1rem 0.25rem;
        padding: 0.75rem 1rem;
        max-width: 80%;
        border: 1px solid #E8E4F7;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
    }

    .typing-indicator {
        display: flex;
        gap: 4px;
        padding: 0.5rem 1rem;
        background-color: white;
        border: 1px solid #E8E4F7;
        border-radius: 1rem 1rem 1rem 0.25rem;
        width: fit-content;
        margin-bottom: 0.75rem;
    }

    .typing-dot {
        width: 8px;
        height: 8px;
        background-color: #7C6BBE;
        border-radius: 50%;
        animation: typing 1.4s infinite ease-in-out;
        opacity: 0.5;
    }

    .typing-dot:nth-child(1) { animation-delay: -0.32s; }
    .typing-dot:nth-child(2) { animation-delay: -0.16s; }

    @keyframes typing {
        0%, 80%, 100% {
            transform: scale(0.8);
            opacity: 0.5;
        }
        40% {
            transform: scale(1);
            opacity: 1;
        }
    }

    .chat-suggestion {
        background-color: rgba(124, 107, 190, 0.1);
        color: #403866;
        border-radius: 2rem;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        transition: all 0.2s ease;
        border: 1px solid rgba(124, 107, 190, 0.2);
    }

    .chat-suggestion:hover {
        background-color: rgba(124, 107, 190, 0.2);
        transform: translateY(-1px);
    }

    .account-plan-card {
        background-color: white;
        border-radius: 0.75rem;
        border: 1px solid #E8E4F7;
        padding: 1.5rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        margin-bottom: 1rem;
    }

    .mermaid-container {
        text-align: center;
        min-height: 200px;
        position: relative;
        background-color: white;
        padding: 1rem;
        border-radius: 0.5rem;
        border: 1px solid #E8E4F7;
    }

    .mermaid {
        display: inline-block;
        max-width: 100%;
    }

    .modal-backdrop {
        transition: opacity 0.2s ease-out;
    }

    .modal-content {
        transform: scale(0.95);
        opacity: 0;
        transition: all 0.2s ease-out;
    }

    .modal-content.show {
        transform: scale(1);
        opacity: 1;
    }

    /* Mobile layout improvements */
    @media (max-width: 640px) {
        .chat-container {
            height: 60vh;
        }

        .account-plan-card {
            padding: 1rem;
        }

        input[type="text"],
        input[type="email"],
        textarea {
            font-size: 16px !important; /* Prevent zoom on iOS */
        }

        #chat-input {
            min-height: 44px;
        }
    }

    /* iOS Safari viewport fix */
    @supports (-webkit-touch-callout: none) {
        .chat-container {
            height: 60dvh;
        }

        html, body {
            height: 100%;
            overflow-x: hidden;
        }

        body {
            -webkit-overflow-scrolling: touch;
        }
    }
</style>

</head>
<body>
    <div class="max-w-screen-lg mx-auto px-4 sm:px-6 lg:px-8 pt-4 pb-20">
        <header class="text-center mb-4">
            <a href="/" aria-label="AskArti Home" class="inline-block">
                <img src="/images/asklite.png" alt="AskArti" class="h-16 w-auto md:h-20 lg:h-24">
            </a>
        </header>

        <main class="bg-white rounded-xl shadow-sm border border-brand-100 mb-3 overflow-hidden">
            <!-- Chat Interface -->
            <div class="chat-container p-4">
                <div id="chat-messages" class="space-y-4">
                    <div class="flex justify-start">
                        <div class="chat-message-arti">
                            <p>Hey! I'm Arti, your federal sales coach. Tell me about a deal you're working on, a meeting you're preparing for, or any federal sales challenge you're facing.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Input Area -->
            <div class="border-t border-brand-100 bg-white p-4">
                <div class="flex gap-2 items-end">
                    <input 
                        type="text" 
                        id="chat-input"
                        inputmode="text"
                        autocomplete="off"
                        autocorrect="on"
                        autocapitalize="sentences"
                        spellcheck="true"
                        class="flex-1 p-3 text-base border border-brand-200 rounded-xl focus:ring-2 focus:ring-brand-300 focus:border-brand-500 min-h-[44px]"
                        placeholder="Type your message here..."
                        maxlength="500">
                    <button 
                        id="chat-send-btn" 
                        class="bg-brand-600 hover:bg-brand-700 text-white font-medium px-5 py-3 rounded-xl transition-all text-base min-h-[44px] flex items-center justify-center">
                        <span>Send</span>
                    </button>
                </div>
                <div class="flex justify-center mt-4">
                    <button id="account-plan-btn" class="bg-brand-50 hover:bg-brand-100 border border-brand-200 text-brand-700 font-medium px-4 py-2 rounded-xl transition-all text-sm hidden">
                        Create Account Plan
                    </button>
                </div>
            </div>
        </main>

        <!-- Account Plan Results -->
        <div id="account-plan-container" class="space-y-6 mt-8 hidden"></div>

        <!-- Footer -->
        <footer class="text-center mt-8 sm:mt-12 space-y-3 sm:space-y-4 pb-20">
            <div class="flex justify-center gap-6 text-sm">
                <button id="about-btn" class="text-brand-600 hover:text-brand-800 font-medium">About</button>
                <button id="share-btn" class="text-brand-600 hover:text-brand-800 font-medium">Share</button>
                <a href="mailto:mark@subhoo.com" class="text-brand-600 hover:text-brand-800 font-medium">Contact</a>
            </div>

            <div class="bg-white border border-brand-100 rounded-lg p-4 text-sm max-w-2xl mx-auto">
                <div class="flex items-center gap-2 mb-2">
                    <span class="text-xs font-medium text-brand-600 bg-brand-50 px-2 py-1 rounded-full">SPONSOR</span>
                    <span class="text-gray-800 font-semibold">Want to support AskArti?</span>
                </div>
                <p class="text-sm leading-relaxed text-gray-700">
                    By the time I pay off all my scientists, lab coats, and Lambda bills…I'm losing money every time you press that Send button.
                </p>
                <p class="mt-2 text-xs text-brand-600 font-medium">
                    <a href="mailto:mark@subhoo.com" class="hover:underline">Contact me to sponsor this space →</a>
                </p>
            </div>

            <p class="text-xs text-gray-500 max-w-lg mx-auto">
                AskArti.com results are provided for informational and educational purposes only and do not constitute professional business advice. Always consult qualified professionals before making important business decisions.
            </p>

            <p class="text-xs text-gray-400">© 2025 AskArti. Made for Sellers by Sellers.</p>
        </footer>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50 modal-backdrop">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6 modal-content">
            <div class="flex justify-between items-start mb-4">
                <div class="flex items-center gap-3">
                    <img src="images/oldmark.jpg" alt="Mark Flournoy" class="w-12 h-12 rounded-full object-cover border-2 border-brand-200">
                    <h2 class="text-xl font-bold text-gray-900">Hi, I'm Mark</h2>
                </div>
                <button id="close-about" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700">
                <p>I built AskArti to help salespeople use AI in a practical way to better support federal customers. Arti's not perfect, so use your judgment, but he's available 24/7 when you need to talk through a stuck deal or prep for a tough meeting.</p>
                
                <div class="mt-6 pt-4 border-t border-gray-200">
                    <div class="bg-brand-50 rounded-lg p-4 text-sm">
                        <h3 class="font-semibold text-gray-800 mb-2 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-brand-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                            Privacy & Technology
                        </h3>
                        <p class="text-gray-600 mb-2">AskArti uses models that may include Gemini, Claude, and ChatGPT. These models may use API inputs to improve responses. We do not store, log, or persist any prompt or response data. All processing occurs in-memory using AWS Lambda and is discarded after execution.</p>
                    </div>
                </div>
                
                <div class="pt-4">
                    <a href="https://calendly.com/markflournoy/30min" target="_blank" class="block w-full bg-brand-600 hover:bg-brand-700 text-white font-medium py-3 px-4 rounded-lg text-center transition-colors">
                        Let's chat about AI or Fed Sales →
                    </a>
                </div>
            </div>
        </div>
    </div>

<script>
// Configuration
const CONFIG = {
    API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
    REQUEST_TIMEOUT: 25000,
    MAX_RETRIES: 2,
    RETRY_DELAY: 2000,
    MAX_INPUT_LENGTH: 500
};

// Application class
class AskArti {
    constructor() {
        this.elements = this.getElements();
        this.state = {
            pendingRequest: false,
            lastRequestTime: 0,
            abortController: null,
            chatHistory: [],
            messageCount: 0
        };
        this.init();
    }

    getElements() {
        return {
            chatMessages: document.getElementById('chat-messages'),
            chatInput: document.getElementById('chat-input'),
            chatSendBtn: document.getElementById('chat-send-btn'),
            accountPlanBtn: document.getElementById('account-plan-btn'),
            accountPlanContainer: document.getElementById('account-plan-container'),
            aboutBtn: document.getElementById('about-btn'),
            aboutModal: document.getElementById('about-modal'),
            closeAbout: document.getElementById('close-about'),
            shareBtn: document.getElementById('share-btn')
        };
    }

    init() {
        this.initializeMermaid();
        this.setupEventListeners();
        this.elements.chatInput.focus();
    }

    initializeMermaid() {
        mermaid.initialize({ 
            startOnLoad: false,
            securityLevel: 'strict',
            theme: 'neutral',
            flowchart: {
                htmlLabels: true,
                curve: 'basis'
            }
        });
    }

    setupEventListeners() {
        // Chat events
        this.elements.chatSendBtn.addEventListener('click', () => this.sendChatMessage());
        this.elements.chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.sendChatMessage();
            }
        });
        
        // Account plan button
        this.elements.accountPlanBtn.addEventListener('click', () => this.generateAccountPlan());

        // About modal
        this.elements.aboutBtn.addEventListener('click', () => this.showModal());
        this.elements.closeAbout.addEventListener('click', () => this.hideModal());
        this.elements.aboutModal.addEventListener('click', (e) => {
            if (e.target === this.elements.aboutModal) this.hideModal();
        });

        // Share button
        this.elements.shareBtn.addEventListener('click', () => this.share());

        // Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') this.hideModal();
        });
    }

    addChatMessage(content, isUser = false) {
        const messageHtml = `
            <div class="flex ${isUser ? 'justify-end' : 'justify-start'}">
                <div class="${isUser ? 'chat-message-user' : 'chat-message-arti'}">
                    ${isUser ? content : marked.parse(content)}
                </div>
            </div>
        `;
        
        this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
        this.scrollChatToBottom();
    }

    showTypingIndicator() {
        const typingHtml = `
            <div id="typing-indicator" class="flex justify-start">
                <div class="typing-indicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
            </div>
        `;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
        this.scrollChatToBottom();
    }

    hideTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
    }

    scrollChatToBottom() {
        const scrollContainer = document.querySelector('.chat-container');
        if (!scrollContainer) return;

        requestAnimationFrame(() => {
            scrollContainer.scrollTop = scrollContainer.scrollHeight;
            setTimeout(() => {
                scrollContainer.scrollTop = scrollContainer.scrollHeight;
            }, 100);
        });
    }

    async sendChatMessage() {
        const message = this.elements.chatInput.value.trim();
        if (!message || this.state.pendingRequest) return;

        // Add user message
        this.addChatMessage(message, true);
        this.elements.chatInput.value = '';
        
        // Add to chat history
        this.state.chatHistory.push({ role: 'user', content: message });
        this.state.messageCount++;

        // Show typing indicator
        this.showTypingIndicator();
        this.state.pendingRequest = true;

        try {
            const response = await this.makeChatRequest(message);
            this.hideTypingIndicator();
            
            // Add Arti's response
            this.addChatMessage(response.message || "I'm not sure how to respond to that. Could you rephrase?");
            this.state.chatHistory.push({ role: 'assistant', content: response.message || "I'm not sure how to respond to that. Could you rephrase?" });

            // Show account plan button after sufficient conversation
            if (this.state.messageCount >= 2 && response.message && response.message.includes("Create Account Plan")) {
                this.elements.accountPlanBtn.classList.remove('hidden');
            }

            // Add follow-up suggestions if provided
            if (response.suggestions && response.suggestions.length > 0) {
                this.addSuggestions(response.suggestions);
            }

        } catch (error) {
            console.error('Chat request failed:', error);
            this.hideTypingIndicator();
            this.addChatMessage("Sorry, I'm having trouble connecting right now. Please try again in a moment.");
        } finally {
            this.state.pendingRequest = false;
        }
    }

    async makeChatRequest(message) {
        // Format chat history for context (last few exchanges)
        const conversationContext = this.state.chatHistory.slice(-6);
        
        const response = await fetch(CONFIG.API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                situation: message,
                mode: 'chat',
                conversationHistory: conversationContext
            })
        });

        if (!response.ok) throw new Error('Request failed');
        return await response.json();
    }

    addSuggestions(suggestions) {
        if (!suggestions || !Array.isArray(suggestions) || suggestions.length === 0) return;
        
        const suggestionsHtml = `
            <div class="flex justify-center flex-wrap gap-2 mt-4 mb-1">
                ${suggestions.map(s => `
                    <button class="chat-suggestion"
                            onclick="app.useSuggestion('${s.replace(/'/g, "\\'")}')">
                        ${s}
                    </button>
                `).join('')}
            </div>
        `;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', suggestionsHtml);
        this.scrollChatToBottom();
    }

    useSuggestion(suggestion) {
        this.elements.chatInput.value = suggestion;
        this.sendChatMessage();
    }

    async generateAccountPlan() {
        if (this.state.pendingRequest || this.state.chatHistory.length < 2) return;
        
        // Show loading in account plan area
        this.elements.accountPlanContainer.innerHTML = `
            <div class="flex justify-center items-center p-8">
                <div class="loader mr-3"></div>
                <p class="text-brand-700">Creating your account plan...</p>
            </div>
        `;
        this.elements.accountPlanContainer.classList.remove('hidden');
        
        // Scroll to account plan area
        this.elements.accountPlanContainer.scrollIntoView({ behavior: 'smooth' });
        
        this.state.pendingRequest = true;
        
        try {
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    situation: "Generate account plan",
                    mode: 'account_plan',
                    conversationHistory: this.state.chatHistory
                })
            });
            
            if (!response.ok) throw new Error('Request failed');
            
            const data = await response.json();
            this.displayAccountPlan(data);
            
        } catch (error) {
            console.error('Account plan generation failed:', error);
            this.elements.accountPlanContainer.innerHTML = `
                <div class="bg-red-50 border border-red-100 rounded-lg p-4 text-center">
                    <p class="text-red-700">Sorry, I couldn't generate your account plan. Please try again.</p>
                    <button class="mt-2 bg-red-100 hover:bg-red-200 text-red-700 font-medium py-2 px-4 rounded-lg text-sm"
                            onclick="app.generateAccountPlan()">
                        Retry
                    </button>
                </div>
            `;
        } finally {
            this.state.pendingRequest = false;
        }
    }

    displayAccountPlan(data) {
        const { 
            account_name,
            objectives,
            stakeholders,
            opportunities,
            challenges,
            success_metrics,
            action_items,
            mermaid_chart
        } = data;
        
        if (!account_name) {
            this.elements.accountPlanContainer.innerHTML = `
                <div class="bg-red-50 border border-red-100 rounded-lg p-4 text-center">
                    <p class="text-red-700">Sorry, I couldn't generate a complete account plan. Please try again or provide more information about your account.</p>
                </div>
            `;
            return;
        }
        
        const html = `
            <div class="fade-in">
                <div class="account-plan-card">
                    <h2 class="text-2xl font-bold text-brand-900 mb-6 text-center">${account_name} - Account Plan</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-brand-700 mb-3">Key Objectives</h3>
                            <ul class="space-y-2">
                                ${objectives?.map(o => `
                                    <li class="flex items-start gap-2">
                                        <span class="text-brand-500 font-bold mt-1">→</span>
                                        <span>${o}</span>
                                    </li>
                                `).join('') || '<li class="text-gray-500">No objectives defined</li>'}
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-brand-700 mb-3">Challenges</h3>
                            <ul class="space-y-2">
                                ${challenges?.map(c => `
                                    <li class="flex items-start gap-2">
                                        <span class="text-red-500 font-bold mt-1">•</span>
                                        <span>${c}</span>
                                    </li>
                                `).join('') || '<li class="text-gray-500">No challenges identified</li>'}
                            </ul>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-brand-700 mb-3">Key Stakeholders</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full border border-brand-100 rounded-lg">
                                <thead>
                                    <tr class="bg-brand-50">
                                        <th class="py-2 px-4 text-left text-brand-900 font-medium border-b border-brand-100">Name/Role</th>
                                        <th class="py-2 px-4 text-left text-brand-900 font-medium border-b border-brand-100">Influence</th>
                                        <th class="py-2 px-4 text-left text-brand-900 font-medium border-b border-brand-100">Notes</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${stakeholders?.map((s, i) => `
                                        <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-brand-50'}">
                                            <td class="py-2 px-4 border-b border-brand-100">${s.name || 'Unknown'}</td>
                                            <td class="py-2 px-4 border-b border-brand-100">
                                                <span class="px-2 py-1 rounded-full text-xs font-medium ${
                                                    s.influence?.toLowerCase() === 'high' ? 'bg-green-100 text-green-800' :
                                                    s.influence?.toLowerCase() === 'medium' ? 'bg-yellow-100 text-yellow-800' :
                                                    'bg-gray-100 text-gray-800'
                                                }">${s.influence || 'Unknown'}</span>
                                            </td>
                                            <td class="py-2 px-4 border-b border-brand-100">${s.notes || '-'}</td>
                                        </tr>
                                    `).join('') || `
                                        <tr>
                                            <td colspan="3" class="py-3 px-4 text-center text-gray-500">No stakeholders identified</td>
                                        </tr>
                                    `}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <h3 class="text-lg font-semibold text-brand-700 mb-3">Opportunities</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full border border-brand-100 rounded-lg">
                                <thead>
                                    <tr class="bg-brand-50">
                                        <th class="py-2 px-4 text-left text-brand-900 font-medium border-b border-brand-100">Opportunity</th>
                                        <th class="py-2 px-4 text-left text-brand-900 font-medium border-b border-brand-100">Value</th>
                                        <th class="py-2 px-4 text-left text-brand-900 font-medium border-b border-brand-100">Status</th>
                                        <th class="py-2 px-4 text-left text-brand-900 font-medium border-b border-brand-100">Next Steps</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    ${opportunities?.map((o, i) => `
                                        <tr class="${i % 2 === 0 ? 'bg-white' : 'bg-brand-50'}">
                                            <td class="py-2 px-4 border-b border-brand-100">${o.name || 'Unknown'}</td>
                                            <td class="py-2 px-4 border-b border-brand-100 font-medium">${o.value || '-'}</td>
                                            <td class="py-2 px-4 border-b border-brand-100">${o.status || '-'}</td>
                                            <td class="py-2 px-4 border-b border-brand-100">${o.next_steps || '-'}</td>
                                        </tr>
                                    `).join('') || `
                                        <tr>
                                            <td colspan="4" class="py-3 px-4 text-center text-gray-500">No opportunities identified</td>
                                        </tr>
                                    `}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <h3 class="text-lg font-semibold text-brand-700 mb-3">Success Metrics</h3>
                            <ul class="space-y-2">
                                ${success_metrics?.map(m => `
                                    <li class="flex items-start gap-2">
                                        <span class="text-green-500 font-bold mt-1">✓</span>
                                        <span>${m}</span>
                                    </li>
                                `).join('') || '<li class="text-gray-500">No success metrics defined</li>'}
                            </ul>
                        </div>
                        
                        <div>
                            <h3 class="text-lg font-semibold text-brand-700 mb-3">Action Items</h3>
                            <ul class="space-y-2">
                                ${action_items?.map(a => `
                                    <li class="flex items-start gap-2">
                                        <span class="text-brand-500 font-bold mt-1">▶</span>
                                        <span>${a}</span>
                                    </li>
                                `).join('') || '<li class="text-gray-500">No action items defined</li>'}
                            </ul>
                        </div>
                    </div>
                    
                    ${mermaid_chart ? `
                        <div class="mb-6">
                            <h3 class="text-lg font-semibold text-brand-700 mb-3">Stakeholder Map</h3>
                            <div class="mermaid-container">
                                <div class="flex justify-center items-center absolute inset-0" id="mermaid-loading">
                                    <div class="loader"></div>
                                </div>
                                <div id="mermaid-diagram" class="mermaid opacity-0">
                                    ${mermaid_chart}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="flex justify-end mt-6">
                        <button id="print-account-plan" class="bg-brand-600 hover:bg-brand-700 text-white font-medium px-4 py-2 rounded-lg text-sm flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2z" />
                            </svg>
                            Print Account Plan
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        this.elements.accountPlanContainer.innerHTML = html;
        
        // Render mermaid chart if present
        if (mermaid_chart) {
            this.renderMermaidChart();
        }
        
        // Add print functionality
        document.getElementById('print-account-plan')?.addEventListener('click', () => {
            window.print();
        });
    }

    async renderMermaidChart() {
        try {
            // Give DOM time to settle
            await new Promise(resolve => setTimeout(resolve, 100));
            
            const element = document.getElementById('mermaid-diagram');
            if (!element) return;
            
            // Run mermaid
            await mermaid.run();
            
            // Fade in the chart
            element.style.opacity = '1';
            element.style.transition = 'opacity 0.3s ease-in';
            
            // Hide loader
            const loader = document.getElementById('mermaid-loading');
            if (loader) loader.style.display = 'none';
            
        } catch (error) {
            console.error('Mermaid rendering error:', error);
            const container = document.querySelector('.mermaid-container');
            if (container) {
                container.innerHTML = '<div class="p-4 bg-brand-50 text-gray-700 rounded text-center">Stakeholder map visualization unavailable</div>';
            }
        }
    }

    share() {
        const shareData = {
            title: 'AskArti - Federal Sales Coach',
            text: 'Check out this AI federal sales coach',
            url: 'https://askarti.com'
        };
        
        if (navigator.share) {
            navigator.share(shareData).catch(console.error);
        } else {
            navigator.clipboard.writeText(`${shareData.text}: ${shareData.url}`)
                .then(() => {
                    this.elements.shareBtn.textContent = 'Link Copied!';
                    setTimeout(() => this.elements.shareBtn.textContent = 'Share', 2000);
                })
                .catch(() => alert('Please copy the URL manually: https://askarti.com'));
        }
    }

    showModal() {
        this.elements.aboutModal.classList.remove('hidden');
        requestAnimationFrame(() => {
            this.elements.aboutModal.querySelector('.modal-content').classList.add('show');
        });
    }

    hideModal() {
        const content = this.elements.aboutModal.querySelector('.modal-content');
        content.classList.remove('show');
        setTimeout(() => this.elements.aboutModal.classList.add('hidden'), 200);
    }
}

// Initialize app
const app = new AskArti();
</script>
</body>
</html>