<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AskArti - Your 24/7 Sales Buddy</title>
    
    <!-- Meta tags unchanged from original -->
    <meta name="description" content="Get personalized federal sales advice from AskArti. Free AI tool provides SMART goals, customer messaging, and deal strategies for government contractors and sales professionals.">
    <meta name="keywords" content="federal sales, government sales, AI sales coach, sales strategy, federal contractors, govcon, sales advice">
    <meta name="author" content="Mark">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://askarti.com">
    
    <!-- OG tags unchanged from original -->
    <meta property="og:title" content="AskArti - Your Federal Sales Buddy">
    <meta property="og:description" content="Get personalized federal sales advice from AskArti.">
    <meta property="og:image" content="https://askarti.com/images/arti_right.png">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="AskArti - Your Federal Sales Buddy">
    <meta name="twitter:description" content="Get personalized federal sales advice from AskArti.">
    <meta name="twitter:image" content="https://askarti.com/images/arti_right.png">
    
    <!-- Favicon tags unchanged from original -->
    <link rel="icon" href="/images/favicon.ico" sizes="any">
    <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
    <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
    <meta name="theme-color" content="#ffffff">
    
    <!-- Preconnect and preload -->
    <link rel="preconnect" href="https://cdn.tailwindcss.com">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="/images/arti_right.png" as="image">
    
    <!-- Scripts and styles -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script> 
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;800&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-WLGEPY5H4G"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-WLGEPY5H4G');
    </script>
    
    <!-- Tailwind config - unchanged from original -->
    <script>
    tailwind.config = {
        theme: {
            extend: {
                fontFamily: {
                    sans: ['Inter', 'sans-serif'],
                    serif: ['Merriweather', 'serif']
                },
                colors: {
                    'brand-purple': '#8E88A7',
                    'brand-purple-faint': '#E1DDEE',
                    'brand-gray': {
                        50: '#F9FAFB', 100: '#F3F4F6', 200: '#E5E7EB',
                        400: '#9CA3AF', 600: '#4B5563', 800: '#1F2937', 900: '#111827'
                    },
                    'brand-yellow': { bg: '#FCF8E8', text: '#7A6A34', border: '#F5EED8' },
                    'brand-blue': { bg: '#E8EDF2', text: '#3A4F6A', border: '#D4DCE6' },
                    'brand-green': { bg: '#EBF0EA', text: '#4A5C4A', border: '#D8E2D9' }
                }
            }
        }
    }
    </script>

    <style>
    /* === CSS VARIABLES & BASE === */
    :root {
        --brand-purple: #8E88A7;
        --brand-purple-faint: #E1DDEE;
        --brand-gray-50: #F9FAFB;
        --brand-gray-100: #F3F4F6;
        --brand-gray-800: #1F2937;
    }

    html { scroll-behavior: smooth; }

    body {
        background-color: var(--brand-gray-50);
        font-family: 'Inter', sans-serif;
        color: var(--brand-gray-800);
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    /* === LAYOUT === */
    .main-container {
        max-width: 768px;
        margin: 0 auto;
        padding: 1rem;
    }

    .fade-in {
        animation: fadeIn 0.5s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    /* === CARDS === */
    .io-card {
        background-color: white;
        border-radius: 1rem;
        border: 0px solid #E5E7EB;
        padding: 1.5rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -2px rgba(0, 0, 0, 0.05);
        transition: box-shadow 0.2s ease;
    }

    .results-card {
        background-color: white;
        border-radius: 1rem;
        border: 1px solid #E5E7EB;
        overflow: hidden;
        margin-top: 1.5rem;
    }

    .results-card-header {
        padding: 1rem 1.5rem;
        border-bottom: 1px solid #E5E7EB;
    }

    .results-card-body {
        padding: 1.5rem;
    }

    .results-card-body > div {
        margin-bottom: 1.5rem;
    }

    /* === TYPOGRAPHY === */
    h1, h2, h3, h4, h5, h6 {
        font-weight: 700;
        margin-bottom: 1rem;
    }

    p, li, span {
        font-weight: 400;
        line-height: 1.6;
    }

    /* === FORM INPUTS === */
    textarea, input[type="text"] {
        font-size: 16px !important;
        transition: all 0.2s ease;
        font-weight: 400;
        color: #374151;
        line-height: 1.4;
    }

    #chat-input {
        font-weight: 400 !important;
        color: #4B5563 !important;
        letter-spacing: 0.005em;
        line-height: 1.4 !important;
        font-size: 15px !important;
    }

    #chat-input::placeholder {
        color: #9CA3AF;
        font-weight: 300;
        font-style: italic;
        line-height: 1.4;
    }

    #chat-input:focus {
        color: #1F2937;
        outline: none;
        ring: 1px;
        ring-color: #8E88A7;
        border-color: #8E88A7;
    }

    /* === BUTTONS === */
    .btn {
        display: inline-flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        border-radius: 0.75rem;
        padding: 0.75rem 1.5rem;
        min-height: 44px;
        min-width: 44px;
        transition: all 0.2s ease;
        cursor: pointer;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
    }

    .btn:active { transform: scale(0.95); }

    .btn-primary {
        background-color: var(--brand-purple);
        color: white;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-primary:hover {
        background-color: #7A7391;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    .btn-primary:active {
        transform: scale(0.95);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .btn-secondary {
        background-color: white;
        color: #374151;
        border: 1px solid #D1D5DB;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .btn-secondary:hover {
        background-color: #F9FAFB;
        border-color: #9CA3AF;
        transform: translateY(-1px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .btn-secondary:active {
        transform: scale(0.95);
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    }

    .btn-recommended {
        border-width: 2px;
        border-color: var(--brand-purple);
        box-shadow: 0 4px 12px rgba(124, 107, 190, 0.2);
    }

    /* === UTILITY BUTTONS === */
    .copy-btn {
        position: absolute;
        top: 0.5rem;
        right: 0.5rem;
        background-color: rgba(255, 255, 255, 0.7);
        border: 1px solid #E5E7EB;
        border-radius: 0.5rem;
        padding: 0.5rem;
        min-width: 44px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #4B5563;
        cursor: pointer;
        transition: all 0.2s ease;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        font-size: 0.75rem;
    }

    .copy-btn:hover {
        background-color: white;
        border-color: #9CA3AF;
        transform: translateY(-1px);
        color: #374151;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .copy-btn:active { transform: scale(0.95); }

    .copy-btn.copied {
        background-color: #10B981;
        color: white;
        border-color: #10B981;
    }

    .copy-btn.copied:hover {
        background-color: #059669;
        border-color: #059669;
    }

    /* === ANIMATIONS === */
    @keyframes copyFlash {
        0% { background-color: rgba(16, 185, 129, 0.1); }
        50% { background-color: rgba(16, 185, 129, 0.3); }
        100% { background-color: rgba(16, 185, 129, 0.1); }
    }

    .copy-flash { animation: copyFlash 0.6s ease-in-out; }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    .loader {
        border: 2px solid rgba(255, 255, 255, 0.3);
        border-top: 2px solid white;
        border-radius: 50%;
        width: 1.25rem;
        height: 1.25rem;
        animation: spin 1s linear infinite;
    }

    .btn-secondary .loader {
        border-color: rgba(0, 0, 0, 0.1);
        border-top-color: var(--brand-purple);
    }

    /* === CHAT === */
    .chat-container {
        height: 65dvh;
        max-height: 600px;
        overflow-y: auto;
        padding: 1rem;
        background-color: #F9FAFB;
        border-radius: 1rem;
        border: 0px solid #E5E7EB;
    }

    .chat-message-user {
        background-color: var(--brand-purple);
        color: white;
        border-radius: 1rem 1rem 0.25rem 1rem;
    }

    .chat-message-arti {
        background-color: white;
        color: #1f2937;
        border: 1px solid #e5e7eb;
        border-radius: 1rem 1rem 1rem 0.25rem;
    }

    /* === DIGEST STYLES === */
    .digest-card .results-card-body { padding: 2rem; }

    .digest-header {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 2rem;
        padding-bottom: 1rem;
        border-bottom: 0px solid #E5E7EB;
    }

    .digest-header img {
        width: 3rem;
        height: 3rem;
        border-radius: 50%;
        background-color: var(--brand-purple-faint);
        padding: 0.25rem;
        border: none;
    }

    .digest-header h2 {
        font-size: 1.75rem;
        font-weight: 800;
        color: #111827;
        letter-spacing: -0.025em;
        margin-bottom: 0.25rem;
    }

    .digest-header-meta {
        font-size: 0.875rem;
        color: #6B7280;
        text-transform: uppercase;
        font-weight: 600;
    }

    .digest-section {
        padding-top: 1.5rem;
        margin-top: 1.5rem;
        border-top: 1px solid #E5E7EB;
    }

    .digest-section-title {
        font-size: 0.75rem;
        font-weight: 700;
        color: var(--brand-purple);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        margin-bottom: 1rem;
    }

    .digest-item {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 0 1rem;
        margin-bottom: 2rem;
    }

    .digest-item-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: #374151;
        line-height: 1.2;
    }

    .digest-item-headline {
        font-weight: 700;
        font-size: 1.125rem;
        color: #1F2937;
        margin-bottom: 0.25rem;
    }

    .digest-item-headline a {
        color: inherit;
        text-decoration: none;
        transition: background-color 0.2s ease;
    }

    .digest-item-headline a:hover {
        background-color: var(--brand-purple-faint);
    }

    .digest-item-summary, .digest-item-insight {
        font-family: 'Merriweather', serif;
        font-size: 1rem;
        line-height: 1.7;
        color: #374151;
        word-wrap: break-word;
        overflow-wrap: break-word;
    }
    .digest-item-insight {
        font-style: italic;
        color: var(--brand-purple);
        margin-top: 0.75rem;
    }

    .digest-item-meta { margin-top: 0.75rem; }

    .digest-code-block {
        background-color: #F9FAFB;
        border: 1px solid #E5E7EB;
        border-radius: 0.5rem;
        padding: 1rem;
        font-family: monospace;
        font-size: 0.875rem;
        white-space: pre-wrap;
        word-wrap: break-word;
        word-break: normal;
        overflow-wrap: break-word;
        position: relative;
        line-height: 1.5;
    }

    .digest-tag {
        display: inline-block;
        background-color: #F3F4F6;
        color: #374151;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 9999px;
        margin-right: 0.5rem;
        margin-bottom: 0.5rem;
    }

    /* === MISC === */
    .checkmark {
        width: 16px;
        height: 16px;
        stroke: currentColor;
        stroke-width: 2;
        stroke-linecap: round;
        stroke-linejoin: round;
        fill: none;
    }

    .mermaid-container {
        background-color: #ffffff;
        border: 1px solid #E5E7EB;
        border-radius: 0.5rem;
        padding: 1rem;
        margin: 1rem 0;
    }

    .sample-link {
        color: var(--brand-purple);
        font-weight: 600;
        text-decoration: none;
        border-bottom: 1px dotted var(--brand-purple);
        transition: all 0.2s ease;
    }

    .sample-link:hover {
        background-color: var(--brand-purple-faint);
        border-bottom-style: solid;
    }
    
    .border-l-3 {
        border-left-width: 3px;
    }

    .border-purple-300 {
        border-left-color: #d8b4fe;
    }

    .border-blue-300 {
        border-left-color: #93c5fd;
    }

    .border-green-300 {
        border-left-color: #86efac;
    }

    .border-yellow-300 {
        border-left-color: #fde047;
    }

    .border-red-300 {
        border-left-color: #fca5a5;
    }
    .border-orange-300 {
        border-left-color: #fdba74;
    }

    .border-indigo-300 {
        border-left-color: #a5b4fc;
    }

    .suggestion-chip {
        background-color: #F3F4F6;
        border: 1px solid #E5E7EB;
        border-radius: 9999px;
        padding: 0.5rem 1rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: #4B5563;
        cursor: pointer;
        transition: all 0.2s ease;
        white-space: nowrap;
    }

    .suggestion-chip:hover {
        background-color: #E5E7EB;
        color: #1F2937;
        transform: translateY(-1px);
    }

    .suggestion-chip:active {
        transform: scale(0.95);
    }

    /* === MOBILE RESPONSIVE === */
    @media (max-width: 640px) {
        .main-container { padding: 0.5rem; padding-bottom: 0.5rem; }
        .io-card, .results-card-body { padding: 0.75rem; }
        .results-card-header { padding: 0.75rem 1rem; }
        .results-card-body > div { margin-bottom: 1rem; }
        .btn { padding: 0.75rem 1rem; font-size: 0.9rem; }
        .copy-btn { padding: 0.625rem; min-width: 48px; min-height: 48px; }
        .mt-4 { margin-top: 0.5rem; }
        .mt-6 { margin-top: 0.75rem; }
        .chat-container { height: 55dvh; max-height: 450px; padding: 0.75rem; }
        header { margin-bottom: 0.5rem; }
        header img { height: 4rem; }
        footer { margin-top: 2rem; }
        .space-y-3 > * + * { margin-top: 0.5rem; }
        .space-y-4 > * + * { margin-top: 0.75rem; }
        .space-y-6 > * + * { margin-top: 1rem; }
        .space-y-8 > * + * { margin-top: 1.25rem; }
        .digest-card .results-card-body { padding: 1.25rem; }
        .digest-header h2 { font-size: 1.5rem; }
        .digest-item-headline { font-size: 1rem; }
        .suggestion-chips-container { 
            padding-bottom: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .suggestion-chip {
            padding: 0.375rem 0.75rem;
            font-size: 0.75rem;
        }
    }

    @media (max-width: 768px) {
        .copy-playbook-btn { padding: 0.5rem 0.75rem; font-size: 0.75rem; }
        .copy-playbook-btn svg { width: 1rem; height: 1rem; margin-right: 0.25rem; }
        .results-card-header .flex { flex-direction: column; align-items: flex-start; gap: 0.75rem; }
        .results-card-header .flex > div:first-child { flex: 1; width: 100%; }
        .copy-playbook-btn { align-self: stretch; justify-content: center; width: 100%; }
        .playbook-persona-circle { min-width: 2rem !important; width: 2rem !important; height: 2rem !important; flex-shrink: 0 !important; font-size: 0.75rem !important; }
    }

    /* Responsive fixes */
    .results-card,
    .digest-card {
        box-sizing: border-box !important;
    }

    .results-card-body,
    .digest-card .results-card-body {
        max-width: 100% !important;
        box-sizing: border-box !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
    }

    .digest-header,
    .digest-section,
    .digest-item {
        max-width: 100% !important;
        box-sizing: border-box !important;
    }

    .digest-item > div:nth-child(2) {
        min-width: 0 !important;
        flex: 1 !important;
    }

    .digest-item-summary,
    .digest-item-insight,
    .digest-item-headline,
    .digest-code-block {
        max-width: 100% !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
        box-sizing: border-box !important;
    }

    /* Fix all text content in renderers */
    .results-card p,
    .results-card h1,
    .results-card h2,
    .results-card h3,
    .results-card h4,
    .results-card li,
    .results-card span {
        max-width: 100% !important;
        word-wrap: break-word !important;
        overflow-wrap: break-word !important;
    }
    
    /* Structured card in chat - new styles */
    .structured-card {
        background-color: white;
        border-radius: 0.75rem;
        border: 1px solid #E5E7EB;
        overflow: hidden;
        margin-top: 0.5rem;
        margin-bottom: 0.5rem;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: box-shadow 0.2s;
    }
    
    .structured-card:hover {
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    
    .chat-structured-content {
        max-width: 95%;
        margin-top: 0.5rem;
    }
    
    /* Highlighted action text */
    .action-highlight {
        background-color: #FCF8E8;
        border-left: 3px solid #fde047;
        padding: 0.5rem;
        margin: 0.5rem 0;
        border-radius: 0.25rem;
        font-weight: 500;
    }
    </style>
</head>
<body class="bg-brand-gray-50">
    <div class="main-container pt-4 pb-20">
        <!-- Header -->
        <header class="text-center mb-3">
            <a href="/" aria-label="AskArti Home" class="inline-block">
                <img src="/images/asklite.png" alt="AskArti Logo" class="h-20 w-auto mx-auto sm:h-24">
            </a>
        </header>

        <!-- Main content -->
        <main id="main-content">
            <div class="io-card">
                <!-- Chat container -->
                <div class="chat-container mb-4" id="chat-container">
                    <div id="chat-messages" class="space-y-4">
                        <div class="flex justify-start">
                            <div class="chat-message-arti p-3 text-sm max-w-[85%]">
                                <p id="chat-greeting">Hey! I'm Arti, your federal sales coach. I can help with your sales challenges, analyze deals, or create structured plans. What's on your mind today?</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Suggestion chips container -->
                <div class="suggestion-chips-container flex gap-2 overflow-x-auto pb-3 mb-3 border-b border-gray-200 hidden" id="suggestion-chips-container">
                    <!-- Chips will be dynamically inserted here -->
                </div>
                
                <!-- Input area -->
                <div class="flex gap-2">
                    <input type="text" id="chat-input" class="flex-1 p-3 text-base border border-gray-300 rounded-lg focus:outline-none focus:ring-1 focus:ring-gray-300 focus:border-gray-300" placeholder="Type your message or paste an article..." maxlength="2500">
                    <button id="chat-send-btn" class="btn btn-primary px-4">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                
                <!-- Sample prompt tips -->
                <div class="mt-3 text-sm text-gray-600 leading-relaxed">
                    <div class="grid grid-cols-1 gap-2 text-xs">
                        <div class="bg-gray-50 p-2 rounded border-l-3 border-indigo-300">
                            <strong>ðŸ’¡ Try these:</strong> 
                            <a href="#" class="sample-link sample-prompt" data-prompt="Help with a stuck deal">Stuck deal</a> â€¢
                            <a href="#" class="sample-link sample-prompt" data-prompt="Create a sales playbook for cloud services at DoD">Sales playbook</a> â€¢
                            <a href="#" class="sample-link sample-prompt" data-prompt="Analyze this article: [paste article text]">Article analysis</a> â€¢
                            <a href="#" class="sample-link sample-prompt" data-prompt="Get today's federal news briefing">Daily news</a>
                        </div>
                    </div>
                </div>
            </div>
<div class="mt-6 bg-gray-50 p-4 rounded-lg border border-gray-200 text-sm text-gray-600 max-w-none mx-auto">
    <p class="mb-3"><strong>ðŸ‘‹ Hi there!</strong> I'm designed to help with all your federal sales needs. You can chat with me naturally about sales challenges, paste articles or news for actionable intelligence, ask for a "sales playbook" to get comprehensive strategy, request a "daily briefing" for federal market news, ask for deal strategies to unstick your sales opportunities, or even analyze financials for investment insights.</p>
    <p>Try one of the sample prompts above or just ask me anything about federal sales. I'm here to help!</p>
</div>
            <!-- Error message -->
            <div id="error-message" class="bg-red-100 border border-red-300 rounded-lg p-4 text-center my-4 hidden">
                <p class="text-red-800 font-semibold mb-1">Â¯\_(ãƒ„)_/Â¯ Oops, that didn't work.</p>
                <p class="text-red-700 text-sm" id="error-details">We're having trouble connecting to Arti.</p>
            </div>
        </main>
   
        <!-- Footer -->
        <footer class="text-center mt-8 text-xs text-gray-500">
            <div class="flex justify-center gap-4 mb-4">
                <a href="#" id="about-btn" class="font-medium text-brand-purple hover:underline">About AskArti</a>
                <a href="mailto:mark@subhoo.com" class="font-medium text-brand-purple hover:underline">Contact</a>
            </div>
            <p class="mb-3 text-gray-600">
                You're interacting with an AI assistant trained through June 2024. AskArti offers general guidance for informational purposes only and isn't a substitute for professional advice. Always evaluate recommendations carefully before making decisions.
            </p>
            <p>
                For Federal Sellers by Federal Sellers.
                <br>
                Powered by AWS.
                <br>
                Â© 2025 AskArti.com.
            </p>
        </footer>
    </div>
 
    <!-- About modal -->
    <div id="about-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-xl w-full max-w-md p-6">
            <div class="flex justify-between items-start mb-4">
                <h2 class="text-xl font-bold text-gray-900">About AskArti</h2>
                <button id="close-about" class="text-gray-400 hover:text-gray-600">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
            <div class="space-y-4 text-gray-700 text-sm">
                <p>AskArti is your 24/7 AI sales coach, designed for federal sales professionals. Get instant advice on stuck deals, meeting preparation, and sales strategy.</p>
                <div class="mt-4 pt-4 border-t">
                    <h3 class="font-semibold text-gray-800 mb-2">Privacy & Technology</h3>
                    <p class="text-gray-600">AskArti uses advanced AI models. We do not store, log, or persist any conversation data. All processing occurs in-memory and is discarded.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script>
    // Configuration
    const CONFIG = {
        API_ENDPOINT: 'https://vd823jgh0a.execute-api.us-east-1.amazonaws.com/prod/AskArtiAPI',
        REQUEST_TIMEOUT: 30000,
        MAX_RETRIES: 2,
        RETRY_DELAY: 2000,
        MAX_INPUT_LENGTH: 2500,
        MIN_REQUEST_INTERVAL: 2000,
        LOADING_MESSAGES: [
            "Hang on. I'm...Working Backwards", 
            "...Diving Deep", 
            "...Unpacking This", 
            "...Putting a Pin in it", 
            "...Circling Back", 
            "...Thinking Big"
        ],
        SUGGESTION_TYPES: {
            DEFAULT: [
                "How do I prospect better?",
                "Create a sales playbook",
                "Get today's federal news briefing"
            ],
            DEAL: [
                "What would be the next step?",
                "How to handle pricing objections?",
                "Help me create a follow-up email"
            ],
            PROSPECT: [
                "Who are the key stakeholders?",
                "What partners should I consider?",
                "What's my best approach?"
            ],
            NEWS: [
                "Who are the key people to contact?",
                "What are the next actions?",
                "Create a GTM strategy"
            ]
        }
    };

   class AskArti {
    constructor() {
        this.elements = this.getElements();
        this.state = {
            pendingRequest: false,
            lastRequestTime: 0,
            loadingInterval: null,
            abortController: null,
            chatHistory: [],
            lastResponseType: null
        };
        this.init();
    }

    getElements() {
        return {
            chatContainer: document.getElementById('chat-container'),
            chatMessages: document.getElementById('chat-messages'),
            chatInput: document.getElementById('chat-input'),
            chatSendBtn: document.getElementById('chat-send-btn'),
            suggestionChipsContainer: document.getElementById('suggestion-chips-container'),
            errorMessage: document.getElementById('error-message'),
            errorDetails: document.getElementById('error-details'),
            aboutBtn: document.getElementById('about-btn'),
            aboutModal: document.getElementById('about-modal'),
            closeAbout: document.getElementById('close-about')
        };
    }

    init() {
        this.updateGreeting();
        this.setupEventListeners();
        this.setupMermaid();
        
        // Focus the input field
        this.elements.chatInput.focus();
        
        // Update the click event handlers in the init() method
document.querySelectorAll('.sample-prompt, .sample-link').forEach(link => {
    link.addEventListener('click', (e) => {
        e.preventDefault();
        const promptText = e.currentTarget.dataset.prompt;
        
        // Special handling for daily news request
        if (promptText.toLowerCase().includes('news') || 
            promptText.toLowerCase().includes('brief') || 
            promptText.toLowerCase().includes('digest')) {
            this.fetchDailyNews();
            return;
        }
        
        // Special handling for playbook requests
        if (promptText.toLowerCase().includes('playbook') ||
            promptText.toLowerCase().includes('sales plan')) {
            this.fetchSalesPlaybook(promptText);
            return;
        }
        
        // Standard behavior for other prompts
        this.elements.chatInput.value = promptText;
        this.elements.chatInput.focus();
    });
});
        
        // Set up sample link event listeners
        document.querySelectorAll('.sample-link').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const promptText = e.currentTarget.dataset.prompt;
                
                // Special handling for daily news request
                if (promptText.toLowerCase().includes('news') || 
                    promptText.toLowerCase().includes('brief') || 
                    promptText.toLowerCase().includes('digest')) {
                    this.fetchDailyNews();
                    return;
                }
                
                // Standard behavior for other prompts
                this.elements.chatInput.value = promptText;
                this.elements.chatInput.focus();
            });
        });
    }

    async fetchDailyNews() {
        // Show that we're working on it
        this.addMessage("Get today's federal news briefing", true);
        this.showTypingIndicator();
        
        try {
            // Make direct API call for digest
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ 
                    situation: "Get today's federal news briefing", 
                    forceType: "digest"  // Force digest type regardless of content
                }),
            });
            
            if (!response.ok) throw new Error(`Server error: ${response.status}`);
            
            const data = await response.json();
            this.hideTypingIndicator();
            
            // Handle the response appropriately
            if (data.response_type === "digest") {
                // Add a brief intro message
                this.addMessage("Here's today's federal sales intelligence briefing:");
                // Then add the structured digest card
                this.addStructuredCard(data);
                // Add to chat history
                this.state.chatHistory.push({ 
                    role: 'user', 
                    content: "Get today's federal news briefing" 
                });
                this.state.chatHistory.push({ 
                    role: 'assistant', 
                    content: "Here's today's federal sales intelligence briefing:",
                    structuredData: data
                });
            } else if (data.message) {
                // If we got a regular chat message back
                this.addMessage(data.message);
                // Add to chat history
                this.state.chatHistory.push({ 
                    role: 'user', 
                    content: "Get today's federal news briefing" 
                });
                this.state.chatHistory.push({ 
                    role: 'assistant', 
                    content: data.message 
                });
            } else {
                this.addMessage("I'm having trouble retrieving today's news briefing. Please try again in a few minutes.");
            }
            
        } catch (error) {
            this.hideTypingIndicator();
            this.addMessage("I'm having trouble retrieving today's news briefing. Please try again in a few minutes.");
            console.error("News briefing error:", error);
        }
    }
// Add this new method to handle playbook requests
async fetchSalesPlaybook(prompt) {
    // Show that we're working on it
    this.addMessage(prompt, true);
    this.showTypingIndicator();
    
    try {
        // Make direct API call for playbook
        const response = await fetch(CONFIG.API_ENDPOINT, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                situation: prompt, 
                forceType: "playbook"  // Force playbook type regardless of content
            }),
        });
        
        if (!response.ok) throw new Error(`Server error: ${response.status}`);
        
        const data = await response.json();
        this.hideTypingIndicator();
        
        // Handle the response appropriately
        if (data.response_type === "playbook") {
            // Add a brief intro message
            const introMessage = `I've created a comprehensive sales playbook for ${data.sales_play_title}:`;
            this.addMessage(introMessage);
            
            // Then add the structured playbook card
            this.addStructuredCard(data);
            
            // Add to chat history
            this.state.chatHistory.push({ 
                role: 'user', 
                content: prompt 
            });
            this.state.chatHistory.push({ 
                role: 'assistant', 
                content: introMessage,
                structuredData: data
            });
        } else if (data.message) {
            // If we got a regular chat message back
            this.addMessage(data.message);
            // Add to chat history
            this.state.chatHistory.push({ 
                role: 'user', 
                content: prompt 
            });
            this.state.chatHistory.push({ 
                role: 'assistant', 
                content: data.message 
            });
        } else {
            this.addMessage("I'm having trouble creating a sales playbook. Please try again with more specific details about your target customers and products.");
        }
        
    } catch (error) {
        this.hideTypingIndicator();
        this.addMessage("I'm having trouble generating a sales playbook. Please try again with more details.");
        console.error("Sales playbook error:", error);
    }
}
    updateGreeting() {
        const hour = new Date().getHours();
        let greeting = '';
        
        if (hour >= 5 && hour < 12) {
            greeting = "Good morning!";
        } else if (hour >= 12 && hour < 17) {
            greeting = "Good afternoon!";
        } else if (hour >= 17 && hour < 21) {
            greeting = "Good evening!";
        } else {
            greeting = "Hello there!";
        }
        
        const chatGreeting = document.getElementById('chat-greeting');
        if (chatGreeting) {
            chatGreeting.textContent = `${greeting} I'm Arti, your federal sales coach. I can help with your sales challenges, analyze deals, or create structured plans. What's on your mind today?`;
        }
    }

    setupMermaid() {
        mermaid.initialize({ 
            startOnLoad: false, 
            securityLevel: 'strict', 
            theme: 'base', 
            themeVariables: {
                primaryColor: '#F3F4F6',
                primaryTextColor: '#1F2937',
                primaryBorderColor: '#D1D5DB',
                lineColor: '#6B7280',
                textColor: '#111827',
                fontSize: '14px'
            }
        });
    }

    setupEventListeners() {
        // Chat send button
        this.elements.chatSendBtn.addEventListener('click', () => {
            this.sendMessage();
        });
        
        // Enter key to send
        this.elements.chatInput.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                this.sendMessage();
            }
        });
        
        // About modal
        this.elements.aboutBtn.addEventListener('click', (e) => {
            e.preventDefault();
            this.showModal();
        });
        
        this.elements.closeAbout.addEventListener('click', () => {
            this.hideModal();
        });
        
        this.elements.aboutModal.addEventListener('click', (e) => {
            if (e.target === this.elements.aboutModal) {
                this.hideModal();
            }
        });
        
        // ESC key for modal
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                this.hideModal();
            }
        });
    }

    showModal() {
        this.elements.aboutModal.classList.remove('hidden');
    }

    hideModal() {
        this.elements.aboutModal.classList.add('hidden');
    }

    addMessage(content, isUser = false) {
        let processedContent = '';
        
        if (isUser) {
            processedContent = content;
        } else {
            // Process <action></action> tags
            processedContent = content.replace(/<action>(.*?)<\/action>/g, '<div class="action-highlight">$1</div>');
            
            // Convert markdown
            processedContent = marked.parse(processedContent);
        }
        
        const messageClass = isUser ? 'chat-message-user justify-end' : 'chat-message-arti justify-start';
        const alignClass = isUser ? 'justify-end' : 'justify-start';
        
        const messageHtml = `
            <div class="flex ${alignClass} fade-in">
                <div class="${messageClass} p-3 text-sm max-w-[85%]">
                    ${processedContent}
                </div>
            </div>
        `;
        
        this.elements.chatMessages.insertAdjacentHTML('beforeend', messageHtml);
        this.scrollChatToBottom();
    }

    // Method to add structured card into chat
    addStructuredCard(data) {
        if (!data || !data.response_type) return;
        
        const alignClass = 'justify-start';
        const cardType = data.response_type;
        
        let cardHtml = '';
        
        // Create appropriate card based on response type
        switch (cardType) {
            case 'digest':
                cardHtml = this.renderDailyDigest(data);
                break;
            case 'playbook':
                cardHtml = this.renderSalesPlaybook(data);
                break;
            case 'news':
                cardHtml = this.renderNewsAdvice(data);
                break;
            case 'investment':
                cardHtml = this.renderMarketAnalysis(data);
                break;
            case 'prospect':
                cardHtml = this.renderProspectAdvice(data);
                break;
            case 'deal':
            case 'interview':
            case 'meeting':
                cardHtml = this.renderGeneralAdvice(data);
                break;
            default:
                return; // Don't render anything if type is unknown
        }
        
        // Add the structured card to chat
        const structuredCardHtml = `
            <div class="flex ${alignClass} fade-in chat-structured-content">
                <div class="structured-card">${cardHtml}</div>
            </div>
        `;
        
        this.elements.chatMessages.insertAdjacentHTML('beforeend', structuredCardHtml);
        this.scrollChatToBottom();
        
        // Setup interactive elements in the card
        this.setupInteractiveElements();
        
        // Render mermaid charts if present
        if (data.mermaid_chart) {
            this.renderMermaidChart().then(() => {
                this.setupMermaidDownloadButton();
            });
        }
        
        // Show relevant suggestion chips based on response type
        this.showSuggestionChips(cardType);
    }

    showTypingIndicator() {
        const typingHtml = `
            <div id="typing-indicator" class="flex justify-start">
                <div class="chat-message-arti p-3 text-sm">
                    <span class="inline-flex">
                        <span class="dot-typing"></span>
                        <span class="dot-typing" style="animation-delay: 0.2s"></span>
                        <span class="dot-typing" style="animation-delay: 0.4s"></span>
                    </span>
                </div>
            </div>
        `;
        this.elements.chatMessages.insertAdjacentHTML('beforeend', typingHtml);
        this.scrollChatToBottom();
    }

    hideTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) indicator.remove();
    }

    scrollChatToBottom() {
        this.elements.chatContainer.scrollTop = this.elements.chatContainer.scrollHeight;
    }

    async sendMessage() {
        const message = this.elements.chatInput.value.trim();
        if (!message || this.state.pendingRequest) return;
        
        this.state.pendingRequest = true;
        this.addMessage(message, true);
        this.state.chatHistory.push({ role: 'user', content: message });
        this.elements.chatInput.value = '';
        this.showTypingIndicator();
        
        try {
            // Determine if this is a special command that needs structured output
            const isStructuredRequest = this.detectStructuredRequest(message);
            
            // Prepare request body
            const requestBody = {
                situation: message,
                mode: 'chat',
                conversationHistory: this.state.chatHistory
            };
            
            // If it's a structured request, set appropriate type
            if (isStructuredRequest) {
                requestBody.forceType = isStructuredRequest;
            }
            
            // Send request to API
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                throw new Error(`Server error (${response.status})`);
            }
            
            const data = await response.json();
            this.hideTypingIndicator();
            
            // Case 1: Direct structured response (old style)
            if (data.response_type && !data.message) {
                // Save last response type
                this.state.lastResponseType = data.response_type;
                
                // First add a brief introduction message
                const introMessage = this.getIntroForStructuredResponse(data);
                this.addMessage(introMessage);
                
                // Then add the structured card
                this.addStructuredCard(data);
                
                // Add to chat history as assistant response
                this.state.chatHistory.push({ 
                    role: 'assistant', 
                    content: introMessage,
                    structuredData: data
                });
            } 
            // Case 2: Chat response with structured data (new unified style)
            else if (data.message && data.structuredData) {
                // First add the conversational message
                this.addMessage(data.message);
                
                // Then add the structured card
                this.addStructuredCard(data.structuredData);
                
                // Add to chat history
                this.state.chatHistory.push({ 
                    role: 'assistant', 
                    content: data.message,
                    structuredData: data.structuredData
                });
                
                // Show suggestion chips if included
                if (data.suggestions && data.suggestions.length > 0) {
                    this.showCustomSuggestionChips(data.suggestions);
                }
            }
            // Case 3: Simple chat response (no structured data)
            else if (data.message) {
                // Standard chat response
                this.addMessage(data.message);
                this.state.chatHistory.push({ 
                    role: 'assistant', 
                    content: data.message 
                });
                
                // Show suggestion chips if included in response
                if (data.suggestions && data.suggestions.length > 0) {
                    this.showCustomSuggestionChips(data.suggestions);
                }
            }
            // Case 4: Unknown response format
            else {
                throw new Error("Invalid response format from server");
            }
        } catch (error) {
            console.error('Request failed:', error);
            this.hideTypingIndicator();
            this.addMessage("Sorry, I'm having trouble connecting right now. Please try again in a moment.");
            this.showError(error.message || "Connection error");
        } finally {
            this.state.pendingRequest = false;
        }
    }

    // Get intro text for structured responses
    getIntroForStructuredResponse(data) {
        const type = data.response_type;
        
        switch (type) {
            case 'digest':
                return "Here's today's federal sales intelligence briefing:";
            case 'playbook':
                return `I've created a comprehensive sales playbook for ${data.sales_play_title}:`;
            case 'news':
                return "Here's my analysis of the news article with actionable insights:";
            case 'investment':
                return "I've analyzed the financial information. Here's my investment breakdown:";
            case 'prospect':
                return "Here's my prospecting intelligence for your target:";
            case 'deal':
                return "I've created a deal strategy to help you move forward:";
            case 'interview':
                return "Here's your interview preparation plan:";
            case 'meeting':
                return "I've prepared a meeting strategy for you:";
            default:
                return "Here's the structured information you requested:";
        }
    }

    // Detect if message should trigger structured output
    detectStructuredRequest(message) {
        const lowerMessage = message.toLowerCase();
        
        // Key phrases that indicate structured output requests
        const patterns = {
            digest: /daily digest|sales digest|federal digest|intelligence digest|daily brief|briefing|federal news|today's news/i,
            playbook: /playbook|sales plan|go-to-market|gtm strategy|create a sales plan|create a playbook/i,
            investment: /analyze (this|these) (earnings|financials)|financial analysis|earnings analysis/i,
            interview: /interview prep|prepare for interview|interview preparation/i,
            prospect: /prospecting strategy|prospect for|lead gen|market to|sell into|find clients/i,
            meeting: /meeting prep|prepare for meeting|meeting strategy/i,
            news: /analyze this (article|news|press release)|article analysis/i,
        };
        
        // Check if message contains long text (likely an article)
        const isLongText = message.length > 300 && !message.startsWith('analyze');
        
        // If it's a long text without explicit request, default to news analysis
        if (isLongText) {
            return 'news';
        }
        
        // Check for specific patterns
        for (const [type, pattern] of Object.entries(patterns)) {
            if (pattern.test(lowerMessage)) {
                return type;
            }
        }
        
        return null; // No structured type detected
    }

    showError(message) {
        this.elements.errorMessage.classList.remove('hidden');
        this.elements.errorDetails.textContent = message;
        
        // Auto-hide after 5 seconds
        setTimeout(() => {
            this.elements.errorMessage.classList.add('hidden');
        }, 5000);
    }

    // Show suggestion chips based on response type
    showSuggestionChips(responseType) {
        let suggestions = [];
        
        // Get relevant suggestions based on response type
        if (CONFIG.SUGGESTION_TYPES[responseType.toUpperCase()]) {
            suggestions = CONFIG.SUGGESTION_TYPES[responseType.toUpperCase()];
        } else {
            suggestions = CONFIG.SUGGESTION_TYPES.DEFAULT;
        }
        
        this.renderSuggestionChips(suggestions);
    }

    // Show custom suggestion chips from API response
    showCustomSuggestionChips(suggestions) {
        if (!suggestions || suggestions.length === 0) {
            this.elements.suggestionChipsContainer.classList.add('hidden');
            return;
        }
        
        this.renderSuggestionChips(suggestions);
    }

    // Render suggestion chips in the container
    renderSuggestionChips(suggestions) {
        if (!suggestions || suggestions.length === 0) {
            this.elements.suggestionChipsContainer.classList.add('hidden');
            return;
        }
        
        // Clear existing chips
        this.elements.suggestionChipsContainer.innerHTML = '';
        
        // Add new chips
        suggestions.forEach(suggestion => {
            const chip = document.createElement('button');
            chip.className = 'suggestion-chip';
            chip.textContent = suggestion;
            chip.addEventListener('click', () => {
                this.elements.chatInput.value = suggestion;
                this.elements.chatInput.focus();
                this.sendMessage();
            });
            
            this.elements.suggestionChipsContainer.appendChild(chip);
        });
        
        // Show the container
        this.elements.suggestionChipsContainer.classList.remove('hidden');
    }

    // Render Mermaid charts
    async renderMermaidChart() {
        try {
            await mermaid.run({
                nodes: document.querySelectorAll('.mermaid')
            });
        } catch (error) {
            console.error('Mermaid rendering error:', error);
            const containers = document.querySelectorAll('.mermaid-container');
            containers.forEach(container => {
                container.innerHTML = '<p class="text-red-500 text-sm">Could not render visual plan.</p>';
            });
        }
    }

    // Setup Mermaid download button
    setupMermaidDownloadButton() {
        const downloadButtons = document.querySelectorAll('#download-png-btn');
        downloadButtons.forEach(btn => {
            btn.addEventListener('click', () => this.downloadMermaidAsPNG(btn));
        });
    }

    // Download Mermaid chart as PNG
    downloadMermaidAsPNG(buttonElement) {
        const mermaidContainer = buttonElement.closest('.digest-section').querySelector('.mermaid-container');
        
        if (!mermaidContainer || typeof html2canvas === 'undefined') {
            console.error("Mermaid container or html2canvas library not found.");
            return;
        }
        
        html2canvas(mermaidContainer, { backgroundColor: '#ffffff' }).then(canvas => {
            const a = document.createElement("a");
            a.href = canvas.toDataURL("image/png");
            a.download = "askarti-diagram.png";
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        });
    }

    // Setup interactive elements like copy buttons
    setupInteractiveElements() {
        const copyButtons = document.querySelectorAll('.copy-btn');
        copyButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                const target = e.currentTarget.parentElement.querySelector('.copy-target');
                if (target) {
                    navigator.clipboard.writeText(target.innerText).then(() => {
                        const originalContent = e.currentTarget.innerHTML;
                        e.currentTarget.classList.add('copied');
                        e.currentTarget.innerHTML = `
                            <svg class="checkmark" viewBox="0 0 24 24">
                                <path d="M9 12l2 2 4-4"></path>
                            </svg>
                            <span>Copied!</span>
                        `;
                        
                        const parent = e.currentTarget.parentElement;
                        parent.classList.add('copy-flash');
                        
                        setTimeout(() => {
                            e.currentTarget.classList.remove('copied');
                            e.currentTarget.innerHTML = originalContent;
                            parent.classList.remove('copy-flash');
                        }, 2000);
                    }).catch(err => {
                        console.error('Failed to copy text: ', err);
                    });
                }
            });
        });
    }

    // STRUCTURED OUTPUT RENDERERS
    // These are the same rendering functions from the original code but adapted for in-chat display

    // RENDERER 1: DAILY DIGEST
    renderDailyDigest(data) {
        const { 
            digest_date, key_intelligence, deal_drivers, action_items, 
            market_temperature, status 
        } = data;
        const sources = deal_drivers && deal_drivers.length > 0 ? [...new Set(deal_drivers.map(d => d.source))].join(' â€¢ ') : 'Internal Analysis';
        const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });

        return `
            <div class="results-card-body" style="max-width: 100%; box-sizing: border-box;">
                <header class="digest-header" style="max-width: 100%;">
                    <img src="/images/arti_right.png" alt="Arti" />
                    <div style="flex: 1; min-width: 0;">
                        <h2 style="word-wrap: break-word;">Daily News</h2>
                        <p class="digest-header-meta">${date}<br>MARKET TEMP: ${market_temperature || 'COOL'}</p>
                    </div>
                </header>
                <section class="digest-section" style="max-width: 100%;">
                    <h3 class="digest-section-title">Key Intelligence</h3>
                    <p class="digest-item-summary text-base" style="max-width: 100%; word-wrap: break-word; overflow-wrap: break-word;">${key_intelligence}</p>
                </section>
                ${deal_drivers && deal_drivers.length > 0 ? `
                <section class="digest-section" style="max-width: 100%;">
                    <h3 class="digest-section-title">Today's Deal Drivers</h3>
                    ${deal_drivers.map((driver, index) => `
                        <div class="digest-item" style="max-width: 100%;">
                            <div class="digest-item-number">${index + 1}</div>
                            <div style="min-width: 0; flex: 1;">
                                <h4 class="digest-item-headline" style="word-wrap: break-word;">
                                    ${driver.link ? `<a href="${driver.link}" target="_blank" rel="noopener noreferrer">${driver.headline}</a>` : driver.headline}
                                </h4>
                                <p class="digest-item-summary" style="word-wrap: break-word; overflow-wrap: break-word;">${driver.summary}</p>
                                <p class="digest-item-insight" style="word-wrap: break-word; overflow-wrap: break-word;">â†’ ${driver.action_insight}</p>
                                <div class="digest-item-meta"><span class="text-xs text-gray-500 font-semibold">${driver.source ? driver.source.toUpperCase() : ''}</span></div>
                            </div>
                        </div>`).join('')}
                </section>` : ''}
                ${data.quick_intel && data.quick_intel.length > 0 ? `
                <section class="digest-section" style="max-width: 100%;">
                    <h3 class="digest-section-title">Quick Intel</h3>
                    <div class="space-y-2">
                    ${data.quick_intel.map(item => `
                        <p class="digest-item-summary" style="word-wrap: break-word; overflow-wrap: break-word;">
                            <strong class="font-semibold text-gray-900">${item.category}:</strong> ${item.insight}
                        </p>
                    `).join('')}
                    </div>
                </section>
                ` : ''}
                ${action_items && action_items.length > 0 ? `
                <section class="digest-section" style="max-width: 100%;">
                    <h3 class="digest-section-title">Your Moves Today</h3>
                    ${action_items.map((action, index) => `
                        <div class="digest-item" style="max-width: 100%;">
                            <div class="digest-item-number">${index + 1}</div>
                            <div style="min-width: 0; flex: 1;">
                                <h4 class="digest-item-headline" style="word-wrap: break-word;">${action.action}</h4>
                                <p class="digest-item-summary" style="word-wrap: break-word; overflow-wrap: break-word;">${action.why}</p>
                            </div>
                        </div>`).join('')}
                </section>` : ''}
                <footer class="digest-section" style="max-width: 100%;">
                    <h3 class="digest-section-title">Sources</h3>
                    <p class="text-sm text-gray-600" style="word-wrap: break-word;">${sources}</p>
                </footer>
            </div>`;
    }

    // RENDERER 2: SALES PLAYBOOK
    renderSalesPlaybook(data) {
        const { 
            sales_play_title, sales_play_summary, key_services, key_partners, 
            competitive_positioning, success_metrics, timeline_milestones, 
            target_personas, insider_tips, risk_mitigation, next_actions, mermaid_chart 
        } = data;
        
        const renderSimpleList = (items) => items?.map(item => `<li class="digest-item-summary">${item}</li>`).join('') || '';

        return `
            <div class="results-card-body">
                <header class="digest-header">
                    <img src="/images/arti_right.png" alt="Arti" />
                    <div>
                        <h2>${sales_play_title}</h2>
                        <p class="digest-header-meta">Sales Playbook</p>
                    </div>
                </header>
                <section class="digest-section">
                    <h3 class="digest-section-title">Executive Summary</h3>
                    <p class="digest-item-summary text-base">${sales_play_summary}</p>
                </section>
                ${key_services && key_services.length > 0 ? `
                <section class="digest-section">
                    <h3 class="digest-section-title">Key Services & Products</h3>
                    <ul class="list-disc list-inside space-y-2">${renderSimpleList(key_services)}</ul>
                </section>` : ''}
                ${key_partners && key_partners.length > 0 ? `
                <section class="digest-section">
                    <h3 class="digest-section-title">Strategic Partners</h3>
                    <ul class="list-disc list-inside space-y-2">${renderSimpleList(key_partners)}</ul>
                </section>` : ''}
                ${competitive_positioning ? `
                <section class="digest-section">
                    <h3 class="digest-section-title">Competitive Positioning</h3>
                    <p class="digest-item-summary">${competitive_positioning}</p>
                </section>` : ''}
                ${success_metrics && success_metrics.length > 0 ? `
                <section class="digest-section">
                    <h3 class="digest-section-title">Success Metrics & Timeline</h3>
                    <ul class="list-disc list-inside space-y-2">${renderSimpleList(success_metrics)}</ul>
                </section>` : ''}
                ${mermaid_chart ? `
                <section class="digest-section">
                    <h3 class="digest-section-title">Visual Strategy</h3>
                    <div class="mermaid-container">
                        <div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div>
                    </div>
                    <div class="flex justify-end gap-2 mt-2">
                        <button class="btn btn-secondary text-xs py-1 px-2" id="download-png-btn">Download PNG</button>
                    </div>
                </section>` : ''}
                ${target_personas && target_personas.length > 0 ? `
                <section class="digest-section">
                    <h3 class="digest-section-title">Stakeholder Guide</h3>
                    ${target_personas.map((persona, index) => `
                        <div class="digest-item">
                            <div class="digest-item-number">${index + 1}</div>
                            <div>
                                <h4 class="digest-item-headline">${persona.persona_title}</h4>
                                <p class="digest-item-summary"><strong>Priorities:</strong> ${persona.business_priorities?.join(', ') || 'Not specified'}</p>
                                <p class="digest-item-summary mt-2"><strong>Starters:</strong> ${persona.conversation_starters?.join(', ') || 'Not specified'}</p>
                            </div>
                        </div>`).join('')}
                </section>` : ''}
                 ${next_actions && next_actions.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Next Actions</h3>
                   ${next_actions.map((action, index) => `
                       <div class="digest-item">
                           <div class="digest-item-number">${index + 1}</div>
                           <div>
                               <p class="digest-item-summary">${action}</p>
                           </div>
                       </div>`).join('')}
               </section>` : ''}
           </div>`;
   }

   // RENDERER 3: NEWS & GTM ANALYSIS
   renderNewsAdvice(data) {
       const { 
           quick_take, key_people_and_titles, money_keywords, 
           suggested_discovery_questions, suggested_opening_lines, 
           immediate_actions, strategic_moves, mermaid_chart 
       } = data;

       return `
           <div class="results-card-body">
               <header class="digest-header">
                   <img src="/images/arti_right.png" alt="Arti" />
                   <div>
                       <h2>News & GTM Analysis</h2>
                       <p class="digest-header-meta">Actionable Intelligence</p>
                   </div>
               </header>
               <section class="digest-section">
                   <h3 class="digest-section-title">Quick Take</h3>
                   <p class="digest-item-summary text-base">${quick_take}</p>
               </section>
               ${money_keywords && money_keywords.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Money Keywords</h3>
                   <div>${money_keywords.map(k => `<span class="digest-tag">${k}</span>`).join('')}</div>
               </section>` : ''}
               ${key_people_and_titles && key_people_and_titles.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Key People</h3>
                   <ul class="list-disc list-inside space-y-2">${key_people_and_titles.map(p => `<li class="digest-item-summary">${p}</li>`).join('')}</ul>
               </section>` : ''}
               ${suggested_discovery_questions && suggested_discovery_questions.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Discovery Questions</h3>
                   ${suggested_discovery_questions.map((q, index) => `
                       <div class="digest-item">
                           <div class="digest-item-number">${index + 1}</div>
                           <div><p class="digest-item-summary">${q}</p></div>
                       </div>`).join('')}
               </section>` : ''}
               ${suggested_opening_lines && suggested_opening_lines.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Email Openers</h3>
                   ${suggested_opening_lines.map((line, index) => `
                       <div class="digest-item">
                           <div class="digest-item-number">${index + 1}</div>
                           <div>
                               <div class="digest-code-block copy-target">${line}</div>
                               <button class="copy-btn" title="Copy to clipboard">
                                   <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                               </button>
                           </div>
                       </div>`).join('')}
               </section>` : ''}
               ${mermaid_chart ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">GTM Flow</h3>
                   <div class="mermaid-container">
                       <div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div>
                   </div>
                   <div class="flex justify-end gap-2 mt-2">
                       <button class="btn btn-secondary text-xs py-1 px-2" id="download-png-btn">Download PNG</button>
                   </div>
               </section>` : ''}
               ${immediate_actions && immediate_actions.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Immediate Actions (0-30 Days)</h3>
                   ${immediate_actions.map((action, index) => `
                       <div class="digest-item">
                           <div class="digest-item-number">${index + 1}</div>
                           <div>
                               <h4 class="digest-item-headline">${action.action}</h4>
                               <p class="digest-item-summary">${action.why}</p>
                           </div>
                       </div>`).join('')}
               </section>` : ''}
           </div>`;
   }

   // RENDERER 4: INVESTMENT / MARKET ANALYSIS
   renderMarketAnalysis(data) {
       const { 
           investment_thesis, executive_summary, key_people_mentioned, leadership_quotes,
           financial_health, market_position, bull_signals, bear_signals, 
           key_financial_metrics, segment_analysis, guidance_and_outlook,
           bull_case, bear_case, missing_information, analyst_price_targets, next_catalyst
       } = data;

       return `
           <div class="results-card-body">
               <header class="digest-header">
                   <img src="/images/arti_right.png" alt="Arti" />
                   <div>
                       <h2>Market Analysis</h2>
                       <p class="digest-header-meta">Bull vs Bear</p>
                   </div>
               </header>
               
               <section class="digest-section">
                   <h3 class="digest-section-title">Summary</h3>
                   <p class="digest-item-summary text-base font-semibold">${investment_thesis}</p>
               </section>

               ${executive_summary ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Executive Summary</h3>
                   <p class="digest-item-summary">${executive_summary}</p>
               </section>` : ''}
               
               ${key_financial_metrics && key_financial_metrics.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Key Financial Metrics</h3>
                   <div class="grid grid-cols-1 gap-2">
                       ${key_financial_metrics.map(metric => `<span class="digest-tag">${metric}</span>`).join('')}
                   </div>
               </section>` : ''}

               ${leadership_quotes && leadership_quotes.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Leadership Quotes</h3>
                   ${leadership_quotes.map((item, index) => `
                       <div class="digest-item">
                           <div class="digest-item-number">${index + 1}</div>
                           <div>
                               <h4 class="digest-item-headline">${item.person}</h4>
                               <div class="digest-code-block mb-2">"${item.quote}"</div>
                               <div class="text-xs font-semibold ${
                                   item.bull_or_bear_signal === 'bull' ? 'text-green-600' : 
                                   item.bull_or_bear_signal === 'bear' ? 'text-red-600' : 'text-gray-600'
                               }">
                                   ${item.bull_or_bear_signal?.toUpperCase()} SIGNAL
                               </div>
                           </div>
                       </div>`).join('')}
               </section>` : ''}

               <section class="digest-section">
                   <h3 class="digest-section-title">Bull vs Bear Signals</h3>
                   <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                       ${bull_signals && bull_signals.length > 0 ? `
                       <div>
                           <h4 class="font-semibold text-green-600 mb-2">ðŸ‚ Bull Signals</h4>
                           <ul class="list-disc list-inside space-y-1 text-sm">
                               ${bull_signals.map(signal => `<li class="text-green-700">${signal}</li>`).join('')}
                           </ul>
                       </div>` : ''}
                       
                       ${bear_signals && bear_signals.length > 0 ? `
                       <div>
                           <h4 class="font-semibold text-red-600 mb-2">ðŸ» Bear Signals</h4>
                           <ul class="list-disc list-inside space-y-1 text-sm">
                               ${bear_signals.map(signal => `<li class="text-red-700">${signal}</li>`).join('')}
                           </ul>
                       </div>` : ''}
                   </div>
               </section>

               <section class="digest-section">
                   <h3 class="digest-section-title">Investment Cases</h3>
                   <div class="space-y-4">
                       <div class="p-3 bg-green-50 border-l-4 border-green-400 rounded">
                           <h4 class="font-semibold text-green-800 mb-2">Bull Case</h4>
                           <p class="text-green-700 digest-item-summary">${bull_case || 'Not specified'}</p>
                       </div>
                       <div class="p-3 bg-red-50 border-l-4 border-red-400 rounded">
                           <h4 class="font-semibold text-red-800 mb-2">Bear Case</h4>
                           <p class="text-red-700 digest-item-summary">${bear_case || 'Not specified'}</p>
                       </div>
                   </div>
               </section>

               ${next_catalyst ? `
               <footer class="digest-section">
                   <h3 class="digest-section-title">Next Catalyst</h3>
                   <p class="digest-item-summary font-semibold">${next_catalyst}</p>
               </footer>` : ''}
           </div>`;
   }

   // RENDERER 5: PROSPECTING INTELLIGENCE
   renderProspectAdvice(data) {
       const { 
           summary, top_s_is, top_software_and_cloud, 
           naics_codes, prospect_recommendations 
       } = data;
       
       const renderPartnerList = (items) => items?.map(item => `<div class="mb-2"><h4 class="font-semibold text-gray-800">${item.company || 'N/A'}</h4><p class="text-sm text-gray-600">${item.value || ''}</p></div>`).join('') || '';

       return `
           <div class="results-card-body">
               <header class="digest-header">
                   <img src="/images/arti_right.png" alt="Arti" />
                   <div>
                       <h2>Prospecting Intelligence</h2>
                       <p class="digest-header-meta">Market Analysis</p>
                   </div>
               </header>
               <section class="digest-section">
                   <h3 class="digest-section-title">Summary</h3>
                   <p class="digest-item-summary text-base">${summary}</p>
               </section>
               ${top_s_is && top_s_is.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Top Service Providers / SIs</h3>
                   <div>${renderPartnerList(top_s_is)}</div>
               </section>` : ''}
               ${top_software_and_cloud && top_software_and_cloud.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Top Software & Cloud Partners</h3>
                   <div>${renderPartnerList(top_software_and_cloud)}</div>
               </section>` : ''}
               ${naics_codes && naics_codes.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">NAICS Codes</h3>
                   <div>${naics_codes.map(k => `<span class="digest-tag">${k.code || k}</span>`).join('')}</div>
               </section>` : ''}
               ${prospect_recommendations && prospect_recommendations.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Recommendations</h3>
                   <ul class="list-disc list-inside space-y-2">${prospect_recommendations.map(p => `<li class="digest-item-summary">${p}</li>`).join('')}</ul>
               </section>` : ''}
           </div>`;
   }

   // RENDERER 6: GENERAL ADVICE (Deal, Interview, Meeting)
   renderGeneralAdvice(data) {
       const { 
           response_type, quick_take, key_moves, talking_points, 
           email_template, next_steps, mermaid_chart 
       } = data;

       const titles = {
           deal: 'Deal Game Plan',
           interview: 'Interview Prep Plan',
           meeting: 'Meeting Strategy',
           default: 'Your Game Plan'
       };
       const title = titles[response_type] || titles.default;

       return `
           <div class="results-card-body">
               <header class="digest-header">
                   <img src="/images/arti_right.png" alt="Arti" />
                   <div>
                       <h2>${title}</h2>
                       <p class="digest-header-meta">Actionable Advice</p>
                   </div>
               </header>
               <section class="digest-section">
                   <h3 class="digest-section-title">Quick Take</h3>
                   <p class="digest-item-summary text-base">${quick_take}</p>
               </section>
               ${key_moves && key_moves.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Your Next Moves</h3>
                   ${key_moves.map((move, index) => `
                       <div class="digest-item">
                           <div class="digest-item-number">${index + 1}</div>
                           <div>
                               <h4 class="digest-item-headline">${move.action}</h4>
                               <p class="digest-item-summary">${move.why}</p>
                           </div>
                       </div>`).join('')}
               </section>` : ''}
               ${mermaid_chart ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Visual Strategy</h3>
                   <div class="mermaid-container">
                       <div id="mermaid-diagram" class="mermaid">${mermaid_chart}</div>
                   </div>
                   <div class="flex justify-end gap-2 mt-2">
                       <button class="btn btn-secondary text-xs py-1 px-2" id="download-png-btn">Download PNG</button>
                   </div>
               </section>` : ''}
               ${talking_points && talking_points.length > 0 ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Key Talking Points</h3>
                   <ul class="list-disc list-inside space-y-2">${talking_points.map(p => `<li class="digest-item-summary">${p}</li>`).join('')}</ul>
               </section>` : ''}
               ${email_template ? `
               <section class="digest-section">
                   <h3 class="digest-section-title">Email Template</h3>
                   <div class="digest-code-block copy-target">${email_template}</div>
                   <button class="copy-btn" title="Copy to clipboard">
                       <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                   </button>
               </section>` : ''}
               ${next_steps ? `
               <footer class="digest-section">
                   <h3 class="digest-section-title">Closing Thought</h3>
                   <p class="digest-item-summary">${next_steps}</p>
               </footer>` : ''}
           </div>`;
   }
}

// Initialize the app when DOM is ready
document.addEventListener('DOMContentLoaded', () => {
   const app = new AskArti();
   window.askArti = app;
   
   // Add dot-typing animation style dynamically to avoid it being in the main CSS block
   const style = document.createElement('style');
   style.textContent = `
       .dot-typing {
           position: relative;
           display: inline-block;
           width: 6px;
           height: 6px;
           margin-right: 3px;
           background-color: currentColor;
           border-radius: 50%;
           opacity: 0.7;
           animation: dotTyping 1.5s infinite linear;
       }
       
       @keyframes dotTyping {
           0% { opacity: 0.2; transform: scale(0.8); }
           20% { opacity: 1; transform: scale(1); }
           50% { opacity: 0.2; transform: scale(0.8); }
           100% { opacity: 0.2; transform: scale(0.8); }
       }
   `;
   document.head.appendChild(style);
}); 
    </script>
</body>
</html>